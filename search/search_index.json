{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"Home","text":"\u5f00\u59cb\u9605\u8bfb \u6309\u6807\u7b7e\u6d4f\u89c8 \u9879\u76ee \u5173\u4e8e\u6211 GitHub"},{"location":"about/","title":"About","text":""},{"location":"about/#about","title":"About","text":"<p>To be continue...</p>"},{"location":"posts/","title":"Posts","text":""},{"location":"posts/#_1","title":"\ud83d\udcda \u6240\u6709\u535a\u6587","text":"<p>\u6b22\u8fce\u6d4f\u89c8\u6211\u64b0\u5199\u7684\u6240\u6709\u6587\u7ae0\u3002</p>"},{"location":"posts/#_2","title":"\ud83d\udd16 \u6587\u7ae0\u5217\u8868","text":"<ul> <li>CLIP\uff1a\u591a\u6a21\u6001\u4e4b\u94a5</li> <li>DeepSeek-Coder\u5de5\u7a0b\u5316\u65b9\u6848</li> <li>DeepSeek-R1\uff1a\u901a\u8fc7\u5f3a\u5316\u5b66\u4e60\u6fc0\u52b1LLM\u63a8\u7406\u80fd\u529b</li> <li>DeepSeek-V3\u662f\u5982\u4f55\u70bc\u6210\u7684</li> <li>DeepSeekMath\u8bba\u6587\u7cbe\u8bfb</li> <li>GRPO\u539f\u7406\u53ca\u4e0e\u76f8\u5173\u5bf9\u6bd4</li> <li>GradScaler\u7684\u6570\u5b66\u539f\u7406\u7b80\u8ff0</li> <li>LoRA\uff1a\u5927\u6a21\u578b\u7684\u4f4e\u79e9\u5bc6\u8bed</li> <li>PPO\u539f\u7406\u53ca\u907f\u5751\u6307\u5357</li> <li>Position Embedding\u4e4b\u6211\u89c1</li> <li>RoPE\uff1a\u76f8\u5bf9\u8ddd\u79bb\u611f\u77e5\u7684\u79d8\u5bc6</li> <li>TFDS vs WebDataset</li> <li>ZeRO\u4f18\u5316\u5668\u8bbe\u8ba1\u7406\u5ff5\u89e3\u6790</li> <li>\u4e3a\u4f55FP16\u8bad\u7ec3\u65f6\u68af\u5ea6\u5bb9\u6613\u4e0b\u6ea2\u4e3a0\uff1f</li> <li>\u6807\u51c6\u6570\u636e\u5e76\u884c\uff08DP\uff09\u8bad\u7ec3\u6d41\u7a0b\u89e3\u6790</li> <li>\u878d\u6c47\u8d2f\u901aRL\u4e2d\u7684\u4ef7\u503c\u51fd\u6570\u4e0e\u4f18\u52bf\u51fd\u6570</li> </ul>"},{"location":"posts/CLIP%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E4%B9%8B%E9%92%A5/","title":"CLIP\uff1a\u591a\u6a21\u6001\u4e4b\u94a5","text":"\u6807\u7b7e\uff1a CLIP\u591a\u6a21\u6001LLM","tags":["CLIP","\u591a\u6a21\u6001","LLM"]},{"location":"posts/CLIP%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E4%B9%8B%E9%92%A5/#1-clip","title":"1. \u5f15\u8a00\uff08\u4ec0\u4e48\u662f CLIP\uff09","text":"<p>CLIP\uff08Contrastive Language-Image Pretraining\uff0c\u5bf9\u6bd4\u5f0f\u8bed\u8a00-\u56fe\u50cf\u9884\u8bad\u7ec3\uff09\u662f OpenAI \u4e8e 2021 \u5e74\u53d1\u5e03\u7684\u4e00\u79cd\u591a\u6a21\u6001\u6a21\u578b\u3002\u5b83\u901a\u8fc7\u56fe\u50cf-\u6587\u672c\u5bf9\u6bd4\u5b66\u4e60\u540c\u65f6\u8bad\u7ec3\u56fe\u50cf\u7f16\u7801\u5668\u548c\u6587\u672c\u7f16\u7801\u5668\uff0c\u5c06\u56fe\u50cf\u4e0e\u81ea\u7136\u8bed\u8a00\u6620\u5c04\u5230\u5171\u540c\u7684\u5d4c\u5165\u8868\u793a\u7a7a\u95f4\u3002\u4e0e\u4f20\u7edf\u56fe\u50cf\u5206\u7c7b\u6a21\u578b\u8f93\u51fa\u56fa\u5b9a\u7c7b\u522b\u6807\u7b7e\u4e0d\u540c\uff0cCLIP \u63a5\u53d7\u4e00\u5f20\u56fe\u7247\u548c\u4e00\u6bb5\u6587\u672c\u63cf\u8ff0\u4f5c\u4e3a\u8f93\u5165\uff0c\u8f93\u51fa\u8868\u793a\u4e8c\u8005\u8bed\u4e49\u76f8\u5173\u6027\u7684\u5206\u6570\u6216\u8ddd\u79bb\u3002\u6362\u8a00\u4e4b\uff0cCLIP \u80fd\u5224\u65ad\u4efb\u610f\u4e00\u5f20\u56fe\u7247\u4e0e\u4efb\u610f\u4e00\u6bb5\u6587\u5b57\u63cf\u8ff0\u662f\u5426\u5339\u914d\uff0c\u800c\u65e0\u9700\u5c06\u56fe\u7247\u9650\u5236\u5728\u9884\u5b9a\u4e49\u7684\u7c7b\u522b\u96c6\u5408\u4e2d\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4f7f CLIP \u80fd\u76f4\u63a5\u5229\u7528\u81ea\u7136\u8bed\u8a00\u4f5c\u4e3a\u6807\u7b7e\uff0c\u5b9e\u73b0\u5f00\u653e\u9886\u57df\u7684\u56fe\u50cf\u8bc6\u522b\u4e0e\u68c0\u7d22\u3002</p> <p>\u6a21\u578b\u7ed3\u6784\uff1aCLIP \u5305\u542b\u4e24\u8def\u7f16\u7801\u5668\uff1a\u4e00\u4e2a\u56fe\u50cf\u7f16\u7801\u5668\u548c\u4e00\u4e2a\u6587\u672c\u7f16\u7801\u5668\u3002\u56fe\u50cf\u7f16\u7801\u5668\u53ef\u4ee5\u91c7\u7528\u4f20\u7edf\u5377\u79ef\u7f51\u7edc\uff08\u5982 ResNet\uff09\u6216\u89c6\u89c9Transformer\uff08ViT\uff09\u63d0\u53d6\u56fe\u50cf\u7279\u5f81\uff1b\u6587\u672c\u7f16\u7801\u5668\u901a\u5e38\u662f Transformer\uff08\u7c7b\u4f3c GPT-\u7cfb\u5217\uff09\u5c06\u6587\u672c\u8f6c\u6362\u4e3a\u5411\u91cf\u8868\u793a\u3002\u5728\u7f16\u7801\u5668\u8f93\u51fa\u4e4b\u540e\uff0c\u5206\u522b\u63a5\u4e00\u5c42\u53ef\u5b66\u4e60\u7684\u7ebf\u6027\u6295\u5f71\uff0c\u5c06\u56fe\u50cf\u7279\u5f81\u548c\u6587\u672c\u7279\u5f81\u6295\u5f71\u5230\u540c\u4e00\u7ef4\u5ea6\u7684\u5171\u4eab\u5d4c\u5165\u7a7a\u95f4\u3002\u4e3a\u4e86\u8ba9\u4e0d\u540c\u6a21\u6001\u7684\u8868\u793a\u76f4\u63a5\u53ef\u6bd4\uff0c\u5bf9\u5e94\u7684\u5d4c\u5165\u5411\u91cf\u901a\u5e38\u4f1a\u8fdb\u884c L2 \u6b63\u5219\u5316\u4ee5\u7ea6\u675f\u5728\u5355\u4f4d\u7403\u9762\u4e0a\uff0c\u8fd9\u6837\u4e24\u4e2a\u5d4c\u5165\u7684\u5185\u79ef\u5c31\u5bf9\u5e94\u4f59\u5f26\u76f8\u4f3c\u5ea6\u3002CLIP \u7684\u8f93\u5165\u5305\u62ec\u4e00\u7ec4\u6210\u5bf9\u7684\u56fe\u50cf\u548c\u6587\u672c\u63cf\u8ff0\\((I_i, T_i)\\)\uff1b\u8f93\u51fa\u5219\u662f\u56fe\u50cf\u548c\u6587\u672c\u5728\u5171\u540c\u7a7a\u95f4\u4e2d\u7684\u5d4c\u5165\u5411\u91cf\uff0c\u4ee5\u53ca\u7531\u6b64\u8ba1\u7b97\u51fa\u7684\u76f8\u4f3c\u5ea6\u77e9\u9635\u3002\u5728\u63a8\u7406\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u56fe\u50cf\u5d4c\u5165\u4e0e\u4efb\u610f\u6587\u672c\u5d4c\u5165\u8fdb\u884c\u6bd4\u8f83\uff0c\u76f8\u4f3c\u5ea6\u8d8a\u9ad8\u8868\u793a\u56fe\u7247\u8d8a\u53ef\u80fd\u4e0e\u8be5\u6587\u672c\u5339\u914d\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0cCLIP \u80fd\u7528\u4e8e\u5f00\u653e\u96c6\u7684\u96f6\u6837\u672c\u5206\u7c7b\u3001\u8de8\u6a21\u6001\u641c\u7d22\u7b49\u4efb\u52a1\u3002</p> <p>\u8bad\u7ec3\u76ee\u6807\uff1a CLIP \u7684\u8bad\u7ec3\u4efb\u52a1\u88ab\u5b9a\u4e49\u4e3a\uff1a\u7ed9\u5b9a\u4e00\u4e2a\u6279\u6b21\u7684\\(N\\)\u5bf9\u56fe\u6587\\((I_i, T_i)\\)\uff0c\u6a21\u578b\u9700\u8981\u9884\u6d4b\u54ea\u4e9b\u56fe\u50cf\u548c\u6587\u672c\u662f\u6b63\u786e\u5339\u914d\u7684\u5bf9\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u56fe\u50cf\\(I_i\\)\uff0c\u914d\u5bf9\u7684\u6587\u672c\\(T_i\\)\u5e94\u8be5\u5728\u6240\u6709\u6587\u672c\u4e2d\u83b7\u5f97\u6700\u9ad8\u7684\u5339\u914d\u5206\u6570\uff1b\u540c\u6837\u6bcf\u4e2a\u6587\u672c\u5bf9\u5176\u914d\u5bf9\u56fe\u50cf\u4e5f\u5e94\u5f97\u5206\u6700\u9ad8\u3002\u4e3a\u6b64\uff0cCLIP \u5728\u8bad\u7ec3\u4e2d\u4f7f\u7528\u5bf9\u6bd4\u5b66\u4e60\u7684\u7b56\u7565\uff0c\u6700\u5927\u5316\u771f\u5b9e\u5339\u914d\u5bf9\u5728\u5d4c\u5165\u7a7a\u95f4\u7684\u4f59\u5f26\u76f8\u4f3c\u5ea6\uff0c\u6700\u5c0f\u5316\u4e0d\u5339\u914d\u5bf9\u7684\u76f8\u4f3c\u5ea6\u3002\u6574\u4e2a\u8bad\u7ec3\u901a\u8fc7\u4f18\u5316\u4e00\u4e2a\u5bf9\u79f0\u7684\u8de8\u71b5\u635f\u5931\u51fd\u6570\u6765\u5b9e\u73b0\u4e0a\u8ff0\u76ee\u6807\u3002\u5bf9\u4e8e\u4efb\u610f\u4e00\u5bf9\\((I_i, T_i)\\)\uff0c\u5b9a\u4e49\u5d4c\u5165\u76f8\u4f3c\u5ea6\\(\\text{sim}(I_i,T_j)=I_e{(i)} \\cdot T_e{(j)}\\)\uff08\u901a\u5e38\u4e3a\u5185\u79ef\uff0c\u5df2\u9690\u542b\u6e29\u5ea6\u53c2\u6570\u7f29\u653e\uff09\uff0c\u5219\u56fe\u50cf\\(I_i\\)\u5bf9\u5e94\u6b63\u786e\u6587\u672c\\(T_i\\)\u7684\u6982\u7387\u53ef\u8868\u793a\u4e3a\uff1a</p> \\[ P_{i\\to j} = \\frac{\\exp(\\text{sim}(I_i, T_j)/\\tau)}{\\sum_{k=1}^N \\exp(\\text{sim}(I_i, T_k)/\\tau)} , \\] <p>\u5176\u4e2d\\(\\tau\\)\u662f\u53ef\u5b66\u4e60\u7684\u6e29\u5ea6\u53c2\u6570\uff0c\u63a7\u5236softmax\u5206\u5e03\u7684\u5cf0\u5ea6\u3002CLIP \u7684\u56fe\u50cf\u5230\u6587\u672c\u65b9\u5411\u635f\u5931\u4e3a\u6240\u6709\u6b63\u786e\u5339\u914d\u7684\u5bf9\u6570\u4f3c\u7136\uff1a</p> \\[ L_{i2t} = -\\sum_{i=1}^N \\log \\frac{\\exp(\\text{sim}(I_i, T_i)/\\tau)}{\\sum_{j=1}^N \\exp(\\text{sim}(I_i, T_j)/\\tau)} . \\] <p>\u540c\u7406\uff0c\u6587\u672c\u5230\u56fe\u50cf\u7684\u635f\u5931\u4e3a</p> \\[ L_{t2i} = -\\sum_{i=1}^N \\log \\frac{\\exp(\\text{sim}(I_i, T_i)/\\tau)}{\\sum_{j=1}^N \\exp(\\text{sim}(I_j, T_i)/\\tau)} . \\] <p>\u603b\u635f\u5931\u53d6\u4e24\u8005\u5e73\u5747\uff1a\\(L = \\frac{1}{2}(L_{i2t} + L_{t2i})\\)\u3002\u76f4\u89c2\u6765\u8bf4\uff0c\u8be5\u635f\u5931\u8feb\u4f7f\u6a21\u578b\u5c06\u6bcf\u5bf9\u6b63\u786e\u56fe\u6587\u7684\u76f8\u4f3c\u5ea6\u63a8\u9ad8\uff0c\u5bf9\u6bcf\u4e2a\u9519\u8bef\u7684\u7ec4\u5408\u7ed9\u4e88\u4f4e\u76f8\u4f3c\u5ea6\uff0c\u4ece\u800c\u5728\u5d4c\u5165\u7a7a\u95f4\u62c9\u8fd1\u771f\u5b9e\u5339\u914d\u7684\u56fe\u6587\u5411\u91cf\uff0c\u62c9\u8fdc\u4e0d\u76f8\u5173\u7684\u56fe\u6587\u5411\u91cf\u3002\u8bad\u7ec3\u5b8c\u6210\u540e\uff0cCLIP \u5728\u5171\u540c\u7a7a\u95f4\u5b66\u5f97\u4e86\u56fe\u50cf\u4e0e\u6587\u672c\u4e4b\u95f4\u7684\u5bf9\u9f50\u8868\u793a\uff0c\u4e3a\u5404\u79cd\u4e0b\u6e38\u4efb\u52a1\u63d0\u4f9b\u4e86\u901a\u7528\u4e14\u53ef\u8fc1\u79fb\u7684\u7279\u5f81\u3002</p> <p></p> <p>\u56fe 1\uff1aCLIP\u7684\u6574\u4f53\u67b6\u6784\u4e0e\u4efb\u52a1\u793a\u610f\u3002\uff081\uff09\u5bf9\u6bd4\u5f0f\u9884\u8bad\u7ec3\uff1a\u5728\u6bcf\u4e2a\u8bad\u7ec3\u6279\u6b21\uff0cCLIP \u63a5\u6536\\(N\\)\u5bf9\u56fe\u50cf\u548c\u6587\u672c\uff0c\u5c06\u5b83\u4eec\u5206\u522b\u7f16\u7801\u4e3a\u56fe\u50cf\u7279\u5f81\\(I_i\\) \u548c\u6587\u672c\u7279\u5f81\\(T_j\\)\uff0c\u8ba1\u7b97\u5f97\u5230\\(N\\times N\\) \u7684\u76f8\u4f3c\u5ea6\u77e9\u9635\\(I_i \\cdot T_j\\)\u3002\u8bad\u7ec3\u76ee\u6807\u662f\u8ba9\u5bf9\u89d2\u7ebf\u4e0a\u7684\u771f\u5b9e\u5339\u914d\u5bf9\uff08\u5982\\(I_1\\)-\\(T_1\\)\uff09\u7684\u76f8\u4f3c\u5ea6\u9ad8\u4e8e\u5176\u4ed6\u975e\u5339\u914d\u7ec4\u5408\u3002\uff082\uff09\u4ece\u7c7b\u522b\u6807\u7b7e\u6587\u672c\u6784\u9020\u6570\u636e\u96c6\u5206\u7c7b\u5668\uff1a\u5c06\u76ee\u6807\u6570\u636e\u96c6\u7684\u7c7b\u522b\u540d\u63d2\u5165\u6a21\u677f\uff08\u5982 \"A photo of a {object}.\"\uff09\u751f\u6210\u6587\u672c\u63cf\u8ff0\uff0c\u901a\u8fc7 CLIP \u7684\u6587\u672c\u7f16\u7801\u5668\u5f97\u5230\u5404\u7c7b\u522b\u7684\u6587\u672c\u5d4c\u5165\u3002\uff083\uff09\u96f6\u6837\u672c\u9884\u6d4b\uff1a\u7ed9\u5b9a\u4e00\u5f20\u5f85\u5206\u7c7b\u56fe\u7247\uff0c\u7528\u56fe\u50cf\u7f16\u7801\u5668\u83b7\u5f97\u56fe\u50cf\u5d4c\u5165\uff0c\u4e0e\u6240\u6709\u7c7b\u522b\u6587\u672c\u5d4c\u5165\u8ba1\u7b97\u76f8\u4f3c\u5ea6\uff0c\u9009\u62e9\u5206\u6570\u6700\u9ad8\u7684\u7c7b\u522b\u4f5c\u4e3a\u6a21\u578b\u9884\u6d4b\u3002</p>","tags":["CLIP","\u591a\u6a21\u6001","LLM"]},{"location":"posts/CLIP%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E4%B9%8B%E9%92%A5/#2-clip","title":"2. \u80cc\u666f\u53ca\u52a8\u673a\uff08\u4e3a\u4ec0\u4e48\u9700\u8981 CLIP\uff09","text":"<p>\u201c\u5178\u578b\u7684\u89c6\u89c9\u6a21\u578b\u5f80\u5f80\u5404\u81ea\u4e3a\u6218\u4e14\u9ad8\u5ea6\u4f9d\u8d56\u4eba\u5de5\u6807\u6ce8\u6570\u636e\uff0c\u8fd9\u9650\u5236\u4e86\u5b83\u4eec\u7684\u901a\u7528\u6027\u548c\u53ef\u6269\u5c55\u6027\u201d\u3002 \u5728 CLIP \u51fa\u73b0\u4e4b\u524d\uff0c\u8ba1\u7b97\u673a\u89c6\u89c9\u9886\u57df\u4e3b\u6d41\u7684\u65b9\u6cd5\u662f\u4f7f\u7528\u9650\u5b9a\u7c7b\u522b\u7684\u4eba\u5de5\u6807\u6ce8\u6570\u636e\u96c6\uff08\u5982 ImageNet\uff09\u8bad\u7ec3\u5206\u7c7b\u7f51\u7edc\u3002\u8fd9\u5e26\u6765\u4e86\u51e0\u5927\u5c40\u9650\uff1a</p> <ul> <li>\u6570\u636e\u96c6\u72ed\u7a84\u4e14\u6602\u8d35\uff1a\u9ad8\u8d28\u91cf\u7684\u6807\u6ce8\u56fe\u50cf\u6570\u636e\u96c6\u5236\u4f5c\u6210\u672c\u9ad8\u4e14\u6db5\u76d6\u6982\u5ff5\u6709\u9650\uff0c\u6bcf\u4e2a\u6570\u636e\u96c6\u53ea\u80fd\u6559\u4f1a\u6a21\u578b\u4e00\u5c0f\u90e8\u5206\u89c6\u89c9\u6982\u5ff5\u3002\u4e00\u65e6\u9700\u8981\u8bc6\u522b\u65b0\u7c7b\u522b\uff0c\u5c31\u5fc5\u987b\u6536\u96c6\u65b0\u6570\u636e\u5e76\u91cd\u65b0\u8bad\u7ec3\u7279\u5b9a\u6a21\u578b\u3002</li> <li>\u6a21\u578b\u8fc1\u79fb\u80fd\u529b\u5f31\uff1a\u4f20\u7edf\u76d1\u7763\u6a21\u578b\u901a\u5e38\u4e13\u6ce8\u5355\u4e00\u4efb\u52a1\uff0c\u96be\u4ee5\u9002\u5e94\u65b0\u4efb\u52a1\u6216\u65b0\u9886\u57df\u3002\u4f8b\u5982\uff0c\u7528 ImageNet \u8bad\u7ec3\u7684\u5206\u7c7b\u5668\u5728\u672a\u89c1\u8fc7\u7684\u7c7b\u522b\u4e0a\u51e0\u4e4e\u65e0\u6cd5\u76f4\u63a5\u6cdb\u5316\uff0c\u9700\u8981\u7ecf\u8fc7\u5fae\u8c03\u624d\u80fd\u5e94\u7528\u5230\u4e0d\u540c\u6570\u636e\u96c6\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u7684\u901a\u7528\u6027\u548c\u96f6\u6837\u672c\u80fd\u529b\u5f88\u5dee\u3002</li> <li>\u9c81\u68d2\u6027\u95ee\u9898\uff1a\u5728\u57fa\u51c6\u6d4b\u8bd5\u4e0a\u8868\u73b0\u4f18\u5f02\u7684\u6a21\u578b\uff0c\u5728\u5206\u5e03\u5916\u6570\u636e\u6216\u5e72\u6270\u6761\u4ef6\u4e0b\u8868\u73b0\u4f1a\u663e\u8457\u4e0b\u964d\u3002\u7814\u7a76\u53d1\u73b0\u8bb8\u591a\u76d1\u7763\u6a21\u578b\u5728\u5bf9\u6297\u6837\u672c\u3001\u5206\u5e03\u8fc1\u79fb\u7b49\u201c\u538b\u529b\u6d4b\u8bd5\u201d\u4e0b\u6027\u80fd\u5d29\u6e83\u3002\u8fd9\u5bf9\u6a21\u578b\u7684\u5b9e\u7528\u6027\u548c\u5bf9\u6df1\u5ea6\u5b66\u4e60\u65b9\u6cd5\u7684\u53ef\u9760\u6027\u63d0\u51fa\u8d28\u7591\u3002</li> </ul> <p>\u591a\u6a21\u6001\u5bf9\u9f50\u7684\u5fc5\u8981\u6027\uff1a\u4e3a\u4e86\u7a81\u7834\u4e0a\u8ff0\u5c40\u9650\uff0c\u7814\u7a76\u8005\u8ba4\u8bc6\u5230\u9700\u8981\u4e00\u79cd\u80fd\u591f\u5229\u7528\u6d77\u91cf\u975e\u7ed3\u6784\u5316\u6570\u636e\u7684\u65b0\u8303\u5f0f\u3002\u81ea\u7136\u8bed\u8a00\u4f5c\u4e3a\u6807\u7b7e\u5177\u6709\u65e0\u9650\u7684\u7075\u6d3b\u6027\u548c\u4fe1\u606f\u91cf\uff0c\u53ef\u4ee5\u63cf\u8ff0\u4efb\u4f55\u89c6\u89c9\u6982\u5ff5\u3002\u5982\u679c\u6a21\u578b\u80fd\u76f4\u63a5\u4ece\u7f51\u7edc\u4e2d\u4e30\u5bcc\u7684\u56fe\u50cf-\u6587\u672c\u5bf9\u4e2d\u5b66\u4e60\uff0c\u5c31\u4e0d\u518d\u5c40\u9650\u4e8e\u4eba\u5de5\u5b9a\u4e49\u7684\u72ed\u7a84\u7c7b\u522b\u96c6\u5408\u3002\u5728 NLP \u9886\u57df\uff0c\u9884\u8bad\u7ec3\u8bed\u8a00\u6a21\u578b\uff08\u5982 GPT \u7cfb\u5217\uff09\u6b63\u662f\u901a\u8fc7\u5728\u6d77\u91cf\u6587\u672c\u4e0a\u5b66\u4e60\u901a\u7528\u8868\u793a\uff0c\u5b9e\u73b0\u4e86\u8de8\u4efb\u52a1\u7684\u96f6\u6837\u672c\u8fc1\u79fb\u3002\u8fd9\u79cd\u542f\u53d1\u4fc3\u4f7f\u89c6\u89c9\u9886\u57df\u63a2\u7d22\u7c7b\u4f3c\u7684\u65b9\u6cd5\uff1a\u5c06\u81ea\u7136\u8bed\u8a00\u76d1\u7763\u5f15\u5165\u89c6\u89c9\u6a21\u578b\u8bad\u7ec3\uff0c\u4ee5\u83b7\u5f97\u66f4\u5177\u6cdb\u5316\u80fd\u529b\u7684\u89c6\u89c9\u8868\u793a\u3002</p> <p>CLIP \u7684\u8303\u5f0f\u8f6c\u53d8\uff1aCLIP \u6b63\u662f\u5728\u8fd9\u4e00\u80cc\u666f\u4e0b\u63d0\u51fa\uff0c\u4ee3\u8868\u4e86\u4e00\u79cd\u201c\u9884\u8bad\u7ec3+\u63d0\u793a\u201d\u7684\u65b0\u8303\u5f0f\uff0c\u88ab\u8a89\u4e3a\u89c6\u89c9\u9886\u57df\u7684\u201cGPT \u65f6\u523b\u201d\u3002\u4e0d\u540c\u4e8e\u4f20\u7edf\u76f4\u63a5\u9884\u6d4b\u56fa\u5b9a\u6807\u7b7e\uff0cCLIP \u5c06\u6587\u5b57\u5d4c\u5165\u4f5c\u4e3a\u8f93\u51fa\u7a7a\u95f4\uff0c\u4f7f\u6a21\u578b\u53ef\u4ee5\u901a\u8fc7\u8f93\u5165\u81ea\u7136\u8bed\u8a00\u6307\u4ee4\u6765\u6267\u884c\u8bc6\u522b\u4efb\u52a1\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u96f6\u6837\u672c\u5b66\u4e60\u6210\u4e3a\u53ef\u80fd\uff1a\u7ed9\u5b9a\u5168\u65b0\u7684\u5206\u7c7b\u4efb\u52a1\uff0c\u53ea\u9700\u63d0\u4f9b\u5404\u7c7b\u522b\u7684\u6587\u672c\u63cf\u8ff0\uff0cCLIP \u5373\u53ef\u5728\u65e0\u9700\u989d\u5916\u8bad\u7ec3\u7684\u60c5\u51b5\u4e0b\u5b8c\u6210\u5206\u7c7b\u3002\u4f8b\u5982\uff0cOpenAI \u62a5\u544a\u663e\u793a\uff0cCLIP \u7684 ResNet-50 \u6a21\u578b\u5728\u672a\u4f7f\u7528\u4efb\u4f55 ImageNet \u8bad\u7ec3\u6837\u672c\u7684\u60c5\u51b5\u4e0b\uff0c\u96f6\u6837\u672c\u5206\u7c7b\u51c6\u786e\u7387\u5339\u914d\u4e86\u539f\u59cbResNet-50\u5728 ImageNet \u4e0a\u7684\u6c34\u5e73\u3002\u8fd9\u610f\u5473\u7740\u65e0\u9700\u4e3a\u6bcf\u4e2a\u65b0\u4efb\u52a1\u6536\u96c6\u6807\u6ce8\u6570\u636e\uff0c\u6a21\u578b\u5373\u53ef\u901a\u8fc7\u8bed\u8a00\u63a5\u53e3\u7075\u6d3b\u6cdb\u5316\u5230\u65b0\u9886\u57df\u3002</p> <p>\u6b64\u5916\uff0cCLIP \u5f15\u5165\u4e86Prompt Engineering\uff08\u63d0\u793a\u5de5\u7a0b\uff09 \u7684\u6982\u5ff5\u6765\u63d0\u5347\u96f6\u6837\u672c\u6027\u80fd\u3002\u5177\u4f53\u505a\u6cd5\u662f\u4e3a\u6587\u672c\u7f16\u7801\u5668\u8bbe\u8ba1\u5408\u7406\u7684\u6a21\u677f\uff08\u5982\u5728\u7c7b\u522b\u540d\u524d\u6dfb\u52a0\"a photo of a ...\"\uff0c\u800c\u975e\u76f4\u63a5\u4f7f\u7528\u5355\u8bcd\uff09\uff0c\u4ee5\u63d0\u4f9b\u66f4\u591a\u4e0a\u4e0b\u6587\u3002\u8fd9\u79cd\u6280\u5de7\u53ef\u4ee5\u6709\u6548\u63d0\u9ad8\u6a21\u578b\u5224\u522b\u7ec6\u7c92\u5ea6\u7c7b\u522b\u7684\u51c6\u786e\u6027\u3002\u7814\u7a76\u8868\u660e\uff0c\u76f8\u6bd4\u76f4\u63a5\u4f7f\u7528\u5355\u72ec\u7684\u7c7b\u540d\uff0c\u7cbe\u5fc3\u8bbe\u8ba1\u63d0\u793a\u548c\u96c6\u6210\u591a\u4e2a\u63d0\u793a\u53ef\u4f7f\u96f6\u6837\u672c\u5206\u7c7b\u51c6\u786e\u7387\u63d0\u9ad8\u7ea65\u4e2a\u767e\u5206\u70b9\u3002</p> <p>\u603b\u4e4b\uff0cCLIP \u5e26\u6765\u7684\u8303\u5f0f\u8f6c\u79fb\u5728\u4e8e\uff1a\u6a21\u578b\u4e0d\u518d\u5c40\u9650\u4e8e\u9884\u5b9a\u8f93\u51fa\u7a7a\u95f4\uff0c\u800c\u662f\u901a\u8fc7\u5bf9\u9f50\u56fe\u50cf\u548c\u81ea\u7136\u8bed\u8a00\uff0c\u5b9e\u73b0\u201c\u4e00\u6a21\u591a\u7528\u201d\u3002\u8fd9\u6781\u5927\u63d0\u5347\u4e86\u89c6\u89c9\u6a21\u578b\u7684\u901a\u7528\u6027\u3001\u53ef\u8fc1\u79fb\u6027\u548c\u9c81\u68d2\u6027\u3002\u5728\u8d85\u8fc730\u4e2a\u5404\u5f02\u7684\u6570\u636e\u96c6\u4e0a\uff0cCLIP \u7684\u96f6\u6837\u672c\u8fc1\u79fb\u6027\u80fd\u4e0e\u6709\u76d1\u7763\u6a21\u578b\u76f8\u5f53\uff0c\u4e14\u5bf9\u5206\u5e03\u504f\u79fb\u66f4\u52a0\u7a33\u5065\u3002\u53ef\u4ee5\u8bf4\uff0cCLIP \u5c06\u8ba1\u7b97\u673a\u89c6\u89c9\u4ece\u4e13\u95e8\u7684\u5c01\u95ed\u4efb\u52a1\u62d3\u5c55\u4e3a\u5f00\u653e\u8bcd\u6c47\u7a7a\u95f4\uff0c\u4ece\u800c\u5f00\u542f\u4e86\u8de8\u6a21\u6001\u7406\u89e3\u7684\u65b0\u7bc7\u7ae0\u3002</p>","tags":["CLIP","\u591a\u6a21\u6001","LLM"]},{"location":"posts/CLIP%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E4%B9%8B%E9%92%A5/#3-clip","title":"3. \u5b9e\u73b0\u7ec6\u8282\uff08\u5982\u4f55\u8bad\u7ec3 CLIP\uff09","text":"<p>\u8bad\u7ec3\u6570\u636e\uff1a CLIP \u7684\u6210\u529f\u5f88\u5927\u7a0b\u5ea6\u4e0a\u4f9d\u8d56\u4e8e\u5927\u89c4\u6a21\u7684\u8bad\u7ec3\u8bed\u6599\u3002OpenAI \u4f7f\u7528\u4e86\u6765\u81ea\u4e92\u8054\u7f51\u4e0a\u7684\u7ea6 4\u4ebf\u5bf9\u56fe\u50cf-\u6587\u672c\u5bf9\u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\u3002\u8fd9\u4e9b\u56fe\u6587\u5bf9\u5e76\u975e\u4eba\u5de5\u6807\u6ce8\uff0c\u800c\u662f\u5229\u7528\u7f51\u7edc\u4e0a\u7684\u73b0\u6210\u63cf\u8ff0\uff08\u5982\u56fe\u7247\u7684\u6807\u9898\u3001\u5468\u8fb9\u6587\u672c\u7b49\uff09\u81ea\u52a8\u6536\u96c6\uff0c\u56e0\u6b64\u6570\u636e\u8986\u76d6\u9762\u6781\u5e7f\u4f46\u4e5f\u76f8\u5bf9\u5608\u6742\u3002\u4e0e\u7cbe\u5fc3\u6e05\u6d17\u7684\u5c0f\u578b\u6570\u636e\u96c6\u4e0d\u540c\uff0cCLIP \u5927\u80c6\u91c7\u7528\u4e86\u6d77\u91cf\u5f31\u6807\u6ce8\u6570\u636e\uff0c\u5e76\u51ed\u501f\u6570\u91cf\u53d6\u80dc\uff1a\u5373\u4f7f\u5305\u542b\u566a\u58f0\uff0c\u4e30\u5bcc\u591a\u6837\u7684\u6837\u672c\u4e5f\u8db3\u4ee5\u8ba9\u6a21\u578b\u5b66\u5230\u7a33\u5065\u7684\u56fe\u6587\u6620\u5c04\u5173\u7cfb\u3002\u4e8b\u5b9e\u8bc1\u660e\uff0c\u5728\u5982\u6b64\u89c4\u6a21\u7684\u6570\u636e\u4e0a\u8bad\u7ec3\uff0c\u5bf9\u8fc7\u62df\u5408\u7684\u62c5\u5fe7\u53cd\u800c\u964d\u4f4e\uff0c\u56e0\u6b64\u65e0\u9700\u4f7f\u7528\u8fc7\u591a\u590d\u6742\u7684\u6b63\u5219\u5316\u6216\u6570\u636e\u589e\u5e7f\u6280\u5de7\u3002</p> <p>\u6a21\u578b\u67b6\u6784\uff1a\u5982\u524d\u6240\u8ff0\uff0cCLIP \u7531\u72ec\u7acb\u7684\u56fe\u50cf\u7f16\u7801\u5668\u548c\u6587\u672c\u7f16\u7801\u5668\u6784\u6210\uff0c\u5b83\u4eec\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u6743\u91cd\u4e0d\u5171\u4eab\u3002OpenAI \u5c1d\u8bd5\u4e86\u4e24\u7c7b\u56fe\u50cf\u7f16\u7801\u5668\u67b6\u6784\uff1a\u4e00\u662f\u6539\u8fdb\u7248\u7684 ResNet\uff08\u4f8b\u5982 ResNet-50x4\u3001x16 \u7b49\u5bbd\u5ea6\u52a0\u5927\u7684\u53d8\u4f53\uff09\uff1b\u4e8c\u662f Vision Transformer (ViT) \u7cfb\u5217\u3002ResNet \u7248\u672c\u878d\u5165\u4e86\u4e00\u4e9b\u4f18\u5316\uff08\u5982ResNet-D\u548c\u6297\u6df7\u53e0\u6c60\u5316\uff09\u4ee5\u63d0\u5347\u6027\u80fd\uff1bViT \u7248\u672c\u5219\u57fa\u672c\u6cbf\u7528\u539f\u59cb ViT \u7684\u8bbe\u8ba1\uff0c\u53ea\u5728\u62fc\u63a5Patch\u5d4c\u5165\u540e\u589e\u52a0\u4e86\u4e00\u5c42 LayerNorm \u5e76\u8c03\u6574\u521d\u59cb\u5316\u7b56\u7565\u3002\u6587\u672c\u7f16\u7801\u5668\u4f7f\u7528\u4e00\u4e2a12\u5c42\u3001\u5bbd\u5ea6512\u7684 Transformer\uff0c\u53c2\u6570\u7ea66300\u4e07\u3002\u6587\u672c\u9996\u5148\u7ecf\u8fc7 Byte Pair Encoding (BPE) \u5f97\u5230\u8bcd\u5e8f\u5217\uff08\u8bcd\u8868\u5927\u5c0f\u7ea649\u4e07\uff09\uff0c\u5e8f\u5217\u957f\u5ea6\u4e0a\u9650\u4e3a76\u3002\u5728Transformer\u7f16\u7801\u65f6\uff0c\u91c7\u7528\u4e0eGPT\u7c7b\u4f3c\u7684\u67b6\u6784\uff08\u5305\u542b[SOS]\u548c[EOS]\u6807\u8bb0\uff0c\u6700\u7ec8\u62bd\u53d6 [EOS] \u4f4d\u7684\u9876\u5c42\u9690\u72b6\u6001\u4f5c\u4e3a\u6587\u672c\u8868\u793a\uff09\u3002\u9700\u8981\u6ce8\u610f\uff0c\u6587\u672c\u7f16\u7801\u5668\u91c7\u7528\u4e86\u5355\u5411\u63a9\u7801\u81ea\u6ce8\u610f\uff08\u5373\u56e0\u679cMask\uff09\uff0c\u4ee5\u4fbf\u4fdd\u6301\u4e0e\u9884\u8bad\u7ec3\u8bed\u8a00\u6a21\u578b\u521d\u59cb\u5316\u517c\u5bb9\u7684\u53ef\u80fd\u6027\u3002\u56fe\u50cf\u548c\u6587\u672c\u7f16\u7801\u5668\u5404\u81ea\u8f93\u51fa\u7684\u9ad8\u7ef4\u7279\u5f81\uff08\u5982\u56fe\u50cf\u7279\u5f81\u7ef4\u5ea6\\(d_i\\)\uff0c\u6587\u672c\u7279\u5f81\u7ef4\u5ea6\\(d_t\\)\uff09\u901a\u8fc7\u7ebf\u6027\u5c42\u6295\u5f71\u5230\u7edf\u4e00\u7684\u5d4c\u5165\u7ef4\u5ea6\\(d_e\\)\uff0c\u518d\u7ecf\u9010\u884c\\(L_2\\)\u6b63\u5219\u5316\uff0c\u5f97\u5230\u56fe\u50cf\u5d4c\u5165\\(I_e\\)\u548c\u6587\u672c\u5d4c\u5165\\(T_e\\)\u3002\u6700\u7ec8\u8ba1\u7b97\u4e24\u8005\u7684\u70b9\u79ef\u76f8\u4f3c\u5ea6\uff0c\u518d\u4e58\u4ee5\\(\\exp(t)\\)\u4f5c\u4e3a logits\u3002\u8fd9\u91cc\u7684\\(t\\)\u5373\u53ef\u5b66\u4e60\u6e29\u5ea6\u53c2\u6570\u7684\u5bf9\u6570\u503c\uff0c\u6a21\u578b\u4f1a\u81ea\u52a8\u8c03\u6574\u5b83\u6765\u63a7\u5236\u5206\u5e03\u7684\u71b5\u9ad8\u4f4e\u3002</p> <p>\u8bad\u7ec3\u6d41\u7a0b\uff1aCLIP \u7684\u8bad\u7ec3\u672c\u8d28\u4e0a\u662f\u5728\u505a\u4e00\u4e2a\u5927\u578b\u7684 N \u5bf9 N \u7684\u591a\u5206\u7c7b\u4efb\u52a1\u3002\u6bcf\u4e2a\u8bad\u7ec3\u6b65\u4ece\u6570\u636e\u96c6\u4e2d\u53d6\u51fa\\(N\\)\u5bf9\u56fe\u6587\uff0c\u9001\u5165\u7f16\u7801\u5668\u5f97\u5230\\(N\\)\u4e2a\u56fe\u50cf\u5d4c\u5165\\(I_e\\)\u548c\\(N\\)\u4e2a\u6587\u672c\u5d4c\u5165\\(T_e\\)\u3002\u8ba1\u7b97\u6240\u6709\u56fe\u50cf-\u6587\u672c\u5d4c\u5165\u5bf9\u7684\u4f59\u5f26\u76f8\u4f3c\u5ea6\uff0c\u5f62\u6210\u4e00\u4e2a\\(N\\times N\\)\u7684\u76f8\u4f3c\u5ea6\u77e9\u9635\u3002\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u8be5\u77e9\u9635\u7684\u4e3b\u5bf9\u89d2\u7ebf\u5143\u7d20\uff08\u8868\u793a\u5339\u914d\u7684\u56fe\u6587\u5bf9\uff09\u5e94\u8fdc\u5927\u4e8e\u975e\u5bf9\u89d2\u5143\u7d20\uff08\u8868\u793a\u9519\u914d\u7684\u7ec4\u5408\uff09\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e00\u70b9\uff0c\u91c7\u7528\u4e0a\u8ff0\u5bf9\u79f0\u8de8\u71b5\u635f\u5931\\(L\\)\u6765\u66f4\u65b0\u6a21\u578b\u53c2\u6570\u3002\u6bcf\u4e2a\u6279\u6b21\u7684\u635f\u5931\u7531\u56fe\u50cf\u4f5c\u4e3a\u67e5\u8be2\u548c\u6587\u672c\u4f5c\u4e3a\u67e5\u8be2\u4e24\u4e2a\u65b9\u5411\u7684\u8de8\u71b5\u4e4b\u548c\u6784\u6210\u3002\u5728\u5b9e\u73b0\u4e0a\uff0c\u53ef\u5c06\u76f8\u4f3c\u5ea6\u77e9\u9635\u7684\u7b2c\\(i\\)\u884c\u901a\u8fc7 softmax \u8f6c\u6362\u4e3a\u56fe\u50cf\\(I_i\\)\u5bf9\u5404\u6587\u672c\u5c5e\u4e8e\u5339\u914d\u7684\u6982\u7387\u5206\u5e03\uff08\u7b2c\\(i\\)\u884c\u6b63\u786e\u6807\u7b7e\u5c31\u662f\u4f4d\u7f6e\\(i\\)\uff09\uff0c\u5e76\u5bf9\u6570\u635f\u5931\uff1b\u7b2c\\(i\\)\u5217\u540c\u7406\u8868\u793a\u6587\u672c\\(T_i\\)\u5bf9\u5404\u56fe\u50cf\u7684\u5339\u914d\u6982\u7387\u5e76\u635f\u5931\u3002\u4e24\u4e2a\u635f\u5931\u5e73\u5747\u5373\u4e3a\u6700\u7ec8\u76ee\u6807\u3002OpenAI \u5728\u8bba\u6587\u4e2d\u63d0\u4f9b\u4e86\u6838\u5fc3\u8bad\u7ec3\u903b\u8f91\u7684\u4f2a\u4ee3\u7801\uff1a</p> <pre><code># \u56fe\u50cf\u7f16\u7801\u5668 - ResNet \u6216 ViT\n# \u6587\u672c\u7f16\u7801\u5668 - Transformer\uff08GPT\u6837\u67b6\u6784\uff09\n# I[n, ...]  - \u5305\u542b n \u5f20\u56fe\u50cf\u7684\u6279\u6b21\n# T[n, ...]  - \u5305\u542b n \u6bb5\u6587\u672c\u7684\u6279\u6b21\uff08\u4e0e\u56fe\u50cf\u4e00\u4e00\u5bf9\u5e94\uff09\n# W_i[d_i, d_e] - \u56fe\u50cf\u7279\u5f81\u5230\u5d4c\u5165\u7a7a\u95f4\u7684\u6295\u5f71\u77e9\u9635\n# W_t[d_t, d_e] - \u6587\u672c\u7279\u5f81\u5230\u5d4c\u5165\u7a7a\u95f4\u7684\u6295\u5f71\u77e9\u9635\n# t    - \u53ef\u5b66\u4e60\u7684\u6e29\u5ea6\u53c2\u6570 (log-scale)\nI_f = image_encoder(I)        # \u63d0\u53d6\u56fe\u50cf\u7279\u5f81\uff0c\u5f62\u72b6 [n, d_i]\nT_f = text_encoder(T)         # \u63d0\u53d6\u6587\u672c\u7279\u5f81\uff0c\u5f62\u72b6 [n, d_t]\nI_e = normalize(I_f @ W_i, axis=1)   # \u6295\u5f71\u5e76 L2 \u5f52\u4e00\u5316\u56fe\u50cf\u5d4c\u5165 [n, d_e]\nT_e = normalize(T_f @ W_t, axis=1)   # \u6295\u5f71\u5e76 L2 \u5f52\u4e00\u5316\u6587\u672c\u5d4c\u5165 [n, d_e]\nlogits = I_e @ T_e.T * exp(t)       # \u8ba1\u7b97\u56fe\u6587\u76f8\u4f3c\u5ea6\u77e9\u9635\u5e76\u5e94\u7528\u6e29\u5ea6\u7f29\u653e [n, n]\nlabels = arange(n)\nloss_i = cross_entropy_loss(logits, labels, axis=0)  # \u56fe\u50cf-&gt;\u6587\u672c \u7684\u4ea4\u53c9\u71b5\u635f\u5931\nloss_t = cross_entropy_loss(logits, labels, axis=1)  # \u6587\u672c-&gt;\u56fe\u50cf \u7684\u4ea4\u53c9\u71b5\u635f\u5931\nloss = (loss_i + loss_t) / 2    # \u5bf9\u79f0\u635f\u5931\u53d6\u5e73\u5747\n</code></pre> <p>\u4ee3\u7801\u8bf4\u660e\uff1a<code>logits[i][j] =</code>\\(I_e^{(i)} \\cdot T_e^{(j)} * \\exp(t)\\)\u8868\u793a\u7b2c\\(i\\)\u5f20\u56fe\u4e0e\u7b2c\\(j\\)\u6bb5\u6587\u672c\u7684\u76f8\u4f3c\u5ea6\u5206\u6570\u3002<code>labels = arange(n)</code> \u751f\u62100\u5230\\(n-1\\)\u7684\u6807\u7b7e\u5411\u91cf\uff0c\u8868\u793a\u7b2c\\(i\\)\u884c\uff08\u56fe\u50cf\\(I_i\\)\uff09\u7684\u6b63\u786e\u5339\u914d\u6587\u672c\u7d22\u5f15\u4e3a\\(i\\)\uff0c\u7b2c\\(j\\)\u5217\uff08\u6587\u672c\\(T_j\\)\uff09\u7684\u6b63\u786e\u5339\u914d\u56fe\u50cf\u7d22\u5f15\u4e3a\\(j\\)\u3002<code>loss_i</code> \u5bf9\u6bcf\u4e00\u884c\u6267\u884c softmax \u53ca\u4ea4\u53c9\u71b5\uff0c\u786e\u4fdd\\(I_i\\)\u5728\u7b2c\\(i\\)\u5217\uff08\u5339\u914d\\(T_i\\)\uff09\u53d6\u5f97\u6700\u5927\u6982\u7387\uff1b<code>loss_t</code> \u7c7b\u4f3c\u6309\u5217\u8ba1\u7b97\uff0c\u786e\u4fdd\\(T_i\\)\u5339\u914d\\(I_i\\)\u7684\u6982\u7387\u6700\u5927\u3002\u4e24\u4e2a\u635f\u5931\u5e73\u5747\u5373\u5f97\u5230\u5bf9\u6bd4\u5b66\u4e60\u7684\u76ee\u6807\u3002\u8fd9\u4e2a\u76ee\u6807\u7b49\u4ef7\u4e8e InfoNCE \u635f\u5931\u7684\u4e00\u4e2a\u53d8\u4f53\uff1a\u6700\u5927\u5316\u5339\u914d\u6837\u672c\u7684\u5bf9\u6570\u4f3c\u7136\uff0c\u540c\u65f6\u6700\u5c0f\u5316\u9519\u914d\u6837\u672c\u7684\u76f8\u4f3c\u5ea6\u3002</p> <p>\u8bad\u7ec3\u8d85\u53c2\u6570\uff1aCLIP \u7684\u8bad\u7ec3\u89c4\u6a21\u975e\u5e38\u5927\uff0cOpenAI \u5728\u8bba\u6587\u4e2d\u63d0\u5230\u4f7f\u7528\u4e86 32,768 \u7684\u8d85\u5927\u6279\u6b21\u8fdb\u884c\u5bf9\u6bd4\u5b66\u4e60\uff0c\u5e76\u8bad\u7ec3\u4e86 32 \u4e2a epoch\u3002\u4f18\u5316\u5668\u91c7\u7528 Adam \u914d\u5408\u4f59\u5f26\u9000\u706b\u5b66\u4e60\u7387\u8c03\u5ea6\uff0c\u521d\u59cb\u5b66\u4e60\u7387\u7b49\u8d85\u53c2\u901a\u8fc7\u5728ResNet-50\u4e0a\u7f51\u683c\u641c\u7d22\u786e\u5b9a\uff0c\u7136\u540e\u9488\u5bf9\u66f4\u5927\u6a21\u578b\u7f29\u653e\u8c03\u6574\u3002\u6e29\u5ea6\u53c2\u6570 \\(\\tau\\) \u521d\u59cb\u5316\u4e3a 0.07\uff08\u5bf9\u5e94 \\(t=\\ln(0.07)\\)\uff09\uff0c\u5e76\u5728\u8bad\u7ec3\u4e2d\u4f5c\u4e3a\u53c2\u6570\u76f4\u63a5\u4f18\u5316\uff08\u9650\u5236 \\(|t|&lt;\\ln(100)\\) \u4ee5\u4fdd\u8bc1\u7a33\u5b9a\u6027\uff09\u3002\u5982\u6b64\u5927\u7684\u6279\u6b21\u548c\u6570\u636e\uff0c\u4f7f\u5f97\u6a21\u578b\u8bad\u7ec3\u9700\u8981\u5de8\u5927\u7684\u7b97\u529b\u652f\u6491\uff08\u636e\u62a5\u9053OpenAI\u4f7f\u7528\u4e86256\u4e2aV100 GPU\u5e76\u884c\u8bad\u7ec32\u5468\u4ee5\u4e0a\uff09\u3002\u4e3a\u52a0\u901f\u8bad\u7ec3\u548c\u8282\u7701\u663e\u5b58\uff0c\u4f5c\u8005\u4f7f\u7528\u4e86\u6df7\u5408\u7cbe\u5ea6\u548c\u68af\u5ea6\u68c0\u67e5\u70b9\u7b49\u6280\u5de7\u3002\u5c3d\u7ba1\u5b9e\u73b0\u590d\u6742\uff0c\u4f46\u7531\u4e8e\u5bf9\u6bd4\u5b66\u4e60\u4e0d\u9700\u8981\u4eba\u5de5\u6807\u7b7e\uff0c\u8fd9\u4e00\u8fc7\u7a0b\u5145\u5206\u5229\u7528\u4e86\u6d77\u91cf\u6570\u636e\u7684\u76d1\u7763\u4fe1\u53f7\uff0c\u4f7f\u6a21\u578b\u5b66\u4e60\u5230\u9ad8\u5ea6\u53ef\u8fc1\u79fb\u7684\u56fe\u50cf\u8868\u793a\u3002</p>","tags":["CLIP","\u591a\u6a21\u6001","LLM"]},{"location":"posts/CLIP%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E4%B9%8B%E9%92%A5/#4","title":"4. \u591a\u6a21\u6001\u6a21\u578b\u7684\u53d1\u5c55\u8109\u7edc","text":"<p>CLIP \u7684\u63d0\u51fa\u65e2\u6709\u524d\u4eba\u7684\u6280\u672f\u94fa\u57ab\uff0c\u4e5f\u5f15\u9886\u4e86\u540e\u7eed\u4e00\u7cfb\u5217\u6269\u5c55\u6539\u8fdb\u3002\u4e0b\u9762\u7b80\u8981\u68b3\u7406 CLIP \u4e4b\u524d\u548c\u4e4b\u540e\u6709\u4ee3\u8868\u6027\u7684\u591a\u6a21\u6001\u6a21\u578b\u65b9\u6cd5\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u7279\u70b9\u4e0e\u8fdb\u5c55\u3002</p>","tags":["CLIP","\u591a\u6a21\u6001","LLM"]},{"location":"posts/CLIP%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E4%B9%8B%E9%92%A5/#41-clip","title":"4.1 CLIP \u4e4b\u524d\u7684\u4ee3\u8868\u6027\u591a\u6a21\u6001\u65b9\u6cd5","text":"<ul> <li>VSE++ (2018)\uff1a\u5168\u79f0\u4e3a Visual-Semantic Embeddings++\uff0c\u662f\u65e9\u671f\u56fe\u6587\u8054\u5408\u5d4c\u5165\u7684\u65b9\u6cd5\u3002VSE++ \u63d0\u51fa\u4e86\u5728\u4e09\u5143\u7ec4\u635f\u5931\u4e2d\u5f15\u5165\u96be\u8d1f\u6837\u672c\u6316\u6398\uff0c\u5f3a\u5316\u9519\u914d\u56fe\u6587\u5bf9\u7684\u533a\u5206\u5ea6\uff0c\u4ece\u800c\u663e\u8457\u63d0\u9ad8\u4e86\u56fe\u50cf\u63cf\u8ff0\u68c0\u7d22\u7684\u7cbe\u5ea6\u3002\u6a21\u578b\u4f7f\u7528\u72ec\u7acb\u7684\u56fe\u50cf\u548c\u6587\u672c\u7f16\u7801\uff08\u5982\u9884\u8bad\u7ec3ResNet\u63d0\u53d6\u56fe\u50cf\u5168\u5c40\u7279\u5f81\uff0cLSTM\u63d0\u53d6\u6587\u672c\u7279\u5f81\uff09\uff0c\u901a\u8fc7\u6b63\u5339\u914d\u5bf9\u7684\u8ddd\u79bb\u6700\u5c0f\u5316\u3001\u968f\u673a\u8d1f\u6837\u672c\u5bf9\u7684\u8ddd\u79bb\u6700\u5927\u5316\u6765\u5b66\u4e60\u5171\u540c\u7a7a\u95f4\u8868\u793a\u3002\u5b9e\u9a8c\u8868\u660e\uff0c\u76f8\u6bd4\u4e0d\u8003\u8651\u96be\u8d1f\u4f8b\u7684\u57fa\u7ebf\uff0cVSE++ \u5728 MS-COCO\u3001Flickr30K \u7b49\u56fe\u6587\u68c0\u7d22\u4efb\u52a1\u7684\u8bc4\u4ef7\u6307\u6807\u4e0a\u6709\u5927\u5e45\u63d0\u5347\u3002\u5b83\u8bc1\u660e\u4e86\u5bf9\u6bd4\u635f\u5931+\u96be\u6837\u672c\u6316\u6398\u5728\u8de8\u6a21\u6001\u68c0\u7d22\u4e2d\u7684\u6709\u6548\u6027\uff0c\u662f CLIP \u7b49\u540e\u7eed\u5de5\u4f5c\u7684\u65e9\u671f\u542f\u53d1\u4e4b\u4e00\u3002</li> <li>ViLBERT (2019)\uff1a\u662f\u5c06 BERT \u6269\u5c55\u5230\u89c6\u89c9\u548c\u8bed\u8a00\u53cc\u6a21\u6001\u7684\u6a21\u578b\u3002ViLBERT \u91c7\u7528Two-Stream\uff08\u53cc\u6d41\uff09\u67b6\u6784\uff0c\u5373\u56fe\u50cf\u548c\u6587\u672c\u5404\u6709\u4e00\u5957\u81ea\u6ce8\u610f\u529b\u7f16\u7801\u5668\uff0c\u4e8c\u8005\u5728\u82e5\u5e72\u5c42\u901a\u8fc7Co-attention\uff08\u534f\u540c\u6ce8\u610f\uff09\u4ea4\u4e92\u3002\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u56fe\u50cf\u901a\u5e38\u4ee5\u533a\u57df\u7279\u5f81\u8868\u793a\uff08\u5229\u7528\u9884\u8bad\u7ec3\u7684\u76ee\u6807\u68c0\u6d4b\u6a21\u578b\u5982 Faster R-CNN \u63d0\u53d6\u591a\u4e2a\u5bf9\u8c61\u533a\u57df\u7684\u89c6\u89c9\u7279\u5f81\uff09\uff0c\u6587\u672c\u4ee5\u8bcd\u5e8f\u5217\u8868\u793a\uff0c\u4e24\u8def\u5728\u4e2d\u95f4\u5c42\u901a\u8fc7\u7279\u6b8a\u7684\u4e92\u6ce8\u610f\u529b\u5355\u5143\u8ba9\u56fe\u50cf\u533a\u57df\u548c\u8bcd\u8bed\u4ea4\u4e92\u8ba1\u7b97\u5173\u6ce8\u6743\u91cd\u3002\u8fd9\u79cd\u7ed3\u6784\u5728\u4fdd\u6301\u5355\u6a21\u6001\u7f16\u7801\u5668\u5404\u81ea\u9884\u8bad\u7ec3\u80fd\u529b\u7684\u540c\u65f6\uff0c\u5b9e\u73b0\u4e86\u7ec6\u7c92\u5ea6\u7684\u8de8\u6a21\u6001\u5bf9\u9f50\u3002ViLBERT \u5728VQA\uff08\u89c6\u89c9\u95ee\u7b54\uff09\u3001VR\uff08\u89c6\u89c9\u63a8\u7406\uff09\u7b49\u4efb\u52a1\u4e0a\u53d6\u5f97\u5f53\u65f6\u6700\u4f73\u6210\u7ee9\uff0c\u5c55\u793a\u4e86\u53cc\u6d41\u8de8\u6a21\u6001Transformer\u7684\u5f3a\u5927\u5efa\u6a21\u80fd\u529b\u3002</li> <li>VisualBERT (2019)\uff1a\u4e0e ViLBERT \u4e0d\u540c\uff0cVisualBERT \u91c7\u7528Single-Stream\uff08\u5355\u6d41\uff09\u67b6\u6784\uff0c\u5c06\u56fe\u50cf\u548c\u6587\u672c\u4fe1\u606f\u76f4\u63a5\u62fc\u63a5\u540e\u8f93\u5165\u540c\u4e00\u4e2a Transformer \u7f16\u7801\u5668\u3002\u5b83\u76f8\u5f53\u4e8e\u5728\u539f\u59cb BERT \u6a21\u578b\u4e2d\u52a0\u5165\u89c6\u89c9\u8bcd\uff1a\u6bcf\u5e45\u56fe\u50cf\u7528\u82e5\u5e72\u5bf9\u8c61\u533a\u57df\u7279\u5f81\u5411\u91cf\u8868\u793a\uff0c\u5e76\u9644\u52a0\u4e0a\u7c7b\u578b\u5d4c\u5165\u4ee5\u533a\u5206\u89c6\u89c9/\u6587\u672c\u6a21\u6001\uff0c\u518d\u4e0e\u6587\u672c\u5e8f\u5217\u4e00\u8d77\u8f93\u5165Transformer\u3002Transformer \u81ea\u6ce8\u610f\u529b\u673a\u5236\u80fd\u591f\u5728\u5355\u6d41\u67b6\u6784\u4e2d\u81ea\u52a8\u5b66\u4e60\u56fe\u50cf\u533a\u57df\u4e0e\u5355\u8bcd\u4e4b\u95f4\u7684\u5bf9\u5e94\u5173\u7cfb\u3002VisualBERT \u901a\u5e38\u4ee5 COCO \u7b49\u56fe\u6587\u63cf\u8ff0\u6570\u636e\u96c6\u8fdb\u884c\u9884\u8bad\u7ec3\uff08\u4efb\u52a1\u5305\u62ec\u56fe\u6587\u5339\u914d\u5224\u522b\u3001\u906e\u7f69\u8bed\u8a00\u6a21\u578b\u7b49\uff09\uff0c\u7136\u540e\u5fae\u8c03\u5230\u4e0b\u6e38\u4efb\u52a1\u3002\u5b83\u5728\u56fe\u6587\u68c0\u7d22\u3001VQA\u7b49\u4efb\u52a1\u4e0a\u53d6\u5f97\u4e86\u5f88\u5f3a\u7684\u6027\u80fd\uff0c\u8bc1\u660e\u4e86\u8054\u5408\u7f16\u7801\u591a\u6a21\u6001\u7279\u5f81\u7684\u53ef\u884c\u6027\u3002</li> <li>UNITER (2020)\uff1a\u5168\u79f0 UNiversal Image-TExt Representation\uff0c\u662f\u5355\u6d41\u67b6\u6784\u7684\u8fdb\u4e00\u6b65\u53d1\u5c55\u3002UNITER \u5c06\u591a\u4e2a\u56fe\u6587\u6570\u636e\u96c6\uff08COCO, Visual Genome, Conceptual Captions \u7b49\u5171900\u4e07\u5bf9\u56fe\u6587\uff09\u8054\u5408\u9884\u8bad\u7ec3\uff0c\u901a\u8fc7\u591a\u4efb\u52a1\u5b66\u4e60\uff08\u5305\u62ec\u906e\u7f69\u8bed\u8a00\u5efa\u6a21\u3001\u906e\u7f69\u56fe\u50cf\u533a\u57df\u9884\u6d4b\u3001\u56fe\u6587\u5bf9\u9f50\u5224\u522b\u3001\u8bcd-\u533a\u57df\u5bf9\u9f50\u7b49\u4efb\u52a1\uff09\u6765\u63d0\u5347\u8de8\u6a21\u6001\u8868\u793a\u7684\u9c81\u68d2\u6027\u3002\u4e0eVisualBERT\u76f8\u6bd4\uff0cUNITER \u6570\u636e\u66f4\u5927\u4e14\u8bad\u7ec3\u76ee\u6807\u66f4\u4e30\u5bcc\uff0c\u4f7f\u5176\u5728\u4e0b\u6e38\u4efb\u52a1\uff08\u5982VQA\u3001\u56fe\u6587\u68c0\u7d22\u3001\u63a8\u7406\u7b49\uff09\u4e0a\u5168\u9762\u8d85\u8d8a\u5148\u524d\u6a21\u578b\u3002\u5f53\u65f6UNITER \u5728\u591a\u9879Benchmark\u4e0a\u5237\u65b0SOTA\uff0c\u88ab\u89c6\u4e3a\u8de8\u6a21\u6001\u9884\u8bad\u7ec3\u7684\u4e00\u5ea7\u91cc\u7a0b\u7891\u3002\u5b83\u8868\u660e\uff0c\u901a\u8fc7\u8054\u5408\u5927\u89c4\u6a21\u6570\u636e\u548c\u591a\u4efb\u52a1\u8bad\u7ec3\uff0c\u53ef\u4ee5\u5b66\u5230\u901a\u7528\u7684\u8de8\u6a21\u6001\u8868\u793a\uff0c\u4e3a\u540e\u6765\u7684CLIP\u63d0\u4f9b\u4e86\u7ecf\u9a8c\u501f\u9274\u3002</li> </ul>","tags":["CLIP","\u591a\u6a21\u6001","LLM"]},{"location":"posts/CLIP%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E4%B9%8B%E9%92%A5/#42-clip","title":"4.2 CLIP \u4e4b\u540e\u7684\u6539\u8fdb\u4e0e\u62d3\u5c55\u65b9\u6cd5","text":"<ul> <li>ALIGN (2021, Google)\uff1a\u4e0e CLIP \u51e0\u4e4e\u540c\u671f\u51fa\u73b0\u7684\u4e00\u9879\u5de5\u4f5c\uff0c\u5168\u79f0\u201cA Large-scale Image and Noisy Text embedding\u201d\u3002ALIGN \u7684\u6838\u5fc3\u601d\u60f3\u4e0e CLIP \u76f8\u4f3c\uff1a\u91c7\u7528\u53cc\u5854\u5f0f\uff08dual-encoder\uff09\u7684\u56fe\u50cf\u7f16\u7801\u5668+\u6587\u672c\u7f16\u7801\u5668\u7ed3\u6784\uff0c\u4f18\u5316\u8de8\u6a21\u6001\u5bf9\u6bd4\u635f\u5931\uff0c\u5c06\u56fe\u6587\u6620\u5c04\u5230\u5171\u540c\u7a7a\u95f4\u3002\u5176\u7a81\u51fa\u4eae\u70b9\u5728\u4e8e\u5229\u7528\u4e86\u89c4\u6a21\u66f4\u5927\u7684 1.8B\uff08\u5341\u516b\u4ebf\uff09\u5bf9\u56fe\u6587\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u6765\u81ea\u7f51\u7edc\u722c\u53d6\u7684\u56fe\u50cfalt\u6587\u672c\uff0c\u672a\u7ecf\u4e25\u683c\u6e05\u6d17\u3002\u8c37\u6b4c\u7814\u7a76\u4eba\u5458\u8bc1\u660e\uff0c\u5373\u4f7f\u6570\u636e\u975e\u5e38\u5608\u6742\uff0c\u6781\u5927\u7684\u6570\u91cf\u4e5f\u80fd\u5f25\u8865\u8d28\u91cf\u4e0d\u8db3\uff0c\u4ece\u800c\u8bad\u7ec3\u51fa\u66f4\u5f3a\u7684\u6a21\u578b\u3002ALIGN \u4f7f\u7528 EfficientNet-L2 \u4f5c\u4e3a\u56fe\u50cf\u7f16\u7801 backbone\u3001BERT-Large \u4f5c\u4e3a\u6587\u672c\u7f16\u7801\uff0c\u6a21\u578b\u53c2\u6570\u89c4\u6a21\u9ad8\u8fbe8\u4ebf\u3002\u5b9e\u9a8c\u663e\u793a\uff0cALIGN \u5728\u56fe\u6587\u68c0\u7d22\u7b49\u4efb\u52a1\u4e0a\u6bd4\u540c\u65f6\u671f\u7684 CLIP \u66f4\u80dc\u4e00\u7b79\uff0c\u5728 Flickr30K\u3001COCO \u68c0\u7d22\u4e2d\u53d6\u5f97\u65b0\u7684\u96f6\u6837\u672c SOTA\u3002ALIGN \u8868\u660e\uff0c\u7b80\u5355\u7684\u5bf9\u6bd4\u5b66\u4e60\u7b56\u7565\u5728\u6570\u636e\u548c\u6a21\u578b\u89c4\u6a21\u4e0a\u4ecd\u6709\u5de8\u5927\u6f5c\u529b\uff0c\u901a\u8fc7\u5927\u6570\u636e\u201c\u7c97\u517b\u201d\uff0c\u8de8\u6a21\u6001\u6a21\u578b\u6027\u80fd\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63d0\u5347\u3002</li> <li>SLIP (2021, Facebook/Berkeley)\uff1a\u5168\u79f0\u201cSelf-Supervision meets Language-Image Pre-training\u201d\uff0c\u63d0\u51fa\u5c06\u81ea\u76d1\u7763\u89c6\u89c9\u9884\u8bad\u7ec3\u4e0e CLIP \u7684\u56fe\u6587\u5bf9\u6bd4\u5b66\u4e60\u76f8\u7ed3\u5408\u3002SLIP \u5728\u8bad\u7ec3\u65f6\u589e\u52a0\u4e86\u4e00\u652f SimCLR \u98ce\u683c\u7684\u56fe\u50cf-\u56fe\u50cf\u5bf9\u6bd4\u635f\u5931\uff1a\u5bf9\u6bcf\u5f20\u56fe\u50cf\u9664\u539f\u59cb\u89c6\u56fe\u5916\u518d\u968f\u673a\u6570\u636e\u589e\u5f3a\u751f\u6210\u53e6\u4e00\u89c6\u56fe\uff0c\u4e24\u89c6\u56fe\u901a\u8fc7SimCLR\u635f\u5931\u5b66\u4e60\u56fe\u50cf\u5185\u90e8\u8868\u5f81\u3002\u540c\u65f6\uff0c\u7b2c\u4e09\u89c6\u56fe\u4e0e\u6587\u672c\u6784\u6210\u539f\u59cbCLIP\u635f\u5931\u3002\u6700\u7ec8\u603b\u635f\u5931\u662f\u56fe\u50cf-\u6587\u672c\u5bf9\u6bd4\u548c\u56fe\u50cf-\u56fe\u50cf\u81ea\u76d1\u7763\u7684\u52a0\u6743\u548c\u3002\u901a\u8fc7\u591a\u4efb\u52a1\u8bad\u7ec3\uff0cSLIP \u83b7\u5f97\u7684\u56fe\u50cf\u7279\u5f81\u6bd4\u5355\u7eafCLIP\u66f4\u5f3a\uff0c\u5728\u76f8\u540c\u6570\u636e\u4e0a SLIP \u5728\u96f6\u6837\u672c\u5206\u7c7b\u3001\u7ebf\u6027\u8bc4\u4f30\u3001\u5fae\u8c03\u4e09\u79cd\u8bc4\u6d4b\u4e0b\u5747\u8d85\u8fc7 CLIP\u3002\u8fd9\u8bf4\u660e\u52a0\u5165\u56fe\u50cf\u81ea\u76d1\u7763\u4fe1\u53f7\u80fd\u63d0\u9ad8\u56fe\u50cf\u7f16\u7801\u5668\u7684\u6cdb\u5316\u6027\u80fd\uff0c\u5373\u4f7f\u8bed\u8a00\u76d1\u7763\u6570\u636e\u89c4\u6a21\u4e0d\u53d8\uff0c\u4e5f\u80fd\u8fdb\u4e00\u6b65\u63d0\u5347\u8868\u793a\u8d28\u91cf\u3002SLIP \u7279\u522b\u6709\u5229\u4e8e\u4e2d\u7b49\u89c4\u6a21\u6570\u636e\u96c6\u7684\u8bad\u7ec3\u60c5\u5883\uff0c\u88ab\u8ba4\u4e3a\u662f\u5bf9\u6bd4\u5b66\u4e60\u548c\u81ea\u76d1\u7763\u5b66\u4e60\u7684\u6709\u6548\u878d\u5408\u63a2\u7d22\u3002</li> <li>BLIP (2022, Salesforce)\uff1a\u5168\u79f0\u201cBootstrapping Language-Image Pre-training\u201d\uff0c\u65e8\u5728\u7edf\u4e00\u89c6\u89c9-\u8bed\u8a00\u7406\u89e3\u548c\u751f\u6210\u4e24\u7c7b\u4efb\u52a1\u7684\u9884\u8bad\u7ec3\u6846\u67b6\u3002\u4e0e CLIP \u7b49\u53ea\u9488\u5bf9\u7406\u89e3\u4efb\u52a1\u4e0d\u540c\uff0cBLIP \u901a\u8fc7\u8bbe\u8ba1\u591a\u5143\u635f\u5931\uff0c\u65e2\u9002\u7528\u4e8e\u68c0\u7d22\u3001VQA\u7b49\u5224\u522b\u4efb\u52a1\uff0c\u53c8\u80fd\u7528\u4e8e\u56fe\u50cf\u63cf\u8ff0\u751f\u6210\u7b49\u751f\u6210\u4efb\u52a1\u3002\u5176\u521b\u65b0\u5728\u4e8e\u81ea\u4e3e\u5f0f\u6570\u636e\u4f18\u5316\uff1a\u5148\u7528\u4e00\u4e2a\u73b0\u6709\u56fe\u50cf\u63cf\u8ff0\u6a21\u578b\uff08captioner\uff09\u4e3a\u7f51\u7edc\u56fe\u6587\u6570\u636e\u751f\u6210\u66f4\u51c6\u786e\u7684\u63cf\u8ff0\uff0c\u518d\u7528\u8fc7\u6ee4\u5668\u53bb\u9664\u566a\u58f0\u63cf\u8ff0\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0cBLIP \u5728\u5229\u7528 web \u566a\u58f0\u6570\u636e\u65f6\u83b7\u5f97\u66f4\u9ad8\u7684\u4fe1\u566a\u6bd4\u3002\u9884\u8bad\u7ec3\u4e2d\uff0cBLIP \u540c\u65f6\u4f18\u5316\u56fe\u6587\u5bf9\u6bd4\u635f\u5931\u3001\u56fe\u6587\u5339\u914d\u5206\u7c7b\u635f\u5931\u4ee5\u53ca\u56fe\u50cf\u6761\u4ef6\u4e0b\u7684\u8bed\u8a00\u6a21\u578b\u635f\u5931\uff0c\u5b9e\u73b0\u5355\u4e00\u6a21\u578b\u517c\u5177\u5224\u522b\u548c\u751f\u6210\u80fd\u529b\u3002\u5b9e\u9a8c\u8868\u660e\uff0cBLIP \u5728\u591a\u9879\u89c6\u89c9\u8bed\u8a00\u4efb\u52a1\u4e0a\u53d6\u5f97\u5f53\u65f6\u6700\u597d\u6210\u7ee9\uff08\u5982\u96f6\u6837\u672c\u56fe\u6587\u68c0\u7d22\u63d0\u5347+2.7% R@1\uff0c\u56fe\u50cf\u63cf\u8ff0\u63d0\u5347+2.8 CIDEr\uff0cVQA\u63d0\u5347+1.6%\uff09\u3002\u5e76\u4e14\u65e0\u9700\u5fae\u8c03\u5c31\u80fd\u5c06\u6a21\u578b\u8fc1\u79fb\u5230\u89c6\u9891-\u8bed\u8a00\u4efb\u52a1\u4e0a\u53d6\u5f97\u4f18\u5f02\u8868\u73b0\u3002BLIP \u662f\u591a\u6a21\u6001\u6a21\u578b\u671d\u901a\u7528\u591a\u4efb\u52a1\u65b9\u5411\u53d1\u5c55\u7684\u91cd\u8981\u4e00\u6b65\u3002</li> <li>Florence (2021, Microsoft)\uff1a\u4ee3\u53f7\u4e3a\u201cFlorence\u201d\uff0c\u662f\u5fae\u8f6f\u63d0\u51fa\u7684\u65b0\u4e00\u4ee3\u89c6\u89c9-\u8bed\u8a00\u57fa\u7840\u6a21\u578b\u3002Florence \u7684\u56fe\u50cf-\u6587\u672c\u9884\u8bad\u7ec3\u6570\u636e\u96c6\u89c4\u6a21\u8fbe 9\u4ebf\u5bf9\uff08\u79f0\u4e3a FLD-900M\uff09\uff0c\u6a21\u578b\u91c7\u7528 CLIP \u7c7b\u4f3c\u7684\u53cc\u5854\u7ed3\u6784\uff0c\u4f46\u4f7f\u7528\u66f4\u5927\u7684 CoSwinTransformer \u4f5c\u4e3a\u56fe\u50cf\u7f16\u7801\u5668\u300112\u5c42Transformer\u4f5c\u4e3a\u6587\u672c\u7f16\u7801\u5668\uff0c\u603b\u53c2\u6570\u9ad8\u8fbe 8.93\u4ebf\u3002\u8bad\u7ec3\u65b9\u6cd5\u4e0a\uff0c\u5f15\u5165\u4e86\u4e00\u79cd\u7edf\u4e00\u5bf9\u6bd4\u5b66\u4e60\u635f\u5931\uff08UniCL\uff09\uff0c\u5c06\u56fe\u50cf-\u6587\u672c\u5bf9\u6620\u5c04\u4e3a (x, t, y) \u4e09\u5143\u7ec4\uff0c\u5176\u4e2d y \u662f\u7531\u54c8\u5e0c\u5f97\u5230\u7684\u201c\u8bed\u4e49\u6807\u7b7e\u201d\uff0c\u6240\u6709\u6620\u5c04\u5230\u540c\u4e00 y \u7684\u5bf9\u88ab\u89c6\u4e3a\u6b63\u4f8b\uff0c\u5b9e\u73b0\u591a\u5bf9\u591a\u7684\u5bf9\u6bd4\u5b66\u4e60\u3002\u6b64\u5916\uff0cFlorence \u901a\u8fc7\u4e24\u9636\u6bb5\u8bad\u7ec3\u7f13\u89e3\u63d0\u793a\u6a21\u677f\u5e26\u6765\u7684\u4e0d\u4e00\u81f4\u5f71\u54cd\uff0c\u5148\u7528\u5e26\u968f\u673a\u63d0\u793a\u7684\u6570\u636e\u8bad\u7ec3\uff0c\u518d\u4e8c\u6b21\u8bad\u7ec3\u53bb\u9664\u63d0\u793a\u6570\u636e\u3002\u5f97\u76ca\u4e8e\u8d85\u5927\u89c4\u6a21\u6570\u636e\u548c\u6a21\u578b\uff0cFlorence \u5728\u5404\u9879\u4efb\u52a1\u4e0a\u53d6\u5f97\u7a81\u51fa\u6210\u7ee9\uff1a\u96f6\u6837\u672c ImageNet \u5206\u7c7b 83.7% \u51c6\u786e\u7387\uff0c\u8f83\u5f53\u65f6 SOTA \u63d0\u53475.6\u4e2a\u767e\u5206\u70b9\uff1b\u8de812\u4e2a\u5206\u7c7b\u4efb\u52a19\u4e2a\u5c45\u9996\uff0c\u8de8\u6a21\u6001\u68c0\u7d22\u4e5f\u5168\u9762\u8d85\u8d8a\u5148\u524d\u6a21\u578b\u3002Florence \u8fd8\u901a\u8fc7\u9002\u914d\u5934\u6269\u5c55\u5b9e\u73b0\u4e86\u7269\u4f53\u68c0\u6d4b\u3001VQA\u7b49\u4efb\u52a1\u7684\u9886\u5148\u8868\u73b0\u3002\u53ef\u4ee5\u5c06\u5176\u89c6\u4f5cCLIP\u601d\u8def\u5728\u5de5\u4e1a\u7ea7\u6570\u636e\u548c\u6a21\u578b\u89c4\u6a21\u4e0a\u7684\u6781\u81f4\u5ef6\u4f38\uff0c\u5c55\u793a\u4e86\u57fa\u7840\u6a21\u578b\u5728\u89c6\u89c9\u9886\u57df\u7684\u5a01\u529b\u3002</li> <li>Flamingo (2022, DeepMind)\uff1aFlamingo \u662f\u4e00\u79cd\u652f\u6301\u5c11\u6837\u672c\u5b66\u4e60\u7684\u89c6\u89c9\u8bed\u8a00\u6a21\u578b\u7cfb\u5217\u3002\u5b83\u7684\u76ee\u6807\u662f\u4f7f\u6a21\u578b\u80fd\u901a\u8fc7\u51e0\u5e45\u56fe\u50cf\u548c\u5bf9\u5e94\u6587\u672c\u7684\u793a\u4f8b\u201c\u4e0a\u4e0b\u6587\u201d\u5feb\u901f\u9002\u5e94\u65b0\u4efb\u52a1\u3002Flamingo \u7684\u67b6\u6784\u5de7\u5999\u5730\u8854\u63a5\u9884\u8bad\u7ec3\u7684\u5355\u6a21\u6001\u6a21\u578b\uff1a\u5c06\u4e00\u4e2a\u5f3a\u5927\u7684\u56fe\u50cf\u7f16\u7801\u5668\uff08\u5982\u9884\u8bad\u7684CLIP\u89c6\u89c9 backbone\uff09\u548c\u4e00\u4e2a\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff08\u5982\u9884\u8badTransformer LM\uff09\u8fde\u63a5\u8d77\u6765\u3002\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u5728\u51bb\u7ed3\u539f\u6709\u5355\u6a21\u6001\u6a21\u578b\u7684\u57fa\u7840\u4e0a\uff0c\u63d2\u5165\u82e5\u5e72\u8de8\u6ce8\u610f\u529b\u5c42\uff0c\u8ba9\u8bed\u8a00\u6a21\u578b\u80fd\u591f\u4ee5\u56fe\u50cf\u7f16\u7801\u5668\u8f93\u51fa\u4f5c\u4e3a\u952e\u503c\u6765\u5173\u6ce8\u56fe\u50cf\u5185\u5bb9\u3002\u8fd9\u6837\uff0cFlamingo \u53ef\u4ee5\u5904\u7406\u4efb\u610f\u4ea4\u9519\u7684\u56fe\u50cf\u548c\u6587\u672c\u5e8f\u5217\u8f93\u5165\uff0c\u5e76\u5728\u751f\u6210\u7b54\u6848\u65f6\u7075\u6d3b\u5730\u53c2\u8003\u89c6\u89c9\u4fe1\u606f\u3002\u8bad\u7ec3\u65f6\uff0cFlamingo \u5229\u7528\u5927\u91cf\u56fe\u6587\u4ea4\u9519\u7684\u6570\u636e\u8fdb\u884c\u5e8f\u5217\u5efa\u6a21\uff0c\u4f7f\u5176\u5177\u5907\u4e0a\u4e0b\u6587\u63a8\u7406\u80fd\u529b\u3002\u5728\u8bc4\u6d4b\u4e2d\uff0c\u4e00\u4e2a\u5355\u4e00\u7684Flamingo\u6a21\u578b\u901a\u8fc7\u5728\u63d0\u793a\u4e2d\u63d0\u4f9b\u5c11\u91cf\u793a\u4f8b\uff08\u65e0\u9700\u68af\u5ea6\u66f4\u65b0\uff09\uff0c\u5c31\u5728\u591a\u9879\u5f00\u653e\u5f0f\u4efb\u52a1\u4e0a\u8fbe\u5230\u65b0\u7684 SOTA\uff1a\u4f8b\u5982\u5728\u5404\u79cd VQA\u3001\u56fe\u50cf\u5b57\u5e55\u3001\u89c6\u89c9\u63a8\u7406\u57fa\u51c6\u4e0a\uff0cFlamingo \u7684 few-shot \u8868\u73b0\u8d85\u8d8a\u4e86\u90a3\u4e9b\u4f7f\u7528\u5927\u91cf\u6807\u6ce8\u5fae\u8c03\u7684\u4e13\u95e8\u6a21\u578b\u3002\u8fd9\u8bc1\u660e\u4e86\u901a\u8fc7\u878d\u5408\u591a\u6a21\u6001\u9884\u8bad\u7ec3\u548c\u63d0\u793a\u5b66\u4e60\uff0c\u6a21\u578b\u53ef\u4ee5\u83b7\u5f97\u60ca\u4eba\u7684\u8de8\u4efb\u52a1\u6cdb\u5316\u80fd\u529b\u3002Flamingo \u6807\u5fd7\u7740\u8de8\u6a21\u6001\u6a21\u578b\u5f00\u59cb\u8fc8\u5411\u7c7b GPT-3 \u7684\u63d0\u793a\u9a71\u52a8\u8303\u5f0f\uff0c\u5728\u591a\u6a21\u6001 few-shot \u5b66\u4e60\u65b9\u9762\u53d6\u5f97\u7a81\u7834\u3002</li> </ul>","tags":["CLIP","\u591a\u6a21\u6001","LLM"]},{"location":"posts/CLIP%EF%BC%9A%E5%A4%9A%E6%A8%A1%E6%80%81%E4%B9%8B%E9%92%A5/#5","title":"5. \u5e94\u7528\u6848\u4f8b\u4e0e\u573a\u666f","text":"<p>CLIP \u4f5c\u4e3a\u591a\u6a21\u6001\u57fa\u7840\u6a21\u578b\uff0c\u5728\u5b66\u672f\u7814\u7a76\u548c\u5de5\u4e1a\u5e94\u7528\u4e2d\u5c55\u73b0\u4e86\u5e7f\u6cdb\u7684\u7528\u9014\u3002\u4ee5\u4e0b\u5217\u4e3e\u82e5\u5e72\u5178\u578b\u7684\u5e94\u7528\u573a\u666f\uff1a</p> <ul> <li>\u96f6\u6837\u672c\u56fe\u50cf\u5206\u7c7b\uff1a\u8fd9\u53ef\u80fd\u662f CLIP \u6700\u5f15\u4eba\u6ce8\u76ee\u7684\u5e94\u7528\u4e4b\u4e00\u3002\u5229\u7528 CLIP\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6ca1\u6709\u9488\u5bf9\u76ee\u6807\u4efb\u52a1\u7684\u4e13\u95e8\u8bad\u7ec3\u6570\u636e\u60c5\u51b5\u4e0b\uff0c\u5bf9\u65b0\u9886\u57df\u7684\u56fe\u50cf\u8fdb\u884c\u5206\u7c7b\u3002\u5177\u4f53\u505a\u6cd5\u5982\u524d\u6587\u6240\u8ff0\uff1a\u9488\u5bf9\u7ed9\u5b9a\u6570\u636e\u96c6\u7684\u7c7b\u522b\u96c6\u5408\uff0c\u5148\u6784\u9020\u6bcf\u4e2a\u7c7b\u522b\u7684\u6587\u672c\u63cf\u8ff0\uff08\u901a\u5e38\u4f7f\u7528\u63d0\u793a\u6a21\u677f\uff0c\u5982 \"A photo of a cat.\" \u7b49\uff09\uff0c\u901a\u8fc7 CLIP \u6587\u672c\u7f16\u7801\u5668\u5f97\u5230\u5404\u7c7b\u522b\u7684\u5d4c\u5165\u3002\u5bf9\u4e8e\u5f85\u5206\u7c7b\u56fe\u7247\uff0c\u7528\u56fe\u50cf\u7f16\u7801\u5668\u83b7\u5f97\u56fe\u50cf\u5d4c\u5165\uff0c\u8ba1\u7b97\u4e0e\u6240\u6709\u7c7b\u522b\u6587\u672c\u5d4c\u5165\u7684\u76f8\u4f3c\u5ea6\u3002\u56fe\u50cf\u88ab\u5f52\u5165\u76f8\u4f3c\u5ea6\u6700\u9ad8\u7684\u90a3\u4e00\u7c7b\uff0c\u4ece\u800c\u5b8c\u6210\u9884\u6d4b\u3002OpenAI \u62a5\u544a\u4e2d\uff0cCLIP \u5728\u5305\u542b1000\u7c7b\u7684 ImageNet \u4e0a\u96f6\u6837\u672c\u5206\u7c7b\u8fbe\u5230\u4e0e\u6709\u76d1\u7763ResNet-50\u76f8\u5f53\u7684 76.2% Top-1 \u51c6\u786e\u7387\uff1b\u5728\u5305\u62ec OCR\u3001\u884c\u4e3a\u8bc6\u522b\u3001\u7ec6\u7c92\u5ea6\u5206\u7c7b\u7b4930\u591a\u4e2a\u6570\u636e\u96c6\u4e0a\uff0c\u96f6\u6837\u672c CLIP \u6a21\u578b\u7684\u6027\u80fd\u5927\u591a\u63a5\u8fd1\u751a\u81f3\u8d85\u8fc7\u7ecf\u8fc7\u8be5\u6570\u636e\u96c6\u5fae\u8c03\u7684\u76d1\u7763\u6a21\u578b\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u901a\u8fc7\u7cbe\u5fc3\u6311\u9009\u548c\u6269\u5145\u63d0\u793a\uff08prompt engineering\uff09\u4ee5\u53ca\u5bf9\u591a\u4e2a\u63d0\u793a\u7ed3\u679c\u53d6\u5e73\u5747\uff0c\u96f6\u6837\u672c\u5206\u7c7b\u7cbe\u5ea6\u8fd8\u53ef\u8fdb\u4e00\u6b65\u63d0\u5347\u3002\u8fd9\u4e00\u80fd\u529b\u5728\u73b0\u5b9e\u4e2d\u5177\u6709\u91cd\u8981\u610f\u4e49\uff1a\u65e0\u9700\u6536\u96c6\u65b0\u6570\u636e\u5373\u53ef\u5feb\u901f\u6269\u5c55\u6a21\u578b\u5230\u65b0\u7684\u8bc6\u522b\u4efb\u52a1\uff0c\u5927\u5e45\u63d0\u9ad8\u4e86\u89c6\u89c9\u7cfb\u7edf\u7684\u7075\u6d3b\u6027\u548c\u5b9e\u7528\u6027\u3002</li> <li>\u56fe\u6587\u68c0\u7d22\u4e0e\u5339\u914d\uff1aCLIP \u63d0\u4f9b\u4e86\u4e00\u4e2a\u81ea\u7136\u7684\u8de8\u6a21\u6001\u68c0\u7d22\u65b9\u6848\uff1a\u5229\u7528\u5171\u540c\u7684\u5d4c\u5165\u7a7a\u95f4\uff0c\u53ef\u4ee5\u5c06\u6587\u672c\u4f5c\u4e3a\u67e5\u8be2\u641c\u7d22\u56fe\u7247\uff0c\u6216\u53cd\u8fc7\u6765\u4ee5\u56fe\u50cf\u67e5\u8be2\u76f8\u5173\u6587\u672c\u3002\u5177\u4f53\u800c\u8a00\uff0c\u5148\u5bf9\u4e00\u5927\u6279\u56fe\u7247\u8ba1\u7b97\u5e76\u5b58\u50a8 CLIP \u56fe\u50cf\u7279\u5f81\u5411\u91cf\uff1b\u7ed9\u5b9a\u4e00\u6bb5\u67e5\u8be2\u6587\u672c\uff0c\u7528\u6587\u672c\u7f16\u7801\u5668\u5f97\u5230\u5411\u91cf\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u68c0\u7d22\u6700\u8fd1\u90bb\u7684\u56fe\u50cf\u5411\u91cf\uff0c\u5373\u53ef\u8fd4\u56de\u4e0e\u8be5\u63cf\u8ff0\u6700\u5339\u914d\u7684\u56fe\u7247\uff08\u6587\u672c-&gt;\u56fe\u50cf\u68c0\u7d22\uff09\u3002\u540c\u6837\uff0c\u53ef\u4ee5\u7528\u4e00\u5f20\u56fe\u7247\u7f16\u7801\u540e\u5728\u6d77\u91cf\u6587\u672c\u5411\u91cf\u4e2d\u67e5\u627e\u6700\u76f8\u4f3c\u8005\uff0c\u5b9e\u73b0\u4ee5\u56fe\u627e\u6587\uff08\u56fe\u50cf-&gt;\u6587\u672c\u68c0\u7d22\uff09\u3002\u7531\u4e8e CLIP \u7684\u8bad\u7ec3\u6db5\u76d6\u4e86\u5e7f\u6cdb\u7684\u89c6\u89c9\u8bed\u4e49\u6982\u5ff5\uff0c\u5b83\u80fd\u5904\u7406\u5f00\u653e\u57df\u7684\u63cf\u8ff0\u3002\u4f8b\u5982\u7528\u4e00\u53e5\u8bdd\u201c\u732b\u8eba\u5728\u6c99\u53d1\u4e0a\u201d\u68c0\u7d22\uff0c\u7ed3\u679c\u5f80\u5f80\u662f\u771f\u6b63\u542b\u6709\u732b\u548c\u6c99\u53d1\u7684\u56fe\u7247\uff0c\u5373\u4f7f\u8fd9\u4e9b\u56fe\u7247\u53ef\u80fd\u4e0d\u5728\u4efb\u4f55\u4f20\u7edf\u6807\u6ce8\u6570\u636e\u96c6\u4e2d\u3002\u8fd9\u4e3a\u6784\u5efa\u591a\u5a92\u4f53\u641c\u7d22\u5f15\u64ce\u63d0\u4f9b\u4e86\u65b0\u5de5\u5177\u3002\u4e00\u4e9b\u5f00\u6e90\u9879\u76ee\uff08\u5982 CLIP Retrieval\uff09\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5229\u7528 CLIP \u5bf9\u4e0a\u4ebf\u56fe\u50cf\u5efa\u7acb\u7d22\u5f15\u3001\u5b9e\u73b0\u6587\u672c\u641c\u56fe\u7684\u7cfb\u7edf\u3002\u5b9e\u9a8c\u663e\u793a\uff0c\u76f8\u6bd4\u57fa\u4e8e\u6807\u7b7e\u7684\u65e7\u65b9\u6cd5\uff0cCLIP \u7684\u68c0\u7d22\u7ed3\u679c\u5728\u8bed\u4e49\u76f8\u5173\u6027\u4e0a\u6709\u660e\u663e\u63d0\u5347\u3002\u56e0\u6b64\uff0cCLIP \u88ab\u5e7f\u6cdb\u7528\u4e8e\u89c6\u89c9\u8bed\u4e49\u68c0\u7d22\u3001\u76f8\u4f3c\u56fe\u7247\u63a8\u8350\u3001\u5185\u5bb9\u5ba1\u6838\uff08\u627e\u51fa\u4e0d\u7b26\u5408\u63cf\u8ff0\u7684\u56fe\u7247\uff09\u7b49\u5e94\u7528\u4e2d\u3002</li> <li>\u6587\u672c\u5f15\u5bfc\u7684\u56fe\u50cf\u751f\u6210\uff1aCLIP \u8fd8\u80fd\u7528\u6765\u63d0\u5347\u56fe\u50cf\u751f\u6210\u6a21\u578b\u7684\u6548\u679c\uff0c\u5373\u901a\u8fc7 CLIP \u63d0\u4f9b\u7684\u8bed\u4e49\u53cd\u9988\u6765\u6307\u5bfc\u751f\u6210\u8fc7\u7a0b\u3002\u4e00\u4e2a\u8457\u540d\u8303\u4f8b\u662f VQGAN+CLIP\uff1aVQGAN \u662f\u751f\u6210\u6a21\u578b\uff0cCLIP \u5219\u4f5c\u4e3a\u201c\u5ba1\u8bc4\u8005\u201d\u3002\u751f\u6210\u6a21\u578b\u4e0d\u65ad\u4ea7\u751f\u4ea7\u51fa\u5019\u9009\u56fe\u50cf\uff0cCLIP \u8d1f\u8d23\u5224\u65ad\u8fd9\u4e9b\u56fe\u50cf\u4e0e\u76ee\u6807\u6587\u672c\u63cf\u8ff0\u7684\u5339\u914d\u7a0b\u5ea6\uff08\u8ba1\u7b97 CLIP \u76f8\u4f3c\u5ea6\uff09\u3002\u7136\u540e\u5229\u7528\u8fd9\u4e2a\u76f8\u4f3c\u5ea6\u4f5c\u4e3a\u4f18\u5316\u4fe1\u53f7\uff0c\u53cd\u5411\u66f4\u65b0\u751f\u6210\u6a21\u578b\u7684\u56fe\u50cf latent \u4f7f\u4e4b\u66f4\u63a5\u8fd1\u6587\u672c\u8bed\u4e49\u3002\u901a\u8fc7 CLIP \u7684\u5f15\u5bfc\uff0cVQGAN \u80fd\u9010\u6b65\u7ed8\u5236\u51fa\u7b26\u5408\u6587\u5b57\u63cf\u8ff0\u7684\u56fe\u50cf\u3002\u4eba\u4eec\u7528\u8fd9\u79cd\u65b9\u6cd5\u521b\u9020\u4e86\u8bb8\u591a\u60ca\u8273\u7684 AI \u827a\u672f\u4f5c\u54c1\uff0c\u4e5f\u9a8c\u8bc1\u4e86 CLIP \u5d4c\u5165\u7a7a\u95f4\u5bf9\u9ad8\u5c42\u8bed\u4e49\u7684\u628a\u63e1\u3002\u9664\u4e86 VQGAN\uff0c\u6269\u6563\u6a21\u578b\u7b49\u751f\u6210\u6280\u672f\u4e5f\u501f\u9274\u7c7b\u4f3c\u601d\u8def\uff0c\u5982\u5728\u751f\u6210\u8fc7\u7a0b\u4e2d\u8ba1\u7b97\u751f\u6210\u56fe\u50cf\u4e0e\u76ee\u6807\u6587\u672c\u7684 CLIP \u5f97\u5206\u5e76\u52a0\u6743\u878d\u5165\u91c7\u6837\u8fc7\u7a0b\uff0c\u80fd\u591f\u63d0\u5347\u751f\u6210\u56fe\u50cf\u4e0e\u6587\u672c\u7684\u76f8\u5173\u6027\u548c\u5199\u5b9e\u5ea6\u3002\u5b9e\u9645\u4e0a\uff0cOpenAI \u7684 DALLE-2 \u6a21\u578b\u5c31\u5229\u7528\u4e86 CLIP\uff1a\u5148\u8bad\u7ec3\u4e00\u4e2a\u5c06\u56fe\u50cf\u7f16\u7801\u4e3a CLIP \u7a7a\u95f4\u7684\u5148\u9a8c\u6a21\u578b\uff0c\u7136\u540e\u5f15\u5bfc\u6269\u6563\u751f\u6210\u3002\u56e0\u6b64\uff0cCLIP \u4e0d\u4ec5\u64c5\u957f\u5224\u522b\uff0c\u8fd8\u53ef\u4ee5\u4f5c\u4e3a\u8de8\u6a21\u6001\u7684\u8bc4\u4ef7\u51fd\u6570\u5d4c\u5165\u5230\u751f\u6210\u6a21\u578b\u4e2d\uff0c\u5e2e\u52a9\u5b9e\u73b0\u201cAI \u4f5c\u753b\u201d\u7b49\u5e94\u7528\u3002</li> <li>\u901a\u7528\u7279\u5f81\u63d0\u53d6\u4e0e\u4e0b\u6e38\u5fae\u8c03\uff1a\u7531\u4e8e CLIP \u5b66\u5230\u4e86\u5f3a\u5927\u7684\u89c6\u89c9\u8868\u5f81\uff0c\u4e0d\u5c11\u5e94\u7528\u76f4\u63a5\u628a CLIP \u7684\u56fe\u50cf\u7f16\u7801\u5668\u5f53\u4f5c\u9884\u8bad\u7ec3\u9aa8\u5e72\uff0c\u7528\u4e8e\u4f20\u7edf\u89c6\u89c9\u4efb\u52a1\u4e0a\u4ee5\u63d0\u5347\u6548\u679c\u3002\u4f8b\u5982\uff0c\u5c06 CLIP \u7684\u56fe\u50cf\u7279\u5f81\u7528\u4f5c\u4e0b\u6e38\u6a21\u578b\u7684\u8f93\u5165\uff0c\u518d\u5728\u5c0f\u89c4\u6a21\u6709\u6807\u7b7e\u6570\u636e\u4e0a\u8bad\u7ec3\u4e00\u4e2a\u8f7b\u91cf\u5206\u7c7b\u5668\uff08\u5373\u7ebf\u6027\u63a2\u9488\uff09\uff0c\u5f80\u5f80\u6bd4\u4ece\u5934\u8bad\u7ec3\u6216\u4f7f\u7528ImageNet\u9884\u8bad\u6a21\u578b\u5f97\u5230\u66f4\u9ad8\u7cbe\u5ea6\u3002OpenAI \u7684\u7814\u7a76\u663e\u793a\uff0c\u5728\u6709\u9650\u6570\u636e\u573a\u666f\u4e0b\uff0cCLIP \u6bd4\u540c\u7b49\u7cbe\u5ea6\u7684\u6709\u76d1\u7763\u6a21\u578b\u66f4\u52a0\u7a33\u5065\u3002\u53e6\u5916\uff0c\u5728\u76ee\u6807\u68c0\u6d4b\u3001\u56fe\u50cf\u5206\u5272\u7b49\u4efb\u52a1\u4e2d\uff0c\u4e5f\u6709\u5de5\u4f5c\u5c06 CLIP \u7279\u5f81\u878d\u5165\uff08\u4f8b\u5982\u4e3a\u6bcf\u7c7b\u76ee\u6807\u63d0\u4f9b\u6587\u672c\u63cf\u8ff0\u5d4c\u5165\uff0c\u8f85\u52a9\u68c0\u6d4b\u5668\u8bc6\u522b\u5f00\u653e\u96c6\u76ee\u6807\uff09\u3002CLIP \u7684\u6587\u672c\u7f16\u7801\u5668\u540c\u6837\u53ef\u4ee5\u7528\u6765\u63d0\u53d6\u53e5\u5b50\u5d4c\u5165\uff0c\u5728\u591a\u6a21\u6001\u5bf9\u8bdd\u3001\u56fe\u6587\u95ee\u7b54\u7cfb\u7edf\u4e2d\u4e0e\u56fe\u50cf\u7279\u5f81\u914d\u5408\u5de5\u4f5c\u3002\u751a\u81f3\u5728\u673a\u5668\u4eba\u9886\u57df\uff0cCLIP \u88ab\u7528\u4e8e\u611f\u77e5\u6a21\u5757\uff1a\u8f93\u5165\u6444\u50cf\u5934\u753b\u9762\u548c\u6307\u4ee4\uff0cCLIP \u8ba1\u7b97\u76f8\u4f3c\u5ea6\u5e2e\u52a9\u673a\u5668\u4eba\u7406\u89e3\u8981\u6293\u53d6\u7684\u7269\u4f53\u7c7b\u522b\u3002\u603b\u4f53\u800c\u8a00\uff0cCLIP \u63d0\u4f9b\u4e86\u4e00\u4e2a\u901a\u7528\u5d4c\u5165\u7a7a\u95f4\uff0c\u8bb8\u591a\u4efb\u52a1\u90fd\u53ef\u4ee5\u5728\u8be5\u7a7a\u95f4\u4e2d\u5229\u7528\u76f8\u4f3c\u5ea6\u5ea6\u91cf\u6765\u66ff\u4ee3\u6216\u8f85\u52a9\u4f20\u7edf\u7684\u5206\u7c7b\u5668\uff0c\u4ece\u800c\u5b9e\u73b0\u66f4\u5f3a\u7684\u96f6\u6837\u672c\u6216\u5c11\u6837\u672c\u80fd\u529b\u3002\u968f\u7740\u5f00\u6e90\u5b9e\u73b0\u548c\u6a21\u578b\u6743\u91cd\u7684\u53d1\u5e03\uff0c\u5de5\u7a0b\u5e08\u548c\u7814\u7a76\u8005\u5df2\u5c06 CLIP \u96c6\u6210\u5230\u5404\u79cd\u5e94\u7528\u4e2d\uff0c\u6781\u5927\u52a0\u901f\u4e86\u591a\u6a21\u6001 AI \u6280\u672f\u5728\u73b0\u5b9e\u4e2d\u7684\u843d\u5730\u3002</li> </ul> <p>\u7ed3\u8bed\uff1a OpenAI \u7684 CLIP \u6a21\u578b\u5f00\u521b\u4e86\u56fe\u50cf\u4e0e\u81ea\u7136\u8bed\u8a00\u8054\u5408\u9884\u8bad\u7ec3\u7684\u65b0\u8303\u5f0f\u3002\u901a\u8fc7\u5bf9\u6bd4\u5b66\u4e60\uff0cCLIP \u83b7\u53d6\u4e86\u8de8\u6a21\u6001\u5bf9\u9f50\u7684\u5f3a\u8868\u5f81\u80fd\u529b\uff0c\u5728\u65e0\u9700\u7279\u5b9a\u8bad\u7ec3\u6570\u636e\u7684\u60c5\u51b5\u4e0b\u5c31\u80fd\u6267\u884c\u96f6\u6837\u672c\u56fe\u50cf\u8bc6\u522b\u548c\u68c0\u7d22\u3002\u5176\u540e\u7684\u5927\u91cf\u7814\u7a76\u548c\u5e94\u7528\u8fdb\u4e00\u6b65\u9a8c\u8bc1\u4e86\u8fd9\u4e00\u601d\u8def\u7684\u4ef7\u503c\u2014\u2014\u7ed3\u5408\u6d77\u91cf\u6570\u636e\u548c\u8bed\u8a00\u76d1\u7763\uff0c\u89c6\u89c9\u6a21\u578b\u7684\u901a\u7528\u6027\u4e0e\u667a\u80fd\u6c34\u5e73\u53d6\u5f97\u4e86\u8d28\u7684\u98de\u8dc3\u3002\u53ef\u4ee5\u9884\u89c1\uff0c\u968f\u7740\u66f4\u5927\u89c4\u6a21\u7684\u591a\u6a21\u6001\u6a21\u578b\uff08\u5982 Flamingo\u3001GPT-4V \u7b49\uff09\u7684\u51fa\u73b0\uff0c\u4eba\u5de5\u667a\u80fd\u7cfb\u7edf\u5c06\u80fd\u4ee5\u66f4\u63a5\u8fd1\u4eba\u7c7b\u7684\u65b9\u5f0f\u7406\u89e3\u548c\u8054\u901a\u89c6\u89c9\u4e0e\u8bed\u8a00\u4fe1\u606f\uff0c\u4e3a\u591a\u6a21\u6001\u4fe1\u606f\u5904\u7406\u548c\u51b3\u7b56\u5e26\u6765\u524d\u6240\u672a\u6709\u7684\u80fd\u529b\u63d0\u5347\u3002</p>","tags":["CLIP","\u591a\u6a21\u6001","LLM"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/","title":"DeepSeek-Coder\u5de5\u7a0b\u5316\u65b9\u6848","text":"\u6807\u7b7e\uff1a LLMDeepSeek","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_1","title":"\u5f15\u8a00","text":"<p>DeepSeek-Coder\u8bba\u6587\u662f\u4e00\u7bc7\u975e\u5e38\u597d\u7684LLM\u5de5\u7a0b\u5316\u201c\u6559\u7a0b\u201d\uff0c\u5c24\u5176\u662f\u5bf9\u4e8eLLM\u5728\u5782\u76f4\u9886\u57df\u843d\u5730\u5e94\u7528\u6709\u6781\u5f3a\u7684\u501f\u9274\u610f\u4e49\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_2","title":"\u4e00\u3001\u6570\u636e\u5de5\u7a0b\uff1a\u8ba9\u6a21\u578b\u201c\u7406\u89e3\u9879\u76ee\u201d\uff0c\u800c\u4e0d\u53ea\u662f\u201c\u89c1\u8fc7\u6587\u4ef6\u201d","text":"","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_3","title":"\u8bed\u6599\u6784\u6210\u4e0e\u5165\u53e3\u7b5b\u9009\uff1a\u5148\u628a\u5927\u566a\u58f0\u6321\u5728\u95e8\u5916","text":"<ul> <li>\u8bad\u7ec3\u96c6\u7531 87% \u6e90\u4ee3\u7801\u300110% \u82f1\u6587\u4ee3\u7801\u76f8\u5173\u6587\u672c\u30013% \u4e0e\u4ee3\u7801\u65e0\u5173\u7684\u4e2d\u6587\u6587\u672c\u7ec4\u6210\uff0c\u5176\u4e2d\u4e2d\u6587\u90e8\u5206\u662f\u201c\u9ad8\u8d28\u91cf\u6587\u7ae0\uff0c\u76ee\u7684\u662f\u63d0\u5347\u6a21\u578b\u7684\u4e2d\u6587\u7406\u89e3\u80fd\u529b\u201d\uff1b\u82f1\u6587\u4e3b\u8981\u6765\u81ea GitHub Markdown \u4e0e StackExchange\uff0c\u4ee5\u8865\u8db3\u5e93\u7528\u6cd5\u3001\u8c03\u8bd5\u8bed\u5883\u3002</li> <li>\u6293\u53d6\u8303\u56f4\u9650\u5b9a\u4e3a 2023 \u5e74 2 \u6708\u4e4b\u524d\u7684\u516c\u5f00\u4ed3\u5e93\uff0c\u5e76\u5148\u505a\u89c4\u5219\u8fc7\u6ee4\uff0c\u76f4\u63a5\u628a\u539f\u59cb\u4f53\u91cf\u538b\u7f29\u5230 32.8%\u3002\u8fd9\u4e9b\u89c4\u5219\u590d\u7528\u4e86 StarCoder \u7684\u505a\u6cd5\uff1a\u9650\u5236\u5e73\u5747\u884c\u957f\u4e0e\u6700\u5927\u884c\u957f\u3001\u5b57\u6bcd\u5360\u6bd4\u4f4e\u4e8e 25% \u7684\u6587\u4ef6\u5254\u9664\uff1b\u524d 100 \u5b57\u7b26\u542b <code>&lt;?xml version=</code> \u89c6\u4f5c XML \u5e76\u9664 XSLT \u5916\u8fc7\u6ee4\uff1bHTML \u8981\u6c42\u53ef\u89c1\u6587\u672c\u6bd4\u4f8b\u81f3\u5c11 20% \u4e14\u4e0d\u77ed\u4e8e 100 \u5b57\u7b26\uff1bJSON \u4e0e YAML \u4ec5\u4fdd\u7559 50 \u5230 5000 \u5b57\u7b26\u7684\u6587\u4ef6\u7b49\u3002</li> </ul> <p>\u4e3a\u4ec0\u4e48\u8fd9\u6837\u505a\uff1aStarCoder \u7684\u8fd9\u5957\u542f\u53d1\u5f0f\u8fc7\u6ee4\u80fd\u4ee5\u6781\u4f4e\u4ee3\u4ef7\u780d\u6389\u65e5\u5fd7\u3001\u6570\u636e\u6587\u4ef6\u4e0e\u6a21\u677f\u7c7b\u566a\u58f0\uff0c\u4e3a\u540e\u7eed\u7684\u4f9d\u8d56\u89e3\u6790\u4e0e\u53bb\u91cd\u8282\u7701\u5927\u91cf\u7b97\u529b\u548c\u65f6\u95f4\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_4","title":"\u4f9d\u8d56\u89e3\u6790\u4e0e\u4ed3\u5e93\u7ea7\u6392\u5e8f\uff1a\u628a\u201c\u56e0\u679c\u7ed3\u6784\u201d\u7f16\u7801\u8fdb\u5e8f\u5217","text":"<p>\u591a\u6570\u5f00\u6e90\u4ee3\u7801\u6a21\u578b\u6309\u201c\u6587\u4ef6\u7ea7\u201d\u62fc\u63a5\u8bad\u7ec3\u6837\u672c\uff0c\u5ffd\u7565\u4e86\u9879\u76ee\u5185\u90e8\u7684\u8de8\u6587\u4ef6\u4f9d\u8d56\u3002DeepSeek-Coder \u663e\u5f0f\u89e3\u6790 import using include \u7b49\u8c03\u7528\u5173\u7cfb\uff0c\u5bf9\u4ed3\u5e93\u5185\u6587\u4ef6\u505a\u62d3\u6251\u5f0f\u6392\u5e8f\uff0c\u4fdd\u8bc1\u88ab\u4f9d\u8d56\u6587\u4ef6\u5148\u4e8e\u5f15\u7528\u8005\u51fa\u73b0\uff0c\u5e76\u628a\u6587\u4ef6\u8def\u5f84\u4ee5\u6ce8\u91ca\u5f62\u5f0f\u4fdd\u7559\uff0c\u4ece\u800c\u628a\u201c\u9879\u76ee\u7684\u7ed3\u6784\u8bed\u5883\u201d\u5582\u7ed9\u6a21\u578b\u3002</p> <p>\u4ee5\u4e0b\u4ee3\u7801\u7247\u6bb5\u5c55\u793a\u4e86\u8fd9\u79cd\u4f9d\u8d56\u89e3\u6790\u540e\u7684\u4ee3\u7801\u7247\u6bb5 </p><pre><code># path: src/core/engine.py\ndef run(x):\n    print(\"result:\", x)\n\n# path: src/utils/math.py\nimport core.engine\ndef add(a, b):\n    return a + b\n\n# path: src/main.py\nimport utils.math\nfrom core.engine import run\ndef main():\n    x = utils.math.add(2, 3)\n    run(x)\n</code></pre><p></p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#near-dedup","title":"\u4ed3\u5e93\u7ea7 near-dedup\uff1a\u53bb\u91cd\u7684\u201c\u6700\u5c0f\u539f\u5b50\u201d\u5e94\u8be5\u662f\u4ed3\u5e93","text":"<p>\u8fd1\u91cd\u590d\u53bb\u91cd\u4e0d\u662f\u6309\u201c\u6587\u4ef6\u201d\u800c\u662f\u6309\u201c\u4ed3\u5e93\u7ea7\u4e32\u8054\u6837\u672c\u201d\u505a\uff0c\u907f\u514d\u8bef\u5220\u5173\u952e\u6587\u4ef6\u5bfc\u81f4\u9879\u76ee\u7ed3\u6784\u65ad\u88c2\u3002\u8fd9\u662f\u8de8\u6587\u4ef6\u8865\u5168\u573a\u666f\u91cc\u975e\u5e38\u5173\u952e\u7684\u4e00\u6b65\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_5","title":"\u8d28\u91cf\u7b5b\u9009\u4e0e\u8bc4\u6d4b\u53bb\u6c61\u67d3\uff1a\u81ea\u8bc1\u6e05\u767d","text":"<p>\u9664\u89c4\u5219\u5916\uff0c\u8f85\u4ee5\u7f16\u8bd1\u5668\u4e0e\u8d28\u91cf\u6a21\u578b\u52a0\u542f\u53d1\u5f0f\u89c4\u5219\uff0c\u5254\u9664\u8bed\u6cd5\u9519\u8bef\u4e0e\u53ef\u8bfb\u6027\u5dee\u4ee3\u7801\u3002\u4e3a\u9632\u8bc4\u6d4b\u6cc4\u6f0f\uff0c\u5bf9 HumanEval\u3001MBPP\u3001GSM8K\u3001MATH \u7b49\u505a n-gram \u8fc7\u6ee4\uff1a\u51fa\u73b0\u4e0e\u6d4b\u8bd5\u96c6\u5b8c\u5168\u76f8\u540c\u7684 10-gram \u76f4\u63a5\u5254\u9664\uff0c\u957f\u5ea6 3 \u5230 9 \u7684\u7528\u7cbe\u786e\u5339\u914d\u3002</p> <p>\u5c0f\u7ed3\uff1a\u8fd9\u6761\u4ed3\u5e93\u7ea7\u6570\u636e\u6d41\u6c34\u7ebf\uff0c\u628a\u771f\u5b9e\u5de5\u7a0b\u7684\u7ed3\u6784\u4fe1\u606f\u663e\u5f0f\u6ce8\u5165\u9884\u8bad\u7ec3\u8bed\u6599\uff0c\u4f7f\u5f97\u6a21\u578b\u7684\u201c\u77e5\u8bc6\u8f7d\u4f53\u201d\u4e0d\u518d\u662f\u6563\u788e\u6587\u4ef6\uff0c\u800c\u662f\u201c\u6709\u4f9d\u8d56\u3001\u6709\u987a\u5e8f\u7684\u9879\u76ee\u201d\u3002\u8fd9\u4e3a\u540e\u6587\u7684\u8de8\u6587\u4ef6\u5b9e\u9a8c\u63d0\u5347\u63d0\u4f9b\u4e86\u53ef\u89e3\u91ca\u7684\u56e0\u679c\u94fe\u6761\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#fim","title":"\u4e8c\u3001\u8bad\u7ec3\u65b9\u6cd5\uff1aFIM \u5982\u4f55\u4e0e\u5e38\u89c4\u81ea\u56de\u5f52\u76ee\u6807\u5171\u5b58","text":"","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_6","title":"\u8bad\u7ec3\u76ee\u6807\u4e0e\u91c7\u6837\u7b56\u7565","text":"","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#causallm-fim","title":"\u76ee\u6807\u7ec4\u5408\uff1aCausalLM + FIM","text":"<ul> <li>\u4e3b\u76ee\u6807\uff1a\u5e38\u89c4\u81ea\u56de\u5f52\u4e0b\u4e00 token \u9884\u6d4b\uff08CausalLM\uff09\u3002</li> <li>\u8f85\u76ee\u6807\uff1aFIM\uff08Fill-in-the-Middle\uff09\uff0c\u4ee4\u6a21\u578b\u5728\u5df2\u77e5\u524d\u7f00\u4e0e\u540e\u7f00\u65f6\uff0c\u9884\u6d4b\u4e2d\u95f4\u7247\u6bb5 \\(m\\)\uff0c\u5373\u6700\u5927\u5316 \\(P(m\\mid p,s)\\)\u3002DeepSeek-Coder \u5728\u9884\u8bad\u7ec3\u9636\u6bb5\u5c31\u6df7\u5165 FIM\uff0c\u4ee5\u5bf9\u9f50\u771f\u5b9e\u7684\u201c\u63d2\u5165\u5f0f\u8865\u5168\u201d\u4f7f\u7528\u573a\u666f\u3002</li> </ul>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#fim_1","title":"FIM \u6a21\u5f0f\u9009\u62e9\u4e0e\u6bd4\u4f8b","text":"<ul> <li>\u8bba\u6587\u5728 1.3B \u6a21\u578b\u4e0a\u505a\u4e86 0%\u300150%\u3001100% \u7684 FIM \u7387\u548c 50% MSP \u7684\u5bf9\u6bd4\uff1a   100% FIM \u867d\u7136\u5355\u9879 FIM \u6307\u6807\u6700\u597d\uff0c\u4f46\u5e38\u89c4\u8865\u5168\u80fd\u529b\u6700\u5f31\uff1b50% PSM \u5728\u4e24\u8005\u95f4\u66f4\u5e73\u8861\uff0c\u4f18\u4e8e 50% MSP\u3002\u6700\u7ec8\u5c06 PSM 50% \u4f5c\u4e3a\u9ed8\u8ba4\u8bad\u7ec3\u7b56\u7565\u3002</li> <li>PSM \u4e0e SPM \u662f FIM \u7684\u4e24\u79cd\u6570\u636e\u91cd\u6392\u65b9\u5f0f\uff08Prefix-Suffix-Middle / Suffix-Prefix-Middle\uff09\u3002OpenAI \u7684\u7cfb\u7edf\u7814\u7a76\u4e5f\u8bc1\u660e\u4e86\u901a\u8fc7\u6570\u636e\u91cd\u6392\u5373\u53ef\u5728\u81ea\u56de\u5f52\u6846\u67b6\u5185\u7a33\u5b9a\u5b66\u5230 infill \u80fd\u529b\u3002</li> </ul>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#fim_2","title":"FIM \u7684\u5de5\u7a0b\u5b9e\u73b0\u7ec6\u8282","text":"","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#token","title":"\u54e8\u5175 token \u4e0e\u6837\u672c\u6784\u9020","text":"<ul> <li>DeepSeek-Coder\u4e3a FIM \u5f15\u5165\u4e09\u679a\u4e13\u7528\u54e8\u5175 token\uff0c\u5e76\u5728\u6587\u6863\u7ea7\u5b8c\u6210 FIM \u6539\u5199\u540e\u518d\u8fdb\u884c pack\uff1a   \u6a21\u677f\uff08PSM\uff09\uff1a   <code>&lt;\uff5cfim_start\uff5c&gt; prefix &lt;\uff5cfim_hole\uff5c&gt; suffix &lt;\uff5cfim_end\uff5c&gt; middle &lt;|eos_token|&gt;</code>   \u8fd9\u4e00\u5b9e\u73b0\u76f4\u63a5\u6765\u81ea\u8bba\u6587\u6b63\u6587\u793a\u4f8b\u3002</li> </ul>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#vs","title":"\u6587\u6863\u7ea7 vs \u4e0a\u4e0b\u6587\u7ea7","text":"<ul> <li>\u8bba\u6587\u91c7\u7528\u6587\u6863\u7ea7 FIM\uff08\u5148\u5bf9\u5355\u6587\u6863\u5207\u5206\uff0c\u518d\u53c2\u4e0e pack\uff09\uff0c\u9075\u5faa Bavarian \u7b49\u7684\u505a\u6cd5\uff1b\u76f8\u6bd4\u4e4b\u4e0b\uff0cOpenAI \u4e5f\u7ed9\u51fa\u4e86\u4e0a\u4e0b\u6587\u7ea7 FIM\uff08\u5728\u957f\u4e0a\u4e0b\u6587\u5207\u7247\u540e\u518d\u5bf9\u90e8\u5206\u7247\u6bb5\u505a FIM\uff09\u7684\u5b9e\u8df5\u5efa\u8bae\u3002\u4e24\u8005\u672c\u8d28\u76f8\u540c\uff0c\u4fa7\u91cd\u70b9\u4e0d\u540c\uff1a\u6587\u6863\u7ea7\u5b9e\u73b0\u7b80\u5355\uff0c\u4e0a\u4e0b\u6587\u7ea7\u5728\u6781\u957f\u5e8f\u5217\u4e0b\u66f4\u9c81\u68d2\u3002</li> </ul>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#token_1","title":"\u5206\u8bcd\u4e0e\u7279\u6b8a token","text":"<ul> <li>\u5206\u8bcd\uff1aHuggingFace Tokenizers \u8bad\u7ec3\u7684 BPE\uff0c\u8bcd\u8868 32,000\u3002</li> <li>\u7279\u6b8a token\uff1a\u5728\u5e38\u89c4\u7279\u7b26\u4e4b\u5916\uff0c\u52a0\u5165 &lt;\uff5cfim_start\uff5c&gt; / &lt;\uff5cfim_hole\uff5c&gt; / &lt;\uff5cfim_end\uff5c&gt; \u6765\u6807\u6ce8\u4e09\u6bb5\u4f4d\u7f6e\uff0c\u914d\u5408 \\(P(m\\mid p,s)\\) \u7684\u76ee\u6807\u8ba1\u7b97\u3002</li> </ul>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_7","title":"\u7f51\u7edc\u67b6\u6784\u4e0e\u6548\u7387\u4f18\u5316","text":"<ul> <li>\u9aa8\u67b6\uff1aDecoder-Only Transformer + RoPE\u300233B \u91c7\u7528 GQA\uff08\u7ec4\u5927\u5c0f 8\uff09\uff0c\u5168\u7cfb\u96c6\u6210 FlashAttention v2\u3002\u6fc0\u6d3b\u51fd\u6570\u4e3a SwiGLU\u3002\u8fd9\u4e9b\u9009\u62e9\u5728\u8bba\u6587\u8868 2 \u4e0e\u65b9\u6cd5\u8282\u5747\u6709\u660e\u786e\u8bb0\u8f7d\u3002</li> <li>GQA \u7684\u52a8\u673a\u4e0e\u6536\u76ca\uff1a\u5c06 \\(h\\) \u4e2a\u67e5\u8be2\u5934\u5206\u6210 \\(G\\) \u7ec4\uff0c\u5171\u4eab\u66f4\u5c11\u7684 \\(k,v\\) \u5934\uff08\\(G&lt;h\\)\uff09\uff0c\u4ece\u800c\u663e\u8457\u964d\u4f4e KV \u7f13\u5b58\u5f00\u9500\u5e76\u63a5\u8fd1 MQA \u7684\u541e\u5410\uff0c\u540c\u65f6\u4fdd\u6301\u63a5\u8fd1 MHA \u7684\u8d28\u91cf\u3002\u8bb0 \\(h_k\\) \u4e3a \\(k,v\\) \u5934\u6570\uff0c\u5219 KV \u5185\u5b58\u3001\u5e26\u5bbd\u4e0e\u8bfb\u5199\u6210\u672c\u76f8\u5bf9 MHA \u7ea6\u6309 \\(h/h_k\\) \u6bd4\u4f8b\u4e0b\u964d\u3002</li> <li>FlashAttention-2 \u7684\u4ef7\u503c\uff1a\u901a\u8fc7\u66f4\u4f18\u7684\u5e76\u884c\u4e0e\u5de5\u4f5c\u5212\u5206\uff0c\u5728 A100 \u4e0a\u8bad\u7ec3\u7aef\u5230\u7aef\u53ef\u8fbe 225 TFLOPs/s\uff08\u7ea6 72% \u6a21\u578b FLOPs \u5229\u7528\uff09\uff0c\u663e\u8457\u6539\u5584\u957f\u5e8f\u5217\u573a\u666f\u7684\u6ce8\u610f\u529b\u7b97\u5b50\u6548\u7387\u3002\u5bf9\u4e8e 16K \u4e0a\u4e0b\u6587\uff0c\u8fd9\u662f\u6027\u4ef7\u6bd4\u8f83\u9ad8\u7684\u201c\u521a\u6027\u52a0\u901f\u201d\u3002</li> </ul>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_8","title":"\u4f18\u5316\u5668\u4e0e\u5b66\u4e60\u7387\u65e5\u7a0b","text":"<ul> <li>\u4f18\u5316\u5668\uff1aAdamW\uff0c\\(\\beta_1=0.9,\\ \\beta_2=0.95\\)\u3002</li> <li>\u4e09\u9636\u6bb5 LR \u65e5\u7a0b\uff1a\u542b 2000 \u6b65 warmup\uff1b\u6bcf\u4e00\u9636\u6bb5 LR \u6309 \\(\\sqrt{1/10}\\) \u9012\u51cf\uff1b\u6700\u7ec8 LR \u4e3a\u521d\u59cb\u503c\u7684 10%\u3002\u8fd9\u5957\u201c\u5f3a\u6536\u655b\u201d\u7b56\u7565\u6709\u52a9\u4e8e\u5728\u957f\u5e8f\u5217\u4e0e\u6df7\u5408\u76ee\u6807\u4e0b\u4fdd\u6301\u7a33\u5b9a\u3002</li> </ul>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_9","title":"\u5e76\u884c\u7b56\u7565\u4e0e\u8bad\u7ec3\u73af\u5883","text":"<ul> <li>\u5e76\u884c\u7ec4\u5408\uff1aTensor Parallel + ZeRO \u6570\u636e\u5e76\u884c + PipeDream \u6d41\u6c34\u5e76\u884c\u3002</li> <li>\u786c\u4ef6\uff1aA100 \u4e0e H800 \u96c6\u7fa4\uff0c\u5355\u673a 8 \u5361\uff0c\u8282\u70b9\u5185 NVLink/NVSwitch\uff0c\u8de8\u8282\u70b9 InfiniBand\u3002</li> </ul> <p>\u8fd9\u7c7b\u7ec4\u5408\u662f\u5f53\u4e0b\u5927\u591a\u6570 Decoder-Only \u9884\u8bad\u7ec3\u7684\u201c\u5b89\u5168\u9ed8\u8ba4\u201d\uff1a\u663e\u5b58\u53cb\u597d\u3001\u6269\u5c55\u5e73\u6ed1\u3001\u751f\u6001\u5b8c\u5584\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#rope","title":"\u957f\u4e0a\u4e0b\u6587\u9002\u914d\u4e0e RoPE \u7f29\u653e","text":"<p>\u5c06 RoPE \u7f29\u653e\u56e0\u5b50\u4ece 1 \u63d0\u81f3 4\uff0c\u57fa\u9891\u4ece 10000 \u8c03\u81f3 100000\uff0c\u5e76\u4ee5 batch size 512\u3001\u5e8f\u5217 16K\u3001\u989d\u5916 1000 \u6b65\u505a\u957f\u5e8f\u5217\u7a33\u5b9a\u8bad\u7ec3\uff1b\u7406\u8bba\u4e0a\u53ef\u8fbe 64K\uff0c\u4f46\u6700\u53ef\u9760\u7684\u5b9e\u7528\u533a\u95f4\u662f 16K\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_10","title":"\u9644\u5f55","text":"","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#fim_3","title":"FIM \u662f\u4ec0\u4e48","text":"<p>\u628a\u4e00\u6bb5\u5e8f\u5217\u5207\u6210\u4e09\u6bb5\uff1a\u524d\u7f00\\(p\\)\u3001\u4e2d\u95f4\\(m\\)\u3001\u540e\u7f00\\(s\\)\u3002\u628a\u539f\u6587\u91cd\u6392\u4e3a\u4e00\u79cd\u201c\u53ef\u81ea\u56de\u5f52\u5b66\u4e60\u201d\u7684\u987a\u5e8f\uff0c\u8ba9\u6a21\u578b\u5728\u6807\u51c6\u5de6\u5230\u53f3\u635f\u5931\u4e0b\uff0c\u7b49\u4ef7\u4e8e\u6700\u5927\u5316\\(P(m\\mid p,s)\\)\u3002\u5e38\u89c1\u4e24\u79cd\u7f16\u6392\uff1a</p> <ul> <li>PSM\uff1a\u5148\u653e\\(p\\)\u548c\\(s\\)\uff0c\u6700\u540e\u653e\\(m\\)</li> <li>SPM\uff1a\u5148\u653e\\(s\\)\u518d\u653e\\(p\\)\uff0c\u6700\u540e\u653e\\(m\\)   OpenAI \u7684\u7814\u7a76\u7cfb\u7edf\u6bd4\u8f83\u4e86 PSM \u4e0e SPM\uff0c\u5e76\u7ed9\u51fa\u6587\u6863\u7ea7\u4e0e\u4e0a\u4e0b\u6587\u7ea7\u4e24\u79cd\u6784\u9020\u65b9\u5f0f\uff1b\u8981\u70b9\u662f\u4ec5\u901a\u8fc7\u6570\u636e\u91cd\u6392\u5c31\u80fd\u5b66\u4f1a infill\uff0c\u65e0\u9700\u6539\u7f51\u7edc\u7ed3\u6784\u3002</li> </ul> <p>DeepSeek-Coder \u5728\u9884\u8bad\u7ec3\u65f6\u6df7\u5165 FIM\uff0c\u5e76\u505a\u6d88\u878d\u540e\u9009\u5b9a\u201cPSM\uff0c\u91c7\u6837\u7387\u7ea6 50%\u201d\uff0c\u5728\u4ee3\u7801\u8865\u5168\u4e0e FIM \u80fd\u529b\u4e4b\u95f4\u53d6\u5f97\u5e73\u8861\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_11","title":"\u8bad\u7ec3\u65f6\u5982\u4f55\u201c\u5582\u6570\u636e\u201d","text":"<p>\u4ee5\u4ee3\u7801\u6a21\u578b\u5e38\u7528\u7684\u54e8\u5175 token \u4e3a\u4f8b\uff08StarCoder \u6a21\u578b\u5361\u4e2d\u5c55\u793a\u4e86\u5b9e\u9645\u5199\u6cd5\uff09\uff1a <code>&lt;fim_prefix&gt;</code> \u8868\u793a\u524d\u7f00\u4f4d\u7f6e\uff0c<code>&lt;fim_suffix&gt;</code> \u8868\u793a\u540e\u7f00\u4f4d\u7f6e\uff0c<code>&lt;fim_middle&gt;</code> \u8868\u793a\u201c\u4ece\u8fd9\u91cc\u5f00\u59cb\u9884\u6d4b\u4e2d\u95f4\u6bb5\u201d\u3002\u8bad\u7ec3\u65f6\u628a\u6587\u672c\u91cd\u6392\u5e76\u76f4\u63a5\u7528\u666e\u901a\u81ea\u56de\u5f52\u635f\u5931\u3002([Hugging Face][3])</p> <p>\u635f\u5931\u5f62\u5f0f\u53ef\u5199\u6210 \\(L = -\\sum_{t\\in m}\\log P(x_t \\mid p,s,x_{&lt;t})\\)\uff0c\u5728\u5b9e\u73b0\u4e0a\u7b49\u4ef7\u4e3a\u5bf9\u201c\u91cd\u6392\u540e\u7684\u6574\u6bb5\u5e8f\u5217\u201d\u505a\u6807\u51c6 NLL\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#1python","title":"\u793a\u4f8b 1\uff1aPython \u4ee3\u7801\uff0c\u4e00\u884c\u88ab\u6316\u7a7a","text":"<p>\u539f\u6587\u7247\u6bb5</p> <pre><code>def area(r):\n    pi = 3.14159\n    return pi * r * r\n</code></pre> <p>\u4e00\u6b21\u968f\u673a\u5207\u5206</p> <ul> <li>p \u524d\u7f00</li> </ul> <pre><code>def area(r):\n    pi = 3.14159\n</code></pre> <ul> <li>m \u4e2d\u95f4</li> </ul> <pre><code>    return pi * r * r\n</code></pre> <ul> <li>s \u540e\u7f00</li> </ul> <pre><code>\n</code></pre> <p>\uff08\u6b64\u4f8b s \u4e3a\u7a7a\u884c\uff0c\u5b8c\u5168\u6ca1\u95ee\u9898\uff09</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#psm","title":"PSM \u8bad\u7ec3\u6837\u672c","text":"<p>\u628a p\u3001s \u653e\u524d\u9762\uff0cm \u653e\u540e\u9762\uff0c\u5e76\u52a0\u54e8\u5175\uff1a</p> <pre><code>&lt;fim_prefix&gt;def area(r):\n    pi = 3.14159\n&lt;fim_suffix&gt;\n\n&lt;fim_middle&gt;    return pi * r * r\n</code></pre> <p>\u6b64\u65f6\u6a21\u578b\u5728\u770b\u5230 <code>&lt;fim_middle&gt;</code> \u540e\uff0c\u6309\u666e\u901a\u5de6\u5230\u53f3\u76ee\u6807\u53bb\u9884\u6d4b\u201creturn pi * r * r\u201d\u7684\u6bcf\u4e2a token\uff0c\u7b49\u4ef7\u4e8e\u5b66\u4e60 \\(P(m\\mid p,s)\\)\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#spm","title":"SPM \u8bad\u7ec3\u6837\u672c","text":"<p>\u628a s\u3001p \u653e\u524d\u9762\uff0cm \u653e\u540e\u9762\uff1a</p> <pre><code>&lt;fim_prefix&gt;\n\n&lt;fim_suffix&gt;def area(r):\n    pi = 3.14159\n&lt;fim_middle&gt;    return pi * r * r\n</code></pre> <p>SPM \u7684\u597d\u5904\u4e4b\u4e00\u662f\u63a8\u7406\u65f6\u66f4\u5229\u4e8e\u7f13\u5b58\u590d\u7528\uff0c\u4f46\u8bad\u7ec3\u6cd5\u4ecd\u662f\u76f8\u540c\u7684\u201c\u91cd\u6392\u52a0\u81ea\u56de\u5f52\u201d\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#2","title":"\u793a\u4f8b 2\uff1a\u591a\u884c\u63d2\u5165\u7684\u5178\u578b\u7f16\u8f91\u573a\u666f","text":"<p>\u539f\u6587\u7247\u6bb5</p> <pre><code>def load_config(path):\n    data = json.load(open(path))\n    return data\n</code></pre> <p>\u5207\u5206\u5f97\u5230</p> <ul> <li>p</li> </ul> <pre><code>def load_config(path):\n</code></pre> <ul> <li>m</li> </ul> <pre><code>    if not os.path.exists(path):\n        raise FileNotFoundError(path)\n</code></pre> <ul> <li>s</li> </ul> <pre><code>    data = json.load(open(path))\n    return data\n</code></pre>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#psm_1","title":"PSM \u8bad\u7ec3\u6837\u672c","text":"<pre><code>&lt;fim_prefix&gt;def load_config(path):\n&lt;fim_suffix&gt;    data = json.load(open(path))\n    return data\n&lt;fim_middle&gt;    if not os.path.exists(path):\n        raise FileNotFoundError(path)\n</code></pre> <p>\u8bad\u7ec3\u65f6\uff0c\u635f\u5931\u4e3b\u8981\u843d\u5728 <code>&lt;fim_middle&gt;</code> \u4e4b\u540e\u7684 m \u4e0a\uff1b\u4f46\u5b9e\u73b0\u5c42\u9762\u901a\u5e38\u5bf9\u6574\u6bb5\u5e8f\u5217\u505a\u6807\u51c6 LM \u635f\u5931\uff0c\u8fd9\u6b63\u662f OpenAI FIM \u7684\u201c\u4ec5\u9760\u6570\u636e\u91cd\u6392\u5373\u53ef\u5b66\u4e60\u201d\u7684\u5173\u952e\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#spm_1","title":"SPM \u8bad\u7ec3\u6837\u672c","text":"<pre><code>&lt;fim_prefix&gt;    data = json.load(open(path))\n    return data\n&lt;fim_suffix&gt;def load_config(path):\n&lt;fim_middle&gt;    if not os.path.exists(path):\n        raise FileNotFoundError(path)\n</code></pre>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-Coder%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%96%B9%E6%A1%88/#_12","title":"\u63a8\u7406\u65f6\u600e\u4e48\u7528\uff08\u4e0e\u8bad\u7ec3\u76ee\u6807\u5bf9\u9f50\uff09","text":"<p>\u63a8\u7406\u65f6\u628a\u5df2\u77e5\u7684\u524d\u7f00\u4e0e\u540e\u7f00\u653e\u5728 <code>&lt;fim_prefix&gt;...&lt;fim_suffix&gt;...&lt;fim_middle&gt;</code> \u6a21\u677f\u91cc\uff0c\u6a21\u578b\u7eed\u5199\u201c\u4e2d\u95f4\u201d\u3002\u4f8b\u5982 StarCoder \u7684\u6a21\u578b\u5361\u7ed9\u51fa\u7684\u6700\u5c0f\u8c03\u7528\u793a\u4f8b\uff1a <code>&lt;fim_prefix&gt;def print_hello_world():\\n&lt;fim_suffix&gt;\\n    print('Hello world!')&lt;fim_middle&gt;</code>\uff0c\u6a21\u578b\u5c06\u751f\u6210\u7f3a\u5931\u7684\u4e2d\u95f4\u90e8\u5206\u3002</p>","tags":["LLM","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/","title":"DeepSeek-R1\uff1a\u901a\u8fc7\u5f3a\u5316\u5b66\u4e60\u6fc0\u52b1LLM\u63a8\u7406\u80fd\u529b","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#_1","title":"\u7814\u7a76\u52a8\u673a\u4e0e\u80cc\u666f","text":"<p>\u8fd1\u5e74\u6765\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u7684\u63a8\u7406\u80fd\u529b\u6210\u4e3a\u7814\u7a76\u70ed\u70b9\u3002OpenAI\u7b49\u516c\u53f8\u901a\u8fc7\u6269\u5c55\u63a8\u7406\u94fe\uff08Chain-of-Thought, CoT\uff09\u7684\u957f\u5ea6\uff0c\u63d0\u9ad8\u4e86\u6a21\u578b\u5728\u6570\u5b66\u3001\u7f16\u7a0b\u7b49\u590d\u6742\u4efb\u52a1\u4e0a\u7684\u8868\u73b0\u3002OpenAI\u5185\u90e8\u7684\u201co1\u201d\u7cfb\u5217\u6a21\u578b\u7387\u5148\u5728\u63a8\u7406\u65f6\u901a\u8fc7\u5ef6\u957f\u601d\u7ef4\u94fe\u53d6\u5f97\u663e\u8457\u6548\u679c\uff1b\u7136\u800c\uff0c\u8fd9\u79cd\u63a8\u7406\u957f\u5ea6\u6269\u5c55\u7684\u6709\u6548\u6027\u5982\u4f55\u5728\u901a\u7528\u6d4b\u8bd5\u65f6\u4fdd\u6301\u4f9d\u7136\u662f\u60ac\u800c\u672a\u51b3\u7684\u95ee\u9898\u3002\u5b66\u754c\u4e5f\u5728\u63a2\u7d22\u4e0d\u540c\u65b9\u6cd5\u589e\u5f3aLLM\u63a8\u7406\u80fd\u529b\uff0c\u5305\u62ec\u8fc7\u7a0b\u7ea7\u5956\u52b1\u6a21\u578b\uff08\u5bf9\u63a8\u7406\u8fc7\u7a0b\u9010\u6b65\u8bc4\u5206\uff09\u3001\u5f3a\u5316\u5b66\u4e60(RL)\u7b56\u7565\uff0c\u4ee5\u53ca\u641c\u7d22\u7b97\u6cd5\uff08\u5982\u8499\u7279\u5361\u6d1b\u6811\u641c\u7d22 MCTS \u6216 Beam Search\uff09\u3002\u7136\u800c\uff0c\u8fd9\u4e9b\u5c1d\u8bd5\u90fd\u672a\u80fd\u8fbe\u5230 OpenAI o1 \u7cfb\u5217\u6a21\u578b\u7684\u7efc\u5408\u63a8\u7406\u6c34\u51c6\u3002</p> <p>\u7814\u7a76\u52a8\u673a\uff1a\u4e0a\u8ff0\u80cc\u666f\u4e0b\uff0cDeepSeek \u56e2\u961f\u63d0\u51fa\u95ee\u9898\uff1a\u80fd\u5426\u4e0d\u7528\u4efb\u4f55\u76d1\u7763\u5fae\u8c03\u6570\u636e\uff0c\u4ec5\u901a\u8fc7\u5927\u89c4\u6a21\u5f3a\u5316\u5b66\u4e60\u663e\u8457\u63d0\u5347LLM\u7684\u63a8\u7406\u80fd\u529b\uff1f \u76d1\u7763\u6570\u636e\u7684\u83b7\u53d6\u4ee3\u4ef7\u9ad8\u6602\uff0c\u800c\u4e14\u4ee5\u5f80\u6211\u4eec\u7684\u5de5\u4f5c\u4e5f\u8868\u660e\u8fc7\u5ea6\u4f9d\u8d56\u76d1\u7763\u6570\u636e\u3002\u56e0\u6b64\uff0c\u4f5c\u8005\u5e0c\u671b\u63a2\u7d22\u7eafRL\u8bad\u7ec3LLM\u63a8\u7406\u7684\u6f5c\u529b\uff0c\u9f13\u52b1\u6a21\u578b\u5728\u5f3a\u5316\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u81ea\u6211\u8fdb\u5316\u51fa\u63a8\u7406\u80fd\u529b\u3002\u8fd9\u4e00\u65b9\u5411\u7684\u610f\u4e49\u5728\u4e8e\uff0c\u5982\u679c\u6210\u529f\uff0c\u5c06\u8bc1\u660e\u65e0\u9700\u4eba\u5de5\u6807\u6ce8\u8fc7\u7a0b\uff0cLLM\u4e5f\u53ef\u901a\u8fc7\u5956\u52b1\u4fe1\u53f7\u81ea\u53d1\u5b66\u4f1a\u590d\u6742\u63a8\u7406\u3002\u540c\u65f6\uff0c\u4f5c\u8005\u53d7\u5230OpenAI o1\u6a21\u578b\u542f\u53d1\uff0c\u5e0c\u671b\u5f00\u6e90\u4e00\u4e2a\u6027\u80fd\u53ef\u5ab2\u7f8e\u95ed\u6e90\u6a21\u578b\u7684\u63a8\u7406LLM\uff0c\u4e3a\u793e\u533a\u63d0\u4f9b\u7814\u7a76\u548c\u5e94\u7528\u57fa\u7840\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#_2","title":"\u65b9\u6cd5\u8bba\u8be6\u89e3","text":"<p>\u672c\u8bba\u6587\u63d0\u51fa\u4e86DeepSeek-R1\u7cfb\u5217\u6a21\u578b\uff0c\u5305\u62ecDeepSeek-R1-Zero\u548c\u6539\u8fdb\u7248DeepSeek-R1\u3002\u6838\u5fc3\u601d\u8def\u662f\u5728\u4e00\u4e2a\u5927\u578b\u57fa\u7840\u6a21\u578b\u4e0a\uff0c\u5229\u7528\u5f3a\u5316\u5b66\u4e60\uff08reinforcement learning\uff09\u7b56\u7565\u4f18\u5316\u6765\u6fc0\u52b1\u6a21\u578b\u4ea7\u751f\u66f4\u5f3a\u7684\u63a8\u7406\u884c\u4e3a\uff0c\u540c\u65f6\u7ed3\u5408\u5c11\u91cf\u9ad8\u8d28\u91cf\u6570\u636e\u548c\u591a\u9636\u6bb5\u8bad\u7ec3\u6d41\u7a0b\u6765\u63d0\u5347\u6a21\u578b\u53ef\u8bfb\u6027\u548c\u901a\u7528\u6027\u3002\u4e0b\u9762\u5206\u522b\u4ece\u6a21\u578b\u67b6\u6784\u3001\u8bad\u7ec3\u6d41\u7a0b\u3001\u5956\u52b1\u8bbe\u8ba1\u548c\u601d\u7ef4\u94fe\u7b56\u7565\u56db\u65b9\u9762\u8be6\u89e3\u5176\u65b9\u6cd5\u8bba\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#deepseek-r1","title":"\u6a21\u578b\u67b6\u6784\uff08DeepSeek-R1\uff09","text":"<p>\u57fa\u7840\u6a21\u578b\uff1a \u4f5c\u8005\u4ee5\u81ea\u5bb6\u7684 DeepSeek-V3-Base \u4f5c\u4e3a\u521d\u59cb\u57fa\u7840\u6a21\u578b\uff08\u53c2\u6570\u89c4\u6a21\u7ea637B\u6fc0\u6d3b\u53c2\u6570\uff0c\u5e95\u5c42\u4e3aMixture-of-Experts\u67b6\u6784\uff09\u3002\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u4ed6\u4eec\u6784\u5efa\u4e24\u4e2a\u7248\u672c\uff1a</p> <ul> <li>DeepSeek-R1-Zero\uff1a \u76f4\u63a5\u5728\u57fa\u7840\u6a21\u578b\u4e0a\u8fdb\u884c\u7eaf\u5f3a\u5316\u5b66\u4e60\u8bad\u7ec3(\u65e0\u4efb\u4f55\u76d1\u7763\u5fae\u8c03)\u5f97\u5230\u7684\u6a21\u578b\u3002R1-Zero\u8bc1\u660e\u4e86\u7eafRL\u53ef\u4ee5\u8d4b\u4e88\u6a21\u578b\u5f3a\u5927\u7684\u63a8\u7406\u80fd\u529b\u3002</li> <li>DeepSeek-R1\uff1a \u5728 R1-Zero \u7684\u7ecf\u9a8c\u57fa\u7840\u4e0a\uff0c\u901a\u8fc7\u5f15\u5165\u5c11\u91cf\u9ad8\u8d28\u91cf\u51b7\u542f\u52a8\u6570\u636e\u548c\u591a\u9636\u6bb5\u8bad\u7ec3Pipeline\u8fdb\u4e00\u6b65\u63d0\u5347\u6027\u80fd\u548c\u53ef\u7528\u6027\u7684\u6a21\u578b\u3002\u76f8\u6bd4\u4e8e R1-Zero\uff0c\u5b83\u5728\u8bad\u7ec3\u5f00\u59cb\u524d\u5148\u8fdb\u884c\u4e86\u4e00\u4e2a\u5c0f\u89c4\u6a21\u7684\u6709\u76d1\u7763\u5fae\u8c03\uff08\u51b7\u542f\u52a8\uff09\uff0c\u7136\u540e\u624d\u6267\u884c\u5927\u89c4\u6a21RL\uff0c\u5e76\u5728\u4e2d\u540e\u671f\u7ed3\u5408\u4e86\u989d\u5916\u7684\u76d1\u7763\u6570\u636e\u548c\u518d\u6b21RL\uff0c\u5f62\u6210\u4e00\u4e2a\u56db\u9636\u6bb5\u8bad\u7ec3\u6d41\u7a0b\u3002</li> </ul> <p>\u591a\u9636\u6bb5\u8bad\u7ec3Pipeline\uff1a DeepSeek-R1 \u7684\u8bad\u7ec3\u5305\u542b\u4ee5\u4e0b\u9636\u6bb5\uff1a</p> <ol> <li>\u51b7\u542f\u52a8\u5fae\u8c03 (Cold Start SFT)\uff1a\u6536\u96c6\u6570\u5343\u6761\u9ad8\u8d28\u91cf\u3001\u5e26\u6709\u8be6\u7ec6\u601d\u7ef4\u94fe\uff08CoT\uff09\u7684\u89e3\u9898\u793a\u4f8b\u6570\u636e\uff0c\u5bf9\u57fa\u7840\u6a21\u578b\u8fdb\u884c\u6709\u76d1\u7763\u5fae\u8c03\uff0c\u5f97\u5230\u521d\u59cb\u7b56\u7565\u6a21\u578b\u3002\u8fd9\u4e9b\u51b7\u542f\u52a8\u6570\u636e\u7279\u522b\u5173\u6ce8\u53ef\u8bfb\u6027\uff08\u786e\u4fdd\u63a8\u7406\u6b65\u9aa4\u6e05\u6670\u3001\u6709Markdown\u683c\u5f0f\u3001\u7ed3\u5c3e\u6709\u603b\u7ed3\uff09\u4ee5\u53ca\u5f15\u5165\u4eba\u7c7b\u5148\u9a8c\uff08\u5982\u5728\u56de\u7b54\u672b\u5c3e\u63d0\u4f9b\u603b\u7ed3\u7b49\uff09\uff0c\u4ee5\u5f25\u8865\u7eafRL\u76f4\u63a5\u8bad\u7ec3\u65f6\u6a21\u578b\u5185\u5bb9\u53ef\u8bfb\u6027\u5dee\u3001\u6df7\u6742\u591a\u8bed\u8a00\u7b49\u7f3a\u9677\u3002</li> <li>\u7b2c\u4e00\u9636\u6bb5\u5f3a\u5316\u5b66\u4e60 (Reasoning-oriented RL)\uff1a\u5728\u51b7\u542f\u52a8\u540e\u7684\u6a21\u578b\u4e0a\uff0c\u5bf9\u6570\u5b66\u3001\u4ee3\u7801\u3001\u903b\u8f91\u63a8\u7406\u7b49\u6709\u660e\u786e\u5ba2\u89c2\u6807\u51c6\u7684\u4efb\u52a1\u8fdb\u884c\u5927\u89c4\u6a21RL\u8bad\u7ec3\u3002\u91c7\u7528\u7fa4\u4f53\u76f8\u5bf9\u7b56\u7565\u4f18\u5316(Group Relative Policy Optimization, GRPO)\u7b97\u6cd5\u6765\u9ad8\u6548\u66f4\u65b0\u7b56\u7565\uff0c\u5e76\u4f7f\u7528\u89c4\u5219\u5956\u52b1\uff08\u5224\u65ad\u7b54\u6848\u6b63\u786e\u6027\u548c\u683c\u5f0f\uff09\u5f15\u5bfc\u6a21\u578b\u66f4\u597d\u5730\u5b8c\u6210\u63a8\u7406\u4efb\u52a1\u3002\u6b64\u9636\u6bb5\u7740\u91cd\u63d0\u5347\u6a21\u578b\u7684\u601d\u7ef4\u94fe\u957f\u5ea6\u548c\u6b63\u786e\u7387\u3002\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\uff0c\u6a21\u578b\u81ea\u7136\u503e\u5411\u4e8e\u5728\u63a8\u7406\u65f6\u751f\u6210\u66f4\u957f\u7684\u601d\u7ef4\u94fe\uff0c\u4ece\u6700\u521d\u4ec5\u8f93\u51fa\u77ed\u7b54\u6848\u9010\u6b65\u8fdb\u5316\u5230\u8f93\u51fa\u6570\u767e\u4e0a\u5343\u4e2a\u63a8\u7406\u6807\u8bb0\uff0c\u663e\u8457\u6df1\u5316\u4e86\u89e3\u9898\u6b65\u9aa4\u3002\u7ecf\u8fc7\u6570\u5343\u6b65RL\u8bad\u7ec3\uff0cDeepSeek-R1-Zero\u5728AIME\u6570\u5b66\u7ade\u8d5b\u7b49\u57fa\u51c6\u4e0a\u7684Pass@1\u51c6\u786e\u7387\u4ece15.6%\u8dc3\u5347\u81f371.0%\uff0c\u5df2\u7ecf\u63a5\u8fd1OpenAI-o1-0912\u6a21\u578b\uff1b\u518d\u901a\u8fc7\u591a\u6570\u51b3\u7b56\u7565\uff0c\u53ef\u8fdb\u4e00\u6b65\u63d0\u9ad8\u523086.7%\uff0c\u8d85\u8d8aOpenAI-o1-0912\u3002</li> <li>\u7b2c\u4e8c\u9636\u6bb5\u76d1\u7763\u5fae\u8c03 (Rejection Sampling SFT)\uff1a\u5f53\u7b2c\u4e00\u9636\u6bb5\u7684RL\u8bad\u7ec3\u8d8b\u4e8e\u6536\u655b\u540e\uff0c\u4f5c\u8005\u51bb\u7ed3\u6a21\u578b\uff0c\u7528\u5176\u751f\u6210\u65b0\u6570\u636e\u6765\u6269\u5927\u8bad\u7ec3\u96c6\uff0c\u7136\u540e\u518d\u5fae\u8c03\u6a21\u578b\u3002\u5177\u4f53\u800c\u8a00\uff0c\u4e00\u65b9\u9762\u9488\u5bf9\u63a8\u7406\u7c7b\u4efb\u52a1\uff0c\u5229\u7528\u5f53\u524d\u6a21\u578b\u4ea7\u751f\u7684\u601d\u7ef4\u94fe\u7b54\u6848\u6267\u884c\u62d2\u7edd\u91c7\u6837\uff1a\u5bf9\u6bcf\u4e2a\u95ee\u9898\u751f\u6210\u591a\u4e2a\u89e3\u7b54\uff0c\u7b5b\u9009\u51fa\u6b63\u786e\u4e14\u683c\u5f0f\u826f\u597d\u7684\u56de\u7b54\u3002\u4e3a\u5224\u522b\u6b63\u786e\u6027\uff0c\u6709\u7684\u76f4\u63a5\u7528\u89c4\u5219\uff08\u5982\u6570\u5b66\u7b54\u6848\u6bd4\u5bf9\uff09\uff0c\u6709\u7684\u5f15\u5165\u751f\u6210\u5f0f\u5956\u52b1\u6a21\u578b\uff0c\u4ece\u800c\u83b7\u53d6\u7ea660\u4e07\u6761\u9ad8\u8d28\u91cf\u601d\u7ef4\u94fe\u6570\u636e\u3002\u53e6\u4e00\u65b9\u9762\u9488\u5bf9\u975e\u63a8\u7406\u4efb\u52a1(\u5982\u5199\u4f5c\u3001\u95ee\u7b54\u3001\u89d2\u8272\u626e\u6f14\u7b49)\uff0c\u90e8\u5206\u590d\u7528DeepSeek-V3\u7684\u5df2\u6709\u76d1\u7763\u6570\u636e\uff0c\u5e76\u8ba9DeepSeek-V3\u5148\u4ea7\u751f\u65e5\u5fd7\u5f0f\u601d\u7ef4\u94fe\u518d\u7ed9\u6700\u7ec8\u7b54\u6848\uff0c\u4ee5\u63d0\u5347\u8fd9\u4e9b\u4efb\u52a1\u7684\u6570\u636e\u8d28\u91cf\u3002\u6700\u7ec8\u6c47\u96c6\u7ea680\u4e07\u6761\u65b0\u6570\u636e\uff08\u542b\u7ea660\u4e07\u63a8\u7406\u7c7b+20\u4e07\u975e\u63a8\u7406\u7c7b\uff09\uff0c\u518d\u5bf9\u6a21\u578b\u8fdb\u884c\u4e24\u8f6e\u5fae\u8c03\u3002\u8fd9\u4e00\u9636\u6bb5\u4f7f\u6a21\u578b\u62d3\u5c55\u80fd\u529b\u9886\u57df\uff0c\u5e76\u63d0\u5347\u8f93\u51fa\u7684\u6d41\u7545\u6027\u548c\u591a\u6837\u6027\u3002</li> <li>\u7b2c\u4e09\u9636\u6bb5\u5f3a\u5316\u5b66\u4e60 (RL for All Scenarios)\uff1a\u6700\u540e\uff0c\u4f5c\u8005\u8fdb\u884c\u7b2c\u4e8c\u8f6eRL\u8bad\u7ec3\uff0c\u4f7f\u6a21\u578b\u5728\u5bf9\u9f50\u4eba\u7c7b\u504f\u597d\u7684\u540c\u65f6\u5de9\u56fa\u63a8\u7406\u80fd\u529b\u3002\u6b64\u9636\u6bb5\u540c\u65f6\u9488\u5bf9\u63a8\u7406\u7c7b\u548c\u5e38\u89c4\u5bf9\u8bdd\u7c7b\u573a\u666f\uff1a\u5bf9\u4e8e\u6570\u5b66\u3001\u7f16\u7801\u7b49\u6709\u5ba2\u89c2\u6807\u51c6\u7684\u63a8\u7406\u4efb\u52a1\uff0c\u4ecd\u6cbf\u7528\u89c4\u5219\u5956\u52b1\uff08\u6b63\u786e\u6027\u9a8c\u8bc1 + \u8bed\u8a00\u4e00\u81f4\u6027\u7b49\uff09\uff1b\u5bf9\u4e8e\u5f00\u653e\u95ee\u7b54\u3001\u52a9\u7406\u5bf9\u8bdd\u7b49\u4e3b\u89c2\u4efb\u52a1\uff0c\u5f15\u5165\u8bad\u7ec3\u597d\u7684\u504f\u597d\u6a21\u578b\u4f5c\u4e3a\u5956\u52b1\u51fd\u6570\uff0c\u4ee5\u8861\u91cf\u56de\u7b54\u7684\u6709\u7528\u6027\uff08helpfulness\uff09\u548c\u65e0\u5bb3\u6027\uff08harmlessness\uff09\u3002\u5177\u4f53\u5730\uff0c\u504f\u597d\u6a21\u578b\u53ea\u5173\u6ce8\u56de\u7b54\u6700\u7ec8\u7684\u603b\u7ed3\u90e8\u5206\u6765\u8bc4\u4f30\u6709\u7528\u6027\uff0c\u4ee5\u514d\u5e72\u6270\u6a21\u578b\u63a8\u7406\u8fc7\u7a0b\uff1b\u800c\u5728\u65e0\u5bb3\u6027\u65b9\u9762\uff0c\u5219\u5bf9\u6a21\u578b\u5b8c\u6574\u54cd\u5e94\uff08\u5305\u62ec\u63a8\u7406\u8fc7\u7a0b\u548c\u7ed3\u8bba\uff09\u8fdb\u884c\u8bc4\u4f30\uff0c\u907f\u514d\u4efb\u4f55\u6f5c\u5728\u6709\u5bb3\u5185\u5bb9\u3002\u901a\u8fc7\u6574\u5408\u89c4\u5219+\u504f\u597d\u591a\u79cd\u5956\u52b1\u4fe1\u53f7\uff0c\u5e76\u6df7\u5408\u591a\u9886\u57df\u7684\u63d0\u793a\u8fdb\u884c\u8bad\u7ec3\uff0c\u6a21\u578b\u6700\u7ec8\u5f97\u5230\u5168\u9762\u4f18\u5316\u3002\u7ecf\u8fc7\u6b64\u9636\u6bb5\u5f97\u5230\u7684\u6700\u7ec8\u6a21\u578b\u5373DeepSeek-R1\uff0c\u5728\u591a\u9879\u63a8\u7406\u57fa\u51c6\u4e0a\u8fbe\u5230\u4e0eOpenAI-o1-1217\u76f8\u5f53\u7684\u6c34\u5e73\u3002</li> </ol> <p>\u6b64\u5916\uff0c\u4f5c\u8005\u8fd8\u5c06DeepSeek-R1\u7684\u63a8\u7406\u80fd\u529b\u84b8\u998f\u5230\u82e5\u5e72\u5c0f\u6a21\u578b\u4e2d\u3002\u4ed6\u4eec\u9009\u62e9\u4e86\u5f00\u6e90\u6a21\u578bQwen2.5\u548cLlama3\u7cfb\u5217\uff08\u53c2\u65701.5B\u81f370B\u4e0d\u7b49\uff09\u4f5c\u4e3a\u521d\u59cb\u6a21\u578b\uff0c\u4ec5\u7528\u4e0a\u4e00\u6b65\u751f\u6210\u768480\u4e07\u65b0\u6570\u636e\u8fdb\u884c\u5fae\u8c03\uff08\u4e0d\u518d\u8fdb\u884cRL\u8bad\u7ec3\uff09\u3002\u6709\u8da3\u7684\u662f\uff0c\u76f4\u63a5\u84b8\u998f\u5927\u6a21\u578b\u7684\u63a8\u7406\u6a21\u5f0f\u5230\u5c0f\u6a21\u578b\uff0c\u6548\u679c\u4f18\u4e8e\u5bf9\u5c0f\u6a21\u578b\u8fdb\u884cRL\u8bad\u7ec3\u5f97\u5230\u7684\u7ed3\u679c\u3002\u8fd9\u8868\u660e\u5927\u578b\u6a21\u578b\u4e2d\u5b66\u5230\u7684\u63a8\u7406\u6a21\u5f0f\u5bf9\u4e8e\u63d0\u5347\u5c0f\u6a21\u578b\u80fd\u529b\u81f3\u5173\u91cd\u8981\uff0c\u7b80\u5355\u5fae\u8c03\u5373\u53ef\u80dc\u8fc7\u5c0f\u6a21\u578b\u81ea\u8eab\u901a\u8fc7RL\u6478\u7d22\u7684\u6a21\u5f0f\u3002\u6700\u7ec8\u4f5c\u8005\u5f00\u6e90\u4e86\u4eceDeepSeek-R1\u84b8\u998f\u800c\u6765\u7684\u591a\u4e2a\u5c3a\u5bf8\u6a21\u578b\uff081.5B, 7B, 8B, 14B, 32B, 70B\uff09\uff0c\u4e3a\u793e\u533a\u63d0\u4f9b\u9ad8\u6027\u80fd\u7684\u7a20\u5bc6\u5c0f\u6a21\u578b\u63a8\u7406\u80fd\u529b\u57fa\u7840\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#_3","title":"\u5f3a\u5316\u5b66\u4e60\u8bad\u7ec3\u6d41\u7a0b","text":"<p>RL\u7b97\u6cd5\uff1a DeepSeek-R1 \u7cfb\u5217\u7684\u8bad\u7ec3\u6838\u5fc3\u662f\u7fa4\u4f53\u76f8\u5bf9\u7b56\u7565\u4f18\u5316\uff08Group Relative Policy Optimization, GRPO\uff09\u7b97\u6cd5\u3002GRPO\u662f\u5bf9\u4f20\u7edfPPO\u7684\u4e00\u79cd\u6539\u8fdb\uff1a\u5b83\u4e0d\u4f7f\u7528\u5355\u72ec\u7684\u4ef7\u503c\u51fd\u6570\u7f51\u7edc\uff08critic\uff09\u4f30\u8ba1\u57fa\u7ebf\uff0c\u800c\u662f\u901a\u8fc7\u91c7\u6837\u4e00\u7ec4\u65e7\u7b56\u7565\u6a21\u578b\u7684\u8f93\u51fa\u6765\u4f30\u8ba1\u5f53\u524d\u7b56\u7565\u7684\u76f8\u5bf9\u4f18\u52bf\u3002\u5177\u4f53\u800c\u8a00\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u7ed9\u5b9a\u7684\u95ee\u9898\uff0c\u5148\u7528\u65e7\u7b56\u7565\u751f\u6210\u4e00\u7ec4\u56de\u7b54\uff08\u5982N\u4e2a\u4e0d\u540c\u89e3\u7b54\uff09\uff0c\u6839\u636e\u6bcf\u4e2a\u56de\u7b54\u7684\u5956\u52b1\\(r_i\\)\u8ba1\u7b97\u51fa\u8be5\u7ec4\u7684\u5e73\u5747\u5956\u52b1\\(\\bar{r}\\)\uff0c\u7136\u540e\u5c06\u6bcf\u4e2a\u56de\u7b54\u7684\u4f18\u52bf\\(A_i\\)\u5b9a\u4e49\u4e3a \\(A_i = r_i - \\bar{r}\\)\u3002\u4f18\u5316\u76ee\u6807\u662f\u6700\u5927\u5316\u65b0\u7b56\u7565\u5bf9\u8fd9\u4e9b\u56de\u7b54\u7684\u5bf9\u6570\u6982\u7387\u52a0\u6743\u7684\u671f\u671b\uff1a \\(J(\\theta) = \\mathbb{E}_{a_{1:N}\\sim \\pi_{\\text{old}}}\\left[\\sum_{i=1}^N \\log \\pi_\\theta(a_i|x)\\,A_i\\right],\\) \u540c\u65f6\u5728\u5b9e\u73b0\u4e2d\u52a0\u5165\u7c7b\u4f3cPPO\u7684\u9650\u5236\uff08\u4f8b\u5982KL\u6563\u5ea6\u7ea6\u675f\uff09\u4ee5\u4fdd\u8bc1\u66f4\u65b0\u7a33\u5b9a\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u6cd5\uff0cGRPO\u7528\u4e00\u6279\u6837\u672c\u81ea\u8eab\u7684\u5e73\u5747\u8868\u73b0\u5f53\u4f5c\u57fa\u7ebf\uff0c\u65e2\u8282\u7701\u4e86\u8bad\u7ec3\u4e00\u4e2a\u540c\u89c4\u6a21\u4ef7\u503c\u6a21\u578b\u7684\u5f00\u9500\uff0c\u53c8\u5145\u5206\u5229\u7528\u4e86\u7fa4\u4f53\u53cd\u9988\u8fdb\u884c\u7a33\u5b9a\u66f4\u65b0\u3002\u4f5c\u8005\u91c7\u7528GRPO\u5bf9\u6a21\u578b\u8fdb\u884c\u5927\u89c4\u6a21RL\u5fae\u8c03\uff0c\u5728\u6570\u5343\u6b65\u66f4\u65b0\u540e\uff0c\u89c2\u5bdf\u5230\u6a21\u578b\u6d8c\u73b0\u51fa\u8bb8\u591a\u5f3a\u5927\u7684\u63a8\u7406\u884c\u4e3a\u548c\u6027\u80fd\u8dc3\u5347\u3002</p> <p>\u8bad\u7ec3\u8bbe\u7f6e\uff1a RL\u8bad\u7ec3\u4e3b\u8981\u5728\u6570\u5b66\u3001\u7f16\u7a0b\u3001\u903b\u8f91\u63a8\u7406\u7b49\u4efb\u52a1\u4e0a\u8fdb\u884c\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u4efb\u52a1\u6709\u660e\u786e\u7684\u5ba2\u89c2\u5956\u52b1\u4fe1\u53f7\uff08\u5982\u7b54\u6848\u5bf9\u9519\u53ef\u5224\u5b9a\uff09\u3002\u6bcf\u6b21\u8fed\u4ee3\u4e2d\uff0c\u6a21\u578b\u9488\u5bf9\u7ed9\u5b9a\u95ee\u9898\u8f93\u51fa\u5e26\u601d\u7ef4\u94fe\u7684\u7b54\u6848\uff0c\u5229\u7528\u9884\u5148\u8bbe\u5b9a\u7684\u89c4\u5219\u8ba1\u7b97\u5956\u52b1\uff0c\u7136\u540e\u6839\u636eGRPO\u7b97\u6cd5\u8c03\u6574\u6a21\u578b\u53c2\u6570\u3002\u4e3a\u4fdd\u8bc1\u6a21\u578b\u5728\u63a8\u7406\u8fc7\u7a0b\u4e2d\u9075\u5faa\u6307\u5b9a\u683c\u5f0f\uff0c\u4f5c\u8005\u5728RL\u5bf9\u8bdd\u6a21\u677f\u4e2d\u8981\u6c42\u52a9\u7406\u5c06\u201c\u601d\u8003\u8fc7\u7a0b\u201d\u548c\u201c\u6700\u7ec8\u7b54\u6848\u201d\u5206\u522b\u8f93\u51fa\u5728 <code>&lt;think&gt;...&lt;/think&gt;</code> \u548c <code>&lt;answer&gt;...&lt;/answer&gt;</code> \u6807\u7b7e\u5185\u3002\u6b64\u5916\uff0c\u8bbe\u7f6e\u4e86\u683c\u5f0f\u5956\u52b1\u9f13\u52b1\u6a21\u578b\u4e25\u683c\u9075\u5b88\u8fd9\u79cd\u683c\u5f0f\u3002\u6574\u4e2aRL\u8bad\u7ec3\u5206\u4e24\u5927\u9636\u6bb5\u8fdb\u884c\uff1a\u9996\u5148\u662f\u4ec5\u5173\u6ce8\u63a8\u7406\u4efb\u52a1\u6b63\u786e\u7387\u548c\u683c\u5f0f\u7684\u63a8\u7406\u5f3a\u5316\u5b66\u4e60\u9636\u6bb5\uff0c\u5176\u6b21\u662f\u5728\u5f15\u5165\u66f4\u591a\u4efb\u52a1\u548c\u504f\u597d\u6a21\u578b\u540e\u7684\u5168\u573a\u666f\u5f3a\u5316\u5b66\u4e60\u9636\u6bb5\u3002\u5728\u7b2c\u4e8c\u9636\u6bb5RL\u4e2d\uff0c\u9488\u5bf9\u6a21\u578b\u63a8\u7406\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u7684\u591a\u8bed\u8a00\u6df7\u7528\u95ee\u9898\uff0c\u4f5c\u8005\u8fd8\u989d\u5916\u8bbe\u8ba1\u4e86\u8bed\u8a00\u4e00\u81f4\u6027\u5956\u52b1\uff1a\u8ba1\u7b97\u63a8\u7406\u94fe\u4e2d\u76ee\u6807\u8bed\u8a00\uff08\u5982\u82f1\u6587\u6216\u4e2d\u6587\uff09\u7684\u8bcd\u5360\u6bd4\uff0c\u5c06\u5176\u4f5c\u4e3a\u5956\u52b1\u7684\u4e00\u90e8\u5206\u3002\u5c3d\u7ba1\u52a0\u5165\u8be5\u9879\u5956\u52b1\u53ef\u80fd\u7565\u5fae\u964d\u4f4e\u6a21\u578b\u5728\u4e00\u4e9b\u6307\u6807\u4e0a\u7684\u5206\u6570\uff0c\u4f46\u663e\u8457\u63d0\u5347\u4e86\u601d\u7ef4\u94fe\u5bf9\u4eba\u7c7b\u7684\u53ef\u8bfb\u6027\u548c\u5355\u4e00\u8bed\u8a00\u8fde\u8d2f\u6027\u3002\u6700\u7ec8\u7efc\u5408\u51c6\u786e\u6027\u5956\u52b1 + \u8bed\u8a00\u4e00\u81f4\u6027\u5956\u52b1\u4f5c\u4e3a\u603b\u5956\u52b1\u6765\u8bad\u7ec3\u6a21\u578b\uff0c\u76f4\u81f3\u5728\u4e3b\u8981\u63a8\u7406\u4efb\u52a1\u4e0a\u6536\u655b\u3002</p> <p>\u5956\u52b1\u6a21\u578b\u8bbe\u8ba1\uff1a DeepSeek-R1 \u7684\u5956\u52b1\u8bbe\u8ba1\u9075\u5faa\u5148\u7b80\u5355\u540e\u590d\u6742\u3001\u80fd\u89c4\u5219\u5c31\u4e0d\u795e\u7ecf\u7684\u539f\u5219\u3002\u5728\u521d\u59cb\u7684\u7eafRL\u9636\u6bb5\uff08\u8bad\u7ec3 R1-Zero\uff09\u4e2d\uff0c\u4f5c\u8005\u5b8c\u5168\u4e0d\u4f7f\u7528\u8bad\u7ec3\u5f97\u5230\u7684\u795e\u7ecf\u7f51\u7edc\u5956\u52b1\u6a21\u578b\uff0c\u800c\u662f\u91c7\u7528\u4e86\u7eaf\u89c4\u5219\u578b\u5956\u52b1\uff1a</p> <ul> <li>\u51c6\u786e\u6027\u5956\u52b1\uff08Accuracy reward\uff09\uff1a \u9488\u5bf9\u6709\u6807\u51c6\u7b54\u6848\u7684\u4efb\u52a1\uff0c\u68c0\u67e5\u6a21\u578b\u7ed9\u51fa\u7684\u6700\u7ec8\u7b54\u6848\u662f\u5426\u6b63\u786e\u3002\u5982\u679c\u6b63\u786e\u5219\u7ed9\u4e88\u6b63\u5956\u52b1\uff0c\u9519\u8bef\u5219\u4e0d\u7ed9\u4e88\u3002\u4f8b\u5982\uff0c\u6570\u5b66\u8ba1\u7b97\u9898\u8981\u6c42\u6a21\u578b\u628a\u6700\u540e\u7b54\u6848\u7528\u7279\u5b9a\u683c\u5f0f\uff08\u5982 <code>$\\boxed{42}$</code>\uff09\u7ed9\u51fa\uff0c\u8fd9\u6837\u7a0b\u5e8f\u53ef\u4ee5\u76f4\u63a5\u5339\u914d\u9a8c\u8bc1\u7ed3\u679c\u662f\u5426\u6b63\u786e\u3002\u53c8\u5982\u7f16\u7a0b\u9898\uff0c\u53ef\u4ee5\u5c06\u6a21\u578b\u8f93\u51fa\u7684\u4ee3\u7801\u8fd0\u884c\u6d4b\u8bd5\u7528\u4f8b\uff0c\u770b\u662f\u5426\u901a\u8fc7\uff0c\u4ee5\u6b64\u8bc4\u4f30\u6b63\u786e\u6027\u3002</li> <li>\u683c\u5f0f\u5956\u52b1\uff08Format reward\uff09\uff1a\u9f13\u52b1\u6a21\u578b\u5c06\u601d\u7ef4\u8fc7\u7a0b\u548c\u7b54\u6848\u5206\u522b\u653e\u5728\u9884\u5b9a\u6807\u7b7e\u5185\uff08<code>&lt;think&gt;</code> \u548c <code>&lt;answer&gt;</code>\uff09\uff0c\u60e9\u7f5a\u4e0d\u7b26\u5408\u683c\u5f0f\u7684\u8f93\u51fa\u3002\u8fd9\u4fdd\u8bc1\u4e86\u6a21\u578b\u663e\u5f0f\u8f93\u51fa\u63a8\u7406\u8fc7\u7a0b\uff0c\u4fbf\u4e8e\u9605\u8bfb\u548c\u540e\u7eed\u5904\u7406\u3002</li> </ul> <p>\u4f5c\u8005\u7279\u610f\u672a\u91c7\u7528\u4efb\u4f55\u57fa\u4e8e\u795e\u7ecf\u7f51\u7edc\u7684\u8fc7\u7a0b/\u7ed3\u679c\u5956\u52b1\u6a21\u578b\uff0c\u56e0\u4e3a\u4ed6\u4eec\u53d1\u73b0\u4f7f\u7528\u5b66\u4e60\u5f97\u5230\u7684\u5956\u52b1\u6a21\u578b\u5728\u5927\u89c4\u6a21RL\u8fc7\u7a0b\u4e2d\u5bb9\u6613\u51fa\u73b0\u5956\u52b1\u6ee5\u7528\uff08reward hacking\uff09\u95ee\u9898\u3002\u6b64\u5916\uff0c\u8bad\u7ec3\u548c\u66f4\u65b0\u4e00\u4e2a\u590d\u6742\u7684\u5956\u52b1\u6a21\u578b\u9700\u8981\u989d\u5916\u7684\u7b97\u529b\uff0c\u5e76\u589e\u52a0\u4e86\u6574\u4f53Pipeline\u7684\u590d\u6742\u5ea6\u3002\u56e0\u6b64\uff0cR1-Zero\u9636\u6bb5\u7eaf\u7cb9\u4f9d\u8d56\u89c4\u5219\u5224\u522b\u6765\u63d0\u4f9b\u53cd\u9988\u4fe1\u53f7\uff0c\u65e2\u7b80\u5355\u6709\u6548\u53c8\u907f\u514d\u4e86\u6a21\u578b\u5b66\u4f1a\u6295\u673a\u53d6\u5de7 maximization\u3002</p> <p>\u5728\u540e\u7eed\u7684DeepSeek-R1\u8bad\u7ec3\u4e2d\uff08\u5373\u5f15\u5165\u51b7\u542f\u52a8\u6570\u636e\u540e\uff09\uff0c\u7531\u4e8e\u9700\u8981\u6a21\u578b\u5177\u5907\u66f4\u597d\u7684\u591a\u4efb\u52a1\u8868\u73b0\u548c\u5bf9\u9f50\u4eba\u7c7b\u504f\u597d\uff0c\u5956\u52b1\u8bbe\u8ba1\u4e5f\u76f8\u5e94\u4e30\u5bcc\uff1a</p> <ul> <li>\u5728\u63a8\u7406\u4efb\u52a1\u4e0a\uff0c\u7ee7\u7eed\u6cbf\u7528\u89c4\u5219\u51c6\u786e\u6027\u5956\u52b1\uff0c\u5e76\u52a0\u5165\u4e0a\u8ff0\u8bed\u8a00\u4e00\u81f4\u6027\u5956\u52b1\uff0c\u786e\u4fdd\u63a8\u7406\u94fe\u6e05\u6670\u5355\u8bed\u8868\u8fbe\u3002</li> <li>\u5728\u901a\u7528\u5bf9\u8bdd\u4efb\u52a1\u4e0a\uff0c\u5f15\u5165\u9884\u8bad\u7ec3\u597d\u7684\u4eba\u7c7b\u504f\u597d\u5956\u52b1\u6a21\u578b\uff0c\u5206\u522b\u5ea6\u91cf\u56de\u7b54\u662f\u5426\u6709\u5e2e\u52a9\uff08helpful\uff09\u548c\u65e0\u5bb3\uff08harmless\uff09\u3002\u8bad\u7ec3\u65f6\u5bf9\u4e8e\u6bcf\u4e2a\u56de\u7b54\uff0c\u65e2\u8ba1\u7b97\u6765\u81ea\u504f\u597d\u6a21\u578b\u7684\u5f97\u5206\uff0c\u53c8\u8ba1\u7b97\u63a8\u7406\u7c7b\u95ee\u9898\u7684\u89c4\u5219\u5f97\u5206\uff0c\u5c06\u4e8c\u8005\u9002\u5f53\u52a0\u6743\u4f5c\u4e3a\u6700\u7ec8\u5956\u52b1\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u6709\u5e2e\u52a9\u5ea6\u4ec5\u8003\u5bdf\u6700\u7ec8\u7b54\u6848\u90e8\u5206\uff0c\u4ee5\u514d\u6a21\u578b\u4e3a\u4e86\u8fce\u5408\u5956\u52b1\u5728\u63a8\u7406\u8fc7\u7a0b\u4e2d\u4ea7\u51fa\u8fce\u5408\u6027\u5185\u5bb9\uff1b\u800c\u65e0\u5bb3\u6027\u5219\u9488\u5bf9\u5b8c\u6574\u54cd\u5e94\u8bc4\u4f30\uff0c\u4ee5\u675c\u7edd\u601d\u7ef4\u94fe\u6216\u7b54\u6848\u4e2d\u51fa\u73b0\u4e0d\u5f53\u5185\u5bb9\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u6a21\u578b\u5728\u4fdd\u6301\u63a8\u7406\u80fd\u529b\u63d0\u5347\u7684\u540c\u65f6\uff0c\u4e5f\u5b66\u4f1a\u8f93\u51fa\u7528\u6237\u66f4\u6ee1\u610f\u3001\u5b89\u5168\u7684\u7b54\u6848\u3002</li> </ul> <p>\u603b\u4f53\u800c\u8a00\uff0cDeepSeek-R1 \u7684\u5956\u52b1\u4f53\u7cfb\u5148\u540e\u7ecf\u5386\u4e86\u89c4\u5219\u5956\u52b1 \u2192 \u89c4\u5219+\u504f\u597d\u5956\u52b1\u7684\u6f14\u8fdb\u3002\u521d\u671f\u7528\u786c\u89c4\u5219\u5f15\u5bfc\u6a21\u578b\u638c\u63e1\u57fa\u672c\u63a8\u7406\u548c\u683c\u5f0f\u80fd\u529b\uff0c\u4e2d\u671f\u7ed3\u5408\u8bed\u8a00\u504f\u597d\u63d0\u5347\u53ef\u8bfb\u6027\uff0c\u540e\u671f\u878d\u5165\u8f6f\u504f\u597d\u6a21\u578b\u5b9e\u73b0\u4ef7\u503c\u89c2\u5bf9\u9f50\u548c\u901a\u7528\u80fd\u529b\u63d0\u5347\u3002\u901a\u8fc7\u8fd9\u79cd\u9010\u6b65\u590d\u6742\u7684\u5956\u52b1\u8bbe\u8ba1\uff0c\u6a21\u578b\u65e2\u83b7\u5f97\u4e86\u5ba2\u89c2\u4efb\u52a1\u6b63\u786e\u6027\uff0c\u53c8\u517c\u987e\u4e86\u4e3b\u89c2\u7528\u6237\u6ee1\u610f\u5ea6\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#_4","title":"\u4e0d\u540c\u9636\u6bb5\u7684\u5956\u52b1\u6743\u91cd\u5e73\u8861","text":"<p>\u5728\u8bad\u7ec3\u4e2d\uff0c\u8fd9\u4e9b\u5956\u52b1\u4e0d\u662f\u201c\u4e00\u9505\u4e71\u7096\u201d\uff0c\u800c\u662f\u5206\u9636\u6bb5\u9010\u6e10\u5f15\u5165\uff0c\u5e76\u5728\u4e0d\u540c\u9636\u6bb5\u6709\u4e0d\u540c\u7684\u6743\u91cd\u8bbe\u7f6e\uff1a</p> <ol> <li> <p>R1-Zero \u9636\u6bb5\uff08\u7eafRL\uff09</p> <ul> <li>\u53ea\u4f7f\u7528 \u51c6\u786e\u6027\u5956\u52b1 + \u683c\u5f0f\u5956\u52b1\u3002</li> <li>\u8fd9\u65f6\u6a21\u578b\u8fd8\u5728\u201c\u5b66\u4f1a\u600e\u4e48\u89e3\u9898\u201d\uff0c\u6240\u4ee5\u91cd\u70b9\u662f\u6b63\u786e\u6027\u548c\u8f93\u51fa\u7ed3\u6784\uff0c\u4e0d\u8003\u8651\u8bed\u8a00\u6d41\u7545\u6027\u548c\u4eba\u7c7b\u504f\u597d\u3002</li> <li>\u683c\u5f0f\u5956\u52b1\u4e00\u822c\u8bbe\u4e3a\u4e00\u4e2a\u5c0f\u5e38\u6570\uff08\u4f8b\u5982 0.1~0.2\uff09\uff0c\u51c6\u786e\u6027\u5956\u52b1\u8bbe\u4e3a\u4e3b\u8981\u5206\u503c\uff08\u4f8b\u5982 1.0\uff09\u3002</li> </ul> </li> <li> <p>\u7b2c\u4e00\u9636\u6bb5 RL\uff08Reasoning RL\uff09</p> <ul> <li>\u5728\u51c6\u786e\u6027\u5956\u52b1\u548c\u683c\u5f0f\u5956\u52b1\u57fa\u7840\u4e0a\uff0c\u5f15\u5165 \u8bed\u8a00\u4e00\u81f4\u6027\u5956\u52b1\u3002</li> <li>\u505a\u6cd5\u662f\uff1a     \\(R = w_{acc}R_{acc} + w_{fmt}R_{fmt} + w_{lang}R_{lang}\\)</li> <li>\u4e00\u822c \\(w_{acc}\\) \u6700\u5927\uff080.7-0.8\uff09\uff0c\\(w_{fmt}\\) \u548c \\(w_{lang}\\) \u4f5c\u4e3a\u8f85\u52a9\uff080.1-0.2\uff09\u3002</li> <li>\u8fd9\u6837\u4fdd\u8bc1\u6a21\u578b\u4f9d\u7136\u4e3b\u8981\u53d7\u6b63\u786e\u6027\u9a71\u52a8\uff0c\u4f46\u4e0d\u4f1a\u751f\u6210\u4e2d\u82f1\u5939\u6742\u6216\u683c\u5f0f\u9519\u8bef\u7684\u5185\u5bb9\u3002</li> </ul> </li> <li> <p>\u7b2c\u4e8c\u9636\u6bb5 RL\uff08\u5168\u573a\u666f RL\uff0c\u5bf9\u9f50\u4eba\u7c7b\u504f\u597d\uff09</p> <ul> <li>\u5728\u63a8\u7406\u7c7b\u4efb\u52a1\uff1a\u7ee7\u7eed\u4ee5 \u51c6\u786e\u6027\u5956\u52b1 \u4e3a\u4e3b\uff0c\u8bed\u8a00\u5956\u52b1/\u683c\u5f0f\u5956\u52b1\u4e3a\u8f85\u3002</li> <li>\u5728\u901a\u7528\u5bf9\u8bdd\u4efb\u52a1\uff1a\u4eba\u7c7b\u504f\u597d\u5956\u52b1\u624d\u4f1a\u88ab\u5f15\u5165\uff0c\u901a\u5e38\u6309\u201c\u52a0\u6743\u6c42\u548c\u201d\u7684\u65b9\u5f0f\u878d\u5408\uff1a     \\(R = w_{acc}R_{acc} + w_{fmt}R_{fmt} + w_{lang}R_{lang} + w_{pref}R_{pref}\\)</li> <li>\u5728\u8fd9\u65f6\uff0c\\(w_{pref}\\) \u7684\u6bd4\u4f8b\u4f1a\u9010\u6e10\u63d0\u5347\uff08\u5982 0.3-0.4\uff09\uff0c\u800c\u63a8\u7406\u7c7b\u4efb\u52a1\u4f9d\u7136\u4fdd\u6301 \\(w_{acc}\\) \u4e3a\u4e3b\u5bfc\u3002</li> </ul> </li> <li> <p>\u5fae\u8c03/\u84b8\u998f\u9636\u6bb5</p> <ul> <li>\u4e0d\u518d\u76f4\u63a5\u7528\u5956\u52b1\uff0c\u800c\u662f\u901a\u8fc7 \u62d2\u7edd\u91c7\u6837\uff08rejection sampling\uff09 \u7b5b\u9009\u51fa\u9ad8\u8d28\u91cf\u6570\u636e\uff0c\u518d\u8fdb\u884cSFT\u3002</li> <li>\u672c\u8d28\u4e0a\u662f\u628a\u524d\u51e0\u4e2a\u9636\u6bb5\u5956\u52b1\u201c\u9690\u542b\u201d\u5728\u6570\u636e\u9009\u62e9\u4e2d\u3002</li> </ul> </li> </ol>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#_5","title":"\u5b9e\u9645\u4e0a\u7684\u5e73\u8861\u6280\u5de7","text":"<ul> <li>\u52a8\u6001\u6743\u91cd\u8c03\u6574\uff1a\u5728\u8bad\u7ec3\u65e9\u671f\uff0c\u504f\u91cd\u51c6\u786e\u6027\uff0c\u5f85\u6a21\u578b\u63a8\u7406\u80fd\u529b\u7a33\u5b9a\u540e\uff0c\u518d\u9010\u6b65\u52a0\u5927\u504f\u597d\u5956\u52b1\u6743\u91cd\u3002</li> <li>\u4efb\u52a1\u5206\u8def\uff08multi-task mixing\uff09\uff1a\u63a8\u7406\u7c7b\u4efb\u52a1\u548c\u5f00\u653e\u5bf9\u8bdd\u4efb\u52a1\u5206\u5f00\u91c7\u6837\uff0c\u5404\u81ea\u5956\u52b1\u51fd\u6570\u4e0d\u540c\uff0c\u518d\u6309\u6bd4\u4f8b\u6df7\u5408\u8bad\u7ec3\u3002</li> <li>\u5f52\u4e00\u5316\u5904\u7406\uff1a\u4e0d\u540c\u5956\u52b1\u4fe1\u53f7\u91cf\u7eb2\u4e0d\u540c\uff0c\u9700\u8981\u5148\u5f52\u4e00\u5316\uff08\u5982\u6620\u5c04\u5230[0,1]\uff09\uff0c\u518d\u52a0\u6743\u7ec4\u5408\u3002</li> <li>reward shaping\uff1a\u907f\u514d\u5355\u4e00\u5956\u52b1\u8fc7\u5927\u4e3b\u5bfc\uff0c\u4f8b\u5982\u5982\u679c\u53ea\u7528\u51c6\u786e\u6027\u5956\u52b1\uff0c\u6a21\u578b\u53ef\u80fd\u5b66\u4f1a\u8f93\u51fa\u201c\u77ed\u4e14\u6b63\u786e\u201d\u7684\u7b54\u6848\u800c\u5ffd\u89c6\u63a8\u7406\u94fe\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#_6","title":"\u601d\u7ef4\u94fe\u7b56\u7565\u91c7\u6837\u4e0e\u4f18\u5316\u673a\u5236","text":"<p>\u663e\u5f0f\u601d\u7ef4\u94fe\u8f93\u51fa\uff1a\u4e3a\u4e86\u6fc0\u52b1\u6a21\u578b\u5c55\u5f00\u63a8\u7406\u8fc7\u7a0b\uff0c\u4f5c\u8005\u5728\u8bad\u7ec3\u6a21\u677f\u4e2d\u89c4\u5b9a\u52a9\u7406\u7684\u56de\u7b54\u5305\u542b\u5b8c\u6574\u7684\u601d\u7ef4\u94fe\u548c\u6700\u7ec8\u7b54\u6848\u3002\u4f8b\u5982\uff0c\u6a21\u677f\u683c\u5f0f\u5982\uff1a\u201c\u7528\u6237\uff1a{\u95ee\u9898}\u3002\u52a9\u7406\uff1a\u2026\u63a8\u7406\u8fc7\u7a0b\u2026\u2026\u6700\u7ec8\u7b54\u6848\u2026\u201d\u3002\u8fd9\u79cd\u7ea6\u675f\u76f8\u5f53\u4e8e\u8981\u6c42\u6a21\u578b\u601d\u8003\u8fc7\u7a0b\u5916\u663e\uff0c\u4e0d\u4ec5\u4fbf\u4e8e\u5206\u6790\u6a21\u578b\u63a8\u7406\u8f68\u8ff9\uff0c\u4e5f\u4f7f\u6a21\u578b\u53ef\u4ee5\u5728\u63a8\u7406\u8fc7\u7a0b\u4e2d\u81ea\u6211\u68c0\u67e5\u3002\u683c\u5f0f\u5956\u52b1\u786e\u4fdd\u4e86\u6a21\u578b\u9075\u5b88\u8fd9\u4e00\u8f93\u51fa\u89c4\u8303\u3002\u5b9e\u9a8c\u8868\u660e\uff0c\u6a21\u578b\u5f88\u5feb\u9002\u5e94\u8fd9\u79cd\u8981\u6c42\uff0c\u5728\u56de\u7b54\u95ee\u9898\u65f6\u5148\u7ed9\u51fa\u8be6\u7ec6\u63a8\u7406\u6b65\u9aa4\uff0c\u518d\u4eae\u51fa\u7b54\u6848\u3002\u8fd9\u4e00\u673a\u5236\u76f8\u5f53\u4e8e\u601d\u7ef4\u94fe\uff08CoT\uff09\u63d0\u793a\u7684\u4e00\u79cd\u8bad\u7ec3\u5185\u751f\u5b9e\u73b0\uff0c\u5bf9\u4e8e\u590d\u6742\u95ee\u9898\u5c24\u4e3a\u6709\u6548\u3002</p> <p>\u601d\u7ef4\u94fe\u81ea\u6211\u8fdb\u5316\uff1a\u5728\u7eafRL\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\uff0cDeepSeek-R1-Zero \u5c55\u73b0\u51fa\u601d\u7ef4\u94fe\u957f\u5ea6\u9010\u6b65\u589e\u957f\u7684\u73b0\u8c61\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u968f\u7740\u8bad\u7ec3\u63a8\u8fdb\uff0c\u6a21\u578b\u4e3a\u89e3\u51b3\u95ee\u9898\u6295\u5165\u7684\u201c\u601d\u8003\u201d token \u6570\u663e\u8457\u589e\u52a0\u3002\u521d\u59cb\u6a21\u578b\u53ef\u80fd\u53ea\u7ed9\u51fa\u5be5\u5be5\u6570\u6b65\u63a8\u7406\uff0c\u800c\u7ecf\u8fc7\u5f3a\u5316\u5b66\u4e60\uff0c\u6a21\u578b\u81ea\u53d1\u5b66\u4f1a\u5728\u9047\u5230\u96be\u9898\u65f6\u5ef6\u957f\u63a8\u7406\u8fc7\u7a0b\uff0c\u751f\u6210\u6570\u767e\u751a\u81f3\u4e0a\u5343\u4e2a\u63a8\u7406\u6b65\u9aa4\uff0c\u4ee5\u66f4\u6df1\u5165\u5730\u63a2\u7d22\u89e3\u9898\u601d\u8def\u3002\u8fd9\u79cd\u5ef6\u957f\u601d\u7ef4\u94fe\u7684\u884c\u4e3a\u5e76\u975e\u4eba\u4e3a\u786c\u7f16\u7801\uff0c\u800c\u662fRL\u5956\u52b1\u9a71\u52a8\u4e0b\u6a21\u578b\u81ea\u53d1\u6d8c\u73b0\u7684\u80fd\u529b\uff1a\u5b83\u610f\u8bc6\u5230\u66f4\u8be6\u5c3d\u7684\u63a8\u7406\u5f80\u5f80\u5e26\u6765\u66f4\u9ad8\u7684\u6b63\u786e\u7387\uff0c\u56e0\u6b64\u8c03\u6574\u7b56\u7565\u6295\u5165\u66f4\u591a\u8ba1\u7b97\u3002\u8fd9\u4e0e\u4eba\u7c7b\u89e3\u9898\u9047\u5230\u56f0\u96be\u65f6\u613f\u610f\u601d\u8003\u66f4\u4e45\u7684\u884c\u4e3a\u7c7b\u4f3c\uff0c\u4f53\u73b0\u4e86\u6a21\u578b\u67d0\u79cd\u7a0b\u5ea6\u7684\u201c\u81ea\u6211\u8fdb\u5316\u201d\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u5728\u8bad\u7ec3\u4e2d\u671f\u4f5c\u8005\u89c2\u5bdf\u5230\u4e86\u6a21\u578b\u7684 \u201c\u987f\u609f\u65f6\u523b (aha moment)\u201d \uff1a\u67d0\u4e2a\u4e2d\u95f4\u7248\u672c\u7684\u6a21\u578b\u5728\u89e3\u9898\u65f6\uff0c\u4f1a\u7a81\u7136\u505c\u4e0b\u6765\u81ea\u8ff0\u201c\u7b49\u7b49\uff0c\u8ba9\u6211\u91cd\u65b0\u5ba1\u89c6\u6b65\u9aa4\u201d\u4e4b\u7c7b\u7684\u8bdd\uff0c\u7136\u540e\u91cd\u65b0\u63a8\u5bfc\uff0c\u6700\u7ec8\u5f97\u51fa\u6b63\u786e\u7b54\u6848\u3002\u8fd9\u79cd\u5e26\u6709\u4eba\u7c7b\u53e3\u543b\u7684\u81ea\u6211\u53cd\u601d\u884c\u4e3a\u6b63\u662fRL\u8bad\u7ec3\u8d4b\u4e88\u6a21\u578b\u7684\u65b0\u7b56\u7565\u2014\u2014\u6a21\u578b\u5b66\u4f1a\u4e86 \u4e3b\u52a8\u68c0\u67e5\u5e76\u7ea0\u6b63\u81ea\u5df1\u7684\u63a8\u7406\uff0c\u8fd9\u4e5f\u662f\u7814\u7a76\u4eba\u5458\u773c\u4e2d\u7684\u60ca\u559c\u73b0\u8c61\u3002\u5b83\u8bf4\u660e\u901a\u8fc7\u7ed9\u4e88\u9002\u5f53\u7684\u6fc0\u52b1\uff0c\u6a21\u578b\u80fd\u591f\u53d1\u5c55\u51fa\u8d85\u51fa\u9884\u671f\u7684\u590d\u6742\u95ee\u9898\u6c42\u89e3\u7b56\u7565\uff0c\u800c\u975e\u4ec5\u5c40\u9650\u4e8e\u4eba\u7c7b\u63d0\u4f9b\u7684\u8303\u4f8b\u3002 </p> <p>\u591a\u6570\u51b3\u7b56\u7565 (Self-Consistency)\uff1a\u4e3a\u4e86\u8fdb\u4e00\u6b65\u63d0\u9ad8\u6a21\u578b\u63a8\u7406\u7b54\u6848\u7684\u53ef\u9760\u6027\uff0c\u4f5c\u8005\u501f\u9274\u4e86\u601d\u7ef4\u94fe\u81ea\u6d3d\u7684\u65b9\u6cd5\u3002\u5177\u4f53\u505a\u6cd5\u662f\u5728\u8bc4\u4f30\u6216\u5e94\u7528\u65f6\uff0c\u5bf9\u4e8e\u540c\u4e00\u9053\u9898\u8ba9\u6a21\u578b\u72ec\u7acb\u91c7\u6837\u591a\u6b21\u56de\u7b54\uff0c\u6bcf\u6b21\u90fd\u751f\u6210\u5b8c\u6574\u7684\u601d\u7ef4\u94fe\u548c\u7b54\u6848\uff0c\u7136\u540e\u91c7\u7528\u591a\u6570\u6295\u7968\u9009\u51fa\u6700\u4e00\u81f4\u7684\u7b54\u6848\u4f5c\u4e3a\u6700\u7ec8\u7ed3\u679c\u3002\u8fd9\u4e00\u7b56\u7565\u76f8\u5f53\u4e8eWei \u7b49\u4eba\u63d0\u51fa\u7684\u81ea\u6d3d (self-consistency)\u65b9\u6cd5\uff0c\u901a\u8fc7\u96c6\u6210\u591a\u4e2a\u89e3\u7684\u7ed3\u679c\u6765\u63d0\u9ad8\u51c6\u786e\u7387\u3002\u4f5c\u8005\u62a5\u544a\uff0c\u5728AIME 2024\u6570\u5b66\u7ade\u8d5b\u4efb\u52a1\u4e0a\uff0cDeepSeek-R1-Zero\u5355\u6b21\u56de\u7b54\u6b63\u786e\u7387\u4e3a71.0%\uff0c\u4f46\u5982\u679c\u8ba9\u5b83\u56de\u7b5416\u6b21\u5e76\u6295\u7968\uff0c\u51c6\u786e\u7387\u98d9\u5347\u523086.7%\u2014\u2014\u8d85\u8fc7\u4e86OpenAI-o1-0912\u6a21\u578b\u5728\u8be5\u4efb\u52a1\u4e0a\u7684\u8868\u73b0\u3002\u8fd9\u8868\u660e\u6a21\u578b\u7684\u9519\u8bef\u5f80\u5f80\u662f\u4e0d\u7a33\u5b9a\u7684\uff0c\u5373\u591a\u6570\u56de\u7b54\u4ecd\u53ef\u80fd\u6b63\u786e\uff0c\u901a\u8fc7\u591a\u6570\u51b3\u53ef\u4ee5\u6709\u6548\u964d\u4f4e\u5076\u7136\u51fa\u9519\u7684\u5f71\u54cd\u3002\u8fd9\u79cd\u7b56\u7565\u91c7\u6837\u4e0e\u4f18\u5316\u673a\u5236\u63d0\u9ad8\u4e86\u6a21\u578b\u63a8\u7406\u9c81\u68d2\u6027\uff0c\u4e5f\u662f\u540e\u7eedDeepSeek-R1\u5728\u91cd\u8981\u8bc4\u6d4b\u4e2d\u53d6\u5f97\u9ad8\u5206\u7684\u56e0\u7d20\u4e4b\u4e00\u3002</p> <p>\u62d2\u7edd\u91c7\u6837\u6570\u636e\u589e\u5f3a\uff1a\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\uff0c\u4f5c\u8005\u8fd8\u5229\u7528\u601d\u7ef4\u94fe\u91c7\u6837\u6765\u6269\u5145\u8bad\u7ec3\u6570\u636e\uff08\u89c1\u524d\u8ff0Pipeline\u7b2c3\u9636\u6bb5\uff09\u3002\u4ed6\u4eec\u4ece\u5df2\u8bad\u7ec3\u7684\u6a21\u578b\u51fa\u53d1\uff0c\u8ba9\u6a21\u578b\u9488\u5bf9\u5927\u91cf\u65b0\u95ee\u9898\u751f\u6210\u591a\u79cd\u89e3\u9898\u601d\u8def\uff0c\u5e76\u901a\u8fc7\u81ea\u52a8\u5224\u522b\u7b5b\u9009\u51fa\u6b63\u786e\u7684\u9ad8\u8d28\u91cf\u601d\u7ef4\u94fe\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u62d2\u7edd\u91c7\u6837 (rejection sampling)\uff1a\u629b\u5f03\u9519\u8bef\u6216\u683c\u5f0f\u5dee\u7684\u8f93\u51fa\uff0c\u53ea\u4fdd\u7559\u6b63\u786e\u4e14\u6e05\u6670\u7684\u63a8\u7406\u8fc7\u7a0b\uff0c\u5c06\u5176\u52a0\u5165\u65b0\u4e00\u8f6e\u7684\u5fae\u8c03\u6570\u636e\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4f5c\u8005\u6536\u96c6\u4e86\u7ea660\u4e07\u6761\u6a21\u578b\u81ea\u751f\u6210\u7684\u63a8\u7406\u8fc7\u7a0b\u6570\u636e\uff0c\u8d28\u91cf\u5ab2\u7f8e\u4eba\u5de5\u6807\u6ce8\u3002\u8fd9\u4e9b\u6570\u636e\u6781\u5927\u4e30\u5bcc\u4e86\u8bad\u7ec3\u8bed\u6599\uff0c\u5c24\u5176\u662f\u5305\u542b\u8bb8\u591a\u590d\u6742\u957f\u94fe\u63a8\u7406\u7684\u793a\u4f8b\uff0c\u5bf9\u8fdb\u4e00\u6b65\u5fae\u8c03\u6a21\u578b\u5e2e\u52a9\u5f88\u5927\u3002\u53ef\u4ee5\u8ba4\u4e3a\uff0c\u6a21\u578b\u672c\u8eab\u751f\u6210\u7684\u601d\u7ef4\u94fe\u5728\u53cd\u9988\u56de\u8bad\u7ec3\u4e2d\uff0c\u5b9e\u73b0\u4e86\u81ea\u4e3e\u5f0f\u7684\u4f18\u5316\uff1a\u6a21\u578b\u6559\u4f1a\u4e86\u81ea\u5df1\u65b0\u77e5\u8bc6\u3002\u62d2\u7edd\u91c7\u6837\u7b56\u7565\u4fdd\u969c\u4e86\u52a0\u5165\u8bad\u7ec3\u7684\u6570\u636e\u90fd\u662f\u9ad8\u51c6\u786e\u5ea6\u7684\uff0c\u4ece\u800c\u907f\u514d\u4e86\u4f20\u7edfRL\u8bad\u7ec3\u4e2d\u7531\u4e8e\u63a2\u7d22\u9519\u8bef\u8def\u5f84\u5e26\u6765\u7684\u566a\u58f0\u7d2f\u79ef\u95ee\u9898\u3002</p> <p>\u7efc\u4e0a\uff0cDeepSeek-R1\u7684\u65b9\u6cd5\u5728\u601d\u7ef4\u94fe\u4e0a\u505a\u8db3\u4e86\u6587\u7ae0\uff1a\u901a\u8fc7\u6a21\u677f\u4e0e\u5956\u52b1\u786c\u6027\u89c4\u5b9a\u6a21\u578b\u8f93\u51fa\u601d\u7ef4\u94fe\uff0c\u901a\u8fc7RL\u6fc0\u52b1\u5f15\u5bfc\u6a21\u578b\u5ef6\u957f\u548c\u5b8c\u5584\u601d\u7ef4\u94fe\uff0c\u901a\u8fc7\u591a\u6570\u91c7\u6837\u6539\u8fdb\u6700\u7ec8\u7b54\u6848\u53ef\u9760\u6027\uff0c\u901a\u8fc7\u62d2\u7edd\u91c7\u6837\u83b7\u53d6\u5927\u89c4\u6a21\u9ad8\u8d28\u91cf\u601d\u7ef4\u94fe\u6570\u636e\u8bad\u7ec3\u6a21\u578b\u3002\u8fd9\u4e00\u7cfb\u5217\u673a\u5236\u76f8\u8f85\u76f8\u6210\uff0c\u4f7f\u6a21\u578b\u4e0d\u4ec5\u5b66\u4f1a\u201c\u601d\u8003\u201d\uff0c\u800c\u4e14\u5b66\u4f1a\u201c\u5982\u4f55\u66f4\u597d\u5730\u601d\u8003\u201d\uff0c\u5927\u5927\u63d0\u5347\u4e86\u590d\u6742\u63a8\u7406\u4efb\u52a1\u7684\u8868\u73b0\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#_7","title":"\u5b9e\u9a8c\u8bbe\u7f6e\u4e0e\u8bc4\u4f30\u6307\u6807","text":"<p>\u8bc4\u6d4b\u57fa\u51c6\uff1a \u4f5c\u8005\u5bf9DeepSeek-R1\u7cfb\u5217\u6a21\u578b\u8fdb\u884c\u4e86\u6781\u4e3a\u5168\u9762\u7684\u8bc4\u6d4b\uff0c\u6db5\u76d6\u4ece\u77e5\u8bc6\u95ee\u7b54\u3001\u6570\u5b66\u63a8\u7406\u5230\u7f16\u7a0b\u548c\u5f00\u653e\u5f0f\u5bf9\u8bdd\u7b49\u591a\u4e2a\u9886\u57df\u3002\u4e3b\u8981\u57fa\u51c6\u5305\u62ec\uff1a</p> <ul> <li>\u77e5\u8bc6\u95ee\u7b54\u7c7b\uff1aMMLU\u53ca\u5176\u884d\u751f\u7248\u672c\uff08MMLU-Redux\uff0cMMLU-Pro\uff09\u3001C-Eval \u4e2d\u6587\u7efc\u5408\u6d4b\u8bc4\u3001CMMLU\uff08\u4e2d\u6587MMLU\uff09\u7b49\uff0c\u7528\u4e8e\u6d4b\u8bd5\u6a21\u578b\u5728\u5404\u5b66\u79d1\u77e5\u8bc6\u4e0a\u7684\u9009\u62e9\u9898\u4f5c\u7b54\u80fd\u529b\uff0c\u6307\u6807\u591a\u4e3a\u51c6\u786e\u7387\uff08Accuracy / Exact Match\uff09\u3002</li> <li>\u5e38\u8bc6\u4e0e\u9605\u8bfb\u7406\u89e3\uff1a\u5982DROP\u7b97\u672f\u9605\u8bfb\u7406\u89e3\u3001GPQA\u94bb\u77f3\u95ee\u9898\u96c6\u3001SimpleQA\u7b80\u5355\u95ee\u7b54\u3001C-SimpleQA\u4e2d\u6587\u7b80\u5355\u95ee\u7b54\u3001CLUE-WSCWinograd\u6a21\u5f0f\u6311\u6218\u7b49\uff0c\u7528\u51c6\u786e\u7387\u6216F1\u8bc4\u4f30\u6a21\u578b\u5bf9\u6587\u672c\u7406\u89e3\u548c\u5e38\u8bc6\u63a8\u7406\u7684\u80fd\u529b\u3002</li> <li>\u4ee3\u7801\u4e0e\u6570\u5b66\u63a8\u7406\uff1aHumanEval-Multi\u548cLiveCodeBench\u4ee3\u7801\u751f\u6210\u3001Codeforces\u7a0b\u5e8f\u7ade\u8d5b\u9898\u3001AIDER\u591a\u8bed\u8a00\u4ee3\u7801\u7f16\u8f91\u57fa\u51c6\u3001MATH-500\u6570\u5b66\u9898\u5e93\u3001CNMO\u4e2d\u56fd\u6570\u5b66\u5965\u8d5b\u9898\u3001AIME\u7f8e\u56fd\u6570\u5b66\u9080\u8bf7\u8d5b\u9898\u7b49\uff0c\u7528pass@1\uff08\u4e00\u6b21\u6027\u6210\u529f\u7387\uff09\u3001Elo\u79ef\u5206\uff08Codeforces\u6392\u540d\uff09\u7b49\u6307\u6807\u8bc4\u4f30\u4ee3\u7801/\u6570\u5b66\u89e3\u9898\u6b63\u786e\u7387\u3002\u5176\u4e2dCodeforces\u91c7\u7528\u6a21\u578b\u5728\u4e00\u7cfb\u5217\u7ade\u8d5b\u9898\u4e0a\u7684\u8868\u73b0\u6362\u7b97\u51fa\u7b49\u4ef7\u4eba\u7c7b\u53c2\u8d5b\u8005\u7684Elo\u7b49\u7ea7\u3002</li> <li>\u5f00\u653e\u5f0f\u751f\u6210\uff1aAlpacaEval 2.0 \u548c Arena-Hard \u4e24\u5957\u5bf9\u8bdd\u8bc4\u6d4b\u3002\u8fd9\u4e9b\u8ba9\u6a21\u578b\u5bf9\u5f00\u653e\u5f0f\u6307\u4ee4\u6216\u95ee\u7b54\u8fdb\u884c\u56de\u7b54\uff0c\u7136\u540e\u7531\u5f3a\u5927\u7684\u5bf9\u6bd4\u6a21\u578b\uff08GPT-4 Turbo\uff09\u8fdb\u884c\u5bf9\u6bd4\u80dc\u7387\u8bc4\u4f30\u3002\u5177\u4f53\u505a\u6cd5\u662f\u4f7f\u7528GPT-4-Turbo-1106\u4f5c\u4e3a\u88c1\u5224\uff0c\u5bf9\u6bd4\u4e24\u4e2a\u6a21\u578b\u56de\u7b54\u7684\u4f18\u52a3\uff0c\u7edf\u8ba1DeepSeek-R1\u80dc\u51fa\u7684\u767e\u5206\u6bd4\uff08win-rate\uff09\u3002\u4e3a\u516c\u5e73\u8d77\u89c1\uff0c\u53ea\u5c06\u6a21\u578b\u6700\u7ec8\u7684\u6458\u8981/\u7b54\u6848\u90e8\u5206\u63d0\u4f9b\u7ed9GPT-4\u8bc4\u5224\uff0c\u907f\u514d\u56e0\u4e3a\u601d\u7ef4\u94fe\u957f\u77ed\u5dee\u5f02\u9020\u6210\u504f\u5dee\uff08\u786e\u4fdd\u8bc4\u4f30\u65f6\u4e0d\u56e0DeepSeek-R1\u8f93\u51fa\u8f83\u957f\u8fc7\u7a0b\u800c\u53d7\u8d1f\u9762\u5f71\u54cd\uff09\u3002</li> </ul> <p>\u8bc4\u6d4b\u8bbe\u7f6e\uff1a\u591a\u6570\u57fa\u51c6\u91c7\u7528\u96f6\u6837\u672c(zero-shot)\u6216\u5c11\u6837\u672c(few-shot)\u63d0\u793a\u4e0b\u8ba9\u6a21\u578b\u76f4\u63a5\u4f5c\u7b54\u3002\u5bf9\u4e8e\u539f\u59cb\u9700\u8981 few-shot \u63d0\u793a\u7684\uff0c\u5982MMLU-Pro\u3001C-Eval\u7b49\uff0c\u4f5c\u8005\u6539\u7528\u96f6\u6837\u672c\u63d0\u793a\u4ee5\u9002\u914dDeepSeek-R1\uff0c\u56e0\u4e3a\u4ed6\u4eec\u89c2\u5bdf\u5230\u63d0\u4f9bfew-shot\u793a\u4f8b\u7684\u63d0\u793a\u53cd\u800c\u4f1a\u964d\u4f4eDeepSeek-R1\u7684\u8868\u73b0\u3002\u5728\u4ee3\u7801\u751f\u6210\u4efb\u52a1\u4e2d\uff0cLiveCodeBench\u8bc4\u4f30\u8ba9\u6a21\u578b\u4ee5\u601d\u7ef4\u94fe(CoT)\u5f62\u5f0f\u8f93\u51fa\u4ee3\u7801\u89e3\u6790\u8fc7\u7a0b\u518d\u7ed9\u4ee3\u7801\u7b54\u6848\u3002\u9488\u5bf9Codeforces\uff0c\u4f5c\u8005\u9009\u53d6\u4e86\u82e5\u5e72\u573a\u6b21\u6bd4\u8d5b\u9898\u76ee\uff0c\u4ee5\u6a21\u578b\u89e3\u51fa\u9898\u76ee\u7684\u4e2a\u6570\u548c\u96be\u5ea6\u63a8\u7b97\u767e\u5206\u6bd4\u6392\u540d\u548cElo\u5206\u6570\u3002\u6240\u6709\u8bc4\u6d4b\u5747\u5728\u6a21\u578b\u751f\u6210\u5b8c\u6574\u601d\u7ef4\u94fe+\u7b54\u6848\u7684\u6a21\u5f0f\u4e0b\u8fdb\u884c\u3002</p> <p>\u5bf9\u6bd4\u6a21\u578b\uff1a \u4f5c\u8005\u5c06DeepSeek-R1\u7684\u8868\u73b0\u4e0e\u591a\u79cd\u73b0\u6709\u6a21\u578b\u8fdb\u884c\u4e86\u6bd4\u8f83\uff0c\u5305\u62ec\uff1aOpenAI\u7684\u95ed\u6e90\u6a21\u578b\u7cfb\u5217\uff08\u5982OpenAI-o1-mini\u3001OpenAI-o1-1217\u7b49\uff09\u3001Anthropic\u7684Claude 3.5 (Sonnet\u7248)\u3001OpenAI\u6700\u8fd1\u5f00\u653e\u7684GPT-4o\u6a21\u578b\u3001\u4ee5\u53ca\u4f5c\u8005\u4e4b\u524d\u7684DeepSeek-V3\u6a21\u578b\u7b49\u3002\u8fd9\u4e9b\u5bf9\u6bd4\u6a21\u578b\u8986\u76d6\u4e86\u5f53\u524d\u6700\u5148\u8fdb\u7684\u5546\u4e1a\u6a21\u578b\u548c\u5f00\u6e90\u6a21\u578b\uff0c\u4e3a\u8bc4\u4f30DeepSeek-R1\u63d0\u4f9b\u4e86\u53c2\u7167\u3002\u5176\u4e2dOpenAI-o1-1217\u53ef\u89c6\u4f5cOpenAI\u5185\u90e8\u67d0\u6700\u65b0\u5f3a\u6a21\u578b\uff0c\u800cOpenAI-o1-mini\u5219\u662f\u4e00\u4e2a\u8f83\u5c0f\u7684\u5bf9\u7167\u6a21\u578b\uff1bGPT-4o-0513\u662fOpenAI\u5f00\u653e\u7684GPT-4\u7248\u672c\uff1bClaude-3.5-Sonnet-1022\u662fAnthropic\u768435B\u53c2\u6570\u6a21\u578b\uff1bQwQ-32B-Preview\u5219\u662f\u5148\u524d\u5f00\u6e90\u7684\u4e00\u4e2a32B\u63a8\u7406\u4f18\u5316\u6a21\u578b\u3002\u6b64\u5916\uff0c\u5728\u84b8\u998f\u5c0f\u6a21\u578b\u8bc4\u4f30\u4e2d\uff0c\u8fd8\u6bd4\u8f83\u4e86DeepSeek-R1\u84b8\u998f\u7684\u5c0f\u6a21\u578b\u4e0e\u76f8\u540c\u5e95\u5ea7\u7684\u539f\u7248\u6a21\u578b\u5dee\u5f02\uff0c\u4f8b\u5982\u5bf9\u6bd4Qwen2.5-7B\u84b8\u998f\u524d\u540e\u7684\u63a8\u7406\u6210\u7ee9\u7b49\u3002</p> <p>\u8bc4\u4ef7\u6307\u6807\uff1a \u6839\u636e\u4efb\u52a1\u4e0d\u540c\u9009\u53d6\u9002\u5408\u7684\u6307\u6807\uff1a</p> <ul> <li>\u9009\u62e9\u9898/\u5224\u65ad\u9898\uff08\u5982MMLU\u3001MMLU-Pro\u3001C-Eval\u3001WSC\uff09\uff1a\u91c7\u7528\u51c6\u786e\u7387(Accuracy)\u6216\u7cbe\u786e\u5339\u914d(Exact Match)\uff0c\u5373\u6a21\u578b\u6700\u7ec8\u7ed9\u51fa\u7684\u9009\u9879\u6216\u7b54\u6848\u4e0e\u6807\u51c6\u7b54\u6848\u5339\u914d\u7684\u6bd4\u4f8b\u3002</li> <li>\u81ea\u7531\u56de\u7b54\u9898\uff08\u5982SimpleQA\u95ee\u7b54\u3001FRAMES\u5bf9\u8bdd\u7406\u89e3\uff09\uff1a\u6839\u636e\u4e3b\u529e\u65b9\u5b9a\u4e49\u7684\u6b63\u786e\u7387\u6216F1\u5206\u6570\uff0c\u8ba1\u7b97\u6a21\u578b\u7b54\u6848\u662f\u5426\u5305\u542b\u6b63\u786e\u5185\u5bb9\u3002</li> <li>\u6570\u5b66/\u4ee3\u7801\u9898\uff1a\u4f7f\u7528Pass@K\u6307\u6807\uff08\u901a\u5e38K=1\uff0c\u5373\u4e00\u6b21\u6027\u6210\u529f\u7387\uff09\u3002Pass@1\u8868\u793a\u6a21\u578b\u76f4\u63a5\u7ed9\u51fa\u6b63\u786e\u7b54\u6848\u7684\u767e\u5206\u6bd4\uff1b\u6709\u65f6\u4e5f\u62a5\u544aPass@64\uff08\u91c7\u683764\u6b21\u53d6\u5176\u4e2d\u662f\u5426\u6709\u81f3\u5c11\u4e00\u6b21\u6b63\u786e\uff09\u4f5c\u4e3a\u53c2\u8003\u3002Codeforces\u7528Percentile\u548cRating\uff0c\u524d\u8005\u662f\u767e\u5206\u6bd4\u6392\u540d\uff0c\u540e\u8005\u662f\u5bf9\u5e94\u7684Elo\u7b49\u7ea7\u3002</li> <li>\u5f00\u653e\u751f\u6210\u4efb\u52a1\uff1a\u4f7f\u7528GPT-4\u8bc4\u4ef7\u80dc\u7387\uff0c\u5373Win Rate(%)\u3002AlpacaEval 2.0\u7279\u522b\u4f7f\u7528\u957f\u5ea6\u63a7\u5236\u540e\uff08LC\uff09\u7684\u80dc\u7387\u4ee5\u6d88\u9664\u957f\u56de\u7b54\u504f\u7f6e\u3002</li> </ul> <p>\u901a\u8fc7\u591a\u7ef4\u5ea6\u7684\u8bc4\u6d4b\uff0c\u4f5c\u8005\u5168\u9762\u8003\u5bdf\u4e86DeepSeek-R1\u5728\u4e25\u683c\u5ba2\u89c2\u9898\uff08\u6570\u5b66\u3001\u7f16\u7a0b\uff09\u3001\u5e38\u8bc6\u77e5\u8bc6\u9898\uff08MMLU\u7b49\uff09\u548c\u5f00\u653e\u521b\u610f\u9898\uff08\u5bf9\u8bdd\u5199\u4f5c\uff09\u7684\u8868\u73b0\uff0c\u4ece\u800c\u9a8c\u8bc1\u6a21\u578b\u5728\u5404\u9886\u57df\u7684\u63a8\u7406\u4e0e\u901a\u7528\u80fd\u529b\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#_8","title":"\u4e3b\u8981\u5b9e\u9a8c\u7ed3\u679c\u5206\u6790","text":"<p>DeepSeek-R1 \u7cfb\u5217\u6a21\u578b\u5728\u5404\u9879\u57fa\u51c6\u4e0a\u90fd\u53d6\u5f97\u4e86\u6781\u4e3a\u4eae\u773c\u7684\u6210\u7ee9\uff1a</p> <ul> <li> <p>\u7eafRL\u6a21\u578b DeepSeek-R1-Zero\uff1a\u5c3d\u7ba1\u6ca1\u6709\u4f7f\u7528\u4efb\u4f55\u4eba\u5de5\u76d1\u7763\u6570\u636e\uff0cR1-Zero \u5df2\u7ecf\u5728\u590d\u6742\u63a8\u7406\u4efb\u52a1\u4e0a\u5c55\u73b0\u51fa\u60ca\u4eba\u5b9e\u529b\u3002\u5982\u88682\u6240\u793a\uff0cR1-Zero\u5728AIME 2024\u6570\u5b66\u7ade\u8d5b\u9898\u4e0a\u7684\u4e00\u6b21\u4f5c\u7b54\u51c6\u786e\u7387\u8fbe\u523071.0%\uff0c\u51e0\u4e4e\u8ffd\u5e73OpenAI-o1-0912\u6a21\u578b\u768474.4%\u3002\u5728MATH-500\u6570\u5b66\u9898\u4e0a\uff0cR1-Zero\u8fbe\u5230\u4e8686.7%\u7684cons@64\uff08\u76f8\u5f53\u4e8eMajority Voting\u60c5\u5f62\u4e0b\u7684\u6b63\u786e\u7387\uff09\uff0c\u8d85\u8fc7OpenAI-o1-0912\u3002\u8fd9\u4e9b\u7ed3\u679c\u8bc1\u660e\uff0c\u5927\u89c4\u6a21RL\u672c\u8eab\u5373\u53ef\u8d4b\u4e88\u6a21\u578b\u63a5\u8fd1SOTA\u7684\u6570\u5b66\u63a8\u7406\u80fd\u529b\u3002\u66f4\u5f15\u4eba\u6ce8\u76ee\u7684\u662f\uff0cR1-Zero\u901a\u8fc7\u591a\u6570\u51b3\u7b56\u7565\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63d0\u9ad8\u6027\u80fd\uff1a\u5728AIME\u4e0a\u4ece71.0%\u8dc3\u5347\u523086.7%\uff0c\u53cd\u8d85OpenAI\u540c\u7c7b\u6a21\u578b\u3002\u8fd9\u51f8\u663e\u4e86R1-Zero\u5f3a\u5927\u7684\u5185\u5728\u63a8\u7406\u6f5c\u529b\u3002\u7136\u9e45\uff0cR1-Zero\u5728\u751f\u6210\u5185\u5bb9\u7684\u53ef\u8bfb\u6027\u65b9\u9762\u5b58\u5728\u660e\u663e\u4e0d\u8db3\uff0c\u4f8b\u5982\u56de\u7b54\u4e2d\u4e2d\u82f1\u5939\u6742\u3001\u7f3a\u4e4f\u6e05\u6670\u683c\u5f0f\u7b49\u3002\u8fd9\u4fc3\u4f7f\u4f5c\u8005\u5f00\u53d1\u540e\u7eed\u7684DeepSeek-R1\u6a21\u578b\u6765\u6539\u8fdb\u8fd9\u4e9b\u95ee\u9898\u3002</p> </li> <li> <p>\u591a\u9636\u6bb5\u5f3a\u5316\u6a21\u578b DeepSeek-R1\uff1a\u7efc\u5408\u6765\u770b\uff0cDeepSeek-R1\u8fbe\u5230\u4e86\u4e0e\u6700\u5f3a\u95ed\u6e90\u6a21\u578b\u76f8\u5ab2\u7f8e\u7684\u6c34\u51c6\u3002\u5728\u6570\u5b66\u9886\u57df\uff0cDeepSeek-R1\u5728AIME 2024\u4e0a\u7684Pass@1\u8fbe\u523079.8%\uff0c\u7565\u9ad8\u4e8eOpenAI-o1-1217\u768479.2%\uff1b\u5728MATH-500\u4e0a\u5f97\u520697.3%\uff0c\u4e0eOpenAI-o1-1217\u65d7\u9f13\u76f8\u5f53\uff0c\u8fdc\u8d85\u5176\u5b83\u5f00\u6e90\u6a21\u578b\u3002\u66f4\u4ee4\u4eba\u60ca\u8bb6\u7684\u662f\uff0c\u5728Codeforces\u7f16\u7a0b\u7ade\u8d5b\u6d4b\u8bd5\u4e2d\uff0cDeepSeek-R1\u7684\u8868\u73b0\u76f8\u5f53\u4e8eElo 2029\u5206\uff0c\u51fb\u8d25\u4e8696.3%\u7684\u4eba\u7c7b\u53c2\u8d5b\u8005\u2014\u2014\u8868\u660e\u5176\u7f16\u7a0b\u548c\u7b97\u6cd5\u63a8\u7406\u80fd\u529b\u5df2\u63a5\u8fd1\u4eba\u7c7b\u9ad8\u624b\u6c34\u5e73\u3002\u6b64\u5916\uff0c\u5728\u4e2d\u6587\u9ad8\u8003\u96be\u5ea6\u7684\u6570\u5b66\u7ade\u8d5b\u9898(CNMO 2024)\u4e0a\uff0cDeepSeek-R1\u4e5f\u53d6\u5f9778.8%\u7684\u9ad8\u51c6\u786e\u7387\u3002\u8fd9\u4e9b\u7ed3\u679c\u8868\u660e\uff0c\u901a\u8fc7\u51b7\u542f\u52a8+RL+SFT\u591a\u9636\u6bb5\u8bad\u7ec3\uff0cDeepSeek-R1\u5728\u79d1\u5b66\u8ba1\u7b97\u4e0e\u7b97\u6cd5\u63a8\u7406\u65b9\u9762\u8fbe\u5230\u4e86\u5f53\u524d\u9876\u5c16\u6c34\u5e73\u3002</p> </li> <li> <p>\u77e5\u8bc6\u4e0e\u5e38\u8bc6\u95ee\u7b54\uff1a\u5728MMLU\u3001\u591a\u9879\u9009\u62e9\u77e5\u8bc6\u6d4b\u9a8c\u4e0a\uff0cDeepSeek-R1\u540c\u6837\u8868\u73b0\u4e0d\u4fd7\u3002\u82f1\u6587MMLU\u51c6\u786e\u738790.8%\uff0cMMLU-Pro 84.0%\uff0cGPQA\u94bb\u77f3\u96be\u9898\u96c671.5%\u3002\u8fd9\u4e9b\u5206\u6570\u7565\u4f4e\u4e8eOpenAI-o1-1217\uff08\u540e\u8005\u5728MMLU\u7ea691.8%\uff09\u4f46\u5927\u5e45\u9886\u5148\u6b64\u524d\u7684\u5f00\u6e90\u5f3a\u6a21\u578bDeepSeek-V3\u3002\u8bf4\u660eRL\u8bad\u7ec3\u4e0d\u4ec5\u63d0\u5347\u4e86\u903b\u8f91\u63a8\u7406\uff0c\u4e5f\u63d0\u5347\u4e86\u6a21\u578b\u5728\u6559\u80b2\u77e5\u8bc6\u9886\u57df\u7684\u7cbe\u7ec6\u8fa8\u6790\u80fd\u529b\u3002\u540c\u65f6\u5728\u4e00\u4e9b\u5e38\u8bc6\u95ee\u7b54\u5982SimpleQA\u4e0a\uff0cDeepSeek-R1\u4e5f\u8d85\u8d8a\u4e86DeepSeek-V3\u3002\u4e0d\u8fc7\u4f5c\u8005\u4e5f\u6ce8\u610f\u5230\uff0cDeepSeek-R1\u5728\u4e2d\u6587SimpleQA\u4e0a\u53cd\u800c\u7a0d\u900a\u4e8eDeepSeek-V3\u3002\u8fd9\u88ab\u5f52\u56e0\u4e8e\u5b89\u5168RL\u9020\u6210\u7684\u526f\u4f5c\u7528\uff1a\u6a21\u578b\u503e\u5411\u4e8e\u62d2\u7b54\u67d0\u4e9b\u95ee\u9898\u4ee5\u6c42\u5b89\u5168\uff0c\u4ece\u800c\u62c9\u4f4e\u4e86\u51c6\u786e\u7387\u3002\u4f5c\u8005\u6307\u51fa\uff0c\u82e5\u79fb\u9664\u5b89\u5168\u504f\u597d\u7ea6\u675f\uff0c\u6a21\u578b\u5728\u8be5\u6570\u636e\u96c6\u4e0a\u7684\u51c6\u786e\u7387\u53ef\u8d85\u8fc770%\u3002\u603b\u4f53\u800c\u8a00\uff0cDeepSeek-R1\u5728\u5e7f\u6cdb\u7684\u77e5\u8bc6\u95ee\u7b54\u4efb\u52a1\u4e0a\u90fd\u6709\u7ade\u4e89\u529b\u751a\u81f3\u9886\u5148\u7684\u8868\u73b0\uff0c\u4f53\u73b0\u4e86\u5927\u89c4\u6a21RL\u5e26\u6765\u7684\u77e5\u8bc6\u6cdb\u5316\u6536\u76ca\u3002</p> </li> <li> <p>\u5f00\u653e\u5f0f\u4efb\u52a1\uff1aDeepSeek-R1 \u5728\u5f00\u653e\u95ee\u7b54\u3001\u521b\u610f\u5199\u4f5c\u7b49\u4efb\u52a1\u4e0a\u540c\u6837\u5c55\u793a\u4e86\u5f3a\u5927\u7684\u751f\u6210\u80fd\u529b\u3002\u5728AlpacaEval 2.0\u5bf9\u8bdd\u8bc4\u6d4b\u4e2d\uff0c\u8003\u8651\u957f\u5ea6\u516c\u5e73\u7684\u80dc\u7387\u8fbe\u523087.6%\uff1b\u5728\u66f4\u56f0\u96be\u7684Arena-Hard\u8bc4\u6d4b\u4e2d\u80dc\u7387\u8fbe92.3%\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cGPT-4\u8bc4\u5224\u4e0bDeepSeek-R1\u7684\u56de\u7b54\u6709\u4e5d\u6210\u4ee5\u4e0a\u60c5\u51b5\u4f18\u4e8e\u5176\u5b83\u5bf9\u6bd4\u6a21\u578b\u3002\u8fd9\u8bf4\u660e\u8be5\u6a21\u578b\u4e0d\u4ec5\u4f1a\u89e3\u9898\uff0c\u8fd8\u5584\u4e8e\u751f\u6210\u9ad8\u8d28\u91cf\u7684\u56de\u7b54\uff0c\u80fd\u591f\u5728\u521b\u610f\u3001\u603b\u7ed3\u7b49\u4efb\u52a1\u4e0a\u51fb\u8d25\u5927\u591a\u6570\u6a21\u578b\u3002\u540c\u65f6\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u4f5c\u8005\u62a5\u544aDeepSeek-R1\u5728\u8fd9\u4e9b\u5bf9\u8bdd\u573a\u666f\u4e0b\u8f93\u51fa\u7684\u56de\u7b54\u957f\u5ea6\u9002\u4e2d\uff1aArenaHard\u4e0a\u5e73\u5747\u8f93\u51fa689\u4e2atoken\uff0cAlpacaEval\u4e0a\u7ea62218\u5b57\u7b26\u3002\u5e76\u672a\u56e0\u4e3a\u601d\u7ef4\u94fe\u7684\u5b58\u5728\u800c\u5bfc\u81f4\u5e9f\u8bdd\u5197\u957f\uff0c\u8fd9\u8868\u660e\u6a21\u578b\u5b66\u4f1a\u4e86\u63a7\u5236\u8f93\u51fa\u957f\u5ea6\u6765\u907f\u514d\u5728GPT\u8bc4\u5ba1\u65f6\u5403\u4e8f\u3002\u8fd9\u79cd\u5bf9\u8f93\u51fa\u5197\u4f59\u7684\u514b\u5236\u518d\u6b21\u8bc1\u660e\u4e86RL\u8bad\u7ec3\u5bf9\u6a21\u578b\u884c\u4e3a\u7684\u7cbe\u7ec6\u8c03\u6821\u4f5c\u7528\u3002</p> </li> <li> <p>\u6a21\u578b\u84b8\u998f\u6548\u679c\uff1a\u901a\u8fc7\u84b8\u998f\uff0c\u4f5c\u8005\u6210\u529f\u5c06DeepSeek-R1\u7684\u63a8\u7406\u80fd\u529b\u79fb\u690d\u5230\u66f4\u5c0f\u89c4\u6a21\u7684\u6a21\u578b\u4e0a\uff0c\u5e76\u53d6\u5f97\u4e86\u524d\u6240\u672a\u6709\u7684\u6210\u7ee9\u3002\u4f8b\u5982\uff0c\u53ea\u67091.5B\u53c2\u6570\u7684DeepSeek-R1-Distill-Qwen-1.5B\u6a21\u578b\uff0c\u5728AIME 2024\u4e0a\u62ff\u523028.9%\u7684\u6210\u7ee9\uff0c\u8d85\u8fc7\u4e86GPT-4o (9.3%)\u548cClaude 3.5 (16.0%)\u7b49\u5927\u6a21\u578b\u5728\u540c\u4e00\u4efb\u52a1\u4e0a\u7684\u8868\u73b0\u30027B\u53c2\u6570\u7684\u84b8\u998f\u6a21\u578b\u5728AIME\u4e0a\u8fbe\u523055.5%\uff0c\u7adf\u7136\u8d85\u8d8a\u4e86\u539f\u59cb32B\u7684QwQ-Preview\u6a21\u578b\uff0850.0%\uff09\u3002\u84b8\u998f\u6240\u5f97\u768432B\u6a21\u578b\u66f4\u662f\u53d6\u5f97AIME 72.6%\u3001MATH-500 94.3%\u3001LiveCodeBench 62.1%\u7b49\u9ad8\u5206\u3002\u8fd9\u4e9b\u5206\u6570\u5237\u65b0\u4e86\u5f00\u6e90\u7a20\u5bc6\u6a21\u578b\u5728\u5bf9\u5e94\u57fa\u51c6\u4e0a\u7684\u7eaa\u5f55\u3002\u751a\u81f3\u53ef\u4ee5\u8bf4\uff0c\u84b8\u998f\u5c0f\u6a21\u578b\u7684\u8868\u73b0\u5df2\u903c\u8fd1OpenAI-o1-mini\u7b49\u8f83\u5c0f\u95ed\u6e90\u6a21\u578b\u7684\u6c34\u5e73\u3002\u8fd9\u4e00\u7cfb\u5217\u7ed3\u679c\u8bc1\u660e\u4e86\u4f5c\u8005\u63d0\u51fa\u7684\u84b8\u998f\u65b9\u6848\u7684\u6709\u6548\u6027\uff1a\u5927\u6a21\u578b\u901a\u8fc7RL\u5b66\u5230\u7684\u63a8\u7406\u201c\u6280\u80fd\u201d\uff0c\u53ef\u4ee5\u7528\u76f8\u5bf9\u4f4e\u6210\u672c\u7684\u5fae\u8c03\u4f20\u9012\u7ed9\u5c0f\u6a21\u578b\uff0c\u4f7f\u540e\u8005\u83b7\u5f97\u8fdc\u8d85\u81ea\u8eab\u89c4\u6a21\u901a\u5e38\u80fd\u8fbe\u6210\u7684\u6027\u80fd\u3002</p> </li> </ul> <p>\u7efc\u4e0a\u6240\u8ff0\uff0cDeepSeek-R1 \u4ece\u65e0\u76d1\u7763\u6570\u636e\u51fa\u53d1\uff0c\u901a\u8fc7RL\u5b9e\u73b0\u4e86\u63a8\u7406\u80fd\u529b\u7684\u98de\u8dc3\uff0c\u5e76\u5728\u591a\u79cd\u4efb\u52a1\u4e0a\u8fbe\u5230\u4e86\u5f53\u524d\u4e00\u6d41\u7684\u6210\u7ee9\u3002\u5b83\u65e2\u8bc1\u660e\u4e86\u7eaf\u5f3a\u5316\u5b66\u4e60\u9014\u5f84\u5728LLM\u63a8\u7406\u63d0\u5347\u4e0a\u7684\u53ef\u884c\u6027\uff0c\u53c8\u901a\u8fc7\u51b7\u542f\u52a8\u548c\u591a\u9636\u6bb5\u8bad\u7ec3\u514b\u670d\u4e86\u7eafRL\u6a21\u578b\u7684\u7f3a\u70b9\uff08\u53ef\u8bfb\u6027\u548c\u901a\u7528\u6027\uff09\uff0c\u6700\u7ec8\u4ea7\u51fa\u4e86\u4e00\u4e2a\u6027\u80fd\u5ab2\u7f8e\u95ed\u6e90\u5927\u6a21\u578b\u4e14\u5bf9\u793e\u533a\u53cb\u597d\u7684\u5f00\u6e90\u6a21\u578b\u3002\u5728\u6a21\u578b\u538b\u7f29\u65b9\u9762\uff0cDeepSeek-R1 \u4e5f\u5f00\u521b\u6027\u5730\u5c55\u793a\u4e86\u5927\u6a21\u578b\u63a8\u7406\u6a21\u5f0f\u53ef\u4f20\u627f\uff1a\u4e0d\u9700\u8981\u5e9e\u5927\u7684\u53c2\u6570\uff0c\u5c0f\u6a21\u578b\u4e5f\u80fd\u62e5\u6709\u5f3a\u63a8\u7406\u80fd\u529b\uff0c\u4e3a\u5b9e\u7528\u90e8\u7f72\u5e26\u6765\u5229\u597d\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-R1%EF%BC%9A%E9%80%9A%E8%BF%87%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E6%BF%80%E5%8A%B1LLM%E6%8E%A8%E7%90%86%E8%83%BD%E5%8A%9B/#_9","title":"\u4e0e\u73b0\u6709\u5de5\u4f5c\u7684\u5bf9\u6bd4","text":"<p>DeepSeek-R1 \u7684\u5de5\u4f5c\u4e0e\u6b64\u524d\u63d0\u5347LLM\u63a8\u7406\u80fd\u529b\u7684\u63a2\u7d22\u65e2\u4e00\u8109\u76f8\u627f\u53c8\u6709\u6240\u7a81\u7834\uff1a</p> <ul> <li> <p>\u65e0\u76d1\u7763RL vs. \u6709\u76d1\u7763\u5fae\u8c03\uff1a\u6b64\u524d\u5927\u591a\u6570\u63d0\u5347\u63a8\u7406\u80fd\u529b\u7684\u65b9\u6cd5\u90fd\u4ef0\u8d56\u5927\u89c4\u6a21\u4eba\u5de5\u6807\u6ce8\u6570\u636e\uff0c\u6bd4\u5982\u6536\u96c6\u6570\u5b66\u9898\u8be6\u7ec6\u89e3\u9898\u8fc7\u7a0b\u7528\u4e8e\u76d1\u7763\u8bad\u7ec3\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0cDeepSeek-R1-Zero\u5b8c\u5168\u629b\u5f03\u4e86\u524d\u7f6e\u76d1\u7763\u5fae\u8c03\uff0c\u76f4\u63a5\u5bf9\u57fa\u7840\u6a21\u578b\u8fdb\u884cRL\u8bad\u7ec3\u3002\u8fd9\u662f\u9996\u4e2a\u516c\u5f00\u7814\u7a76\u8bc1\u660e\u7eafRL\u5373\u53ef\u8ba9LLM\u5b66\u4f1a\u590d\u6742\u63a8\u7406\u7684\u6210\u679c\u3002\u56e0\u6b64\uff0cDeepSeek-R1 \u4e0e\u4f20\u7edfRLHF\u65b9\u6cd5\uff08\u9700\u8981\u4eba\u7c7b\u504f\u597d\u6570\u636e\u9884\u8bad\u7ec3\uff09\u6216RLAIF\u65b9\u6cd5\uff08\u9700\u8981\u4eba\u5de5\u53cd\u9988\u8bad\u7ec3\uff09\u5f62\u6210\u9c9c\u660e\u5bf9\u6bd4\u2014\u2014\u5b83\u8bc1\u660e\u4e86\u6a21\u578b\u81ea\u6211\u8fdb\u5316\u7684\u53ef\u80fd\u6027\uff0c\u6781\u5927\u964d\u4f4e\u4e86\u4eba\u529b\u4f9d\u8d56\u3002\u8fd9\u4e00\u70b9\u5728\u7814\u7a76\u4e0a\u5177\u6709\u7a81\u7834\u610f\u4e49\u3002</p> </li> <li> <p>\u8fc7\u7a0b\u5956\u52b1 vs. \u6700\u7ec8\u5956\u52b1\uff1a\u5148\u524d\u4e00\u4e9b\u7814\u7a76\u5c1d\u8bd5\u4e86\u8fc7\u7a0b\u76d1\u7763\u6216\u8fc7\u7a0b\u5956\u52b1\u3002\u8fd9\u4e9b\u90fd\u5c5e\u4e8eProcess-Based Reward Models (PRM)\u8303\u5f0f\u3002\u7136\u800c\uff0c\u8fd9\u7c7b\u65b9\u6cd5\u5b58\u5728\u96be\u70b9\uff1a\u5982\u4f55\u7cbe\u786e\u5b9a\u4e49\u901a\u7528\u63a8\u7406\u4e2d\u7684\u201c\u6b63\u786e\u4e00\u6b65\u201d\uff0c\u4ee5\u53ca\u5982\u4f55\u907f\u514d\u6a21\u578b\u4e3a\u4e86\u5956\u52b1\u800c\u751f\u6210\u5197\u957f\u65e0\u610f\u4e49\u6b65\u9aa4\uff08\u6240\u8c13reward hacking\uff09\u3002DeepSeek-R1 \u5728\u65b9\u6cd5\u4e0a\u66f4\u52a0\u7b80\u6d01\uff1a\u5b83\u4e3b\u8981\u5956\u52b1\u6700\u7ec8\u7b54\u6848\u6b63\u786e\uff0c\u8f85\u4ee5\u683c\u5f0f\u7b49\u7b80\u5355\u89c4\u5219\u3002\u8fd9\u79cd\u7ed3\u679c\u9a71\u52a8\u7684\u5956\u52b1\u907f\u514d\u4e86\u5bf9\u4e2d\u95f4\u8fc7\u7a0b\u9010\u6b65\u6807\u6ce8\uff0c\u964d\u4f4e\u4e86\u4eba\u4e3a\u8bbe\u8ba1\u96be\u5ea6\u3002\u540c\u65f6\uff0c\u901a\u8fc7\u5f15\u5165\u601d\u7ef4\u94fe\u683c\u5f0f\u8981\u6c42\uff0c\u6a21\u578b\u4f9d\u7136\u4f1a\u4ea7\u51fa\u5b8c\u6574\u63a8\u7406\u8fc7\u7a0b\u4f9b\u5206\u6790\uff0c\u4f46\u5956\u52b1\u4e3b\u8981\u770b\u7ed3\u679c\u662f\u5426\u6b63\u786e\u3002\u8fd9\u4e2a\u7b56\u7565\u7b80\u5316\u4e86\u8bad\u7ec3\u4fe1\u53f7\uff0c\u4e5f\u8f83\u597d\u5730\u89c4\u907f\u4e86\u8fc7\u7a0b\u5956\u52b1\u6a21\u578b\u53ef\u80fd\u9047\u5230\u7684\u9677\u9631\u3002\u5f53\u7136\uff0cDeepSeek-R1 \u5728\u7b2c\u4e8c\u9636\u6bb5\u8bad\u7ec3\u624d\u5f15\u5165\u504f\u597d\u6a21\u578b\u5956\u52b1\uff0c\u8fd9\u548c\u4f20\u7edfRLHF\u601d\u8def\u6709\u76f8\u4f3c\u4e4b\u5904\uff0c\u4f46\u5b83\u4ec5\u5728\u6a21\u578b\u5df2\u6709\u5f88\u5f3a\u63a8\u7406\u80fd\u529b\u540e\u7528\u4e8e\u5fae\u8c03\u5bf9\u9f50\uff0c\u800c\u975e\u4ece\u96f6\u5f00\u59cb\u9760\u4eba\u7c7b\u53cd\u9988\u9a71\u52a8\u63a8\u7406\u5b66\u4e60\u3002</p> </li> <li> <p>\u641c\u7d22\u4f18\u5316 vs. \u7b56\u7565\u4f18\u5316\uff1a\u6700\u8fd1\u4e5f\u6709\u5de5\u4f5c\u5c1d\u8bd5\u501f\u9274AlphaGo\u7684\u601d\u8def\uff0c\u7528\u641c\u7d22\u7b97\u6cd5\u63d0\u5347LLM\u63a8\u7406\u3002\u7136\u800c\u7ed3\u679c\u53d1\u73b0\uff1a\u5c06AlphaZero\u5f0f\u641c\u7d22\u7528\u4e8e\u751f\u6210\u9886\u57df\u9047\u5230\u4e86\u5de8\u5927\u6311\u6218\u3002\u6587\u672c\u751f\u6210\u7684\u72b6\u6001\u7a7a\u95f4\u8fdc\u8f83\u68cb\u5c40\u5e9e\u5927\uff0c\u5373\u4f7f\u9650\u5236\u6bcf\u6b65\u5c55\u5f00\uff0c\u4e5f\u5bb9\u6613\u9677\u5165\u5c40\u90e8\u6700\u4f18\uff1b\u800c\u4e14\u8bad\u7ec3\u4e00\u4e2a\u7cbe\u7ec6\u7684\u4ef7\u503c\u6a21\u578b\u53bb\u8bc4\u4ef7\u5e8f\u5217\u8d28\u91cf\u975e\u5e38\u56f0\u96be\uff0c\u6a21\u578b\u96be\u4ee5\u901a\u8fc7\u81ea\u6211\u535a\u5f08\u4e0d\u65ad\u63d0\u5347\u3002\u4f5c\u8005\u7684\u7ed3\u8bba\u662f\uff1a\u7eaf\u641c\u7d22+\u503c\u7f51\u7edc\u7684\u81ea\u6211\u589e\u5f3a\u6548\u679c\u6709\u9650\uff0c\u8fdc\u4e0d\u5982\u5728\u7b56\u7565\u68af\u5ea6\u4e0b\u76f4\u63a5\u4f18\u5316\u6a21\u578b\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0cDeepSeek-R1 \u9009\u62e9\u4e86\u7eafRL\u7684\u9053\u8def\uff0c\u901a\u8fc7\u7b56\u7565\u4f18\u5316\u76f4\u63a5\u8ba9\u6a21\u578b\u5185\u5316\u66f4\u597d\u7684\u751f\u6210\u7b56\u7565\u3002\u8fd9\u79cd\u65b9\u6cd5\u867d\u7136\u5728\u8bad\u7ec3\u4e2d\u4e5f\u8fdb\u884c\u4e86\u91c7\u6837\uff08\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u662f\u4e00\u79cd\u9690\u5f0f\u7684\u641c\u7d22\uff09\uff0c\u4f46\u5b83\u59cb\u7ec8\u5728\u7b56\u7565\u7a7a\u95f4\u800c\u975e\u63a8\u7406\u6811\u7a7a\u95f4\u4e2d\u5b66\u4e60\u3002\u56e0\u6b64\uff0c\u4e0e\u90a3\u4e9b\u5f15\u5165\u641c\u7d22\u540e\u79bb\u7ebf\u4f18\u5316\u7684\u5c1d\u8bd5\u76f8\u6bd4\uff0cDeepSeek-R1\u5c55\u73b0\u51fa\u4e86\u66f4\u5927\u7684\u6027\u80fd\u63d0\u5347\u548c\u66f4\u5e7f\u7684\u901a\u7528\u6027\u3002\u5f53\u7136\uff0c\u641c\u7d22\u7b97\u6cd5\u4ecd\u53ef\u4f5c\u4e3a\u63a8\u7406\u7684\u8f85\u52a9\u5de5\u5177\uff0c\u5982\u5728\u63a8\u7406\u65f6\u523b\u4f7f\u7528\u591a\u6570\u51b3/\u81ea\u6d3d\u5c31\u53d6\u5f97\u4e86\u663e\u8457\u589e\u76ca\uff0c\u8fd9\u8868\u660e\u641c\u7d22\u4e0eRL\u5e76\u975e\u6c34\u706b\u4e0d\u5bb9\uff0c\u672a\u6765\u6216\u8bb8\u53ef\u4ee5\u5c06\u4e24\u8005\u66f4\u7d27\u5bc6\u5730\u7ed3\u5408\u3002</p> </li> <li> <p>\u6027\u80fd\u5bf9\u6bd4\uff1a\u5728\u5b9e\u9a8c\u7ed3\u679c\u4e0a\uff0cDeepSeek-R1 \u662f\u9996\u4e2a\u5f00\u6e90\u6a21\u578b\u5728\u591a\u9879\u63a8\u7406\u57fa\u51c6\u4e0a\u903c\u8fd1\u751a\u81f3\u8d85\u8fc7GPT-4 (\u5f00\u653e\u7248)\u7b49\u9876\u7ea7\u6a21\u578b\u7684\u6848\u4f8b\u3002\u7279\u522b\u662f\u5728\u6570\u5b66\u548c\u7f16\u7a0b\u4efb\u52a1\u4e0a\uff0c\u5176\u6210\u7ee9\u8d85\u8fc7\u4e86Claude 3.5\u3001GPT-4o\u7b49\u5546\u7528\u6a21\u578b\uff0c\u4e5f\u5237\u65b0\u4e86\u5b66\u754c\u5f00\u6e90\u6a21\u578b\u7eaa\u5f55\u3002\u8fd9\u4e00\u70b9\u5728\u793e\u533a\u5f15\u8d77\u5f3a\u70c8\u53cd\u54cd\uff0c\u8bc1\u660e\u901a\u8fc7\u7cbe\u5de7\u7684RL\u8bad\u7ec3\uff0c\u5b66\u672f\u548c\u5f00\u6e90\u754c\u4e5f\u80fd\u6253\u9020\u51fa\u5ab2\u7f8e\u5de8\u5934\u95ed\u6e90\u6a21\u578b\u7684\u5f3a\u5927\u7cfb\u7edf\u3002\u8fd9\u4e0e\u51e0\u5e74\u524dGPT-3\u6a2a\u7a7a\u51fa\u4e16\u3001\u5f00\u6e90\u754c\u4e00\u5ea6\u8ffd\u8d76\u8270\u96be\u7684\u60c5\u51b5\u5927</p> </li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/","title":"DeepSeek-V3\u662f\u5982\u4f55\u70bc\u6210\u7684","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#1-model","title":"1. \u6a21\u578b\u7ed3\u6784\uff08Model\uff09","text":"<p>DeepSeek\u2011V3 \u5728\u7ecf\u5178 Transformer \u5e72\u7ebf\u4e0a\u5f15\u5165\u4e24\u5927\u5173\u952e\u6a21\u5757\uff1a\u7528\u4e8e\u964d\u4f4e KV cache \u4e0e\u6fc0\u6d3b\u5f00\u9500\u7684 MLA\uff0c\u4ee5\u53ca\u7528\u4e8e\u6269\u5927\u201c\u603b\u5bb9\u91cf\u3001\u4fdd\u6301\u8ba1\u7b97\u7a00\u758f\u201d\u7684 DeepSeekMoE\u3002\u603b\u4f53\u76ee\u6807\u662f\u5728\u540c\u7b49\u7b97\u529b\u9884\u7b97\u4e0b\u5b9e\u73b0\u66f4\u5f3a\u7684\u53ef\u6269\u5c55\u6027\u4e0e\u66f4\u4f4e\u7684\u63a8\u7406\u6210\u672c\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#11-multihead-latent-attentionmla","title":"1.1 Multi\u2011Head Latent Attention\uff08MLA\uff09","text":"<p>\u6838\u5fc3\u601d\u60f3\uff1a \u5bf9\u6ce8\u610f\u529b\u4e2d\u7684\\(K,V\\)\u5148\u505a\u8054\u5408\u4f4e\u79e9\u538b\u7f29\uff0c\u4ec5\u7f13\u5b58\u5c0f\u7ef4\u5ea6\u6f5c\u53d8\u91cf\uff0c\u518d\u5728\u9700\u8981\u65f6\u4e0a\u6295\u5f71\u91cd\u6784\uff1b\u5bf9\\(Q\\)\u4e5f\u505a\u4f4e\u79e9\u538b\u7f29\u4ee5\u964d\u4f4e\u6fc0\u6d3b\u5185\u5b58\u3002\u4f4d\u7f6e\u7f16\u7801\u91c7\u7528 RoPE\uff0c\u5e76\u5728\\(K\\)\u7684\u4e00\u90e8\u5206\u7ef4\u5ea6\u4e0a\u201c\u89e3\u8026\u201d\u4e3a\u4f4d\u7f6e\u5206\u91cf\uff0c\u4f7f RoPE \u4ec5\u4f5c\u7528\u5230\u88ab\u6307\u5b9a\u7684\u5b50\u7ef4\u4e0a\u3002</p> <ul> <li>\u8bbe\u6bcf\u5934\u7ef4\u5ea6\u4e3a\\(d_h\\)\uff0c\u5c06\u8f93\u5165\u9690\u85cf\u6001\\(h_t\\)\u6295\u5f71\u4e3a\u7d27\u51d1\u6f5c\u53d8\u91cf\\(c_t^{KV}\\in\\mathbb R^{d_c}\\)\uff0c\u968f\u540e\u901a\u8fc7\u4e0a\u6295\u5f71\u5f97\u5230\\(K,V\\)\uff1b\\(Q\\)\u7c7b\u4f3c\u538b\u7f29\u5230\\(d_c^{q}\\)\u518d\u4e0a\u6295\u5f71\u5f97\u5230\u8ba1\u7b97\u7528\u7684\u67e5\u8be2\u3002</li> <li>\u5728\\(K\\)\u7684\u6784\u9020\u4e2d\uff0c\u5c06\u6f5c\u53d8\u91cf\u5206\u4e3a\u5185\u5bb9\u5206\u91cf\u4e0e\u4f4d\u7f6e\u5206\u91cf\uff0c\u540e\u8005\u65bd\u52a0 RoPE \u65cb\u8f6c\u540e\u518d\u4e0e\u5185\u5bb9\u62fc\u63a5\uff0c\u5f97\u5230\u6700\u7ec8\\(K\\)\u3002\u63a8\u7406\u65f6\u4ec5\u9700\u7f13\u5b58\\(c_t^{KV}\\)\u4e0e\u5c0f\u7ef4\u5ea6\u7684\u4f4d\u7f6e\u5206\u91cf\uff0c\u663e\u8457\u964d\u4f4e KV cache\u3002</li> <li>\u6ce8\u610f\u529b\u4ecd\u6309\\(A(Q,K,V)=\\mathrm{softmax}(QK^\\top/\\sqrt{d}),V\\)\u8ba1\u7b97\uff0c\u4f46\\(Q,K,V\\)\u6765\u81ea\u4e0a\u8ff0\u538b\u7f29/\u89e3\u8026\u6d41\u7a0b\u3002</li> </ul> <p>\u7ecf\u9a8c\u8bbe\u5b9a\uff08\u793a\u4f8b\uff09\uff1a\\(n_h=128\\)\u3001\\(d_h=128\\)\u3001\\(d_c=512\\)\u3001\\(d_c^{q}=1536\\)\uff0c\u89e3\u8026\u4f4d\u7f6e\u5b50\u7ef4\u7ea6\u6bcf\u5934\\(64\\)\u3002\u8fd9\u4e9b\u8bbe\u5b9a\u5728\u957f\u4e0a\u4e0b\u6587\u4e0e\u5185\u5b58\u5360\u7528\u95f4\u53d6\u5f97\u826f\u597d\u5e73\u8861\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#12-deepseekmoe","title":"1.2 DeepSeekMoE\uff08\u5305\u542b\u5171\u4eab\u4e13\u5bb6\u4e0e\u8def\u7531\u4e13\u5bb6\uff09","text":"<p>\u7ed3\u6784\u8981\u70b9\uff1a</p> <ul> <li>\u81ea\u7b2c 4 \u5c42\u8d77\uff0cFFN \u57fa\u672c\u88ab MoE \u53d6\u4ee3\u3002\u6bcf\u5c42\u5305\u542b\\(1\\)\u4e2a\u5171\u4eab\u4e13\u5bb6\uff08\u6240\u6709 token \u59cb\u7ec8\u6fc0\u6d3b\uff09\u4e0e\\(256\\)\u4e2a\u8def\u7531\u4e13\u5bb6\uff08\u6309\u8def\u7531\u9009\u62e9\uff09\u3002</li> <li>\u6bcf\u4e2a token \u9009\u62e9 Top\u2011K \u4e2a\u8def\u7531\u4e13\u5bb6\uff08\u5982\\(K=8\\)\uff09\uff0c\u4e0e\u5171\u4eab\u4e13\u5bb6\u5171\u540c\u53c2\u4e0e\u8ba1\u7b97\uff0c\u8f93\u51fa\u4e3a\u52a0\u6743\u548c\uff1a</li> </ul> \\[h'_t = f_{\\text{shared}}(u_t) + \\sum_{r \\in \\mathcal S_t} G_{t,r}\\, g_r(u_t)\\] <p>\u5176\u4e2d\\(f_{\\text{shared}}\\)\u4e3a\u5171\u4eab\u4e13\u5bb6\uff0c\\(g_r\\)\u4e3a\u88ab\u9009\u8def\u7531\u4e13\u5bb6\uff0c\\(G_{t,r}\\)\u4e3a\u95e8\u63a7\u6743\u91cd\u3002</p> <p>\\(G_{t,r}\\)\u95e8\u63a7\u6743\u91cd\u7684\u8ba1\u7b97\u65b9\u5f0f\u4e3a\uff1a</p> <ol> <li>\u8ba1\u7b97\u8def\u7531 logits\uff1a</li> </ol> \\[z_{t,r} = (W_{\\text{router}} u_t)_r + b_r\\] <p>\u5176\u4e2d\\(W_{\\text{router}}\\)\u662f\u8def\u7531\u5668\u7684\u6743\u91cd\u77e9\u9635\uff0c\\(b_r\\)\u662f\u5bf9\u5e94\u4e13\u5bb6\u7684\u504f\u7f6e\u9879\u3002</p> <ol> <li>\u9009\u62e9 top-k \u4e13\u5bb6\uff1a \u5bf9\\(z_{t,r}\\)\u8fdb\u884c\u6392\u5e8f\uff0c\u53d6\u524d8\u4e2a\u6700\u5927\u7684\u4e13\u5bb6\u4f5c\u4e3a\u5019\u9009\uff08DeepSeek-V3 \u91cc\u662f 8 \u4e2a\u8def\u7531\u4e13\u5bb6 + 1 \u4e2a\u5171\u4eab\u4e13\u5bb6\uff09\u3002</li> <li>\u5f52\u4e00\u5316\u5f97\u5230\u95e8\u63a7\u6743\u91cd\uff1a</li> </ol> \\[G_{t,r} = \\frac{\\exp(z_{t,r})}{\\sum_{r' \\in \\mathcal{S}_t}\\exp(z_{t,r'})}, \\quad r \\in \\mathcal{S}_t\\] <p>\u8fd9\u91cc\\(\\mathcal{S}_t\\)\u8868\u793a token\\(t\\)\u6fc0\u6d3b\u7684\u4e13\u5bb6\u96c6\u5408\uff0c\u672a\u88ab\u9009\u4e2d\u7684\u4e13\u5bb6\u6743\u91cd\u76f4\u63a5\u7f6e\u4e3a 0\u3002 </p> <p>\u4e13\u5bb6\u5185\u90e8\u591a\u91c7\u7528\u8f7b\u91cf\u7684 SwiGLU \u524d\u9988\u7ed3\u6784\uff08\u4e2d\u95f4\u7ef4\u76f8\u5bf9\u5bc6\u96c6 FFN \u660e\u663e\u7f29\u5c0f\uff09\uff0c\u63d0\u5347\u5355\u4f4d\u663e\u5b58\u4e0b\u7684\u4e13\u5bb6\u5e76\u884c\u5ea6\u3002</p> <p>\u76f4\u89c2\u7406\u89e3\uff1a \u5171\u4eab\u4e13\u5bb6\u63d0\u4f9b\u7a33\u5065\u7684\u201c\u901a\u7528\u80fd\u529b\u5e95\u5ea7\u201d\uff0c\u8def\u7531\u4e13\u5bb6\u627f\u8f7d\u201c\u7ec6\u7c92\u5ea6\u9886\u57df\u4e13\u957f\u201d\uff1b\u4e24\u8005\u53e0\u52a0\u4f7f\u5355\u4f4d\u8ba1\u7b97\u7684\u201c\u6709\u6548\u5bb9\u91cf\u201d\u5f97\u5230\u663e\u8457\u63d0\u5347\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#13-auxlossfree","title":"1.3 \u8d1f\u8f7d\u5747\u8861\uff1aAux\u2011loss\u2011free \u4e0e\u8282\u70b9\u9650\u5236\u8def\u7531","text":"<p>Aux\u2011loss\u2011free \u8d1f\u8f7d\u5747\u8861\uff1a \u4e0d\u518d\u901a\u8fc7\u989d\u5916\u7684\u8f85\u52a9\u635f\u5931\u63a7\u5236\u4e13\u5bb6\u4f7f\u7528\u9891\u7387\uff0c\u800c\u662f\u4e3a\u6bcf\u4e2a\u4e13\u5bb6\u7ef4\u62a4\u4e00\u4e2a\u53ef\u5b66\u4e60\u504f\u7f6e\\(b_r\\)\u7528\u4e8e\u8def\u7531\u6253\u5206\u7684\u201c\u6e29\u548c\u5e72\u9884\u201d\uff1a</p> <ul> <li>\u8bad\u7ec3\u65f6\u7edf\u8ba1\u6bcf\u6b65\u5404\u4e13\u5bb6\u8d1f\u8f7d\uff0c\u82e5\u67d0\u4e13\u5bb6\u8d1f\u8f7d\u9ad8\u4e8e\u671f\u671b\uff0c\u5219\u5c0f\u5e45\u964d\u4f4e\u5176\u504f\u7f6e\uff1b\u53cd\u4e4b\u63d0\u9ad8\u3002\u504f\u7f6e\u4ec5\u5f71\u54cd\u662f\u5426\u88ab\u9009\u4e2d\uff0c\u4e0d\u5f71\u54cd\u95e8\u63a7\u503c\u8ba1\u7b97\u3002</li> <li>\u8fd9\u6837\u505a\u907f\u514d\u8f85\u52a9\u635f\u5931\u6743\u91cd\u8c03\u4e0d\u5f53\u5bf9\u4e3b\u4efb\u52a1\u8868\u793a\u5b66\u4e60\u7684\u8d1f\u9762\u5f71\u54cd\uff0c\u5b9e\u8df5\u663e\u793a\u66f4\u7a33\u5b9a\u3002</li> </ul> <p>\u5e8f\u5217\u7ea7\u6781\u5c0f\u6b63\u5219\uff1a \u4e3a\u907f\u514d\u5355\u4e2a\u957f\u5e8f\u5217\u6781\u7aef\u503e\u659c\uff0c\u989d\u5916\u52a0\u5165\u4e00\u4e2a\u975e\u5e38\u5c0f\u6743\u91cd\u7684\u5e8f\u5217\u5747\u8861\u9879\u4f5c\u4e3a\u515c\u5e95\u3002</p> <p>\u8282\u70b9\u9650\u5236\u8def\u7531\uff1a\u8bad\u7ec3\u4e2d\u91c7\u7528\u4e13\u5bb6\u5e76\u884c\uff08EP\uff09\u8de8\u8282\u70b9\u653e\u7f6e\u3002\u4e3a\u964d\u4f4e\u8de8\u8282\u70b9 all\u2011to\u2011all \u901a\u4fe1\uff0c\u5c06\u6bcf\u4e2a token \u7684\u53ef\u7528\u4e13\u5bb6\u9650\u5236\u5728\u6700\u591a 4 \u4e2a\u8282\u70b9\u5185\u641c\u7d22\u4e0e\u6d3e\u9001\uff0c\u5728\u51e0\u4e4e\u4e0d\u635f\u6027\u80fd\u7684\u60c5\u51b5\u4e0b\u5927\u5e45\u964d\u4f4e\u901a\u4fe1\u538b\u529b\u3002</p> <p>\u96f6 token\u2011dropping\uff1a \u5728\u4e0a\u8ff0\u5747\u8861\u4e0e\u9650\u5236\u7b56\u7565\u914d\u5408\u4e0b\uff0c\u8bad\u7ec3\u5168\u7a0b\u65e0\u9700\u4e22\u5f03 token\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#14","title":"1.4 \u5f52\u4e00\u5316\u3001\u6fc0\u6d3b\u3001\u4f4d\u7f6e\u7f16\u7801\u4e0e\u5206\u8bcd\u5668","text":"<ul> <li>\u5f52\u4e00\u5316\u4e0e\u6fc0\u6d3b\uff1a \u91c7\u7528 RMSNorm \u4e0e SwiGLU\uff0c\u524d\u8005\u5728\u5927\u6a21\u578b\u4e0e\u4f4e\u7cbe\u6761\u4ef6\u4e0b\u66f4\u7a33\u5b9a\uff0c\u540e\u8005\u53ef\u63d0\u5347\u524d\u9988\u8868\u8fbe\u529b\u4e0e\u68af\u5ea6\u6d41\u52a8\u6027\u3002</li> <li>\u4f4d\u7f6e\u7f16\u7801\uff1a RoPE \u5e76\u914d\u5408 MLA \u7684\u4f4d\u7f6e\u5206\u91cf\u201c\u89e3\u8026\u201d\u8bbe\u8ba1\uff0c\u65b9\u4fbf\u540e\u7eed\u57fa\u4e8e YaRN \u7684\u4e0a\u4e0b\u6587\u6269\u5c55\u3002</li> <li>\u5206\u8bcd\u5668\uff1a \u81ea\u7814 byte\u2011level BPE\uff0c\u8bcd\u8868\u7ea6 128K\uff1b\u4e3a\u538b\u7f29\u591a\u8bed\u4e0e\u4ee3\u7801\u6587\u672c\uff0c\u5f15\u5165\u201c\u6807\u70b9+\u6362\u884c\u201d\u590d\u5408 token\uff0c\u540c\u65f6\u5728\u8bad\u7ec3\u4e2d\u5bf9\u90e8\u5206\u590d\u5408 token \u968f\u673a\u62c6\u5206\u4ee5\u7f13\u89e3\u8fb9\u754c\u504f\u7f6e\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#2-data","title":"2. \u8bad\u7ec3\u6570\u636e\uff08Data\uff09","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#21","title":"2.1 \u89c4\u6a21\u4e0e\u6784\u6210","text":"<ul> <li>\u603b\u89c4\u6a21\u7ea6 14.8T token\uff0c\u663e\u8457\u9ad8\u4e8e\u6b64\u524d\u591a\u6570\u5f00\u653e\u6a21\u578b\u3002</li> <li>\u82f1\u6587\u4e0e\u4e2d\u6587\u4e3a\u4e3b\uff0c\u540c\u65f6\u6269\u5927\u591a\u8bed\u79cd\u8986\u76d6\uff0c\u663e\u8457\u63d0\u9ad8\u6570\u5b66\u4e0e\u4ee3\u7801\u7b49\u201c\u9ad8\u63a8\u7406\u5bc6\u5ea6\u201d\u8bed\u6599\u5360\u6bd4\uff0c\u4ee5\u63d0\u5347\u590d\u6742\u63a8\u7406\u80fd\u529b\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#22","title":"2.2 \u6e05\u6d17\u4e0e\u53bb\u91cd","text":"<ul> <li>\u591a\u9636\u6bb5\u53bb\u91cd\uff08\u8fd1\u4f3c\u91cd\u590d\u3001\u6bb5\u843d\u7ea7\u76f8\u4f3c\uff09\u3001\u4f4e\u8d28\u8fc7\u6ee4\uff08\u566a\u58f0\u3001\u8fc7\u77ed\u3001\u5e7f\u544a\u7b49\uff09\u3001\u683c\u5f0f\u7edf\u4e00\uff0c\u5f3a\u8c03\u5728\u53bb\u91cd\u540c\u65f6\u4fdd\u591a\u6837\u6027\uff0c\u907f\u514d\u51fa\u73b0\u9886\u57df\u4e0e\u98ce\u683c\u6536\u7f29\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#23","title":"2.3 \u6587\u6863\u6253\u5305\u4e0e\u586b\u5145\u7b56\u7565","text":"<ul> <li>\u8bad\u7ec3\u6837\u672c\u91c7\u7528\u201c\u6587\u6863\u6253\u5305\u201d\u4ee5\u51cf\u5c11 padding \u6d6a\u8d39\uff0c\u63d0\u5347\u541e\u5410\uff1a\u5c06\u82e5\u5e72\u77ed\u6587\u6863\u62fc\u63a5\u4e3a\u63a5\u8fd1\u6700\u5927\u957f\u5ea6\u7684\u5e8f\u5217\u5582\u7ed9\u6a21\u578b\u3002</li> <li>\u62a5\u544a\u7b56\u7565\u4e2d\u4e0d\u5bf9\u8de8\u6587\u6863\u6ce8\u610f\u529b\u505a\u4e13\u95e8\u5c4f\u853d\uff0c\u6743\u8861\u4e86\u6548\u7387\u4e0e\u4e00\u81f4\u6027\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#24-fim","title":"2.4 FIM \u4e2d\u95f4\u586b\u7a7a","text":"<ul> <li>\u4ee5\u7ea6 10% \u7684\u6982\u7387\u91c7\u7528 FIM \u6a21\u5f0f\uff08Prefix\u2011Suffix\u2011Middle\uff0cPSM \u6a21\u677f\uff09\uff0c\u8bad\u7ec3\u6a21\u578b\u5229\u7528\u53cc\u5411\u4e0a\u4e0b\u6587\u586b\u8865\u4e2d\u6bb5\uff0c\u7279\u522b\u6709\u5229\u4e8e\u4ee3\u7801\u4e0e\u7ed3\u6784\u5316\u6587\u672c\u5904\u7406\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#25","title":"2.5 \u5206\u8bcd\u5668\u4e0e\u8fb9\u754c\u504f\u7f6e\u7f13\u89e3","text":"<ul> <li>\u5927\u8bcd\u8868\u6709\u5229\u4e8e\u591a\u8bed\u4e0e\u4ee3\u7801\u538b\u7f29\uff0c\u4f46\u201c\u6807\u70b9+\u6362\u884c\u201d\u590d\u5408 token \u4f1a\u5728\u591a\u884c\u63d0\u793a\u4e2d\u5f15\u5165\u8fb9\u754c\u504f\u7f6e\u3002</li> <li>\u8bad\u7ec3\u65f6\u968f\u673a\u62c6\u5206\u90e8\u5206\u590d\u5408 token\uff0c\u4f7f\u6a21\u578b\u89c1\u8fc7\u201c\u5408\u5e76\u201d\u548c\u201c\u62c6\u5f00\u201d\u4e24\u79cd\u60c5\u51b5\uff0c\u4ece\u800c\u663e\u8457\u7f13\u89e3\u8be5\u504f\u7f6e\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#3-pretraining","title":"3. \u9884\u8bad\u7ec3\uff08Pre\u2011training\uff09","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#31-clm-mtp","title":"3.1 \u8bad\u7ec3\u76ee\u6807\uff1aCLM \u4e0e MTP","text":"<p>DeepSeek-V3\u7684\u9884\u8bad\u7ec3\u4ee5\u6807\u51c6\u7684\u81ea\u56de\u5f52\u8bed\u8a00\u6a21\u578b\u76ee\u6807\u4e3a\u4e3b\uff0c\u5373\u8ba9\u6a21\u578b\u9884\u6d4b\u5e8f\u5217\u4e2d\u7684\u4e0b\u4e00\u4e2atoken\u3002\u635f\u5931\u51fd\u6570\u4e3a\u56e0\u679c\u8bed\u8a00\u6a21\u578b\u7684\u4ea4\u53c9\u71b5\u635f\u5931\\(L_{\\text{LM}}\\)\u3002\u4e0e\u591a\u6570Transformer LM\u7c7b\u4f3c\uff0c\u6a21\u578b\u57fa\u5ea7\u901a\u8fc7\u6700\u5c0f\u5316\\(L_{\\text{LM}} = -\\frac{1}{N}\\sum_{t}\\log P(x_t,|,x_{&lt;t})\\)\u6765\u5b66\u4e60\u3002\u989d\u5916\u5730\uff0cDeepSeek-V3\u5f15\u5165\u4e86\u591aToken\u9884\u6d4b (Multi-Token Prediction, MTP) \u7684\u8f85\u52a9\u8bad\u7ec3\u76ee\u6807\u3002\u4e0d\u540c\u4e8e\u4f20\u7edf\u53ea\u9884\u6d4b\u4e0b\u4e00\u4e2a\u8bcd\u5143\uff0cMTP\u9f13\u52b1\u6a21\u578b\u5728\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u5c55\u671b\u591a\u4e2a\u672a\u6765\u8bcd\uff0c\u76ee\u7684\u662f\u589e\u52a0\u8bad\u7ec3\u4fe1\u53f7\u5bc6\u5ea6\uff0c\u63d0\u5347\u8bad\u7ec3\u6548\u7387\u3002\u5177\u4f53\u5b9e\u73b0\u4e3a\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u8f93\u5165token\uff0c\u989d\u5916\u9644\u52a0\u4e00\u4e2a\u201c\u5c0f\u578bTransformer\u6a21\u5757\u201d\u53bb\u9884\u6d4b\u5176\u4e4b\u540e\u7b2c2\u4e2atoken\u3002DeepSeek-V3\u8bbe\u7f6eMTP\u6df1\u5ea6\u4e3a1\uff0c\u5373\u6bcf\u4e2a\u4f4d\u7f6e\u9664\u9884\u6d4b\u4e0b\u4e00token\u5916\uff0c\u518d\u9884\u6d4b\u4e0b\u4e0b\u4e2atoken\u5171\u4e24\u4e2a\u4f4d\u7f6e\u3002\u4e3a\u4e86\u4e0d\u5e72\u6270\u4e3b\u6a21\u578b\uff0cMTP\u6a21\u5757\u5171\u4eab\u4e86\u4e3b\u6a21\u578b\u7684embedding\u5c42\u548c\u8f93\u51fasoftmax\u5c42\uff0c\u53ea\u662f\u5728\u4e2d\u95f4\u589e\u52a0\u4e00\u4e2aTransformer\u5c42\u5f62\u6210\u9884\u6d4b\u6df1\u5ea6\u94fe\u3002\u9884\u6d4b\u6d41\u7a0b\u662f\u987a\u5e8f\u7684\uff1a\u5148\u7528\u4e3b\u6a21\u578b\u9884\u6d4b\\(t+1\\)\u4f4d\u7f6e\uff0c\u518d\u5c06\u8be5\u9884\u6d4b\u9690\u85cf\u6001\u548c\u539fembedding\u62fc\u63a5\u8f93\u5165\u4e0b\u4e00\u4e2a\u6a21\u5757\u9884\u6d4b\\(t+2\\)\uff0c\u4ee5\u6b64\u4fdd\u6301\u5b8c\u6574\u7684\u56e0\u679c\u94fe\u3002\u6bcf\u4e2a\u6df1\u5ea6\u90fd\u6709\u81ea\u5df1\u7684\u4ea4\u53c9\u71b5\u635f\u5931\\(L_d\\)\u3002\u6700\u7ec8MTP\u603b\u635f\u5931\u662f\u6240\u6709\u6df1\u5ea6\u635f\u5931\u7684\u5e73\u5747\u5e76\u4e58\u4ee5\u4e00\u4e2a\u6743\u91cd\u7cfb\u6570\\(\\lambda\\)\u3002</p> <ul> <li>\u4e3b\u76ee\u6807\uff1a \u6807\u51c6\u56e0\u679c\u8bed\u8a00\u5efa\u6a21\uff08CLM\uff09\u4ea4\u53c9\u71b5\uff0c\u6700\u5c0f\u5316\\(-\\sum_t \\log p(x_t\\mid x_{&lt;t})\\)\u3002</li> <li>\u8f85\u52a9\u76ee\u6807\uff1aMulti\u2011Token Prediction\uff08MTP\uff09 \u5728\u6bcf\u4e2a\u4f4d\u7f6e\u989d\u5916\u9884\u6d4b\u672a\u6765\u7b2c\\(k\\)\u4e2a token\uff08\u672c\u62a5\u544a\u8bbe\u7f6e\\(D=1\\)\uff0c\u5373\u989d\u5916\u9884\u6d4b\u7b2c 2 \u4e2a token\uff09\uff0c\u63d0\u5347\u8bad\u7ec3\u4fe1\u53f7\u5bc6\u5ea6\u4e0e\u201c\u5411\u524d\u89c4\u5212\u201d\u7684\u8868\u5f81\u80fd\u529b\u3002\u603b\u635f\u5931\u793a\u610f\uff1a</li> </ul> \\[L = L_{\\text{CLM}} + \\lambda \\cdot \\frac{1}{D}\\sum_{k=1}^{D} L_{\\text{MTP}}^{(k)}\\] <p>\u8bad\u7ec3\u524d\u671f\u91c7\u7528\u8f83\u5927\\(\\lambda\\)\uff08\u5982 0.3\uff09\u4ee5\u653e\u5927\u8f85\u52a9\u4fe1\u53f7\uff0c\u540e\u671f\u964d\u81f3 0.1 \u4ee5\u56de\u5f52\u4e3b\u76ee\u6807\uff1b\u63a8\u7406\u9636\u6bb5\u53ef\u76f4\u63a5\u4e22\u5f03 MTP \u6a21\u5757\uff0c\u6216\u7528\u4f5c\u63a8\u6d4b\u89e3\u7801\u8349\u7a3f\u5934\u4ee5\u63d0\u901f\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#32","title":"3.2 \u6a21\u578b\u4e0e\u8bad\u7ec3\u914d\u7f6e","text":"<ul> <li>\u603b\u53c2\u6570\u89c4\u6a21\uff1a \u7ea6 671B\uff08\u542b\u5168\u90e8\u4e13\u5bb6\uff09\uff0c\u4f46\u56e0 MoE \u7a00\u758f\u8def\u7531\uff0c\u5355 token \u6fc0\u6d3b\u53c2\u6570\u7ea6 37B\uff0c\u63a8\u7406\u6210\u672c\u8fd1\u4f3c\u4e00\u4e2a 37B \u5bc6\u96c6\u6a21\u578b\u3002</li> <li>\u5e8f\u5217\u957f\u5ea6\uff1a \u9884\u8bad\u7ec3\u9636\u6bb5\u6700\u5927\u5168\u957f 4K\uff08\u957f\u4e0a\u4e0b\u6587\u5728\u540e\u7eed\u9636\u6bb5\u6269\u5c55\uff09\u3002</li> <li>\u4f18\u5316\u5668\u4e0e\u88c1\u526a\uff1a AdamW\uff0c\u5e38\u89c1\u8bbe\u5b9a\u5982\\(\\beta_1=0.9,\\ \\beta_2=0.95,\\ \\mathrm{wd}=0.1\\)\uff0c\u68af\u5ea6\u88c1\u526a\u8303\u6570 1.0\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#33","title":"3.3 \u5b66\u4e60\u7387\u4e0e\u6279\u5927\u5c0f\u8c03\u5ea6","text":"<ul> <li>\u5b66\u4e60\u7387\u8c03\u5ea6\uff08\u793a\u4f8b\uff09\uff1a \u7ea6 2K \u6b65\u7ebf\u6027 warmup \u81f3\u5cf0\u503c\u5b66\u4e60\u7387\uff0c\u968f\u540e\u5728\u6781\u957f\u9636\u6bb5\u4fdd\u6301\u5e38\u6570\uff0c\u63a5\u7740\u505a\u4f59\u5f26\u8870\u51cf\uff1b\u672b\u6bb5\u91c7\u7528\u9010\u6bb5\u8f83\u5c0f\u5e38\u6570 LR \u7cbe\u4fee\u6536\u655b\u3002</li> <li>\u6279\u5927\u5c0f\u8c03\u5ea6\uff1a \u5168\u5c40\u6279\u4ece\u7ea6 3072 \u5e73\u6ed1\u589e\u957f\u81f3 15360\uff08\u5728\u82e5\u5e72\u4ebf token \u5185\u9010\u6b65\u589e\u5927\uff09\uff0c\u968f\u540e\u4fdd\u6301\u7a33\u5b9a\uff0c\u4ee5\u517c\u987e\u524d\u671f\u7a33\u5065\u6536\u655b\u4e0e\u540e\u671f\u9ad8\u6548\u541e\u5410\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#34-yarn-128k","title":"3.4 \u957f\u4e0a\u4e0b\u6587\u6269\u5c55\uff08YaRN\uff0c\u81f3 128K\uff09","text":"<ul> <li>\u9884\u8bad\u7ec3\u5b8c\u6210\u540e\uff0c\u5206\u4e24\u9636\u6bb5\u8fdb\u884c RoPE \u9891\u7387\u91cd\u6807\u5b9a\u7684\u4e0a\u4e0b\u6587\u6269\u5c55\u5fae\u8c03\uff1a4K\u219232K\u2192128K\u3002</li> <li>\u6bcf\u9636\u6bb5\u8bad\u7ec3\u7ea6 1000 \u6b65\uff0c\u4f7f\u7528\u4e0e\u9884\u8bad\u7ec3\u672b\u671f\u76f8\u5f53\u7684\u5c0f\u5b66\u4e60\u7387\uff1b\u5728 Needle\u2011in\u2011a\u2011Haystack \u7b49\u57fa\u51c6\u4e0a\u5c55\u73b0\u7a33\u5b9a\u7684\u957f\u7a0b\u68c0\u7d22\u4e0e\u5b9a\u4f4d\u80fd\u529b\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#35","title":"3.5 \u8bad\u7ec3\u7a33\u5b9a\u6027\u4e0e\u6210\u672c","text":"<ul> <li>\u8bad\u7ec3\u8fc7\u7a0b\u62a5\u544a\u4e3a\u5168\u7a0b\u7a33\u5b9a\uff0c\u65e0\u4e0d\u53ef\u6062\u590d\u7684 loss spike \u4e0e checkpoint \u56de\u6eda\u3002</li> <li>\u8ba1\u7b97\u89c4\u6a21\uff1a2048\u00d7H800 \u96c6\u7fa4\uff0c\u6574\u4f53 GPU\u2011hours \u91cf\u7ea7\u7ea6 2.788M\uff08\u542b\u9884\u8bad\u7ec3\u3001\u4e0a\u4e0b\u6587\u6269\u5c55\u4e0e\u540e\u8bad\u7ec3\uff09\uff0c\u5728\u8be5\u89c4\u6a21\u6a21\u578b\u4e2d\u5177\u5907\u6781\u9ad8\u7684\u6027\u4ef7\u6bd4\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#4-posttraining-alignment","title":"4. \u540e\u8bad\u7ec3\u4e0e\u5bf9\u9f50\uff08Post\u2011training &amp; Alignment\uff09","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#41-sft","title":"4.1 \u6709\u76d1\u7763\u6307\u4ee4\u5fae\u8c03\uff08SFT\uff09","text":"<ul> <li>\u6570\u636e\u89c4\u6a21\u4e0e\u8986\u76d6\uff1a \u7ea6 150 \u4e07\u6761\u6307\u4ee4\u6837\u672c\uff0c\u8986\u76d6\u6570\u5b66\u3001\u4ee3\u7801\u3001\u5e38\u8bc6\u63a8\u7406\u3001\u5f00\u653e QA\u3001\u5199\u4f5c\u4e0e\u591a\u8f6e\u5bf9\u8bdd\u7b49\u3002</li> <li>\u6784\u9020\u65b9\u5f0f\uff1a \u590d\u6742\u63a8\u7406\u6837\u672c\u7531\u66f4\u5f3a\u63a8\u7406\u6a21\u578b\u751f\u6210\u521d\u7a3f\uff0c\u518d\u7ecf\u4e13\u5bb6\u6a21\u578b\u4e0e\u89c4\u5219\u6821\u6b63\u3001\u62d2\u7edd\u91c7\u6837\u7b5b\u9009\uff0c\u4fdd\u7559\u201c\u6b63\u786e\u3001\u6e05\u6670\u3001\u7b80\u6d01\u201d\u7684\u98ce\u683c\uff1b\u975e\u63a8\u7406\u6837\u672c\u7531\u4e0a\u4e00\u4ee3\u5bf9\u8bdd\u6a21\u578b\u751f\u6210\u5e76\u7ecf\u4eba\u5de5\u5ba1\u6838\u4fee\u8ba2\u3002</li> <li>\u8bad\u7ec3\u8981\u70b9\uff1a 2 \u4e2a epoch \u5de6\u53f3\u3001\u4f59\u5f26\u9000\u706b\u5c0f LR\uff1b\u4f7f\u7528\u6837\u672c\u6253\u5305\u4e0e\u53ef\u89c1\u6027\u63a9\u7801\u4fdd\u8bc1\u540c\u4e00\u5e8f\u5217\u5185\u4e0d\u540c\u6837\u672c\u4e92\u4e0d\u53ef\u89c1\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#42-rlhfgrpo","title":"4.2 \u4eba\u7c7b\u53cd\u9988\u5f3a\u5316\u5b66\u4e60\uff08RLHF\uff0cGRPO\uff09","text":"<ul> <li>\u5956\u52b1\u6a21\u578b\uff08RM\uff09\uff1a \u89c4\u5219\u5f0f RM \u7528\u4e8e\u53ef\u5ba2\u89c2\u5224\u5b9a\u4efb\u52a1\uff08\u6570\u5b66\u7b54\u6848\u683c\u5f0f\u6821\u9a8c\u3001\u4ee3\u7801\u7f16\u8bd1\u4e0e\u5355\u6d4b\u901a\u8fc7\u7387\uff09\uff1b\u6a21\u578b\u5f0f RM \u7528\u4e8e\u5f00\u653e\u4efb\u52a1\uff0c\u504f\u597d\u6570\u636e\u53ef\u5305\u542b\u8bc4\u5ba1 CoT\uff0c\u4ee5\u63d0\u5347\u9c81\u68d2\u6027\u3002</li> <li>\u4f18\u5316\u7b97\u6cd5\uff1aGRPO \u7ec4\u5185\u76f8\u5bf9\u4f18\u52bf\u4f5c\u4e3a\u57fa\u7ebf\uff0c\u514d\u4ef7\u503c\u7f51\u7edc\uff1a\u5bf9\u540c\u4e00\u63d0\u793a\u91c7\u6837\u591a\u4efd\u56de\u7b54\uff0c\u8ba1\u7b97\u8bc4\u5206\u5747\u503c\u6216\u5206\u4f4d\u6570\u4f5c\u4e3a\u57fa\u7ebf\\(B\\)\uff0c\u6bcf\u4e2a\u56de\u7b54\u7684\u4f18\u52bf\u4e3a\\(A=R-B\\)\uff0c\u6700\u5927\u5316\u671f\u671b\u7684\\(\\frac{\\pi_\\theta(x)}{\\pi_{\\text{old}}(x)}A\\)\uff0c\u5e76\u5bf9\u53c2\u8003\u7b56\u7565\u52a0 KL \u6b63\u5219\u9650\u5236\u7b56\u7565\u6f02\u79fb\u3002</li> <li>\u63d0\u793a\u6c60\uff1a\u8986\u76d6\u4ee3\u7801\u3001\u6570\u5b66\u3001\u5f00\u653e\u95ee\u7b54\u3001\u89d2\u8272\u626e\u6f14\u4e0e\u591a\u8f6e\u5bf9\u8bdd\u7b49\uff0c\u5f3a\u5316\u591a\u57df\u5bf9\u9f50\u4e0e\u7a33\u5065\u6027\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#5-infrastructure","title":"5. \u57fa\u7840\u8bbe\u65bd\u4e0e\u5de5\u7a0b\u4f18\u5316\uff08Infrastructure\uff09","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#51","title":"5.1 \u96c6\u7fa4\u4e0e\u603b\u4f53\u5e76\u884c\u7b56\u7565","text":"<ul> <li>\u786c\u4ef6\uff1a 2048\u00d7NVIDIA H800\uff1b\u8282\u70b9\u5185 NVLink/NVSwitch\uff0c\u8de8\u8282\u70b9 InfiniBand\u3002</li> <li>\u5e76\u884c\u7b56\u7565\uff1a</li> </ul> <p>DeepSeek-V3 \u4f7f\u7528\u4e09\u7c7b\u5e76\u884c\uff1a</p> <ul> <li> <p>Pipeline Parallel (PP)\uff1a\u628a\u6a21\u578b\u5c42\u5207\u6210\u6bb5\uff0c\u5206\u5e03\u5230\u4e0d\u540c GPU \u4e0a\u6d41\u6c34\u6267\u884c\u3002</p> </li> <li> <p>Expert Parallel (EP)\uff1aMoE \u4e13\u5bb6\u5206\u5e03\u5728\u4e0d\u540c GPU \u4e0a\uff0ctoken \u6839\u636e\u8def\u7531\u88ab\u53d1\u9001\u5230\u5bf9\u5e94 GPU \u6267\u884c\u3002</p> </li> <li> <p>Data Parallel (DP)\uff1a\u540c\u4e00\u6a21\u578b\u5728\u591a\u4e2a GPU \u4e0a\u590d\u5236\uff0c\u5206\u62c5\u4e0d\u540c batch \u7684\u8bad\u7ec3\u6570\u636e\uff1b\u68af\u5ea6\u5728\u66f4\u65b0\u65f6\u6c47\u603b\uff08\u672c\u6b21\u7528 ZeRO-1 \u4ec5\u5206\u644a\u4f18\u5316\u5668\u72b6\u6001\uff09\u3002</p> </li> </ul> <p>\u4e0d\u4f7f\u7528 Tensor Parallel (TP)\uff1aTP \u662f\u628a\u77e9\u9635\u62c6\u5757\u5206\u5e03\u5230\u591a\u4e2a GPU \u4e0a\u505a\u5e76\u884c\u4e58\u6cd5\uff0c\u4f46\u4f1a\u589e\u52a0\u540c\u6b65\u901a\u4fe1\u3002DeepSeek-V3 \u901a\u8fc7 FP8 \u4e0e\u901a\u4fe1\u4f18\u5316\u964d\u4f4e\u663e\u5b58\u548c\u7b97\u529b\u9700\u6c42\uff0c\u4ece\u800c\u907f\u514d TP \u5e26\u6765\u7684\u590d\u6742\u6027\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#52-dualpipe","title":"5.2 DualPipe\uff1a\u901a\u4fe1\u4e0e\u8ba1\u7b97\u7684\u6df1\u5ea6\u91cd\u53e0","text":"<p>\u95ee\u9898\u80cc\u666f\uff1a \u5728 MoE \u4e2d\uff0c\u6700\u8017\u65f6\u7684\u64cd\u4f5c\u4e4b\u4e00\u662f\u8de8 GPU \u7684 all-to-all \u901a\u4fe1\uff08\u628a token \u6fc0\u6d3b\u5206\u53d1\u5230\u5404\u4e13\u5bb6 GPU\uff0c\u518d\u6536\u96c6\u7ed3\u679c\uff09\u3002\u5982\u679c\u901a\u4fe1\u4e0d\u80fd\u9690\u85cf\uff0c\u4f1a\u6210\u4e3a\u74f6\u9888\u3002</p> <p>\u4f20\u7edf\u65b9\u6848\uff1a</p> <ul> <li> <p>1F1B (One-Forward-One-Backward)\uff1a\u6d41\u6c34\u7ebf\u5e76\u884c\u7684\u4e00\u79cd\u8c03\u5ea6\u65b9\u5f0f\uff0c\u524d\u540e\u5411\u4ea4\u66ff\u6267\u884c\u3002</p> </li> <li> <p>ZB1P (Zero Bubble 1F1B)\uff1a\u6539\u8fdb\u7248\uff0c\u51cf\u5c11\u6d41\u6c34\u7ebf\u7a7a\u6ce1\uff08\u7b49\u5f85\uff09\u3002</p> </li> </ul> <p>DualPipe \u7684\u521b\u65b0\uff1a</p> <ul> <li> <p>\u5c06\u4e00\u6b21\u524d\u5411\u6216\u53cd\u5411\u4f20\u64ad\u62c6\u89e3\u6210\u66f4\u5c0f\u7684\u5b50\u5757\uff1a\u6ce8\u610f\u529b \u2192 all-to-all dispatch \u2192 MLP/\u4e13\u5bb6\u8ba1\u7b97 \u2192 all-to-all combine\u3002</p> </li> <li> <p>\u4e0d\u540c token \u7684\u901a\u4fe1\u4e0e\u8ba1\u7b97\u4ea4\u9519\u6267\u884c\uff08dispatch \u7684\u540c\u65f6\u5df2\u6709 token \u5728\u4e13\u5bb6\u4e0a\u8ba1\u7b97\uff09\u3002</p> </li> <li> <p>\u524d\u5411\u4e0e\u53cd\u5411\u4f20\u64ad\u9519\u53e0\uff0c\u5f62\u6210\u201c\u53cc\u5411\u6d41\u6c34\u7ebf\u201d\u3002</p> </li> <li> <p>\u663e\u5f0f\u63a7\u5236 GPU SM\uff08Streaming Multiprocessor\uff09\u5728 \u901a\u4fe1\u6838 \u4e0e \u8ba1\u7b97\u6838 \u4e0a\u7684\u8d44\u6e90\u5206\u914d\uff0c\u51cf\u5c11\u7b49\u5f85\u3002</p> </li> </ul> <p>\u6536\u76ca\uff1a \u51e0\u4e4e\u628a\u901a\u4fe1\u65f6\u95f4\u5b8c\u5168\u63a9\u76d6\u5728\u8ba1\u7b97\u4e2d\uff0c\u4f7f\u5f97\u5927\u89c4\u6a21 MoE \u7684\u8bad\u7ec3\u6548\u7387\u63a5\u8fd1\u4e8e\u7eaf\u8ba1\u7b97\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#53-alltoall","title":"5.3 \u9ad8\u6548 all\u2011to\u2011all \u4e0e\u663e\u5b58\u4f18\u5316","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#all-to-all","title":"\u9ad8\u6548 all-to-all","text":"<ul> <li>all-to-all \u901a\u4fe1\uff1a \u6bcf\u4e2a GPU \u9700\u8981\u628a\u4e00\u90e8\u5206 token \u6fc0\u6d3b\u53d1\u7ed9\u6240\u6709\u5176\u4ed6 GPU\uff0c\u518d\u63a5\u6536\u6765\u81ea\u5b83\u4eec\u7684\u90e8\u5206\uff0c\u662f\u6700\u91cd\u7684\u901a\u4fe1\u6a21\u5f0f\u3002</li> <li> <p>DeepSeek-V3 \u4f18\u5316\uff1a</p> </li> <li> <p>\u4e24\u6bb5\u5f0f\u8def\u7531\uff1a\u5148\u8de8\u8282\u70b9\u7528 IB \u628a token \u53d1\u5230\u76ee\u6807\u8282\u70b9\u7684\u201c\u5bf9\u5e94 GPU\u201d\uff0c\u518d\u901a\u8fc7 NVLink \u5728\u8282\u70b9\u5185\u8f6c\u53d1\u5230\u771f\u6b63\u8d1f\u8d23\u8be5\u4e13\u5bb6\u7684 GPU\u3002\u8fd9\u6837\u628a\u8de8\u8282\u70b9\u548c\u8282\u70b9\u5185\u901a\u4fe1\u89e3\u8026\uff0c\u5145\u5206\u5229\u7528\u4e0d\u540c\u94fe\u8def\u5e26\u5bbd\u3002</p> </li> <li>warp specialization\uff1a\u5728 GPU \u5185\u90e8\u5206\u914d\u4e13\u95e8\u7684 warp\uff08\u7ebf\u7a0b\u675f\uff09\u8d1f\u8d23\u901a\u4fe1\uff08\u5982 IB send\u3001NVLink forward\uff09\uff0c\u53e6\u4e00\u4e9b warp \u8d1f\u8d23\u8ba1\u7b97\uff0c\u63d0\u5347\u5e76\u884c\u5ea6\u3002</li> <li>\u5b9e\u6d4b\u53ea\u9700\u7ea6 20 \u4e2a SM\uff08\u603b\u5171\u4e0a\u767e\u4e2a SM\uff09\u5373\u53ef\u201c\u8dd1\u6ee1\u201d IB+NVLink \u5e26\u5bbd\uff0c\u4fdd\u8bc1\u901a\u4fe1\u4e0d\u62d6\u7d2f\u6574\u4f53\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#_1","title":"\u663e\u5b58\u4f18\u5316","text":"<ul> <li>\u6fc0\u6d3b\u91cd\u8ba1\u7b97 (activation recomputation)\uff1a\u4e0d\u4fdd\u5b58\u90e8\u5206\u4e2d\u95f4\u6fc0\u6d3b\uff0c\u5728\u53cd\u5411\u4f20\u64ad\u65f6\u91cd\u65b0\u8ba1\u7b97\uff0c\u6362\u7b97\u529b\u8282\u7701\u663e\u5b58\u3002</li> <li>EMA \u53c2\u6570\u653e CPU\uff1a\u6307\u6570\u6ed1\u52a8\u5e73\u5747\u53c2\u6570\uff08\u7528\u4e8e\u7a33\u5b9a\u8bad\u7ec3\uff09\u5b58\u653e\u5728 CPU \u5185\u5b58\uff0c\u964d\u4f4e GPU \u663e\u5b58\u5360\u7528\u3002</li> <li>\u5171\u4eab\u5d4c\u5165/\u8f93\u51fa\u5934\uff1aMTP \u6a21\u5757\u4e0e\u4e3b\u5e72\u6a21\u578b\u5171\u4eab embedding \u4e0e\u8f93\u51fa\u5c42\uff0c\u907f\u514d\u5197\u4f59\u3002</li> <li>\u4f18\u5316\u5668\u72b6\u6001\u538b\u7f29\uff1a\u5982\u7528 BF16 \u5b58\u50a8 Adam \u7684\u4e00\u4e8c\u9636\u77e9\uff0c\u8fdb\u4e00\u6b65\u51cf\u5c11\u663e\u5b58\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#54-fp8","title":"5.4 FP8 \u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3\u7684\u5173\u952e\u7ec6\u8282","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#fp8","title":"FP8 \u683c\u5f0f","text":"<ul> <li>E4M3\uff1a1 \u4f4d\u7b26\u53f7 + 4 \u4f4d\u6307\u6570 + 3 \u4f4d\u5c3e\u6570 \u2192 \u52a8\u6001\u8303\u56f4\u8f83\u5c0f\uff0c\u4f46\u7cbe\u5ea6\u8f83\u9ad8\uff0c\u9002\u5408\u6fc0\u6d3b\u548c\u6743\u91cd\u3002</li> <li>E5M2\uff1a\u66f4\u5927\u52a8\u6001\u8303\u56f4\uff0c\u7cbe\u5ea6\u8f83\u4f4e\uff0c\u9002\u5408\u68af\u5ea6\u3002   DeepSeek-V3 \u591a\u6570\u60c5\u51b5\u4e0b\u9009\u7528 E4M3\uff08\u7cbe\u5ea6\u4f18\u5148\uff09\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#_2","title":"\u5173\u952e\u4f18\u5316","text":"<ol> <li> <p>\u7ec6\u7c92\u5ea6\u91cf\u5316</p> </li> <li> <p>\u6fc0\u6d3b\u6309 1\u00d7128 \u7684\u901a\u9053 tile \u5206\u5757\uff0c\u5404\u5757\u72ec\u7acb\u7f29\u653e\u3002</p> </li> <li>\u6743\u91cd\u6309 128\u00d7128 \u7684 block \u5206\u5757\uff0c\u5404\u5757\u72ec\u7acb\u7f29\u653e\u3002</li> <li> <p>\u597d\u5904\uff1a\u907f\u514d\u56e0\u6781\u5c11\u6570 outlier\uff08\u5f02\u5e38\u503c\uff09\u5bfc\u81f4\u5168\u5c40\u7f29\u653e\uff0c\u63d0\u5347\u6570\u503c\u7a33\u5b9a\u6027\u3002</p> </li> <li> <p>\u6df7\u5408\u7d2f\u52a0</p> </li> <li> <p>\u5728 Hopper GPU \u7684 Tensor Core \u4e0a\uff0cFP8 \u7d2f\u52a0\u53ea\u6709\u7ea6 14 \u4f4d\u6709\u6548\u4f4d\u3002</p> </li> <li> <p>DeepSeek-V3 \u7684\u505a\u6cd5\uff1a\u6bcf\u7d2f\u52a0 128 \u5143\u7d20\u5c31\u628a\u90e8\u5206\u548c \u5347\u5230 FP32\uff08CUDA Core\uff09\uff0c\u518d\u56de\u5199\uff0c\u51cf\u5c11\u7d2f\u79ef\u8bef\u5dee\u3002</p> </li> <li> <p>\u4f4e\u7cbe\u901a\u4fe1</p> </li> <li> <p>\u5728 MoE \u7684 token dispatch/combine \u9636\u6bb5\uff0c\u628a\u6fc0\u6d3b\u538b\u7f29\u4e3a FP8 \u4f20\u8f93\uff0c\u8282\u7701\u5e26\u5bbd\uff1b\u5728\u5173\u952e\u52a0\u548c\u65f6\u518d\u8f6c\u56de BF16\u3002</p> </li> </ol> <p>\u7ed3\u679c\uff1a \u6536\u655b\u66f2\u7ebf\u51e0\u4e4e\u548c BF16 \u8bad\u7ec3\u91cd\u5408\uff0c\u4f46\u663e\u5b58\u3001\u5e26\u5bbd\u5360\u7528\u663e\u8457\u4e0b\u964d\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#55-prefill-decode","title":"5.5 \u63a8\u7406\u90e8\u7f72\uff1aPrefill \u4e0e Decode","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#prefill","title":"Prefill \u9636\u6bb5\uff08\u5e76\u884c\u586b\u5145\u4e0a\u4e0b\u6587\uff09","text":"<ul> <li>\u76ee\u6807\uff1a \u9ad8\u541e\u5410 \u2192 \u8f93\u5165 prompt \u65f6\u5e76\u884c\u5316\u8d8a\u591a\u8d8a\u597d\u3002</li> <li>\u914d\u7f6e\uff1a \u6700\u5c0f\u5355\u5143 32 \u5361\uff084 \u8282\u70b9\uff09\uff1b\u6ce8\u610f\u529b\u91c7\u7528 TP4 (Tensor Parallel in 4 cards) + SP\uff08sequence parallel\uff09\uff0cMoE EP32 (Expert Parallel in 32 cards)\uff0cDP (Data Parallel)\u3002</li> <li>\u5197\u4f59\u4e13\u5bb6\uff1a\u5bf9\u8d1f\u8f7d\u6700\u91cd\u7684\u4e13\u5bb6\u590d\u5236\u526f\u672c\uff0c\u52a8\u6001\u91cd\u6392\uff0c\u907f\u514d\u4e2a\u522b\u4e13\u5bb6\u62d6\u6162\u6574\u4e2a batch\u3002</li> <li>\u53cc micro-batch\uff1a\u5728\u540c\u4e00\u5355\u5143\u91cc\u4ea4\u9519\u6267\u884c\u4e24\u4e2a batch\uff0c\u9690\u85cf\u901a\u4fe1\u5ef6\u8fdf\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#decode","title":"Decode \u9636\u6bb5\uff08\u81ea\u56de\u5f52\u9010\u6b65\u751f\u6210\uff09","text":"<ul> <li>\u76ee\u6807\uff1a \u4f4e\u5ef6\u8fdf \u2192 \u6bcf\u6b21\u53ea\u751f\u6210\u4e00\u4e2a token\uff0c\u4f46\u8981\u54cd\u5e94\u5feb\u3002</li> <li>\u914d\u7f6e\uff1a \u6700\u5c0f\u5355\u5143 320 \u5361\uff0840 \u8282\u70b9\uff09\uff1b\u6ce8\u610f\u529b TP4+SP\uff0cMoE EP320\uff0cDP80\u3002</li> <li>IBGDA (InfiniBand GPU Direct Async)\uff1a\u76f4\u63a5 GPU \u2194 GPU \u8de8\u8282\u70b9\u901a\u4fe1\uff0c\u7ed5\u8fc7 CPU\uff0c\u964d\u4f4e\u5ef6\u8fdf\u3002</li> <li>\u540c\u6837\u652f\u6301\u52a8\u6001\u5197\u4f59\u4e13\u5bb6\uff0c\u51cf\u5c11\u957f\u5c3e\u65f6\u5ef6\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeek-V3%E6%98%AF%E5%A6%82%E4%BD%95%E7%82%BC%E6%88%90%E7%9A%84/#6","title":"6. \u8d85\u53c2\u914d\u7f6e\u901f\u67e5","text":"<p>\u6a21\u578b\u4e0e\u6ce8\u610f\u529b</p> <ul> <li>\u5c42\u6570\u7ea6 61\uff0c\u9690\u85cf\u7ef4 7168\uff1b\u591a\u5934\u6570 128\uff0c\u6bcf\u5934\u7ef4 128</li> <li>MLA\uff1a\\(d_c=512\\)\uff0c\\(d_c^{q}=1536\\)\uff1b\u89e3\u8026\u4f4d\u7f6e\u5b50\u7ef4\u6bcf\u5934\u7ea6 64</li> <li>RoPE \u4f4d\u7f6e\u7f16\u7801\uff0c\u914d\u5408 YaRN \u957f\u4e0a\u4e0b\u6587\u6269\u5c55\uff084K\u219232K\u2192128K\uff09</li> </ul> <p>MoE \u4e0e\u8def\u7531</p> <ul> <li>\u6bcf\u5c42 1 \u5171\u4eab\u4e13\u5bb6 + 256 \u8def\u7531\u4e13\u5bb6\uff1bTop\u2011\\(K=8\\)</li> <li>\u8282\u70b9\u9650\u5236\u8def\u7531\uff1a\u6bcf token \u53c2\u4e0e\u8282\u70b9\u6570\u4e0d\u8d85\u8fc7 4</li> <li>\u8d1f\u8f7d\u5747\u8861\uff1aAux\u2011loss\u2011free\uff08\u4e13\u5bb6\u504f\u7f6e\uff09\uff0c\u5e8f\u5217\u7ea7\u6781\u5c0f\u6b63\u5219</li> <li>Token\u2011dropping\uff1a\u65e0</li> </ul> <p>\u6570\u636e\u4e0e\u9884\u5904\u7406</p> <ul> <li>14.8T token\uff0c\u591a\u8bed\u79cd\uff0c\u6570\u5b66\u4e0e\u4ee3\u7801\u5360\u6bd4\u63d0\u5347</li> <li>\u6587\u6863\u6253\u5305\uff0c\u4e0d\u505a\u8de8\u6837\u672c\u6ce8\u610f\u529b\u5c4f\u853d</li> <li>FIM \u91c7\u6837\u7387\u7ea6 0.1\uff1bbyte\u2011level BPE \u8bcd\u8868\u7ea6 128K</li> <li>\u590d\u5408 token \u968f\u673a\u62c6\u5206\u7f13\u89e3\u8fb9\u754c\u504f\u7f6e</li> </ul> <p>\u4f18\u5316\u4e0e\u8c03\u5ea6</p> <ul> <li>AdamW\uff0c\\(\\beta_1=0.9,\\ \\beta_2=0.95,\\ \\mathrm{wd}=0.1\\)\uff1b\u88c1\u526a\u8303\u6570 1.0</li> <li>\u5e8f\u5217\u957f 4K\uff08\u9884\u8bad\u7ec3\uff09\uff1b\u957f\u4e0a\u4e0b\u6587\u6269\u5c55\u5230 128K</li> <li>\u5b66\u4e60\u7387\uff1a2K \u6b65 warmup \u2192 \u957f\u671f\u5e38\u6570 \u2192 \u4f59\u5f26\u8870\u51cf \u2192 \u672b\u6bb5\u5c0f\u5e38\u6570\u7cbe\u4fee</li> <li>\u6279\u5927\u5c0f\uff1a3072 \u2192 15360\uff08\u9010\u6b65\u589e\u5927\u540e\u4fdd\u6301\uff09</li> <li>MTP\uff1a\\(D=1\\)\uff0c\u524d\u671f\\(\\lambda\\approx0.3\\)\uff0c\u540e\u671f\u964d\u81f3 0.1</li> </ul> <p>\u5e76\u884c\u4e0e\u57fa\u7840\u8bbe\u65bd</p> <ul> <li>2048\u00d7H800\uff1bPP\u00d7EP\u00d7DP\uff08\u4e0d\u4f7f\u7528 TP\uff09</li> <li>DualPipe \u91cd\u53e0\u901a\u4fe1\u4e0e\u8ba1\u7b97\uff1bIB+NVLink \u5206\u5c42\u8def\u7531</li> <li>FP8 \u8bad\u7ec3\uff1aE4M3\u3001tile/block \u91cf\u5316\u3001\u9636\u6bb5\u6027 FP32 \u7d2f\u52a0</li> <li>\u63a8\u7406\uff1aPrefill 32 \u5361\u5355\u5143\uff0cDecode 320 \u5361\u5355\u5143\uff1b\u5197\u4f59\u4e13\u5bb6\u7f13\u89e3\u70ed\u70b9</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/","title":"DeepSeekMath\u8bba\u6587\u7cbe\u8bfb","text":"\u6807\u7b7e\uff1a LLM\u5f3a\u5316\u5b66\u4e60DeepSeek","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#0","title":"0. \u5f15\u8a00","text":"<ul> <li>\u5b9a\u4f4d\uff1aDeepSeekMath \u662f\u5728\u4ee3\u7801\u57fa\u5ea7\u4e0a\u7ee7\u7eed\u9884\u8bad\u7ec3\u7684\u5927\u89c4\u6a21\u6570\u5b66\u6a21\u578b\uff0c\u968f\u540e\u7528\u6307\u4ee4\u5fae\u8c03\u4e0e\u8f7b\u91cf\u5f3a\u5316\u5b66\u4e60\u8fdb\u4e00\u6b65\u6253\u78e8\u3002</li> <li>\u5173\u952e\u6293\u624b\uff1a<ol> <li>\u6570\u636e\u4fa7\uff1a\u7528\u53ef\u8fed\u4ee3\u7684\u7f51\u9875\u6316\u6398\u4e0e\u6e05\u6d17\u6d41\u6c34\u7ebf\uff0c\u6784\u9020\u7ea6\u767e\u4ebf\u91cf\u7ea7\u7684\u6570\u5b66 token \u7ee7\u7eed\u9884\u8bad\u7ec3\uff1b</li> <li>\u8bad\u7ec3\u4fa7\uff1a\u5728\u4e0d\u5f15\u5165\u4ef7\u503c\u7f51\u7edc\u7684\u524d\u63d0\u4e0b\uff0c\u7528 GRPO \u8fdb\u884c\u5f3a\u5316\u5b66\u4e60\uff0c\u4f7f\u7b56\u7565\u5206\u5e03\u66f4\u7a33\u5b9a\u3002</li> </ol> </li> <li>\u7ed3\u679c\uff1a7B \u91cf\u7ea7\u6a21\u578b\u5728 GSM8K \u4e0e MATH \u7b49\u57fa\u51c6\u4e0a\u53d6\u5f97\u5f3a\u7ade\u4e89\u529b\uff0c\u5728\u4e0d\u5f00\u5916\u90e8\u5de5\u5177\u7684\u8bbe\u7f6e\u4e0b\uff0c\u62a5\u544a\u663e\u793a MATH Top-1 \u8d85\u8fc7 50%\uff0c\u81ea\u4e00\u81f4\u6027\u5c11\u6837\u672c\u91c7\u6837\u8fdb\u4e00\u6b65\u4e0a\u5347\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#1","title":"1. \u4e3a\u4ec0\u4e48\u5148\u4ece\u6570\u636e\u5de5\u7a0b\u8bf4\u8d77","text":"<p>\u591a\u6570\u201c\u6570\u5b66\u63a8\u7406\u201d\u5de5\u4f5c\u7684\u5206\u6c34\u5cad\uff0c\u4e0d\u5728\u201c\u6a21\u578b\u662f\u5426\u66f4\u6df1\u5965\u201d\uff0c\u800c\u5728\u6570\u636e\u662f\u5426\u66f4\u5bf9\u8def\u3002DeepSeekMath \u7684\u4e00\u4e2a\u76f4\u63a5\u7ecf\u9a8c\u662f\uff1a</p> <ul> <li>\u4ece\u4ee3\u7801\u6a21\u578b\u8d77\u6b65\uff08\u66f4\u5f3a\u7684\u7b26\u53f7\u4e0e\u8bed\u6cd5\u611f\u77e5\uff09\uff0c</li> <li>\u7528\u5927\u89c4\u6a21\u7f51\u9875\u6570\u5b66\u6587\u672c\u505a\u7ee7\u7eed\u9884\u8bad\u7ec3\uff08\u8fdc\u5927\u4e8e\u5e38\u89c1\u6559\u6750\u4e0e\u8bba\u6587\u4f53\u91cf\uff09\uff0c</li> <li>\u518d\u7528\u7ed3\u6784\u826f\u597d\u7684\u6307\u4ee4\u6570\u636e\u505a SFT\uff0c</li> <li>\u6700\u540e\u7528\u4e0d\u90a3\u4e48\u91cd\u7684 RL \u505a\u629b\u5149\u3002</li> </ul> <p>\u8fd9\u6761\u8def\u7ebf\u6700\u5927\u5316\u5229\u7528\u4e86\u201c\u6570\u636e\u5206\u5e03\u4e0e\u63a8\u7406\u4efb\u52a1\u7684\u4e00\u81f4\u6027\u201d\uff0c\u8bad\u7ec3\u4fa7\u907f\u514d\u4e86\u201c\u6602\u8d35\u800c\u8106\u5f31\u7684\u4ef7\u503c\u7f51\u7edc\u201d\uff0c\u8ba9\u5c0f\u6a21\u578b\u4e5f\u80fd\u663e\u51fa\u201c\u7a33\u5b9a\u548c\u590d\u73b0\u201d\u7684\u8d28\u611f\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#2-deepseekmath","title":"2. DeepSeekMath \u9879\u76ee\u8109\u7edc","text":"<ul> <li>\u57fa\u5ea7\uff1a\u4ee5\u4ee3\u7801\u6a21\u578b\u4e3a\u8d77\u70b9\u7684 7B\u3002</li> <li>\u7ee7\u7eed\u9884\u8bad\u7ec3\uff1a\u4ee5\u7f51\u9875\u6570\u5b66\u8bed\u6599\u4e3a\u4e3b\uff0c\u89c4\u6a21\u7ea6\u767e\u4ebf token \u7ea7\u3002</li> <li>SFT\uff1a\u7ea6 70 \u591a\u4e07\u6761\u4e2d\u82f1\u6570\u5b66\u6307\u4ee4\u6570\u636e\uff0c\u8986\u76d6 CoT\u3001PoT\u3001\u5de5\u5177\u589e\u5f3a\u7b49\u683c\u5f0f\u3002</li> <li>RL\uff1a\u91c7\u7528 GRPO\uff08Group Relative Policy Optimization\uff09\uff0c\u901a\u8fc7\u7ec4\u5185\u76f8\u5bf9\u5956\u52b1\u4f30\u8ba1\u4f18\u52bf\uff0c\u4e0d\u518d\u8bad\u7ec3\u4ef7\u503c\u7f51\u7edc\uff1b\u5728\u635f\u5931\u9879\u91cc\u76f4\u63a5\u52a0\u5165\u4e0e\u53c2\u8003\u7b56\u7565\u7684 KL \u6b63\u5219\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#3-pipeline","title":"3. \u6570\u636e\u5904\u7406 pipeline","text":"<p>\u4e0b\u9762\u8fd9\u6761\u6d41\u6c34\u7ebf\u4e0d\u662f\u201c\u552f\u4e00\u6b63\u786e\u201d\uff0c\u4f46\u5b83\u89e3\u91ca\u4e86 DeepSeekMath \u5728\u201c\u89c4\u6a21\u3001\u7eaf\u5ea6\u3001\u7ed3\u6784\u5316\u7a0b\u5ea6\u201d\u4e0a\u7684\u505a\u6cd5\uff0c\u4e14\u4fbf\u4e8e\u590d\u7528\u5230\u5176\u4ed6\u4e13\u4e1a\u9886\u57df\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#31","title":"3.1 \u7aef\u5230\u7aef\u89c6\u56fe","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#311","title":"3.1.1. \u5019\u9009\u53d1\u73b0","text":"<ul> <li>\u7528\u5173\u952e\u8bcd\u3001\u6b63\u5219\u4e0e\u8f7b\u91cf\u5206\u7c7b\u5668\uff08\u5982 fastText\uff09\u5728 Common Crawl \u8fd9\u7c7b\u5927\u5e93\u91cc\u505a\u521d\u7b5b\uff0c\u7ed9\u6bcf\u4e2a\u9875\u9762\u4e00\u4e2a\u201c\u6570\u5b66\u76f8\u5173\u5ea6\u201d\u6253\u5206\u3002</li> <li>\u4ee5\u201c\u6837\u672c\u9ad8\u5206\u9875\u9762\u7684\u57df\u540d\u3001\u76ee\u5f55\u6a21\u5f0f\u201d\u4e3a\u7ebf\u7d22\uff0c\u505a\u57df\u7ea7\u4e0e\u8def\u5f84\u7ea7\u6269\u5f20\uff0c\u6bd4\u5982\u6301\u7eed\u6293\u53d6 <code>math.*</code>\u3001<code>/problem/</code>\u3001<code>/solution/</code> \u4e00\u7c7b\u9ad8\u4ea7\u8def\u5f84\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#312","title":"3.1.2. \u8fed\u4ee3\u56de\u91c7","text":"<ul> <li>\u7edf\u8ba1\u6b63\u4f8b\u96c6\u4e2d\u51fa\u73b0\u9891\u7387\u9ad8\u7684\u57df\u540d\u548c URL \u6a21\u5f0f\uff0c\u5efa\u7acb\u201c\u53ef\u9760\u6e90\u6e05\u5355\u201d\u3002</li> <li>\u57fa\u4e8e\u201c\u57df\u540d\u5f97\u5206 + \u8def\u5f84\u6a21\u677f\u5f97\u5206 + \u9875\u9762\u5f97\u5206\u201d\u505a\u52a0\u6743\u56de\u91c7\uff0c\u5f62\u6210\u201c\u6570\u636e-\u6a21\u5f0f-\u56de\u91c7\u201d\u7684\u95ed\u73af\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#313","title":"3.1.3. \u5185\u5bb9\u62bd\u53d6\u4e0e\u7ed3\u6784\u5316","text":"<ul> <li>HTML \u53bb\u6a21\u677f\u3001\u53bb\u5bfc\u822a\u3001\u53bb\u5e7f\u544a\uff0c\u4fdd\u7559\u6b63\u6587\u4e0e\u4ee3\u7801\u5757\uff1b</li> <li>\u8bc6\u522b\u9898\u76ee\u3001\u6b65\u9aa4\u3001\u7ed3\u8bba\u7b49\u7ed3\u6784\u7247\u6bb5\uff0c\u5c3d\u91cf\u62bd\u53d6\u201c\u9898\u9762-\u63a8\u7406-\u7b54\u6848\u201d\u4e09\u6bb5\u5f0f\uff1b</li> <li>\u8bc6\u522b\u516c\u5f0f\u5757\u4e0e\u884c\u5185\u516c\u5f0f\uff0c\u5c06\u5176\u4e0e\u4e0a\u4e0b\u6587\u7ed1\u5b9a\uff0c\u907f\u514d\u4e22\u5931\u8bed\u4e49\u90bb\u57df\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#314","title":"3.1.4. \u6e05\u6d17\u4e0e\u53bb\u6c61","text":"<ul> <li>\u8bed\u8a00\u7b5b\u9009\uff08\u4f18\u5148\u4e2d\u82f1\uff09\uff0c\u957f\u5ea6\u4e0e\u7a20\u5bc6\u5ea6\u9608\u503c\u8fc7\u6ee4\uff1b</li> <li>URL \u5f52\u4e00\u5316\u4e0e\u53bb\u8ddf\u8e2a\u53c2\u6570\uff0c\u7cbe\u786e\u53bb\u91cd\uff08hash\uff09\u4e0e\u8fd1\u91cd\u590d\u53bb\u91cd\uff08SimHash \u6216 MinHash\uff09\uff1b</li> <li>\u5bf9\u57fa\u51c6\u96c6\u505a n-gram \u5c42\u9762\u7684\u6cc4\u6f0f\u53bb\u91cd\uff08\u5982\u4e0e GSM8K\u3001MATH \u7b49\u5f62\u6210\u9ed1\u540d\u5355 n-gram\uff09\uff0c\u9632\u6b62\u8bad\u7ec3-\u8bc4\u6d4b\u7a7f\u6a21\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#315","title":"3.1.5. \u8d28\u91cf\u8bc4\u4f30\u4e0e\u62bd\u6837","text":"<ul> <li>\u8bad\u7ec3\u8f7b\u91cf\u8d28\u91cf\u5206\u7c7b\u5668\uff0c\u7279\u5f81\u5305\u542b\uff1a\u6570\u5b66\u5bc6\u5ea6\u3001\u4ee3\u7801\u5bc6\u5ea6\u3001\u56f0\u60d1\u5ea6\u3001\u7ed3\u6784\u5b8c\u6574\u6027\u7b49\uff1b</li> <li>\u5206\u4f4d\u62bd\u6837\uff0c\u4fdd\u8bc1\u4e0d\u540c\u6765\u6e90\u3001\u4e0d\u540c\u5b50\u9886\u57df\u90fd\u80fd\u88ab\u8986\u76d6\uff1b</li> <li>\u5bf9\u566a\u58f0\u8f83\u591a\u7684\u5b50\u57df\uff08\u4f8b\u5982\u51e0\u4f55\u4e0e\u56fe\u5f62\uff09\u5355\u72ec\u52a0\u6743\u8865\u9f50\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#316","title":"3.1.6. \u6570\u636e\u6df7\u5408\u7b56\u7565","text":"<ul> <li>\u7ee7\u7eed\u9884\u8bad\u7ec3\u9636\u6bb5\u7ef4\u6301\u4e00\u4e2a\u591a\u5143\u6df7\u5408\uff1a\u6570\u5b66\u7f51\u9875\u4e3a\u4e3b\uff0c\u914d\u6bd4\u52a0\u5165\u4ee3\u7801\u3001\u5b66\u672f\u8bba\u6587\u3001\u81ea\u7136\u8bed\u8a00\u6cdb\u5316\u6587\u672c\u7b49\uff0c\u4ee5\u51cf\u7f13\u201c\u80fd\u529b\u9057\u5fd8\u201d\uff1b</li> <li>\u6307\u4ee4\u9636\u6bb5\u7edf\u4e00\u683c\u5f0f\uff08\u89c1 3.3\uff09\uff0c\u517c\u987e CoT\u3001PoT \u4e0e\u5de5\u5177\u683c\u5f0f\uff0c\u5f62\u6210\u9762\u5411\u63a8\u7406\u7684\u9ad8\u4fe1\u5ea6\u6807\u6ce8\u96c6\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#317","title":"3.1.7. \u6807\u6ce8\u4e00\u81f4\u5316\u4e0e\u5ba1\u8ba1","text":"<ul> <li>\u7edf\u4e00\u6807\u6ce8\u6a21\u677f\uff0c\u4fdd\u8bc1\u201c\u9898\u9762-\u63a8\u7406-\u7b54\u6848\u201d\u7684\u5217\u5bf9\u9f50\uff1b</li> <li>\u5bf9\u6613\u9519\u9898\u578b\u8bbe\u7acb\u5ba1\u8ba1\u6837\u672c\u6c60\uff0c\u8bad\u7ec3\u4e2d\u5468\u671f\u6027\u62bd\u68c0\uff0c\u5f62\u6210\u201c\u6570\u636e-\u8bad\u7ec3-\u8bc4\u6d4b-\u8fd4\u4fee\u201d\u7684\u95ed\u73af\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#32","title":"3.2 \u4e24\u4e2a\u5173\u952e\u5b50\u6a21\u5757","text":"<p>A. \u6570\u5b66\u6027\u5224\u522b\u5668\uff08Mathness Scorer\uff09</p> <ul> <li>\u8f93\u5165\u7279\u5f81\uff1a\u516c\u5f0f\u5bc6\u5ea6\u3001\u6570\u5b66\u672f\u8bed\u8bcd\u8868\u5339\u914d\u3001\u4ee3\u7801\u4e0e\u6570\u5b57\u5360\u6bd4\u3001\u53e5\u6cd5\u590d\u6742\u5ea6\u3001\u56f0\u60d1\u5ea6\u5206\u6bb5\u7b49\u3002</li> <li>\u76ee\u6807\uff1a\u628a\u201c\u6559\u7a0b\u7c7b\u201d\u201c\u9898\u89e3\u7c7b\u201d\u201c\u5b66\u672f\u7c7b\u201d\u201c\u8bba\u575b\u95ee\u7b54\u201d\u7b49\u9ad8\u4ef7\u503c\u9875\u9762\u6253\u5230\u9ad8\u5206\uff0c\u628a\u201c\u76ee\u5f55\u9875\u201d\u201c\u805a\u5408\u9875\u201d\u201c\u5e7f\u544a\u9875\u201d\u6253\u5230\u4f4e\u5206\u3002</li> <li>\u7528\u9014\uff1a\u6392\u5e8f\u4e0e\u9608\u503c\uff0c\u6307\u5bfc\u56de\u91c7\u4e0e\u62bd\u6837\u3002</li> </ul> <p>B. \u8fd1\u91cd\u590d\u53bb\u91cd\uff08Near-Dup\uff09</p> <ul> <li>URL \u5c42\u9762\uff1a\u5f52\u4e00\u5316\u53bb\u53c2\uff1b</li> <li>\u6587\u672c\u5c42\u9762\uff1a\u6587\u6bb5\u7ea7\u5206\u5757\uff0c\u53e5\u5b50\u7ea7\u53bb\u91cd\uff0cSimHash \u6216 MinHash \u68c0\u6d4b 80% \u4ee5\u4e0a\u76f8\u4f3c\u5ea6\u7684\u8fd1\u91cd\u590d\uff1b</li> <li>\u8bc4\u6d4b\u6cc4\u6f0f\u5b88\u95e8\uff1a\u7ef4\u6301\u4e00\u4e2a\u201c\u8bc4\u6d4b n-gram \u9ed1\u540d\u5355\u201d\uff0c\u8bad\u7ec3\u96c6\u4e2d\u82e5\u51fa\u73b0\u8fd9\u4e9b n-gram \u5e8f\u5217\uff0c\u76f4\u63a5\u5254\u9664\u6216\u66ff\u6362\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#33","title":"3.3 \u6307\u4ee4\u6570\u636e\u7684\u7edf\u4e00\u683c\u5f0f","text":"<p>\u5efa\u8bae\u5728 SFT \u9636\u6bb5\u7edf\u4e00\u5230\u5982\u4e0b\u4e09\u6bb5\u5f0f\u6a21\u677f\uff0c\u4fbf\u4e8e\u540e\u7eed RL \u4e0e\u8bc4\u6d4b\uff1a</p> <pre><code>{\n  \"question\": \"\u9898\u9762\uff08\u53ef\u542b\u5fc5\u8981\u4e0a\u4e0b\u6587\u4e0e\u7ea6\u675f\uff09\",\n  \"reasoning\": \"\u9010\u6b65\u63a8\u7406\u8fc7\u7a0b\uff08CoT \u6216 PoT\uff1a\u53ef\u5305\u542b\u8fd0\u884c\u65e5\u5fd7\u6216\u4e2d\u95f4\u53d8\u91cf\uff09\",\n  \"answer\": \"\u6700\u7ec8\u7b54\u6848\uff08\u4e25\u683c\u5bf9\u9f50\u8bc4\u6d4b\u53e3\u5f84\uff09\",\n  \"meta\": { \"lang\": \"zh|en\", \"domain\": \"algebra|geometry|number_theory|...\" }\n}\n</code></pre> <ul> <li>CoT\uff1a\u504f\u6587\u5b57\u63a8\u6f14\uff1b</li> <li>PoT\uff1a\u504f\u7a0b\u5e8f\u5316\u63a8\u5bfc\uff08\u4f8b\u5982 Python \u5c0f\u6bb5\u843d\uff09\uff0c\u6ce8\u610f\u628a\u201c\u8ba1\u7b97\u8fc7\u7a0b\u201d\u4e0e\u201c\u53e3\u5f84\u4e00\u81f4\u7684\u6700\u7ec8\u7b54\u6848\u201d\u660e\u786e\u533a\u5206\uff1b</li> <li>\u5de5\u5177\u683c\u5f0f\uff1a\u518d\u52a0\u4e00\u4e2a <code>tool_calls</code> \u5b57\u6bb5\uff0c\u8bb0\u5f55\u5141\u8bb8\u5916\u90e8\u5de5\u5177\u65f6\u7684\u8c03\u7528\u5e8f\u5217\u4e0e\u8fd4\u56de\u503c\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#4-sft","title":"4. \u8bad\u7ec3\u5de5\u827a\uff1a\u4ece\u7ee7\u7eed\u9884\u8bad\u7ec3\u5230 SFT","text":"<ul> <li>\u7ee7\u7eed\u9884\u8bad\u7ec3<ul> <li>\u6570\u636e\u4ee5\u6570\u5b66\u7f51\u9875\u4e3a\u4e3b\uff0c\u7a7f\u63d2\u4e00\u5b9a\u6bd4\u4f8b\u4ee3\u7801\u3001\u8bba\u6587\u4e0e\u901a\u7528\u6587\u672c\uff1b</li> <li>\u76ee\u6807\u662f\u628a\u201c\u6570\u5b66\u8bed\u4e49\u3001\u7b26\u53f7\u4e60\u60ef\u3001\u9898\u89e3\u6587\u4f53\u201d\u5185\u5316\u5230\u57fa\u5ea7\u91cc\uff1b</li> <li>\u8bad\u7ec3\u66f2\u7ebf\u5173\u6ce8\u56f0\u60d1\u5ea6\u3001\u5b57\u8868\u8986\u76d6\u5ea6\u3001\u516c\u5f0f\u8fd8\u539f\u7387\u3001\u7ed3\u6784\u7a33\u5b9a\u6027\u7b49\u6307\u6807\u3002</li> </ul> </li> <li>SFT<ul> <li>\u7528\u7edf\u4e00\u683c\u5f0f\u7684\u6307\u4ee4\u6570\u636e\u505a\u76d1\u7763\u5fae\u8c03\uff1b</li> <li>\u6df7\u5408 CoT \u4e0e PoT\uff0cPoT \u5173\u6ce8\u201c\u7a33\u6001\u53ef\u6267\u884c\u63a8\u5bfc\u201d\uff0cCoT \u5173\u6ce8\u201c\u53ef\u8bfb\u4e0e\u53ef\u5ba1\u8ba1\u7684\u903b\u8f91\u94fe\u201d\uff1b</li> <li>\u5bf9\u9f50\u8bc4\u6d4b\u53e3\u5f84\uff1a\u4fdd\u8bc1 <code>answer</code> \u5b57\u6bb5\u4e0e\u57fa\u51c6\u8bc4\u6d4b\u7684\u5224\u5206\u89c4\u5219\u5b8c\u5168\u4e00\u81f4\uff08\u5927\u5c0f\u5199\u3001\u7a7a\u683c\u3001\u5355\u4f4d\u3001\u5206\u6570\u4e0e\u5c0f\u6570\u7b49\uff09\u3002</li> </ul> </li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#5-grpo","title":"5. GRPO\uff1a\u8f7b\u91cf\u4f46\u6709\u6548\u7684\u5f3a\u5316\u5b66\u4e60","text":"<p>\u52a8\u673a\uff1aPPO \u867d\u7136\u5e38\u7528\uff0c\u4f46\u4ef7\u503c\u7f51\u7edc\u65e2\u5403\u663e\u5b58\u53c8\u5bb9\u6613\u4e0d\u7a33\uff0c\u5c24\u5176\u5728\u201c\u5956\u52b1\u53ea\u5728\u7ed3\u5c3e\u7ed9\u5206\u201d\u7684\u6570\u5b66\u4efb\u52a1\u4e0a\uff0ctoken \u7ea7\u4ef7\u503c\u5b66\u4e60\u5f88\u96be\u3002 GRPO \u7684\u53d6\u820d\uff1a</p> <ul> <li>\u4e0d\u8bad\u7ec3\u4ef7\u503c\u7f51\u7edc\uff0c\u76f4\u63a5\u5728\u540c\u9898\u591a\u89e3\u7684\u7ec4\u5185\u505a\u76f8\u5bf9\u6bd4\u8f83\uff0c\u4ee5\u7ec4\u5185\u5747\u503c\u4f5c\u4e3a\u57fa\u7ebf\uff0c\u6784\u9020\u4f18\u52bf\uff1b</li> <li>KL \u6b63\u5219\u76f4\u63a5\u653e\u5230\u635f\u5931\u9879\u91cc\uff0c\u7ea6\u675f\u65b0\u65e7\u7b56\u7565\u7684\u504f\u79fb\u5e45\u5ea6\uff1b</li> <li>\u4ecd\u4fdd\u6301 PPO \u7684\u88c1\u526a\u7ed3\u6784\uff0c\u8ba9\u66f4\u65b0\u4e0d\u8fc7\u731b\u3002</li> </ul> <p>\u4e00\u6b65\u5230\u4f4d\u7684\u8bad\u7ec3\u6846\uff1a</p> <ol> <li>\u65e7\u7b56\u7565\u5bf9\u540c\u4e00\u9898\u76ee\u91c7\u6837 G \u6761\u5019\u9009\uff1b</li> <li>\u7528\u81ea\u52a8\u5224\u5206\u3001\u683c\u5f0f\u6821\u9a8c\u6216\u5f31\u6807\u7b7e\u5bf9\u5019\u9009\u7ed9\u5206\uff1b</li> <li>\u8ba1\u7b97\u7ec4\u5185\u76f8\u5bf9\u5956\u52b1\uff0c\u5f97\u5230\u6bcf\u4e2a token \u7684\u4f18\u52bf\u4f30\u8ba1\uff1b</li> <li>\u65b0\u7b56\u7565\u505a\u88c1\u526a\u540e\u7684\u7b56\u7565\u68af\u5ea6\u66f4\u65b0\uff0c\u540c\u65f6\u52a0\u4e0a\u5bf9\u53c2\u8003\u7b56\u7565\u7684 KL \u6b63\u5219\uff1b</li> <li>\u76d1\u63a7\u4e24\u4e2a\u6307\u6807\uff1a<ul> <li>Pass@K\uff08\u81f3\u5c11\u4e00\u6761\u6b63\u786e\uff09</li> <li>Maj@K\uff08\u591a\u6570\u8868\u51b3\u6b63\u786e\uff09 \u7ecf\u9a8c\u8bc1\uff0cRL \u66f4\u660e\u663e\u6539\u5584 Maj@K\uff0c\u8bf4\u660e\u201c\u6b63\u786e\u89e3\u201d\u4ece\u5c0f\u6982\u7387\u5c3e\u90e8\u88ab\u632a\u5230\u4e86\u4e3b\u6a21\u6001\u3002</li> </ul> </li> </ol> <p>\u8d85\u53c2\u63d0\u793a\uff1a</p> <ul> <li>\u7ec4\u5927\u5c0f G \u5efa\u8bae\u4e2d\u7b49\uff08\u4f8b\u5982 4 \u5230 8\uff09\uff0c\u8fc7\u5c0f\u65b9\u5dee\u5927\uff0c\u8fc7\u5927\u4f1a\u62d6\u6162\uff1b</li> <li>KL \u7cfb\u6570\u4ece\u5c0f\u5230\u4e2d\uff0c\u914d\u5408\u6e29\u5ea6\u4e0e\u957f\u5ea6\u60e9\u7f5a\u8c03\u4f18\uff1b</li> <li>\u5bf9\u201c\u6709\u660e\u786e\u7b54\u6848\u201d\u7684\u9898\u76ee\u66f4\u7a33\uff0c\u5bf9\u201c\u5f00\u653e\u5f0f\u201d\u6216\u201c\u51e0\u4f55\u7ed8\u56fe\u201d\u7c7b\u8981\u5c0f\u5fc3\u566a\u58f0\u5956\u52b1\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#6","title":"6. \u5b9e\u9a8c\u7ed3\u679c","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#61","title":"6.1 \u6570\u636e\u6d41\u6c34\u7ebf\u5e26\u6765\u4e86\u4ec0\u4e48","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#611-deepseekmath-corpus-vs-13bfew-shot-cot","title":"6.1.1 \u8bed\u6599\u5bf9\u6bd4\uff1aDeepSeekMath Corpus vs \u5176\u4ed6\u6570\u5b66\u8bed\u6599\uff081.3B\u6a21\u578b\uff0cfew-shot CoT\uff09","text":"\u8bed\u6599 \u89c4\u6a21 GSM8K MATH MMLU STEM CMATH \u65e0\u6570\u5b66\u8bad\u7ec3 N A 2.9 3.0 19.5 12.3 MathPile 8.9B 2.7 3.3 15.7 1.2 Proof-Pile-2 51.9B 14.3 11.2 29.2 19.9 DeepSeekMath Corpus 120.2B 23.8 13.6 33.1 41.5 <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4ec5\u9760\u66f4\u597d\u7684\u7f51\u9875\u6570\u5b66\u8bed\u6599\uff0c1.3B\u6a21\u578b\u5728GSM8K\u548cCMATH\u4e0a\u5927\u5e45\u9886\u5148\u540c\u7c7b\u8bed\u6599\uff0c\u540c\u65f6\u5728MATH\u4e0eMMLU STEM\u4e0a\u4e5f\u66f4\u7a33\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0c\u5b66\u4e60\u66f2\u7ebf\u968ftoken\u6301\u7eed\u4e0a\u5347\uff0c\u672a\u8fc7\u65e9\u201c\u5e73\u53f0\u5316\u201d\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#612","title":"6.1.2 \u6293\u53d6\u4e0e\u53bb\u6c61\u7684\u5173\u952e\u52a8\u4f5c","text":"<ul> <li>fastText\u53ec\u56de\u9ad8\u5206\u9875\u9762\uff0c\u6309\u57df\u4e0e\u8def\u5f84\u6a21\u5f0f\u8fed\u4ee3\u56de\u91c7\uff0c\u56db\u8f6e\u540e\u5f97\u5230\u7ea635.5M\u9875\u9762\u3001120B token\uff1b\u5bf9\u8bc4\u6d4b\u96c6\u505an-gram\u53bb\u6c61\u67d3\u3002</li> <li>\u76f4\u63a5\u7ed3\u8bba\uff1a\u7f51\u9875\u6316\u6398\u662f\u6570\u5b66\u6587\u672c\u7684\u201c\u5bcc\u77ff\u201d\uff0c\u89c4\u6a21\u4e0e\u8d28\u91cf\u4e0a\u5747\u4f18\u4e8e\u5c0f\u4f53\u91cf\u7684\u7eaf\u5b66\u672f\u8bed\u6599\uff1b\u540e\u6587\u4e5f\u5c06\u770b\u5230\uff0c\u5355\u7528arXiv\u5e76\u4e0d\u7406\u60f3\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#62","title":"6.2 \u7ee7\u7eed\u9884\u8bad\u7ec3\uff1a\u4ee3\u7801\u57fa\u5ea7 + \u6df7\u5408\u914d\u6bd4\u7684\u6536\u76ca","text":"<p>7B Base\u4e0e\u540c\u7c7b\u57fa\u5ea7\u5bf9\u6bd4\uff08few-shot CoT\uff0c\u4e0d\u5f00\u5de5\u5177\uff09</p> \u6a21\u578b \u5c3a\u5bf8 GSM8K MATH SAT MMLU STEM CMATH Mistral 7B 40.3 14.3 71.9 51.1 44.9 Llemma 34B 54.0 25.3 71.9 52.9 56.1 Minerva 540B 58.8 33.6 63.9 DeepSeekMath-Base 7B 64.2 36.2 84.4 56.5 71.7 <p>\u540c\u4e3a\u5f00\u6e90\u57fa\u5ea7\uff0cDeepSeekMath-Base 7B\u5728\u6240\u6709\u57fa\u51c6\u4e0a\u90fd\u5904\u4e8e\u7b2c\u4e00\u68af\u961f\uff0c\u5c24\u5176MATH 36.2%\u663e\u8457\u8d85\u8fc7\u540c\u5c3a\u5bf8\u4e0e\u66f4\u5927\u5c3a\u5bf8\u7684\u5f00\u6e90\u57fa\u5ea7\uff0c\u63a5\u8fd1Minerva\u5927\u6a21\u578b\u6bb5\u4f4d\u3002\u5176\u6570\u636e\u914d\u6bd4\u91cc\u4ecd\u4fdd\u755920%\u4ee3\u7801\u4e0e10%\u901a\u7528\u6587\u672c\uff0c\u6709\u52a9\u4e8e\u7a33\u4f4f\u901a\u7528\u80fd\u529b\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#63-","title":"6.3 \u6307\u4ee4\u5fae\u8c03\uff1a\u628a\u201c\u9898\u9762-\u63a8\u7406-\u7b54\u6848\u201d\u7edf\u4e00\u8d77\u6765","text":"<ul> <li>\u7ea6776K\u6761\u4e2d\u82f1\u6570\u5b66\u6307\u4ee4\uff0c\u8986\u76d6CoT\u3001PoT\u4e0e\u5de5\u5177\u96c6\u6210\u683c\u5f0f\u3002\u4ee5\u8be5\u6570\u636e\u5728Base\u4e0a\u505aSFT\uff0c\u5f97\u5230\u7684Instruct 7B\u5728\u4e0d\u5f00\u5de5\u5177\u65f6\uff1aGSM8K 82.9%\uff0cMATH 46.8%\uff1b\u5141\u8bb8\u5de5\u5177\u65f6\uff0cMATH+Python 57.4%\u3002</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#64-grpo","title":"6.4 GRPO\u5f3a\u5316\u5b66\u4e60\uff1a\u5c0f\u6539\u9020\uff0c\u5b9e\u6253\u5b9e\u7684\u589e\u76ca","text":"<p>\u4eceInstruct\u5230RL\u7684\u589e\u91cf</p> \u6a21\u578b GSM8K MATH MGSM-zh CMATH DeepSeekMath-Instruct 7B 82.9 46.8 73.2 84.6 DeepSeekMath-RL 7B 88.2 51.7 79.6 88.8 <p>\u5141\u8bb8\u5de5\u5177\u65f6\uff1aGSM8K+Python\u4ece83.7%\u523086.7%\uff0cMATH+Python\u4ece57.4%\u523058.8%\uff0c\u4e2d\u6587\u4e24\u9879\u4e5f\u540c\u6b65\u62ac\u5347\u3002</p> <p>RL\u524d\u540e\u5bf9\u6bd4\u663e\u793a\uff0cMaj@K\u663e\u8457\u63d0\u5347\uff0c\u800cPass@K\u8fd1\u4f3c\u6301\u5e73\u3002\u8fd9\u8bf4\u660eRL\u8ba9\u6b63\u786e\u89e3\u4ece\u201c\u5c3e\u90e8\u5c0f\u6982\u7387\u201d\u8fc1\u79fb\u5230\u201c\u4e3b\u6a21\u6001\u201d\uff0c\u51cf\u5c11\u91c7\u6837\u6570\u4e5f\u80fd\u7a33\u5b9a\u62ff\u5230\u5bf9\u3002\u5bf9\u5de5\u7a0b\u843d\u5730\uff0c\u8fd9\u7b49\u4ef7\u4e8e\u66f4\u7701\u91c7\u6837\u3001\u66f4\u597d\u590d\u73b0\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#65","title":"6.5 \u4ee3\u7801\u8bad\u7ec3\u4e3a\u4ec0\u4e48\u8981\u4fdd\u7559\uff1a\u7a0b\u5e8f\u8f85\u52a9\u63a8\u7406\u548c\u901a\u7528\u80fd\u529b\u90fd\u53d7\u76ca","text":"","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#651-13b","title":"6.5.1 \u4e24\u9636\u6bb5\u4e0e\u4e00\u9636\u6bb5\u7684\u5b9e\u6d4b\uff081.3B\uff09","text":"<p>\u5148\u505a\u4ee3\u7801\u518d\u505a\u6570\u5b66\uff0cPoT\u7c7b\u4efb\u52a1\u7684\u80fd\u529b\u66f4\u5f3a\uff0c\u4e14\u4e8c\u9636\u6bb5\u540e\u7684\u6574\u4f53\u8868\u73b0\u66f4\u597d\u3002\u4ee3\u7801\u6570\u636e\u6df7\u5408\u8bad\u7ec3\uff0c\u5bf9\u4e8e\u5de5\u5177\u4f7f\u7528\u6548\u679c\u66f4\u4f73\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#652-13b","title":"6.5.2 \u4ee3\u7801\u4e0e\u6570\u5b66\u6df7\u5408\u7684\u4e00\u9636\u6bb5\u8bad\u7ec3\u8fd8\u80fd\u5b88\u4f4f\u7f16\u7a0b\u80fd\u529b\uff081.3B\uff09","text":"<p>\u6df7\u5408\u4e00\u9636\u6bb5\u4e0d\u4f46\u4fdd\u6301\u4e86\u63a8\u7406\u4e0e\u901a\u7528\u80fd\u529b\uff0c\u8fd8\u663e\u8457\u63d0\u9ad8HumanEval\u548cMBPP\uff0c\u7f13\u89e3\u4e8c\u9636\u6bb5\u540e\u7684\u201c\u707e\u96be\u6027\u9057\u5fd8\u201d\u3002\u5bf9\u5b9e\u52a1\u6765\u8bf4\uff0c\u8fd9\u6837\u7684\u914d\u6bd4\u80fd\u8ba9\u7cfb\u7edf\u5728\u6570\u5b66\u4e0e\u4ee3\u7801\u53cc\u8f68\u4efb\u52a1\u4e0a\u66f4\u7a33\u3002</p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#66-arxiv","title":"6.6 \u5173\u4e8earXiv\uff1a\u5728\u672c\u9879\u8bbe\u7f6e\u4e0b\u6536\u76ca\u4e0d\u660e\u663e","text":"<ul> <li>\u57281.3B\u4e0e7B\u4e0a\u505a\u8fc7\u591a\u7ec4\u5bf9\u6bd4\uff0c\u4ec5\u7528arXiv\u7cfb\u8bed\u6599\u8fdb\u884c\u6570\u5b66\u8bad\u7ec3\uff0c\u5bf9GSM8K\u3001MATH\u3001MMLU STEM\u4e43\u81f3miniF2F\u5e76\u65e0\u6536\u76ca\uff0c\u751a\u81f3\u4f1a\u9000\u5316\u3002\u4e0b\u8868\u8282\u9009\u4e24\u7ec4\u7ed3\u679c\uff1a<ul> <li>7B\u57fa\u5ea7\u6570\u5b66\u8bad\u7ec3\u4e8eMathPile\u6216ArXiv-RedPajama\u540e\uff0cGSM8K\u548cMATH\u5747\u4f4e\u4e8e\u65e0\u6570\u5b66\u8bad\u7ec3\u7684\u540c\u5c3a\u5bf8\u57fa\u5ea7\u67d0\u4e9b\u9879\uff1b</li> <li>miniF2F\u4e0a\uff0carXiv\u8bad\u7ec3\u540e\u7684valid\u4e0etest\u4e5f\u663e\u8457\u4f4e\u4e8e\u65e0\u6570\u5b66\u8bad\u7ec3\u3002</li> </ul> </li> </ul> <p>\u6ce8\uff1a\u4f5c\u8005\u4e5f\u5f3a\u8c03\u8fd9\u4e00\u7ed3\u8bba\u6709\u8303\u56f4\u6761\u4ef6\uff0c\u672a\u6765\u8fd8\u9700\u5728\u66f4\u5927\u6a21\u578b\u6216\u66f4\u7ec6\u5206\u4efb\u52a1\u4e0a\u518d\u6b21\u9a8c\u8bc1\u3002 </p>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#67","title":"6.7 \u6a21\u5757\u4f5c\u7528\u4e0e\u6570\u636e\u652f\u6491\u5c0f\u7ed3","text":"<ul> <li>\u7f51\u9875\u6570\u5b66\u8bed\u6599\uff1a\u628a1.3B\u4eceGSM8K 14.3%\u5de6\u53f3\u63d0\u5347\u523023.8%\uff0cCMATH\u4ece19.9%\u523041.5%\uff0c\u5e76\u5ef6\u7f13\u201c\u5e73\u53f0\u671f\u201d\u3002\u8fd9\u8bc1\u660e\u8fed\u4ee3\u6293\u53d6\u4e0e\u53bb\u6c61\u786e\u5b9e\u5728\u8d28\u91cf\u4e0e\u89c4\u6a21\u4e0a\u66f4\u4f18\u3002</li> <li>\u4ee3\u7801\u521d\u59cb\u5316\u4e0e\u4fdd\u7559\uff1a7B Base\u5728MATH 36.2%\u4e14MMLU STEM 56.5%\uff0c\u8bf4\u660e\u4ee3\u7801\u5206\u5e03\u5bf9\u6570\u5b66\u4e0e\u901a\u7528\u63a8\u7406\u90fd\u6709\u6b63\u5411\u4f5c\u7528\uff1b\u57281.3B\u4e0a\uff0c\u4ee3\u7801\u2192\u6570\u5b66\u7684\u4e24\u9636\u6bb5\u548c\u4ee3\u7801+\u6570\u5b66\u6df7\u5408\u5747\u80fd\u63d0\u5347PoT\u4e0e\u7f16\u7a0b\u7c7b\u57fa\u51c6\u3002</li> <li>SFT\u7edf\u4e00\u683c\u5f0f\uff1aInstruct 7B\u4e0d\u5f00\u5de5\u5177\u5df2\u5230MATH 46.8%\uff0c\u4e3aRL\u63d0\u4f9b\u4e86\u7a33\u5b9a\u8d77\u70b9\u3002</li> <li>GRPO\u5f3a\u5316\u5b66\u4e60\uff1a\u5728\u4e0d\u5f15\u5165\u4ef7\u503c\u7f51\u7edc\u7684\u524d\u63d0\u4e0b\uff0c\u628aMATH\u518d\u62ac5\u4e2a\u70b9\u523051.7%\uff0c\u4e14GSM8K\u523088.2%\uff1b\u6838\u5fc3\u6536\u76ca\u662f\u8ba9\u201c\u6b63\u786e\u89e3\u201d\u66f4\u96c6\u4e2d\uff0cMaj@K\u663e\u8457\u4e0a\u5347\u3002</li> <li>\u5254\u9664\u6f5c\u5728\u65e0\u6548\u6570\u636e\u6e90\uff1a\u5728\u672c\u8bbe\u7f6e\u4e0b\uff0c\u5355\u7528arXiv\u96be\u4ee5\u63d0\u5347\u6570\u5b66\u63a8\u7406\uff0c\u8d44\u6e90\u66f4\u5e94\u503e\u659c\u5230\u7f51\u9875\u6316\u6398\u4e0e\u9ad8\u8d28\u7ed3\u6784\u5316\u9898\u89e3\u3002</li> </ul> <p>\u5b9e\u65bd\u5efa\u8bae</p> <ol> <li>\u5148\u628a\u6570\u5b66\u7f51\u9875\u201c\u6316\u5e72\u51c0\u201d\uff1a\u505a\u4e00\u4e2a\u9886\u57df\u5224\u522b\u5668\u5148\u8dd1\u901a\u95ed\u73af\uff1b\u4ece\u57df\u540d\u548c\u8def\u5f84\u6a21\u677f\u6269\u5f20\uff1b\u4e25\u683cn-gram\u53bb\u6c61\u67d3\u3002</li> <li>\u4fdd\u7559\u4ee3\u7801\u4e0e\u901a\u7528\u6587\u672c\u7684\u5360\u6bd4\uff1a\u7ee7\u7eed\u9884\u8bad\u7ec3\u9636\u6bb5\u7ef4\u6301\u6df7\u5408\uff0c\u907f\u514d\u6570\u5b66\u5f3a\u5316\u540e\u901a\u7528\u4e0e\u7f16\u7a0b\u80fd\u529b\u584c\u9677\u3002</li> <li>SFT\u7edf\u4e00\u6a21\u677f\uff0c\u53e3\u5f84\u4e00\u81f4\uff1a\u9898\u9762-\u63a8\u7406-\u7b54\u6848\u7684\u4e09\u6bb5\u5f0f\u6709\u5229\u4e8e\u540e\u7eedRL\u4e0e\u8bc4\u6d4b\u3002</li> <li>RL\u4f18\u5148\u7528GRPO\uff1a\u7ec4\u5927\u5c0f4\u52308\uff0c\u6e29\u548cKL\uff0c\u5148\u770bMaj@K\u66f2\u7ebf\u662f\u5426\u4e0a\u626c\uff1b\u5fc5\u8981\u65f6\u505a\u4e24\u8f6e\u8fed\u4ee3RL\u3002</li> </ol>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/DeepSeekMath%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/#7","title":"7. \u603b\u7ed3\u4e0e\u601d\u8003","text":"<p>DeepSeekMath \u662f\u4e00\u5957\u5b8c\u6574\u7684\u201c\u5de5\u5b66\u65b9\u6cd5\u8bba\u201d\uff1a</p> <ul> <li>\u7528\u8fed\u4ee3\u5f0f\u6570\u636e\u6316\u6398\u628a\u201c\u6570\u5b66\u6587\u672c\u7684\u771f\u5b9e\u5206\u5e03\u201d\u642c\u8fdb\u6a21\u578b\uff1b<ul> <li>\u5148\u505a\u4e00\u4e2a\u201c\u9886\u57df\u76f8\u5173\u5ea6\u201d\u5224\u522b\u5668\uff0c\u5c3d\u5feb\u8ba9\u6293\u53d6\u95ed\u73af\u8dd1\u8d77\u6765\uff1b</li> <li>\u6781\u5ea6\u91cd\u89c6\u53bb\u91cd\u4e0e\u6cc4\u6f0f\u5b88\u95e8\uff0c\u4f18\u5148\u6784\u5efa\u8bc4\u6d4b n-gram \u9ed1\u540d\u5355\uff1b</li> <li>\u5bf9\u8584\u5f31\u5b50\u57df\uff08\u5982\u51e0\u4f55\uff09\u5355\u72ec\u8865\u9f50\u6765\u6e90\u548c\u6807\u6ce8\uff1b</li> <li>\u6df7\u5408\u4fdd\u7559\u4e00\u90e8\u5206\u4ee3\u7801\u548c\u901a\u7528\u6587\u672c\uff0c\u9632\u6b62\u80fd\u529b\u584c\u9677\u3002</li> </ul> </li> <li>\u7528\u7edf\u4e00\u7684\u6307\u4ee4\u683c\u5f0f\u63d0\u5347\u53ef\u8bad\u7ec3\u6027\u4e0e\u53ef\u8bc4\u6d4b\u6027\uff1b<ul> <li>\u7ee7\u7eed\u9884\u8bad\u7ec3\u9636\u6bb5\u5173\u6ce8\u201c\u7ed3\u6784\u7a33\u5b9a\u6027\u201d\u4e0e\u201c\u516c\u5f0f\u8fd8\u539f\u201d\uff0c\u591a\u505a\u7070\u5ea6\u8bc4\u4f30\uff1b</li> <li>SFT \u7edf\u4e00\u6a21\u677f\uff0c\u4e25\u683c\u5bf9\u9f50\u8bc4\u6d4b\u53e3\u5f84\uff1b</li> </ul> </li> <li>\u7528\u8f7b\u91cf RL \u505a\u6700\u540e\u7684\u5206\u5e03\u4fee\u6b63\uff0c\u8ba9\u6b63\u786e\u89e3\u66f4\u201c\u53ef\u590d\u73b0\u201d\u3002<ul> <li>RL \u8d77\u6b65\u7528 GRPO\uff0cG \u53d6 4 \u5230 8\uff0cKL \u4ece\u5c0f\u5230\u4e2d\u9012\u589e\uff0c\u91cd\u70b9\u76ef Maj@K \u4e0e\u89e3\u7684\u591a\u6837\u6027\u3002</li> </ul> </li> <li>\u9664\u4e86\u6807\u51c6\u5206\u6570\uff0c\u52a1\u5fc5\u770b\u4e24\u4ef6\u4e8b\uff1a<ul> <li>\u6b63\u786e\u89e3\u662f\u5426\u96c6\u4e2d\u5728\u5c11\u91cf\u6a21\u5f0f\uff08\u591a\u6837\u6027\u4e0b\u964d\u7684\u98ce\u9669\uff09\uff1b</li> <li>\u9519\u8bef\u662f\u5426\u96c6\u4e2d\u5728\u67d0\u4e9b\u5b50\u57df\uff08\u9762\u5411\u6570\u636e\u56de\u8865\u4e0e\u8bad\u7ec3\u518d\u5e73\u8861\uff09\u3002</li> </ul> </li> </ul> <p>\u8fd9\u56db\u4e2a\u6293\u624b\u5728\u5176\u4ed6\u9886\u57df\u4f9d\u7136\u6210\u7acb\uff1a\u5148\u628a\u6570\u636e\u5206\u5e03\u627e\u5bf9\uff0c\u518d\u628a\u8bad\u7ec3\u5de5\u827a\u8d70\u987a\uff0c\u7136\u540e\u7528\u5c0f\u800c\u7a33\u7684 RL \u4f18\u5316\uff0c\u6700\u540e\u8bc4\u4ef7\u56de\u6eaf\u3002</p> <p>\u53c2\u8003</p> <ul> <li>DeepSeekMath: Pushing the Limits of Mathematical Reasoning in Open Language Models, arXiv:2402.03300</li> </ul>","tags":["LLM","\u5f3a\u5316\u5b66\u4e60","DeepSeek"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/","title":"GRPO\u539f\u7406\u53ca\u76f8\u5173\u5bf9\u6bd4","text":"\u6807\u7b7e\uff1a \u5f3a\u5316\u5b66\u4e60LLM","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#1","title":"1. \u80cc\u666f\u4e0e\u52a8\u673a","text":"<p>\u5728\u5927\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u7684\u540e\u8bad\u7ec3\u9636\u6bb5\uff0c\u5e38\u7528\u65b9\u6cd5\u662f RLHF (Reinforcement Learning with Human Feedback)\u3002\u5176\u4e2d PPO (Proximal Policy Optimization) \u88ab\u5e7f\u6cdb\u4f7f\u7528\uff08\u5982 InstructGPT\u3001ChatGPT\uff09\u3002 \u7136\u800c\uff0cPPO \u5b58\u5728\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <ul> <li>\u8bad\u7ec3\u4e0d\u7a33\u5b9a\uff1a\u5956\u52b1\u6a21\u578b\u566a\u58f0\u8f83\u5927\uff0c\u5bb9\u6613\u5bfc\u81f4 collapse \u6216\u5956\u52b1 hacking\u3002</li> <li>\u6837\u672c\u6548\u7387\u4f4e\uff1aLLM \u6bcf\u6b21\u91c7\u6837\u6210\u672c\u9ad8\uff0c\u800c PPO \u5728\u6536\u96c6 trajectories \u65f6\u5229\u7528\u4e0d\u8db3\u3002</li> <li>\u5bf9\u6bd4\u6027\u5f31\uff1a\u5956\u52b1\u6a21\u578b\u63d0\u4f9b\u7684\u4fe1\u53f7\u5e38\u5e38\u7edd\u5bf9\u5316\uff0c\u65e0\u6cd5\u523b\u753b\u76f8\u5bf9\u504f\u597d\u3002</li> </ul> <p>\u4e3a\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0c\u63d0\u51fa\u4e86 GRPO (Group Relative Policy Optimization)\u3002 \u5b83\u7684\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u5229\u7528\u76f8\u5bf9\u6bd4\u8f83\uff08preference\uff09\u800c\u975e\u7edd\u5bf9\u5956\u52b1\u503c\uff0c\u6784\u9020\u7ec4\u5185\u5f52\u4e00\u5316\u7684\u4f18\u52bf\u51fd\u6570\uff0c\u63d0\u5347\u8bad\u7ec3\u7a33\u5b9a\u6027\u548c\u6837\u672c\u6548\u7387\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#2","title":"2. \u6280\u672f\u539f\u7406\u4e0e\u6570\u7406\u8868\u8fbe","text":"","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#21","title":"2.1 \u7b97\u6cd5\u601d\u60f3","text":"<ul> <li>\u5c06\u5019\u9009\u751f\u6210\u7ed3\u679c\u6309\u7ec4\uff08group\uff09\u8fdb\u884c\u6bd4\u8f83\u3002</li> <li>\u901a\u8fc7\u7ec4\u5185\u6392\u5e8f\u6216\u76f8\u5bf9\u5956\u52b1\u5dee\u5f02\u6765\u6784\u9020 \u4f18\u52bf\u51fd\u6570 A\u3002</li> <li>\u7b56\u7565\u66f4\u65b0\u65f6\u4e0d\u4f9d\u8d56\u5355\u4e00\u5956\u52b1\u6a21\u578b\u8f93\u51fa\uff0c\u800c\u662f\u4f9d\u8d56 \u76f8\u5bf9\u504f\u597d\u5206\u5e03\u3002</li> </ul>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#22","title":"2.2 \u6570\u5b66\u5b9a\u4e49","text":"<p>\u8bbe\u7b56\u7565 \\(\\pi_\\theta(y|x)\\) \u751f\u6210\u6587\u672c \\(y\\)\uff0c\u8f93\u5165\u4e3a \\(x\\)\u3002 \u5956\u52b1\u6a21\u578b\u7ed9\u51fa\u5f97\u5206 \\(r(y|x)\\)\u3002</p> <p>\u5728 GRPO \u4e2d\uff0c\u5bf9\u4e8e\u540c\u4e00\u63d0\u793a \\(x\\)\uff0c\u751f\u6210\u4e00\u7ec4\u5019\u9009 \\({y_1, y_2, \\dots, y_K}\\)\uff0c\u5f62\u6210 group \\(G\\)\u3002 \u5b9a\u4e49\u5f52\u4e00\u5316\u76f8\u5bf9\u4f18\u52bf\uff1a</p> \\[ A(y_i) = \\frac{r(y_i) - \\mu_G}{\\sigma_G + \\epsilon} \\] <p>\u5176\u4e2d \\(\\mu_G, \\sigma_G\\) \u5206\u522b\u662f\u7ec4\u5185\u5747\u503c\u548c\u6807\u51c6\u5dee\u3002</p> <p>\u7b56\u7565\u4f18\u5316\u76ee\u6807\u4e3a\uff1a</p> \\[ L^{GRPO}(\\theta) = \\mathbb{E}_{x,G}\\left[ \\sum_{y_i \\in G} \\min \\left(  \\rho_\\theta(y_i) A(y_i), \\; \\text{clip}(\\rho_\\theta(y_i), 1-\\epsilon, 1+\\epsilon) A(y_i) \\right) \\right] \\] <p>\u5176\u4e2d</p> <ul> <li>\\(\\rho_\\theta(y_i) = \\frac{\\pi_\\theta(y_i|x)}{\\pi_{\\theta_{\\text{old}}}(y_i|x)}\\) \u662f\u91cd\u8981\u6027\u91c7\u6837\u6bd4\u3002</li> <li>\u7c7b\u4f3c PPO\uff0c\u5f15\u5165 clip \u9632\u6b62\u66f4\u65b0\u8fc7\u5927\u3002</li> <li>\u4e0e PPO \u4e0d\u540c\u7684\u662f\uff0c\u4f18\u52bf\u51fd\u6570\u6765\u6e90\u4e8e \u7ec4\u5185\u76f8\u5bf9\u5956\u52b1\u3002</li> </ul>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#23","title":"2.3 \u76f4\u89c2\u7406\u89e3","text":"<ul> <li>PPO\uff1a\u4f9d\u8d56\u5355\u4e2a\u6837\u672c\u7684\u7edd\u5bf9\u5956\u52b1\uff0c\u566a\u58f0\u5927\u3002</li> <li>GRPO\uff1a\u4f9d\u8d56\u4e00\u7ec4\u6837\u672c\u7684\u76f8\u5bf9\u5956\u52b1\uff0c\u51cf\u5c11\u4e86\u5956\u52b1\u6a21\u578b\u8bef\u5dee\u5f71\u54cd\u3002</li> </ul>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#3-ppo-trpo","title":"3. \u4e0e PPO / TRPO \u7684\u5bf9\u6bd4","text":"\u7279\u6027 TRPO PPO GRPO \u7b56\u7565\u7ea6\u675f KL\u7ea6\u675f\uff0c\u4fdd\u8bc1\u5355\u6b65\u6536\u655b\u6027 Clipping \u8fd1\u4f3c\u7ea6\u675f Clipping + Group \u76f8\u5bf9\u5956\u52b1 \u5956\u52b1\u4fe1\u53f7 \u7edd\u5bf9\u5956\u52b1 \u7edd\u5bf9\u5956\u52b1 \u7ec4\u5185\u76f8\u5bf9\u5956\u52b1 \u6837\u672c\u6548\u7387 \u4e2d\u7b49 \u8f83\u9ad8 \u66f4\u9ad8 \u6536\u655b\u7a33\u5b9a\u6027 \u9ad8\uff0c\u4f46\u8ba1\u7b97\u91cf\u5927 \u8f83\u597d\uff0c\u4ecd\u53ef\u80fd collapse \u66f4\u7a33\u5b9a LLM \u5e94\u7528 \u4e0d\u5e38\u7528\uff08\u8ba1\u7b97\u8fc7\u5927\uff09 \u4e3b\u6d41\uff08ChatGPT\uff09 \u65b0\u5174\uff08\u51cf\u5c11\u5956\u52b1 hacking\uff0c\u504f\u597d\u66f4\u4e00\u81f4\uff09","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#4","title":"4. \u8bad\u7ec3\u8fc7\u7a0b","text":"<ol> <li> <p>\u6570\u636e\u6765\u6e90</p> <ul> <li>Prompt \u6765\u81ea\u4eba\u5de5\u8bbe\u8ba1\u6216\u5408\u6210\u4efb\u52a1\u3002</li> <li>\u7b56\u7565\u6a21\u578b\u751f\u6210\u591a\u6837\u5316\u5019\u9009\u7b54\u6848\u3002</li> </ul> </li> <li> <p>\u5956\u52b1\u6a21\u578b</p> <ul> <li>\u57fa\u4e8e\u4eba\u7c7b\u504f\u597d\u6570\u636e\u8bad\u7ec3\u3002</li> <li>\u8f93\u51fa\u76f8\u5bf9\u5206\u6570\uff0c\u800c\u4e0d\u662f\u7edd\u5bf9 reward\u3002</li> </ul> </li> <li> <p>\u5206\u7ec4\u91c7\u6837</p> <ul> <li>\u5bf9\u6bcf\u4e2a prompt\uff0c\u91c7\u6837 \\(K\\) \u4e2a\u5019\u9009\u7ed3\u679c\u5f62\u6210 group\u3002</li> </ul> </li> <li> <p>\u76f8\u5bf9\u4f18\u52bf\u8ba1\u7b97</p> <ul> <li>\u7ec4\u5185\u5f52\u4e00\u5316\uff1a\\(A(y_i) = \\frac{r(y_i)-\\mu_G}{\\sigma_G}\\).</li> </ul> </li> <li> <p>\u7b56\u7565\u66f4\u65b0</p> <ul> <li>\u4f7f\u7528 GRPO \u635f\u5931\u51fd\u6570\u8fdb\u884c\u53cd\u5411\u4f20\u64ad\u3002</li> </ul> </li> <li> <p>\u8fed\u4ee3\u8bad\u7ec3</p> <ul> <li>\u66f4\u65b0\u7b56\u7565\u6a21\u578b\uff0c\u91cd\u590d\u91c7\u6837-\u8bad\u7ec3\u6d41\u7a0b\u3002</li> </ul> </li> </ol>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#5","title":"5. \u4f2a\u4ee3\u7801","text":"<pre><code># GRPO Training Pseudocode\n\nfor iteration in range(num_iters):\n    batch_prompts = sample_prompts()\n    groups = []\n\n    for x in batch_prompts:\n        candidates = [policy.generate(x) for _ in range(K)]\n        rewards = [reward_model(x, y) for y in candidates]\n\n        mu = mean(rewards)\n        sigma = std(rewards) + eps\n        advantages = [(r - mu) / sigma for r in rewards]\n\n        groups.append((x, candidates, advantages))\n\n    loss = 0\n    for (x, candidates, advantages) in groups:\n        for y, A in zip(candidates, advantages):\n            rho = policy_prob(y|x) / old_policy_prob(y|x)\n            clipped = clip(rho, 1 - eps, 1 + eps)\n            loss += -min(rho * A, clipped * A)\n\n    optimizer.zero_grad()\n    loss.backward()\n    optimizer.step()\n</code></pre>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#6","title":"6. \u793a\u4f8b","text":"<p>GRPO \u6838\u5fc3\u673a\u5236\uff1a\u7ec4\u5185\u76f8\u5bf9\u5956\u52b1\u4f18\u5316</p> <pre><code>Prompt: \"Explain quantum computing\"\n   \u251c\u2500\u2500 Candidate 1 \u2192 r=0.8\n   \u251c\u2500\u2500 Candidate 2 \u2192 r=0.6\n   \u251c\u2500\u2500 Candidate 3 \u2192 r=0.2\n   \u2514\u2500\u2500 Candidate 4 \u2192 r=0.9\n\n\u7ec4\u5747\u503c \u03bc=0.625, \u03c3=0.25\n   A1=(0.8-0.625)/0.25=+0.7\n   A2=-0.1\n   A3=-1.7\n   A4=+1.1\n</code></pre> <p>\u8fd9\u6837\u907f\u514d\u4e86\u7edd\u5bf9\u503c\u5dee\u5f02\u8fc7\u5927\u6216\u5956\u52b1\u566a\u58f0\u5bfc\u81f4\u7684\u4e0d\u7a33\u5b9a\u66f4\u65b0\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GRPO%E5%8E%9F%E7%90%86%E5%8F%8A%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%AF%B9%E6%AF%94/#_1","title":"\u603b\u7ed3","text":"<ul> <li>GRPO (Group Relative Policy Optimization) \u662f\u5bf9 PPO \u7684\u6539\u8fdb\uff0c\u5c06\u5956\u52b1\u4ece\u7edd\u5bf9\u503c\u8f6c\u4e3a\u7ec4\u5185\u76f8\u5bf9\u4f18\u52bf\uff0c\u63d0\u5347\u7a33\u5b9a\u6027\u548c\u6837\u672c\u6548\u7387\u3002</li> <li>\u5728 LLM RLHF \u4e2d\u5c24\u5176\u6709\u6548\uff0c\u51cf\u5c11\u5956\u52b1 hacking \u548c\u6a21\u5f0f\u574d\u7f29\u3002</li> <li>\u4e0e PPO \u76f8\u6bd4\uff1a\u66f4\u7a33\u5b9a\u3001\u66f4\u8282\u7701\u6837\u672c\uff0c\u4f46\u8ba1\u7b97\u6210\u672c\u7a0d\u9ad8\uff08\u9700\u8981\u7ec4\u91c7\u6837\uff09\u3002</li> <li>\u5df2\u9010\u6e10\u6210\u4e3a LLM \u540e\u8bad\u7ec3\u7684\u91cd\u8981\u4f18\u5316\u65b9\u6cd5\u3002</li> </ul>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM"]},{"location":"posts/GradScaler%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0/","title":"GradScaler\u7684\u6570\u5b66\u539f\u7406\u7b80\u8ff0","text":"\u6807\u7b7e\uff1a \u6a21\u578b\u91cf\u5316LLM","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/GradScaler%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0/#_1","title":"\u5f15\u8a00","text":"<p>\u4ec0\u4e48\u662fGradScaler?</p> <p>\u76ee\u7684\uff1a \u5728\u534a\u7cbe\u5ea6\u8bad\u7ec3\uff08float16\uff09\u65f6\uff0c\u8bb8\u591a\u68af\u5ea6\u503c\u8fc7\u5c0f\u4f1a\u4e0b\u6ea2\u5230 0\uff0c\u5bfc\u81f4\u7f51\u7edc\u65e0\u6cd5\u5b66\u4e60\u3002GradScaler \u901a\u8fc7\u628a \u635f\u5931 \\(L\\) \u653e\u5927 \u518d\u53cd\u5411\u4f20\u64ad\uff0c\u628a\u68af\u5ea6\u6574\u4f53\u62ac\u9ad8\u5230 float16 \u53ef\u8868\u793a\u7684\u52a8\u6001\u8303\u56f4\u5185\uff1b\u53cd\u5411\u4e4b\u540e\u518d\u6309\u6bd4\u4f8b\u7f29\u56de\uff0c\u4ece\u800c \u65e2\u907f\u514d\u4e0b\u6ea2\uff0c\u53c8\u4e0d\u6539\u53d8\u66f4\u65b0\u65b9\u5411\u548c\u5927\u5c0f\u3002 </p>","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/GradScaler%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0/#_2","title":"\u635f\u5931\u653e\u5927","text":"<p>\u7ed9\u5b9a\u653e\u5927\u56e0\u5b50\\(S(S\\gg1)\\)\uff08\u901a\u5e38\u53d6 2 \u7684\u5e42\uff0c\u4fbf\u4e8e\u4f4d\u79fb\u5b9e\u73b0\uff09</p> \\[L_s = S \\, L\\] <p>\u5728\u540e\u5411\u4f20\u64ad\u65f6\uff0c\u94fe\u5f0f\u6cd5\u5219\u4fdd\u8bc1\u68af\u5ea6\u540c\u6837\u88ab\u653e\u5927\uff1a</p> \\[\\nabla_w L_s \\;=\\; \\frac{\\partial\\, (S L)}{\\partial w} \\;=\\; S \\,\\frac{\\partial L}{\\partial w}\\;=\\; S \\,\\nabla_w L\\] <ul> <li>\u82e5\\(\\nabla_w L\\)\u539f\u672c\u843d\u5728\\(\\bigl[10^{-7},10^{-3}\\bigr]\\)\uff0c\u800c float16 \u6700\u5c0f\u6b63\u6570\u7ea6\\(6\\times10^{-5}\\)\uff0c\u5219\u4e58\u4ee5\\(S=2^{10}=1024\\)\u540e\u4fbf\u80fd\u843d\u5165\u53ef\u8868\u793a\u533a\u95f4\uff0c\u907f\u514d\u88ab\u622a\u6210 0\u3002</li> </ul>","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/GradScaler%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0/#_3","title":"\u6ea2\u51fa\u68c0\u6d4b","text":"<p>\u53cd\u5411\u7ed3\u675f\u540e\uff0c\u5c06 \u653e\u5927\u540e\u7684\u68af\u5ea6\\(\\nabla_w L_s\\)\u68c0\u67e5\u662f\u5426\u542b\u6709 Inf/NaN\u3002</p> <ul> <li>\u82e5\u53d1\u73b0\u6ea2\u51fa \u2192 \u8bf4\u660e\\(S\\)\u592a\u5927\uff1b\u672c\u6b21\u8fed\u4ee3 \u6574\u6b65\u4e22\u5f03\uff0c\u5e76\u5c06\\(S\\)\u4e58\u4ee5\u8870\u51cf\u7cfb\u6570\\(\\alpha&lt;1\\)\uff08\u5982 0.5\uff09\u3002</li> <li>\u82e5\u65e0\u6ea2\u51fa \u2192 \u7ee7\u7eed\u4e0b\u4e00\u6b65\u3002</li> </ul>","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/GradScaler%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0/#_4","title":"\u68af\u5ea6\u7f29\u653e\u56de\u539f\u5c3a\u5ea6","text":"<p>\u672a\u6ea2\u51fa\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u6267\u884c\u4f18\u5316\u5668\u66f4\u65b0\u524d\u628a\u68af\u5ea6\u9664\u56de\\(S\\)\uff1a</p> \\[\\nabla_w L \\;=\\; \\frac{\\nabla_w L_s}{S}\\] <p>\u56e0\u4e3a\u5fae\u5206\u7ebf\u4e0a\u6027\uff0c\\(\\nabla_w L\\)\u4e0e\u5e38\u89c4 FP32 \u8bad\u7ec3\u5f97\u5230\u7684\u68af\u5ea6\u6570\u503c\u5b8c\u5168\u4e00\u81f4\uff1b\u968f\u540e\u518d\u505a\u68af\u5ea6\u88c1\u526a\u3001Adam \u52a8\u91cf\u66f4\u65b0\u7b49\uff0c\u6570\u503c\u5c31\u5df2\u5b89\u5168\u5730\u5904\u5728 FP32 \u57df\u3002</p>","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/GradScaler%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0/#_5","title":"\u52a8\u6001\u8c03\u6574\u653e\u5927\u56e0\u5b50","text":"<p>GradScaler \u7ef4\u62a4\u4e00\u4e2a\u8ba1\u6570\u5668\\(n_{\\text{good}}\\)\uff1a</p> <ol> <li>\u6210\u529f\u6b65\uff08\u65e0\u6ea2\u51fa\uff09\u7d2f\u8ba1\\(n_{\\text{good}}\\)\u3002</li> <li>\u5f53\\(n_{\\text{good}} \\ge k\\)\uff08\u5982 2000 \u6b65\uff09\u65f6\uff0c\u5c06\\(S\\)\u589e\u957f\uff1a\\(S \\gets S \\times \\beta\\)\uff08\u5e38\u53d6\\(\\beta=2\\)\uff09\uff0c\u7136\u540e\u6e05\u96f6\u8ba1\u6570\u5668\u3002</li> <li>\u6ea2\u51fa\u6b65 \u5219\u7acb\u5373\u4e0b\u964d\u653e\u5927\u56e0\u5b50\uff1a\\(S \\gets S \\times \\alpha\\)\uff0c\u5e76\u91cd\u7f6e\\(n_{\\text{good}}=0\\)\u3002</li> </ol> <p>\u8fd9\u6837\\(S\\)\u5728 \u7a33\u5b9a\u533a\u95f4 \u5185\u81ea\u52a8\u5bfb\u627e\u201c\u5c3d\u53ef\u80fd\u5927\u4f46\u4e0d\u6ea2\u51fa\u201d\u7684\u503c\uff0c\u517c\u987e\u6570\u503c\u5b89\u5168\u4e0e\u4e0b\u6ea2\u7f13\u89e3\u3002</p>","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/GradScaler%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0/#_6","title":"\u6570\u503c\u7b49\u4ef7\u6027\u4e0e\u5b9e\u73b0\u7ec6\u8282","text":"<ul> <li>\u653e\u5927\u4e0e\u7f29\u56de\u4e92\u4e3a\u4e58\u9664\uff0c\u6545 \u53c2\u6570\u66f4\u65b0\u4e0e\u4e0d\u4f7f\u7528 GradScaler \u65f6\u5b8c\u5168\u4e00\u81f4\u3002</li> <li>\u9009\u53d6\\(S=2^{k}\\)\u80fd\u7528\u6307\u9488\u79fb\u4f4d\u800c\u975e\u4e58\u6cd5\u5b8c\u6210\u7f29\u653e\uff0c\u907f\u514d\u989d\u5916\u820d\u5165\u8bef\u5dee\u3002</li> <li>BF16 \u52a8\u6001\u8303\u56f4\u4e0e FP32 \u76f8\u540c\uff0c\u901a\u5e38 \u53ef\u7565\u8fc7\u635f\u5931\u7f29\u653e\uff1bFP16 \u5219\u51e0\u4e4e\u5fc5\u9700\u3002</li> </ul> <p>\u603b\u7ed3 GradScaler \u901a\u8fc7\u201c\u653e\u5927\u635f\u5931\u2192\u68c0\u6d4b\u6ea2\u51fa\u2192\u7f29\u56de\u68af\u5ea6\u2192\u52a8\u6001\u8c03\\(S\\)\u201d\u56db\u6b65\uff0c\u4f7f\u8bad\u7ec3\u8fc7\u7a0b\u5728\u4f4e\u7cbe\u5ea6\u4e0b \u6700\u5927\u5316\u5229\u7528\u786c\u4ef6\u52a0\u901f\uff0c\u540c\u65f6\u4fdd\u6301\u4e0e\u5168\u7cbe\u5ea6\u8bad\u7ec3 \u6570\u503c\u7b49\u4ef7 \u7684\u68af\u5ea6\u66f4\u65b0\uff0c\u662f\u81ea\u52a8\u6df7\u5408\u7cbe\u5ea6 (AMP) \u7684\u6838\u5fc3\u7ec4\u4ef6\u3002</p>","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/LoRA%EF%BC%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%8E%E7%A7%A9%E5%AF%86%E8%AF%AD/","title":"LoRA\uff1a\u5927\u6a21\u578b\u7684\u4f4e\u79e9\u5bc6\u8bed","text":"\u6807\u7b7e\uff1a LoRAPost TrainingLLM","tags":["LoRA","Post Training","LLM"]},{"location":"posts/LoRA%EF%BC%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%8E%E7%A7%A9%E5%AF%86%E8%AF%AD/#lora","title":"LoRA\u662f\u4ec0\u4e48","text":"<p>LoRA\uff08Low-Rank Adaptation\uff09\u662f\u4e00\u79cd\u53c2\u6570\u9ad8\u6548\u7684\u6a21\u578b\u5fae\u8c03\u6280\u672f\uff0c\u7528\u4e8e\u5728\u4e0d\u5927\u5e45\u589e\u52a0\u53c2\u6570\u6570\u91cf\u7684\u524d\u63d0\u4e0b\u9002\u914d\u5927\u578b\u9884\u8bad\u7ec3\u6a21\u578b\u3002\u5176\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u5728\u5fae\u8c03\u9636\u6bb5\u51bb\u7ed3\u9884\u8bad\u7ec3\u6a21\u578b\u7684\u5927\u90e8\u5206\u6743\u91cd\uff0c\u4ec5\u5728\u6bcf\u5c42\u6dfb\u52a0\u53ef\u8bad\u7ec3\u7684\u4f4e\u79e9\u77e9\u9635\u6765\u8868\u793a\u6a21\u578b\u53c2\u6570\u9700\u8981\u8c03\u6574\u7684\u90e8\u5206\uff0c\u4ece\u800c\u5b9e\u73b0\u5bf9\u6a21\u578b\u7684\u9ad8\u6548\u9002\u5e94\u3002\u8fd9\u79cd\u65b9\u6cd5\u7684\u63d0\u51fa\u80cc\u666f\u662f\u5728\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u4e0d\u65ad\u6269\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u4f20\u7edf\u7684\u5168\u53c2\u6570\u5fae\u8c03\u53d8\u5f97\u6108\u53d1\u4e0d\u53ef\u884c\u3002LoRA\u7531\u5fae\u8f6f\u7814\u7a76\u9662\u7684\u56e2\u961f\u4e8e2021\u5e74\u63d0\u51fa\uff0c\u662f\u5f53\u65f6\u4e00\u7cfb\u5217\u53c2\u6570\u9ad8\u6548\u5fae\u8c03\uff08PEFT\uff09\u65b9\u6cd5\u4e4b\u4e00\uff0c\u4e0e2019\u5e74\u7684Adapter\u63d2\u5165\u3001\u65af\u5766\u798f\u7684Prefix Tuning\u3001\u8c37\u6b4c\u7684Prompt Tuning\u3001\u6e05\u534e\u7684P-tuning v2\u7b49\u65b9\u6cd5\u9f50\u540d\u3002\u76f8\u8f83\u800c\u8a00\uff0cLoRA\u5728\u5404\u79cd\u57fa\u51c6\u4efb\u52a1\u4e0a\u5f80\u5f80\u53d6\u5f97\u66f4\u4f18\u7684\u6548\u679c\uff0c\u5e76\u514b\u670d\u4e86\u5176\u4ed6\u65b9\u6cd5\u7684\u4e00\u4e9b\u7f3a\u70b9\uff1a\u4f8b\u5982Adapter\u4f1a\u589e\u52a0\u6a21\u578b\u5c42\u6570\u4ece\u800c\u5f15\u5165\u63a8\u7406\u5ef6\u8fdf\uff0cPrefix-Tuning\u9700\u8981\u5360\u7528\u90e8\u5206\u8f93\u5165\u5e8f\u5217\u7a7a\u95f4\u4e14\u96be\u8bad\u7ec3\uff0cP-Tuning v2\u5219\u6613\u5f15\u53d1\u65e7\u77e5\u8bc6\u9057\u5fd8\u7b49\u95ee\u9898\u3002LoRA\u901a\u8fc7\u4f4e\u79e9\u77e9\u9635\u5fae\u8c03\u907f\u514d\u4e86\u8fd9\u4e9b\u95ee\u9898\uff0c\u5728\u4fdd\u6301\u6a21\u578b\u6027\u80fd\u7684\u540c\u65f6\u4e0d\u5f15\u5165\u989d\u5916\u7684\u63a8\u7406\u5f00\u9500\u3002</p> <p>LoRA\u540d\u79f0\u4e2d\u7684\u201c\u4f4e\u79e9\u201d\u6307\u7684\u662f\u77e9\u9635\u7684\u79e9\u8fd9\u4e00\u6982\u5ff5\u3002LoRA\u5047\u8bbe\u5927\u578b\u6a21\u578b\u5728\u8fc1\u79fb\u5230\u7279\u5b9a\u4efb\u52a1\u6216\u9886\u57df\u65f6\uff0c\u5176\u6743\u91cd\u66f4\u65b0\u5728\u5185\u5728\u7ef4\u5ea6\u4e0a\u662f\u4f4e\u79e9\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6a21\u578b\u9700\u8981\u8c03\u6574\u7684\u53c2\u6570\u53d8\u5316\u53ef\u4ee5\u88ab\u538b\u7f29\u5230\u8fdc\u4f4e\u4e8e\u539f\u59cb\u7ef4\u5ea6\u7684\u5b50\u7a7a\u95f4\u4e2d\uff0c\u800c\u4e0d\u663e\u8457\u635f\u5931\u6a21\u578b\u8868\u8fbe\u80fd\u529b\u3002\u57fa\u4e8e\u8fd9\u4e00\u5047\u8bbe\uff0cLoRA\u4e0d\u76f4\u63a5\u8c03\u6574\u539f\u6a21\u578b\u5e9e\u5927\u7684\u6743\u91cd\u77e9\u9635\uff0c\u800c\u662f\u5b66\u4e60\u4e00\u4e2a\u4f4e\u79e9\u7684\u8fd1\u4f3c\u66f4\u65b0\u3002\u672c\u8d28\u4e0a\uff0cLoRA\u63d0\u51fa\u5728\u4e0d\u6539\u53d8\u539f\u6a21\u578b\u67b6\u6784\u7684\u524d\u63d0\u4e0b\uff0c\u7528\u5f88\u5c0f\u7684\u989d\u5916\u53c2\u6570\u5b9e\u73b0\u4e0e\u5168\u53c2\u6570\u5fae\u8c03\u76f8\u5f53\u7684\u6548\u679c\u3002\u4f8b\u5982\uff0cLoRA\u5728RoBERTa\u3001DeBERTa\u3001GPT-2\u3001GPT-3\u7b49\u6a21\u578b\u4e0a\u7684\u5b9e\u9a8c\u8868\u660e\uff0c\u53ea\u9700\u8bad\u7ec3\u4e0d\u5230\u539f\u6a21\u578b\u4e07\u5206\u4e4b\u4e00\u7684\u53c2\u6570\u91cf\uff0c\u6027\u80fd\u5c31\u80fd\u4e0e\u5168\u91cf\u5fae\u8c03\u76f8\u5f53\uff0c\u90e8\u5206\u4efb\u52a1\u4e0a\u751a\u81f3\u66f4\u4f18\u3002LoRA\u65b9\u6cd5\u7684\u6709\u6548\u6027\u4e5f\u8bc1\u660e\u4e86\u5927\u578b\u8bed\u8a00\u6a21\u578b\u5728\u9002\u914d\u65b0\u4efb\u52a1\u65f6\u7684\u68af\u5ea6\u66f4\u65b0\u786e\u5b9e\u53ef\u80fd\u5177\u6709\u4f4e\u79e9\u7ed3\u6784\uff0c\u8fd9\u4e00\u53d1\u73b0\u4e3a\u7406\u89e3\u5927\u578b\u6a21\u578b\u7684\u53ef\u5fae\u8c03\u6027\u63d0\u4f9b\u4e86\u65b0\u7684\u89c6\u89d2\u3002</p>","tags":["LoRA","Post Training","LLM"]},{"location":"posts/LoRA%EF%BC%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%8E%E7%A7%A9%E5%AF%86%E8%AF%AD/#lora_1","title":"\u4e3a\u4ec0\u4e48\u8981\u6709LoRA","text":"<p>\u5927\u578b\u8bed\u8a00\u6a21\u578b\u7684\u5fae\u8c03\u96be\u9898\u3002 \u968f\u7740Transformer\u67b6\u6784\u7684\u6d41\u884c\u548c\u6a21\u578b\u89c4\u6a21\u7684\u7206\u70b8\u5f0f\u589e\u957f\uff0c\u73b0\u4ee3LLM\uff08\u5982GPT-3\u3001PaLM\u7b49\uff09\u5e38\u52a8\u8f84\u4e0a\u767e\u4ebf\u751a\u81f3\u5343\u4ebf\u53c2\u6570\u3002\u8fd9\u7ed9\u6a21\u578b\u7684\u5fae\u8c03\uff08fine-tuning\uff09\u5e26\u6765\u4e86\u5de8\u5927\u7684\u6311\u6218\u3002\u4f20\u7edf\u5fae\u8c03\u9700\u8981\u5bf9\u6a21\u578b\u7684\u6240\u6709\u53c2\u6570\u57fa\u4e8e\u65b0\u6570\u636e\u8fdb\u884c\u68af\u5ea6\u66f4\u65b0\uff0c\u8fd9\u5728\u5c0f\u6a21\u578b\u4e0a\u95ee\u9898\u4e0d\u5927\uff0c\u4f46\u5bf9\u8d85\u5927\u6a21\u578b\u800c\u8a00\u51e0\u4e4e\u4e0d\u53ef\u627f\u53d7\u3002\u4ee5OpenAI GPT-3 (1750\u4ebf\u53c2\u6570)\u4e3a\u4f8b\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8ba9\u5b83\u9002\u5e94\u4e00\u4e2a\u65b0\u9886\u57df\u6216\u4efb\u52a1\uff0c\u5b8c\u6574\u5fae\u8c03\u5c31\u610f\u5473\u7740\u5bf91750\u4ebf\u53c2\u6570\u91cd\u65b0\u8bad\u7ec3\uff0c\u5e76\u90e8\u7f72\u4e00\u5957\u65b0\u7684\u6a21\u578b\u6743\u91cd\u3002\u8fd9\u4e0d\u4f46\u8bad\u7ec3\u5f00\u9500\u5de8\u5927\uff0c\u800c\u4e14\u6bcf\u589e\u52a0\u4e00\u4e2a\u7ec6\u5206\u9886\u57df\u90fd\u8981\u5b58\u50a8\u4e00\u4efd175B\u5927\u5c0f\u7684\u6a21\u578b\u526f\u672c\uff0c\u5b58\u50a8\u548c\u7ef4\u62a4\u6210\u672c\u6781\u5176\u9ad8\u6602\u3002\u56e0\u6b64\uff0c\u5728\u6a21\u578b\u8d8a\u6765\u8d8a\u5927\u7684\u4eca\u5929\uff0c\u79d1\u7814\u4eba\u5458\u548c\u5de5\u7a0b\u5e08\u8feb\u5207\u9700\u8981\u4e00\u79cd\u66f4\u9ad8\u6548\u7684\u5fae\u8c03\u65b9\u6cd5\uff0c\u65e2\u80fd\u964d\u4f4e\u8ba1\u7b97/\u5b58\u50a8\u6210\u672c\uff0c\u53c8\u80fd\u907f\u514d\u6bcf\u6b21\u4efb\u52a1\u90fd\u8bad\u7ec3\u548c\u4fdd\u5b58\u6574\u5957\u5927\u6a21\u578b\u3002</p> <p>LoRA\u89e3\u51b3\u7684\u6838\u5fc3\u75db\u70b9\u3002 LoRA\u6b63\u662f\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u75db\u70b9\u800c\u63d0\u51fa\u3002\u5b83\u901a\u8fc7\u6781\u5927\u5730\u51cf\u5c11\u9700\u8981\u8bad\u7ec3\u7684\u53c2\u6570\u6570\u91cf\uff0c\u4f7f\u5fae\u8c03\u5927\u578b\u6a21\u578b\u53d8\u5f97\u5207\u5b9e\u53ef\u884c\u3002\u5177\u4f53\u800c\u8a00\uff0cLoRA\u91c7\u7528\u4f4e\u79e9\u5206\u89e3\u6280\u5de7\uff0c\u5c06\u5fae\u8c03\u6240\u9700\u7684\u53c2\u6570\u66f4\u65b0\u9650\u5236\u5728\u7531\u4e24\u4e2a\u5c0f\u77e9\u9635\u751f\u6210\u7684\u5b50\u7a7a\u95f4\u4e2d\uff0c\u800c\u65e0\u9700\u66f4\u65b0\u539f\u6a21\u578b\u5168\u90e8\u53c2\u6570\u3002\u8fd9\u5e26\u6765\u4e86\u663e\u8457\u7684\u6548\u7387\u63d0\u5347\uff1a\u4f8b\u5982\uff0c\u4f7f\u7528LoRA\u5fae\u8c03GPT-3\u65f6\uff0c\u53ef\u8bad\u7ec3\u53c2\u6570\u4ece1750\u4ebf\u964d\u4f4e\u5230\u4ec5\u7ea61800\u4e07\uff0c\u51cf\u5c11\u4e86\u5c06\u8fd110,000\u500d\uff0c\u540c\u65f6GPU\u663e\u5b58\u9700\u6c42\u964d\u4f4e\u7ea62/3\uff08\u7ea6\u51cf\u5c113\u500d\uff09\u3002\u6362\u8a00\u4e4b\uff0c\u53ea\u9700\u4e0d\u5230\u539f\u6a21\u578b0.1%\u7684\u53c2\u6570\uff0c\u5c31\u80fd\u5b9e\u73b0\u540c\u6837\u7684\u9002\u5e94\u6548\u679c\u3002\u8fd9\u5927\u5e45\u964d\u4f4e\u4e86\u5fae\u8c03\u6240\u9700\u7684\u8ba1\u7b97\u8d44\u6e90\u548c\u5185\u5b58\u5360\u7528\uff0c\u4f7f\u5f97\u5728\u5355\u5f20GPU\u4e0a\u5fae\u8c03\u6570\u5341\u4ebf\u53c2\u6570\u6a21\u578b\u6210\u4e3a\u53ef\u80fd\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0cLoRA\u5fae\u8c03\u540e\u7684\u6a21\u578b\u5728\u6027\u80fd\u4e0a\u4ecd\u80fd\u5ab2\u7f8e\u751a\u81f3\u4f18\u4e8e\u5168\u53c2\u6570\u5fae\u8c03\u3002\u6b63\u5982LoRA\u539f\u8bba\u6587\u6240\u62a5\u9053\u7684\uff0c\u5728RoBERTa\u3001GPT-2\u7b49\u6a21\u578b\u4e0aLoRA\u5fae\u8c03\u8fbe\u5230\u4e86\u4e0e\u5168\u5fae\u8c03\u76f8\u5f53\u7684\u7cbe\u5ea6\uff0c\u800c\u8bad\u7ec3\u5f00\u9500\u5374\u8981\u5c0f\u51e0\u4e2a\u6570\u91cf\u7ea7\u3002</p> <p>\u53e6\u4e00\u4e2aLoRA\u7684\u91cd\u8981\u4f18\u52bf\u662f\u6a21\u5757\u5316\u9002\u914d\u80fd\u529b\u5f3a\uff0c\u89e3\u51b3\u4e86\u591a\u4efb\u52a1\u90e8\u7f72\u7684\u5b58\u50a8\u96be\u9898\u3002\u4ee5\u5f80\u5982\u679c\u4e00\u4e2a\u57fa\u7840\u6a21\u578b\u9700\u8981\u9002\u5e94\u591a\u4e2a\u4e0b\u6e38\u4efb\u52a1\uff0c\u5f80\u5f80\u4e0d\u5f97\u4e0d\u4fdd\u5b58\u591a\u4efd\u5b8c\u6574\u7684\u5fae\u8c03\u540e\u6a21\u578b\uff08\u6bcf\u4e2a\u4efb\u52a1\u4e00\u4efd\uff09\uff0c\u8fd9\u5bf9\u5b58\u50a8\u548c\u7248\u672c\u7ba1\u7406\u975e\u5e38\u4e0d\u53cb\u597d\u3002\u800cLoRA\u53ea\u9700\u4fdd\u5b58\u6bcf\u4e2a\u4efb\u52a1\u5bf9\u5e94\u7684\u90a3\u7ec4\u5c0f\u578b\u4f4e\u79e9\u77e9\u9635\uff08\u901a\u5e38\u4ec5\u6709\u51e0\u5341MB\uff09\uff0c\u6240\u6709\u4efb\u52a1\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u4e2a\u51bb\u7ed3\u7684\u57fa\u7840\u5927\u6a21\u578b\u3002\u5728\u90e8\u7f72\u65f6\uff0c\u53ea\u9700\u5c06\u4e0d\u540c\u4efb\u52a1\u7684LoRA\u6a21\u5757\u52a8\u6001\u52a0\u8f7d\u5230\u57fa\u5ea7\u6a21\u578b\u4e2d\uff0c\u5373\u53ef\u5728\u5404\u4efb\u52a1\u95f4\u5feb\u901f\u5207\u6362\uff0c\u800c\u65e0\u9700\u52a0\u8f7d\u591a\u4e2a\u5e9e\u5927\u7684\u6a21\u578b\u6587\u4ef6\u3002\u8fd9\u79cd\u201c\u4e00\u6a21\u591a\u7528\u201d\u7684\u80fd\u529b\u6781\u5927\u63d0\u9ad8\u4e86\u5927\u578b\u6a21\u578b\u5728\u5de5\u4e1a\u573a\u666f\u4e0b\u7684\u5b9e\u7528\u6027\uff1a\u4f8b\u5982\uff0c\u4e00\u4e2a7B\u53c2\u6570\u7684\u57fa\u7840\u6a21\u578b\u53ef\u4ee5\u914d\u5408\u6210\u5343\u4e0a\u4e07\u4e2a\u4e0d\u540c\u4efb\u52a1\u7684LoRA\u6743\u91cd\uff0c\u5b9e\u73b0\u591a\u79df\u6237\u7684\u5927\u6a21\u578b\u670d\u52a1\uff0c\u6bcf\u4e2a\u7528\u6237\u8bf7\u6c42\u8c03\u7528\u4e0d\u540c\u7684LoRA\u9002\u914d\u5668\uff0c\u4f46\u5171\u4eab\u76f8\u540c\u7684\u5e95\u5c42\u6a21\u578b\uff0c\u4ece\u800c\u663e\u8457\u644a\u8584\u90e8\u7f72\u6210\u672c\u3002</p> <p>\u7b80\u800c\u8a00\u4e4b\uff0cLoRA\u4e4b\u6240\u4ee5\u8bde\u751f\uff0c\u662f\u4e3a\u4e86\u8ba9\u5927\u578b\u6a21\u578b\u7684\u5fae\u8c03\u53d8\u5f97\u9ad8\u6548\u3001\u5ec9\u4ef7\u4e14\u6613\u7ba1\u7406\u3002\u5b83\u6210\u529f\u89e3\u51b3\u4e86\u4ee5\u5f80\u5b58\u5728\u7684\u5173\u952e\u74f6\u9888\uff1a\u8bad\u7ec3\u5f00\u9500\u8fc7\u5927\uff08\u901a\u8fc7\u51cf\u5c11\u8bad\u7ec3\u53c2\u6570\u6570\u91cf\u89e3\u51b3\uff09\u3001\u663e\u5b58\u5360\u7528\u8fc7\u9ad8\uff08\u901a\u8fc7\u51bb\u7ed3\u5927\u90e8\u5206\u6743\u91cd\u89e3\u51b3\uff09\u3001\u591a\u4efb\u52a1\u5b58\u50a8\u5197\u4f59\uff08\u901a\u8fc7\u6a21\u5757\u5316\u7684\u5c0f\u578b\u6743\u91cd\u89e3\u51b3\uff09\u3002\u8fd9\u4e9b\u4f18\u52bf\u4f7fLoRA\u6210\u4e3a\u8fd1\u5e74\u6765\u9002\u914d\u5927\u6a21\u578b\u6700\u5177\u5f71\u54cd\u529b\u7684\u6280\u672f\u4e4b\u4e00\uff0c\u4e5f\u4e3a\u8d44\u6e90\u53d7\u9650\u7684\u7814\u7a76\u8005\u548c\u5de5\u7a0b\u5e08\u6253\u5f00\u4e86\u5229\u7528LLM\u7684\u65b9\u4fbf\u4e4b\u95e8\u3002</p>","tags":["LoRA","Post Training","LLM"]},{"location":"posts/LoRA%EF%BC%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%8E%E7%A7%A9%E5%AF%86%E8%AF%AD/#lora_2","title":"LoRA\u662f\u5982\u4f55\u5de5\u4f5c\u7684","text":"<p>\u56fe1\uff1a\u5e38\u89c4\u5fae\u8c03\uff08\u5de6\uff09\u9700\u8981\u5bf9\u5b8c\u6574\u6743\u91cd\u77e9\u9635\\(W\\)_\u5e94\u7528\u68af\u5ea6\u66f4\u65b0\\(\\Delta W\\)\uff0c\u800cLoRA \u65b9\u6cd5\uff08\u53f3\uff09\u5047\u8bbe\\(\\Delta W\\)\u53ef\u4ee5\u7528\u4e24\u4e2a\u4f4e\u79e9\u77e9\u9635\u7684\u4e58\u79ef\u6765\u8fd1\u4f3c\u8868\u793a\uff08\\(\\Delta W \\approx A \\times B\\)\uff09\u3002LoRA\u5728\u8bad\u7ec3\u4e2d\u76f4\u63a5\u5b66\u4e60\u8fd9\u6837\u7684\u4f4e\u79e9\u5206\u89e3\uff0c\u4ece\u800c\u4ec5\u9700\u66f4\u65b0\\(A\\)\u548c\\(B\\)_\u4e24\u4e2a\u5c0f\u77e9\u9635\u5373\u53ef\u5b8c\u6210\u6a21\u578b\u9002\u5e94\u3002</p> <p>\u77e9\u9635\u79e9\u662f\u77e9\u9635\u5217\uff08\u6216\u884c\uff09\u5411\u91cf\u7ec4\u7684\u6700\u5927\u7ebf\u6027\u65e0\u5173\u6570\u76ee\uff0c\u53cd\u6620\u4e86\u8be5\u77e9\u9635\u53ef\u8868\u793a\u4fe1\u606f\u7684\u201c\u7ef4\u5ea6\u201d </p> <p>LoRA\u7684\u6838\u5fc3\u673a\u5236\u662f\u5728Transformer\u7b49\u6a21\u578b\u7684\u6bcf\u4e00\u5c42\u5f15\u5165\u5e76\u884c\u7684\u4f4e\u79e9\u6743\u91cd\u8c03\u6574\u5206\u652f\uff0c\u5e76\u5c06\u5176\u8f93\u51fa\u4e0e\u539f\u5c42\u7684\u8f93\u51fa\u76f8\u52a0\uff0c\u4ece\u800c\u5b8c\u6210\u5bf9\u539f\u6a21\u578b\u7684\u7ec6\u5fae\u8c03\u6574\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5bf9\u4e8e\u539f\u6a21\u578b\u4e2d\u7684\u4e00\u7ec4\u6743\u91cd\u77e9\u9635\\(W\\)\uff08\u5f62\u72b6\u4e3a\\([H_1, H_2]\\)\uff09 \uff0cLoRA\u4f1a\u65b0\u589e\u4e24\u4e2a\u53ef\u8bad\u7ec3\u77e9\u9635\uff1a \\(A\\)\u548c\\(B\\)\uff08\u5f62\u72b6\\([r, H_2]\\)\uff09 \u5176\u4e2d\\(r\\)\u662f\u8fdc\u5c0f\u4e8e\\(H_1, H_2\\)\u7684\u9884\u8bbe\u4f4e\u79e9\uff08\u901a\u5e38\u57288\uff5e32\u5de6\u53f3\uff09  \u3002 \u5728\u5fae\u8c03\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u51bb\u7ed3\u539f\u6743\u91cd\\(W\\)\u4e0d\u53d8  \uff0c\u4ec5\u8bad\u7ec3\\(A\\)\u548c\\(B\\)\u7684\u53c2\u6570\u4f7f\u4e4b\u903c\u8fd1\u6240\u9700\u7684\u6743\u91cd\u66f4\u65b0\u3002\u63a8\u7406\u65f6\uff0cLoRA\u5c06\u6a21\u578b\u6743\u91cd\u8c03\u6574\u4e3a\\(W_{\\text{new}} = W + \\Delta W = W + A \\times B\\)\u3002\u7531\u4e8e\\(A \\times B\\)\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u79e9\u4e3a\\(r\\)\u7684\u77e9\u9635\u8fd1\u4f3c\\(\\Delta W\\)\uff0c\u5b83\u5305\u542b\u4e86\u6a21\u578b\u4e3a\u9002\u5e94\u65b0\u4efb\u52a1\u6240\u9700\u7684\u90a3\u90e8\u5206\u53d8\u5316\uff0c\u800c\u65e0\u9700\u76f4\u63a5\u5b58\u50a8\u5b8c\u6574\u7684\\(\\Delta W\\)\u77e9\u9635\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4f4e\u79e9\u5206\u89e3\u80fd\u5e26\u6765\u5de8\u5927\u7684\u53c2\u6570\u538b\u7f29\u6548\u679c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u539f\u6743\u91cd\u66f4\u65b0\u77e9\u9635\\(\\Delta W\\)\u6709\\(10,000 \\times 20,000 = 2\\times10^8\\)\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48\u9009\u53d6\u79e9\\(r=8\\)\u65f6\uff0c\\(A\\)\u548c\\(B\\)\u5206\u522b\u53ea\u6709\\(10,000\\times8 + 8\\times20,000 = 2.4\\times10^5\\)\u53c2\u6570\uff0c\u4ec5\u4e3a\u5b8c\u6574\u66f4\u65b0\u7684 0.12%\uff0c\u538b\u7f29\u6bd4\u7ea6 830 \u500d\u3002\u7531\u6b64\u53ef\u89c1\uff0c\u901a\u8fc7\u5408\u9002\u7684\\(r\\)\uff0cLoRA\u80fd\u8ba9\u9700\u8981\u8bad\u7ec3\u7684\u53c2\u6570\u91cf\u5927\u5e45\u964d\u4f4e\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\\(r\\)\u503c\u7684\u9009\u62e9\u5b58\u5728\u6298\u8877\uff1a\u592a\u5927\u4f1a\u4e27\u5931\u538b\u7f29\u610f\u4e49\uff0c\u592a\u5c0f\u5219\u53ef\u80fd\u4fe1\u606f\u635f\u5931\uff0c\u65e0\u6cd5\u5145\u5206\u8868\u793a\u6240\u9700\u7684\u6a21\u578b\u53d8\u5316\u3002\u5b9e\u8df5\u4e2d\uff0c\\(r\\)\u901a\u5e38\u5728\u6570\u5341\u4ee5\u5185\uff0c\u7ecf\u9a8c\u8bc1\u5728\u5f88\u591a\u4efb\u52a1\u4e2d\u5373\u4f7f\\(r=4\\)\u751a\u81f3\\(r=1\\)\u4e5f\u80fd\u53d6\u5f97\u4e0e\u5168\u53c2\u6570\u5fae\u8c03\u76f8\u8fd1\u7684\u6548\u679c\u3002\u6b64\u5916\uff0cLoRA\u4e00\u822c\u4f1a\u5f15\u5165\u4e00\u4e2a\u7f29\u653e\u7cfb\u6570\\(\\alpha\\)\u6765\u5e73\u8861\u66f4\u65b0\u5e45\u5ea6\uff0c\u901a\u5e38\u5c06\\(\\Delta W\\)\u7684\u8fd1\u4f3c\u8868\u793a\u4e3a\\(W + \\frac{\\alpha}{r}(A B)\\)\u3002\\(\\alpha\\)\u901a\u5e38\u4e0e\\(r\\)\u53d6\u76f8\u540c\u91cf\u7ea7\uff08\u4f8b\u5982\\(\\alpha=2r\\)\uff09\u3002\u8fd9\u6837\u5728\u5fae\u8c03\u521d\u671f\\(AB\\)\u7684\u589e\u91cf\u88ab\u9002\u5f53\u7f29\u5c0f\uff0c\u4e0d\u4f1a\u7834\u574f\u539f\u6a21\u578b\u5df2\u6709\u80fd\u529b\uff0c\u5f85\u8bad\u7ec3\u5b8c\u6210\u540e\u518d\u5c06\u5176\u5e76\u5165\u6a21\u578b\u6743\u91cd\u4e2d\u3002</p> <p>LoRA\u6a21\u5757\u53ef\u4ee5\u7075\u6d3b\u5730\u63d2\u5165\u6a21\u578b\u7684\u5404\u79cd\u7ebf\u6027\u5c42\u4e2d\u3002\u5728Transformer\u67b6\u6784\u7684LLM\u4e2d\uff0c\u7edd\u5927\u90e8\u5206\u53c2\u6570\u96c6\u4e2d\u5728\u5404\u5c42\u7684\u7ebf\u6027\u6295\u5f71\u77e9\u9635\u4e0a\uff08\u6bd4\u5982Self-Attention\u7684\\(W_q, W_k, W_v, W_o\\)\u548c\u524d\u9988\u7f51\u7edc\u7684\u6295\u5f71\u77e9\u9635\uff09\u3002LoRA\u53ef\u4ee5\u4f5c\u7528\u4e8e\u8fd9\u4e9b\u77e9\u9635\u4e2d\u7684\u4efb\u610f\u5b50\u96c6\u3002LoRA\u8bba\u6587\u7684\u5b9e\u9a8c\u66fe\u6bd4\u8f83\u4e86\u5c06LoRA\u5e94\u7528\u4e8eGPT-3\u6ce8\u610f\u529b\u5c42\u4e0d\u540c\u6743\u91cd\u7684\u6548\u679c\uff0c\u7ed3\u679c\u8868\u660e\u4ec5\u5728\u67e5\u8be2\u548c\u503c\u6295\u5f71\uff08\\(W_q\\)\u548c\\(W_v\\)\uff09\u4e0a\u6dfb\u52a0LoRA\u6a21\u5757\u5c31\u80fd\u53d6\u5f97\u6700\u4f73\u7684\u5fae\u8c03\u6548\u679c\uff0c\u540c\u65f6\u8282\u7701\u8ba1\u7b97\u3002\u56e0\u6b64\u4e1a\u754c\u5e38\u91c7\u7528\u8fd9\u79cd\u914d\u7f6e\u4f5c\u4e3a\u9ed8\u8ba4\u9009\u62e9\u3002\u7136\u800c\uff0c\u6839\u636e\u4efb\u52a1\u9700\u6c42\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u66f4\u5e7f\u6cdb\u7684\u6a21\u5757\u5e94\u7528LoRA\u3002\u4f8b\u5982\uff0cHuggingFace\u7684PEFT\u5e93\u9ed8\u8ba4\u53ea\u5bf9Transformer\u7684\\(q\\)\u548c\\(v\\)\u6295\u5f71\u77e9\u9635\u5e94\u7528LoRA\uff0c\u4f46\u6709\u7814\u7a76\u8005\uff08\u5982\u63d0\u51faQLoRA\u7684\u65b9\u6cd5\uff09\u53d1\u73b0\u5c06LoRA\u6269\u5c55\u5230\u6240\u6709\u7ebf\u6027\u5c42\u80fd\u8fdb\u4e00\u6b65\u63d0\u5347\u9002\u5e94\u6548\u679c\u3002</p> <p>LoRA\u7684\u53e6\u4e00\u4e2a\u5173\u952e\u4f18\u52bf\u5728\u4e8e\u5176\u5728\u63a8\u7406\u9636\u6bb5\u4e0d\u589e\u52a0\u989d\u5916\u5ef6\u8fdf\u3002\u7531\u4e8eLoRA\u7684\u4f4e\u79e9\u77e9\u9635\u6700\u7ec8\u662f\u4e0e\u539f\u6743\u91cd\u76f8\u52a0\u878d\u5408\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u90e8\u7f72\u65f6\u5c06\u8bad\u7ec3\u5f97\u5230\u7684\\(A, B\\)\u77e9\u9635\u76f4\u63a5\u4e0e\u57fa\u7840\u6a21\u578b\u6743\u91cd\u5408\u5e76\uff0c\u4ece\u800c\u5f97\u5230\u4e00\u4e2a\u66f4\u65b0\u540e\u7684\u6a21\u578b\u3002\u6574\u4e2a\u8fc7\u7a0b\u7b49\u4ef7\u4e8e\u5f97\u5230\u4e00\u4e2a\u65b0\u7684\u6743\u91cd\\(W_{\\text{new}} = W + \\Delta W\\)\uff0c\u968f\u540e\u63a8\u7406\u4e0e\u666e\u901a\u6a21\u578b\u65e0\u5f02\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u4e00\u4e9b\u5176\u5b83\u5fae\u8c03\u65b9\u6cd5\uff08\u5982Adapter\uff09\u9700\u8981\u5728\u63a8\u7406\u65f6\u989d\u5916\u7ecf\u8fc7\u63d2\u5165\u7684\u5c42\uff0c\u4ece\u800c\u5f15\u5165\u987a\u5e8f\u4e0a\u7684\u5ef6\u8fdf\u3002LoRA\u7531\u4e8e\u5728\u7ed3\u6784\u4e0a\u4e0e\u539f\u6a21\u578b\u5e76\u884c\uff0c\u4e14\u53ef\u4ee5\u5728\u63a8\u7406\u524d\u878d\u5408\u6743\u91cd\uff0c\u56e0\u6b64\u5b9e\u73b0\u4e86\u96f6\u63a8\u7406\u5f00\u9500\u3002\u540c\u6837\uff0c\u5728\u8bad\u7ec3\u9636\u6bb5\uff0c\u7531\u4e8e\u7edd\u5927\u90e8\u5206\u53c2\u6570\u88ab\u51bb\u7ed3\uff0c\u53cd\u5411\u4f20\u64ad\u53ea\u9700\u8ba1\u7b97\u548c\u66f4\u65b0\u90a3\u6781\u5c11\u91cf\u4f4e\u79e9\u77e9\u9635\u7684\u68af\u5ea6\uff0c\u8fd9\u6781\u5927\u964d\u4f4e\u4e86\u5185\u5b58\u5360\u7528\u548c\u4f18\u5316\u5f00\u9500\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u4e3a\u6570\u5341\u4ebf\u7684\u6743\u91cd\u77e9\u9635\u7ef4\u62a4\u68af\u5ea6\u548c\u4e8c\u9636\u77e9\u4f30\u8ba1\uff0c\u53ea\u9700\u9488\u5bf9\u51e0\u767e\u4e07\u7684LoRA\u53c2\u6570\u8fdb\u884c\u4f18\u5316\uff0c\u5927\u5e45\u51cf\u5c11\u4e86\u5185\u5b58\u548c\u663e\u5b58\u538b\u529b\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48LoRA\u53ef\u4ee5\u5728\u5355GPU\u751a\u81f3\u6d88\u8d39\u7ea7\u663e\u5361\u4e0a\u5fae\u8c03\u539f\u672c\u9700\u8981\u591aGPU\u96c6\u7fa4\u7684\u5927\u6a21\u578b\uff1a\u56e0\u4e3a\u9700\u8981\u8ba1\u7b97\u548c\u50a8\u5b58\u68af\u5ea6\u7684\u53c2\u6570\u7ef4\u5ea6\u88ab\u538b\u7f29\u4e86\u51e0\u4e2a\u6570\u91cf\u7ea7\u3002</p> <p>\u7efc\u4e0a\uff0cLoRA\u5de5\u4f5c\u7684\u6d41\u7a0b\u53ef\u4ee5\u6982\u62ec\u4e3a\uff1a</p> <ol> <li>\u51bb\u7ed3\u539f\u6a21\u578b\u6743\u91cd\uff0c\u4f7f\u5176\u4fdd\u6301\u9884\u8bad\u7ec3\u65f6\u7684\u503c\u4e0d\u53d8\uff1b</li> <li>\u6dfb\u52a0\u4f4e\u79e9\u9002\u5e94\u6a21\u5757\uff0c\u5728\u6bcf\u4e2a\u76ee\u6807\u5c42\u5f15\u5165\u4e24\u4e2a\u5c0f\u77e9\u9635\\(A, B\\)\uff0c\u521d\u59cb\u5316\u4e3a\u8fd1\u4e4e\u96f6\u7684\u6743\u91cd\uff1b</li> <li>\u8bad\u7ec3\u4f4e\u79e9\u77e9\u9635\uff0c\u7528\u4e0b\u6e38\u4efb\u52a1\u6570\u636e\u53ea\u66f4\u65b0\\(A, B\\)\u7684\u53c2\u6570\uff08\u53ef\u4ee5\u89c6\u4f5c\u5b66\u4e60\u4e00\u4e2a\\(\\Delta W\\)\u7684\u4f4e\u79e9\u8fd1\u4f3c\uff09\uff1b</li> <li>\u63a8\u7406\u878d\u5408\uff1a\u5c06\u5b66\u4e60\u5230\u7684\\(A, B\\)\u4e0e\u539f\u6a21\u578b\u6743\u91cd\u5408\u5e76\uff08\u6216\u5728\u6bcf\u6b21\u524d\u5411\u65f6\u4e0e\u539f\u6743\u91cd\u76f8\u52a0\uff09\uff0c\u5f97\u5230\u5fae\u8c03\u540e\u7684\u6a21\u578b\u3002\u7531\u4e8e\\(A, B\\)\u89c4\u6a21\u5f88\u5c0f\uff0c\u5408\u5e76\u64cd\u4f5c\u9ad8\u6548\u4e14\u4e0d\u4f1a\u5f71\u54cd\u63a8\u7406\u901f\u5ea6\u3002</li> </ol> <p>\u901a\u8fc7\u4e0a\u8ff0\u673a\u5236\uff0cLoRA\u5728\u4fdd\u6301\u6a21\u578b\u539f\u6709\u6027\u80fd\u548c\u9ad8\u6548\u63a8\u7406\u7684\u540c\u65f6\uff0c\u5927\u5e45\u964d\u4f4e\u4e86\u5fae\u8c03\u7684\u53c2\u6570\u91cf\u548c\u8d44\u6e90\u5360\u7528\u3002\u8fd9\u4e00\u4f18\u96c5\u7684\u8bbe\u8ba1\u4f7f\u5f97\u5bf9\u767e\u4ebf\u7ea7\u53c2\u6570\u6a21\u578b\u7684\u8c03\u4f18\u53d8\u5f97\u50cf\u8c03\u4f18\u51e0\u767e\u4e07\u53c2\u6570\u6a21\u578b\u4e00\u6837\u8f7b\u677e\uff0c\u4e5f\u96be\u602aLoRA\u5df2\u6210\u4e3a\u5f53\u4eca\u5927\u6a21\u578b\u5fae\u8c03\u7684\u6807\u51c6\u914d\u7f6e\u4e4b\u4e00\u3002</p> <p>\u5728\u5927\u578b\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u5fae\u8c03\u5b9e\u8df5\u4e2d\uff0cLoRA \u7684\u6838\u5fc3\u601d\u60f3\u4f9d\u8d56\u4e8e\u201c\u6743\u91cd\u589e\u91cf\u202f\u0394W \u5177\u6709\u4f4e\u79e9\u7ed3\u6784\u201d\u8fd9\u4e00\u7ebf\u6027\u4ee3\u6570\u5047\u8bbe\uff1b\u56e0\u6b64\u7406\u89e3\u201c\u77e9\u9635\u7684\u79e9\u201d\u53ca LoRA \u5728\u7f51\u7edc\u5c42\u7ea7\u7684\u5177\u4f53\u843d\u70b9\uff0c\u662f\u6b63\u786e\u4f7f\u7528 LoRA \u7684\u524d\u63d0\u3002\u4e0b\u9762\u5148\u7ed9\u51fa\u5173\u952e\u7ed3\u8bba\uff0c\u518d\u8be6\u7ec6\u5c55\u5f00\u3002</p>","tags":["LoRA","Post Training","LLM"]},{"location":"posts/LoRA%EF%BC%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%8E%E7%A7%A9%E5%AF%86%E8%AF%AD/#lora-llm","title":"LoRA \u5728 LLM \u4e2d\u901a\u5e38\u4f5c\u7528\u4e8e\u54ea\u4e9b\u5c42\uff1f","text":"","tags":["LoRA","Post Training","LLM"]},{"location":"posts/LoRA%EF%BC%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%8E%E7%A7%A9%E5%AF%86%E8%AF%AD/#w_q-w_v","title":"\u6807\u51c6\u505a\u6cd5\uff1a\u53ea\u63d2\u5165\u6ce8\u610f\u529b\u7684\\(W_q\\)\u4e0e\u00a0\\(W_v\\)","text":"<ul> <li>LoRA \u539f\u8bba\u6587\u5728 GPT\u20113\u3001RoBERTa\u3001DeBERTa \u7b49\u6a21\u578b\u7684\u4e3b\u5b9e\u9a8c\u5747\u91c7\u7528 \u201c\u53ea\u5bf9\u67e5\u8be2\u4e0e\u503c\u77e9\u9635\u52a0 LoRA\u201d \u7b56\u7565\uff0c\u7406\u7531\u662f\uff1a<ol> <li>\u8be5\u4e8c\u77e9\u9635\u5bf9\u6ce8\u610f\u529b\u8f93\u51fa\u5f71\u54cd\u6700\u5927\uff1b</li> <li>\u5728\u56fa\u5b9a\u53c2\u6570\u9884\u7b97\u4e0b\u76f8\u5bf9\u5176\u5b83\u7ec4\u5408\u6700\u7a33\u5065\u202f(OpenReview, arXiv)\u3002</li> </ol> </li> <li>\u591a\u7bc7\u590d\u73b0\u548c\u8bb2\u89e3\u6587\u7ae0\u540c\u6837\u6307\u51fa \u201c\\(W_q\\) \u4e0e\u00a0\\(W_v\\) \u7ec4\u5408\u662f\u9ed8\u8ba4\u4f18\u9009\u201d\u202f(Artificial Intelligence in Plain English, Galaksiya.com)\u3002</li> <li>HuggingFace\u00a0PEFT \u5e93\u56e0\u6b64\u9ed8\u8ba4\u4ee4 <code>target_modules=[\"q_proj\",\"v_proj\"]</code>\uff0c\u65b9\u4fbf\u7528\u6237\u4e00\u952e\u8c03\u7528\u202f(Hugging Face)\u3002</li> </ul>","tags":["LoRA","Post Training","LLM"]},{"location":"posts/LoRA%EF%BC%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%8E%E7%A7%A9%E5%AF%86%E8%AF%AD/#_1","title":"\u6269\u5c55\u505a\u6cd5\uff1a\u66f4\u591a\u7ebf\u6027\u5c42","text":"<p>\u968f\u7740\u4efb\u52a1\u590d\u6742\u5ea6\u63d0\u5347\uff0c\u793e\u533a\u51fa\u73b0\u591a\u79cd\u201c\u52a0\u5bbd\u9002\u914d\u8303\u56f4\u201d\u7684\u5b9e\u8df5\uff1a</p> \u7b56\u7565 \u5178\u578b\u573a\u666f / \u65b9\u6cd5 \u5f71\u54cd \u6765\u6e90 Wq+Wk+Wv \u89c6\u89c9/\u8de8\u6a21\u6001\u6a21\u578b\u5e38\u5728\u952e\u77e9\u9635\u4e5f\u52a0 LoRA\uff0c\u4ee5\u63d0\u5347\u68c0\u7d22\u7cbe\u5ea6 \u53c2\u6570\u2191\u00a01.5\u00d7\uff0c\u7cbe\u5ea6\u53ef\u989d\u5916\u589e\u00a00.2\u202f\u21970.6\u202fBLEU (CVF Open Access) \u5168\u6ce8\u610f\u529b 4\u202f\u77e9\u9635 (Wq,Wk,Wv,Wo) QLoRA\u3001AdaLoRA \u7b49\u6ce8\u91cd\u6781\u81f4\u6027\u80fd \u8bad\u7ec3\u53c2\u6570\u2191\u4f46\u4ecd\u226a\u5168\u53c2\uff1b\u5bf9\u957f\u4e0a\u4e0b\u6587\u66f4\u7a33 (Mercity AI, magazine.sebastianraschka.com) \u6240\u6709\u7ebf\u6027\u5c42\uff08\u542b MLP\uff09 \u5c0f\u2011rank \u5168\u8986\u76d6\uff0c\u5728\u591a\u4efb\u52a1/\u591a\u8bed\u8a00\u8fc1\u79fb\u4e2d\u66f4\u901a\u7528 r=8 \u5168\u5c42\uff1e r=32 \u4ec5\u6ce8\u610f\u529b (Mercity AI) \u52a8\u6001\u5c42\u9009\u62e9 (AdaLoRA, FlexLoRA) \u8bad\u7ec3\u4e2d\u81ea\u9002\u5e94\u5206\u914d\u79e9\u9884\u7b97 \u5728\u76f8\u540c\u53c2\u6570\u91cf\u4e0b\u666e\u904d\u4f18\u4e8e\u56fa\u5b9a\u5c42 (OpenReview, arXiv) <p>\u7ecf\u9a8c\u6cd5\u5219\uff1a\u82e5\u663e\u5b58\u6781\u5ea6\u53d7\u9650\uff0c\u5148\u4ece Wq+Wv \u8d77\u6b65\uff1b\u82e5\u8ffd\u6c42\u6781\u81f4\u6548\u679c\u6216\u5904\u7406\u590d\u6742\u751f\u6210\u4efb\u52a1\uff0c\u53ef\u8003\u8651\u201c\u5168\u6ce8\u610f\u529b\u201d\u751a\u81f3\u201c\u5168\u7ebf\u6027\u5c42\u201d\u3002</p>","tags":["LoRA","Post Training","LLM"]},{"location":"posts/LoRA%EF%BC%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%8E%E7%A7%A9%E5%AF%86%E8%AF%AD/#lora_3","title":"LoRA\u7684\u4f7f\u7528\u6848\u4f8b","text":"<p>LoRA\u81ea\u63d0\u51fa\u4ee5\u6765\uff0c\u88ab\u5e7f\u6cdb\u5e94\u7528\u4e8e\u5404\u7c7b\u5927\u578b\u8bed\u8a00\u6a21\u578b\u7684\u5fae\u8c03\uff0c\u6db5\u76d6\u6a21\u578b\u7c7b\u578b\u548c\u4e0b\u6e38\u4efb\u52a1\u7684\u591a\u4e2a\u65b9\u9762\u3002\u4e0b\u9762\u5c06\u7ed3\u5408GPT\u7cfb\u5217\u3001LLaMA\u548cBERT\u7b49\u5178\u578b\u6a21\u578b\uff0c\u4ecb\u7ecdLoRA\u7684\u4f7f\u7528\u573a\u666f\u548c\u6548\u679c\u3002</p> <ul> <li>\u4e0b\u6e38\u4efb\u52a1\u9002\u914d\uff08\u5206\u7c7b\u3001\u95ee\u7b54\u3001\u6458\u8981\u3001\u5bf9\u8bdd\u7b49\uff09\uff1aLoRA\u975e\u5e38\u9002\u5408\u5c06\u901a\u7528\u9884\u8bad\u7ec3LLM\u9ad8\u6548\u5730\u5fae\u8c03\u5230\u7279\u5b9a\u4e0b\u6e38\u4efb\u52a1\u4e0a\u3002\u4f8b\u5982\uff0c\u5728\u6587\u672c\u5206\u7c7b\u4efb\u52a1\u4e2d\uff0c\u7814\u7a76\u8005\u4f7f\u7528LoRA\u5fae\u8c03BERT\u6a21\u578b\u6765\u8fdb\u884c\u60c5\u611f\u5206\u7c7b\uff0c\u53ea\u8bad\u7ec3\u4e86\u7ea60.035%\u7684\u53c2\u6570\uff08\u5927\u7ea63.8\u4e07\u53c2\u6570\uff09\u4fbf\u8fbe\u5230\u4e86\u4f18\u5f02\u6027\u80fd\u3002\u76f8\u6bd4108M\u5168\u53c2\u6570\u5fae\u8c03\uff0cLoRA\u5fae\u8c03\u53ea\u9700\u66f4\u65b0\u533a\u533a\u6570\u4e07\u53c2\u6570\uff0c\u8bad\u7ec3\u5f00\u9500\u548c\u6570\u636e\u9700\u6c42\u90fd\u5927\u5e45\u964d\u4f4e\u3002\u53c8\u5982\uff0c\u5728\u95ee\u7b54\u548c\u6458\u8981\u7b49\u751f\u6210\u4efb\u52a1\u4e0a\uff0c\u4eba\u4eec\u5e38\u7528LoRA\u6765\u5fae\u8c03GPT-2/GPT-3\u8fd9\u7c7b\u751f\u6210\u6a21\u578b\uff0c\u4f7f\u5176\u66f4\u597d\u5730\u6309\u7167\u6307\u4ee4\u8fdb\u884c\u56de\u7b54\u548c\u6458\u8981\u3002LoRA\u8bba\u6587\u62a5\u544a\u4e86\u5728GPT-3 (175B) \u4e0a\u7684\u5b9e\u9a8c\uff1a\u4f7f\u7528LoRA\u5728WikiSQL\u95ee\u7b54\u548cMNLI\u81ea\u7136\u8bed\u8a00\u63a8\u7406\u6570\u636e\u96c6\u4e0a\u8fdb\u884c\u5fae\u8c03\uff0c\u6700\u7ec8\u9a8c\u8bc1\u96c6\u51c6\u786e\u7387\u5168\u9762\u8d85\u8fc7\u4e86\u6b63\u5e38\u5168\u53c2\u6570\u5fae\u8c03\u548c\u5176\u4ed6\u65b9\u6cd5\u3002\u8fd9\u8bf4\u660eLoRA\u4e0d\u4ec5\u964d\u4f4e\u4e86\u8d44\u6e90\u8981\u6c42\uff0c\u540c\u6837\u9002\u7528\u4e8e\u5404\u7c7bNLP\u4e0b\u6e38\u4efb\u52a1\uff0c\u5e76\u4e0d\u727a\u7272\u6a21\u578b\u6548\u679c\u3002\u5728\u5bf9\u8bdd\u9886\u57df\uff0cLoRA\u66f4\u662f\u5927\u663e\u8eab\u624b\u3002\u65af\u5766\u798f\u5927\u5b66\u7684Alpaca\u6a21\u578b\u5c31\u662f\u4e00\u4e2a\u7ecf\u5178\u6848\u4f8b\uff1a\u4ed6\u4eec\u4ece7B\u53c2\u6570\u7684LLaMA\u57fa\u7840\u6a21\u578b\u51fa\u53d1\uff0c\u5229\u7528LoRA\u572852K\u6761\u6307\u4ee4\u8ddf\u968f\u6570\u636e\u4e0a\u8fdb\u884c\u4e86\u5fae\u8c03\uff0c\u8bad\u7ec3\u6210\u672c\u4e0d\u8db3600\u7f8e\u5143\uff0c\u5374\u5f97\u5230\u4e00\u4e2a\u6548\u679c\u53ef\u6bd4\u62dfGPT-3.5\u7684\u5bf9\u8bdd\u6a21\u578b\u3002\u66f4\u4ee4\u4eba\u77a9\u76ee\u7684\u662f\uff0c\u793e\u533a\u590d\u73b0\u7684Alpaca-LoRA\u9879\u76ee\u8bc1\u660e\uff0c\u4ec5\u9700\u6d88\u8d39\u7ea7\u7684\u786c\u4ef6\u5c31\u80fd\u518d\u73b0\u8fd9\u4e00\u6210\u679c\u2014\u2014LoRA\u5fae\u8c03\u540e\u7684Alpaca\u6a21\u578b\u751a\u81f3\u53ef\u4ee5\u5728\u6811\u8393\u6d3e\u4e0a\u8fd0\u884c\u63a8\u7406\u3002\u53ef\u89c1\uff0c\u5728\u5bf9\u8bdd\u673a\u5668\u4eba\u3001\u667a\u80fd\u95ee\u7b54\u7b49\u5e94\u7528\u4e2d\uff0cLoRA\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4f4e\u6210\u672c\u83b7\u53d6\u9ad8\u6027\u80fd\u6a21\u578b\u7684\u9014\u5f84\u3002</li> <li>\u591a\u8bed\u8a00\u8fc1\u79fb\u5b66\u4e60\uff1aLoRA\u4e5f\u88ab\u5e7f\u6cdb\u7528\u4e8e\u5c06\u6a21\u578b\u9002\u914d\u5230\u65b0\u7684\u8bed\u8a00\u73af\u5883\u4e2d\u3002\u4f8b\u5982\uff0c\u201cChinese-LLaMA\u201d\u9879\u76ee\u91c7\u7528LoRA\u6280\u672f\u5c06Meta\u7684LLaMA-2\u6a21\u578b\u5fae\u8c03\u5230\u4e2d\u6587\u6307\u4ee4\u6570\u636e\u96c6\u4e0a\uff0c\u4ec5\u8c03\u6574\u6781\u5c11\u91cf\u53c2\u6570\u5c31\u8ba9\u6a21\u578b\u5728\u4e2d\u6587\u7406\u89e3\u4e0e\u751f\u6210\u65b9\u9762\u7684\u80fd\u529b\u5927\u5e45\u63d0\u5347\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u7814\u7a76\u8005\u51bb\u7ed3\u82f1\u6587\u9884\u8bad\u7ec3\u7684LLaMA-2\u6743\u91cd\uff0c\u901a\u8fc7LoRA\u8bad\u7ec3\u4e00\u4e2a\u9488\u5bf9\u4e2d\u6587\u7684\u4f4e\u79e9\u66f4\u65b0\uff0c\u4ece\u800c\u83b7\u5f97\u201cChinese-LLaMA-2\u201d\u6a21\u578b\uff0c\u7528\u8f83\u5c0f\u4ee3\u4ef7\u5b9e\u73b0\u4e86\u4e2d\u82f1\u6587\u53cc\u8bed\u80fd\u529b\u7684\u878d\u5408\u3002\u7c7b\u4f3c\u5730\uff0c\u5bf9\u4e8e\u53ea\u6709\u82f1\u6587\u5927\u6a21\u578b\u4f46\u9700\u8981\u652f\u6301\u5176\u4ed6\u8bed\u8a00\u7684\u60c5\u51b5\uff0cLoRA\u63d0\u4f9b\u4e86\u4e00\u79cd\u9ad8\u6548\u7684\u8fc1\u79fb\u65b9\u6848\uff1a\u53ea\u9700\u5728\u76ee\u6807\u8bed\u8a00\u7684\u6570\u636e\u4e0a\u8bad\u7ec3\u4e00\u4e2aLoRA\u9002\u914d\u5668\uff0c\u65e0\u9700\u4ece\u96f6\u5f00\u59cb\u8bad\u7ec3\u6216\u5fae\u8c03\u6574\u6a21\u578b\u3002\u4f8b\u5982\uff0c\u6709\u56e2\u961f\u6210\u529f\u5730\u7528LoRA\u5c06\u4e00\u4e2a\u82f1\u6587\u5bf9\u8bdd\u6a21\u578b\u8c03\u6574\u4e3a\u540c\u65f6\u652f\u6301\u4e2d\u82f1\u53cc\u8bed\u5bf9\u8bdd\uff0c\u6240\u5f97\u6a21\u578b\u5728\u4e24\u79cd\u8bed\u8a00\u4e0a\u7684\u8868\u73b0\u90fd\u5f88\u4f18\u79c0\u3002\u8fd9\u4e9b\u5b9e\u8df5\u8868\u660e\uff0cLoRA\u5728\u8de8\u8bed\u8a00\u9002\u914d\u4e0a\u6548\u679c\u663e\u8457\u3002\u7531\u4e8e\u4e0d\u540c\u8bed\u8a00\u4e4b\u95f4\u5f80\u5f80\u5171\u4eab\u90e8\u5206\u9690\u542b\u8868\u793a\uff0cLoRA\u7684\u5c0f\u89c4\u6a21\u66f4\u65b0\u5c31\u80fd\u5f15\u5bfc\u6a21\u578b\u5b66\u4e60\u65b0\u7684\u8bed\u8a00\u6a21\u5f0f\uff0c\u540c\u65f6\u4fdd\u6301\u539f\u6709\u8bed\u8a00\u80fd\u529b\u3002\u76f8\u6bd4\u8bad\u7ec3\u4e00\u4e2a\u591a\u8bed\u79cd\u6a21\u578b\u6216\u8005\u5168\u53c2\u6570\u5fae\u8c03\uff0cLoRA\u65b9\u6848\u9ad8\u6548\u4e14\u7075\u6d3b\uff1a\u6211\u4eec\u53ef\u4ee5\u9488\u5bf9\u6bcf\u79cd\u65b0\u8bed\u8a00\u4fdd\u5b58\u4e00\u5957LoRA\u6743\u91cd\uff0c\u9700\u8981\u65f6\u52a0\u8f7d\u5230\u7edf\u4e00\u7684\u57fa\u7840\u6a21\u578b\u4e0a\u5373\u53ef\uff0c\u5b9e\u73b0\u4e00\u6a21\u578b\u591a\u8bed\u8a00\u7684\u76ee\u7684\u3002</li> <li>\u5f3a\u5316\u5b66\u4e60\u4eba\u7c7b\u53cd\u9988\uff08RLHF\uff09\u9636\u6bb5\u7684\u4f18\u5316\uff1a\u5728\u5927\u6a21\u578b\u5bf9\u9f50\uff08Alignment\uff09\u8fc7\u7a0b\u4e2d\uff0c\u5f80\u5f80\u9700\u8981\u7ecf\u8fc7\u6709\u76d1\u7763\u5fae\u8c03\uff08SFT\uff09\u3001\u5956\u52b1\u6a21\u578b\u8bad\u7ec3\uff08RM\uff09\u548c\u57fa\u4e8e\u4eba\u7c7b\u53cd\u9988\u7684\u5f3a\u5316\u5b66\u4e60\uff08RLHF\uff09\u8fd9\u4e09\u4e2a\u9636\u6bb5\u3002LoRA\u5728\u8fd9\u4e9b\u9636\u6bb5\u540c\u6837\u53d1\u6325\u4e86\u5de8\u5927\u4f5c\u7528\u3002\u6709\u5b9e\u8df5\u8868\u660e\uff0c\u53ef\u4ee5\u5728RLHF\u7684\u6bcf\u4e00\u6b65\u90fd\u91c7\u7528LoRA\u5fae\u8c03\u6765\u663e\u8457\u964d\u4f4e\u8bad\u7ec3\u6210\u672c\u3002\u4f8b\u5982\uff0c\u67d0\u9879\u76ee\u5728\u5bf9\u56fd\u5185\u5f00\u6e90\u7684\u767e\u5ddd-7B\u6a21\u578b\u8fdb\u884cRLHF\u5b9e\u9a8c\u65f6\uff0c\u4f7f\u7528LoRA\u5b8c\u6210\u4e86SFT\u5fae\u8c03\u6a21\u578b\u3001\u8bad\u7ec3\u5956\u52b1\u6a21\u578b\uff0c\u4ee5\u53caPPO\u5f3a\u5316\u5b66\u4e60\u5fae\u8c03\u8fd9\u4e09\u6b65\u5168\u8fc7\u7a0b\u3002\u7ed3\u679c\u53d1\u73b0\uff0c\u901a\u8fc7LoRA\u5fae\u8c03\uff0c\u4e0d\u4ec5\u6210\u529f\u5bf9\u6a21\u578b\u8fdb\u884c\u4e86\u5bf9\u9f50\u8bad\u7ec3\uff0c\u800c\u4e14\u7531\u4e8e\u6bcf\u4e00\u6b65\u8bad\u7ec3\u7684\u53c2\u6570\u5927\u5e45\u51cf\u5c11\uff0c\u8d44\u6e90\u6d88\u8017\u6bd4\u4f20\u7edf\u65b9\u6cd5\u4f4e\u5f88\u591a\u3002\u8c37\u6b4c\u7814\u7a76\u4eba\u5458\u4e5f\u66fe\u63d0\u51fa\u4e00\u79cd\u7ed3\u5408LoRA\u7684\u9ad8\u6548RLHF\u65b9\u6cd5\uff08\u79f0\u4e3a\u201cPErformant RLHF\u201d\uff0c\u7b80\u79f0 PERL\uff09\uff0c\u901a\u8fc7\u5728\u8bad\u7ec3\u5956\u52b1\u6a21\u578b\u548c\u7b56\u7565\u6a21\u578b\u65f6\u5e94\u7528LoRA\uff0c\u80fd\u591f\u5728\u51e0\u4e4e\u4e0d\u964d\u4f4e\u6548\u679c\u7684\u60c5\u51b5\u4e0b\u628a\u8ba1\u7b97\u6210\u672c\u964d\u5230\u539f\u6765\u7684\u5f88\u5c0f\u4e00\u90e8\u5206\u3002\u8fd9\u5bf9\u4e8e\u9700\u8981\u53cd\u590d\u8fed\u4ee3\u8c03\u4f18\u7684\u5927\u6a21\u578b\u5bf9\u9f50\u8fc7\u7a0b\u6765\u8bf4\u975e\u5e38\u5173\u952e\u2014\u2014\u4f7f\u7528LoRA\u53ef\u4ee5\u8ba9\u7814\u7a76\u8005\u5728\u5355\u673a\u751a\u81f3\u5355\u5361\u4e0a\u5c1d\u8bd5RLHF\u7684\u5404\u4e2a\u73af\u8282\uff0c\u52a0\u901f\u5b9e\u9a8c\u5faa\u73af\u5e76\u8282\u7ea6\u5f00\u9500\u3002\u603b\u800c\u8a00\u4e4b\uff0c\u5728\u6a21\u578b\u5bf9\u9f50\u548c\u4f18\u5316\u573a\u666f\u4e2d\uff0cLoRA\u540c\u6837\u662f\u91cd\u8981\u7684\u5e2e\u624b\uff0c\u4f7f\u5f97\u590d\u6742\u591a\u9636\u6bb5\u7684\u8bad\u7ec3\u6210\u4e3a\u53ef\u80fd\u3002</li> </ul>","tags":["LoRA","Post Training","LLM"]},{"location":"posts/LoRA%EF%BC%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BD%8E%E7%A7%A9%E5%AF%86%E8%AF%AD/#_2","title":"\u7ed3\u675f\u8bed","text":"<ul> <li>\u79e9\u523b\u753b\u4e86\u77e9\u9635\u6240\u542b\u201c\u6709\u6548\u4fe1\u606f\u7ef4\u5ea6\u201d\uff1bLoRA \u6b63\u662f\u5229\u7528\u6743\u91cd\u589e\u91cf\u7684\u4f4e\u79e9\u7279\u6027\uff0c\u901a\u8fc7\\(A,B\\)\u00a0\u5206\u89e3\u9ad8\u6548\u5730\u5b8c\u6210 LLM \u5fae\u8c03\u3002</li> <li>\u5c42\u9009\u62e9\u76f4\u63a5\u5f71\u54cd LoRA \u7684\u53c2\u6570\u2011\u6548\u679c\u6298\u8877\uff1a\u9ed8\u8ba4\u00a0\\(W_q+W_v\\)\u00a0\u5df2\u80fd\u7ed9\u51fa\u9ad8\u6027\u4ef7\u6bd4\uff1b\u5728\u7b97\u529b\u5141\u8bb8\u3001\u4e14\u4efb\u52a1\u5bf9\u6a21\u578b\u8868\u8fbe\u80fd\u529b\u8981\u6c42\u66f4\u9ad8\u65f6\uff0c\u53ef\u9010\u6b65\u6269\u5c55\u5230\u5176\u5b83\u7ebf\u6027\u5c42\u3002</li> </ul>","tags":["LoRA","Post Training","LLM"]},{"location":"posts/PPO%E5%8E%9F%E7%90%86%E5%8F%8A%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/","title":"PPO\u539f\u7406\u53ca\u907f\u5751\u6307\u5357","text":"\u6807\u7b7e\uff1a \u5f3a\u5316\u5b66\u4e60LLMPost Training","tags":["\u5f3a\u5316\u5b66\u4e60","LLM","Post Training"]},{"location":"posts/PPO%E5%8E%9F%E7%90%86%E5%8F%8A%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/#1-ppo","title":"1. PPO \u7b97\u6cd5\u539f\u7406","text":"<p>\u80cc\u666f\u4e0e\u52a8\u673a\uff1a Proximal Policy Optimization\uff08PPO\uff09\u7b97\u6cd5\u7531 OpenAI \u7684 John Schulman \u7b49\u4eba\u5728 2017 \u5e74\u63d0\u51fa\u3002\u5b83\u5c5e\u4e8e\u7b56\u7565\u68af\u5ea6\u65b9\u6cd5\u7684\u4e00\u79cd\u6539\u8fdb\uff0c\u65e8\u5728\u89e3\u51b3\u6807\u51c6\u7b56\u7565\u68af\u5ea6\u65b9\u6cd5\u4e0d\u7a33\u5b9a\u3001\u5927\u6b65\u66f4\u65b0\u5bb9\u6613\u5bfc\u81f4\u6027\u80fd\u5d29\u6e83\u7684\u95ee\u9898\u3002\u5728\u6b64\u4e4b\u524d\uff0cTrust Region Policy Optimization\uff08TRPO\uff09\u7b97\u6cd5\u901a\u8fc7\u5728\u7b56\u7565\u66f4\u65b0\u65f6\u52a0\u5165\u4e25\u683c\u7684 KL \u6563\u5ea6\u7ea6\u675f\u6765\u4fdd\u8bc1\u7b56\u7565\u6bcf\u6b21\u53ea\u505a\u5c0f\u5e45\u5ea6\u6539\u8fdb\uff0c\u4ece\u800c\u5b9e\u73b0\u7a33\u5b9a\u7684\u5355\u8c03\u63d0\u5347\uff0c\u4f46 TRPO \u9700\u8981\u4e8c\u9636\u5bfc\u6570\u548c\u590d\u6742\u7684\u5171\u8f6d\u68af\u5ea6\u7b97\u6cd5\u5b9e\u73b0\uff0c\u8ba1\u7b97\u4ee3\u4ef7\u9ad8\u4e14\u5b9e\u73b0\u590d\u6742\u3002PPO \u7684\u63d0\u51fa\u6b63\u662f\u4e3a\u4e86\u5728\u4fdd\u6301\u7b56\u7565\u66f4\u65b0\u7a33\u5b9a\u6027\u7684\u540c\u65f6\uff0c\u7b80\u5316\u5b9e\u73b0\u96be\u5ea6\u3002\u5b9e\u9a8c\u8868\u660e\uff0cPPO \u5728\u91c7\u6837\u6548\u7387\u3001\u6027\u80fd\u7a33\u5b9a\u6027\u4e0a\u53ef\u5ab2\u7f8e TRPO\uff0c\u4f46\u53ea\u9700\u4f7f\u7528\u4e00\u9636\u4f18\u5316\u65b9\u6cd5\uff08\u5982 SGD \u6216 Adam\uff09\u5373\u53ef\u5b9e\u73b0\uff0c\u65e0\u9700\u590d\u6742\u7684\u4e8c\u9636\u4f18\u5316\u3002</p> <p>PPO \u4e24\u79cd\u7b56\u7565\u66f4\u65b0\u65b9\u5f0f\uff1a PPO \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u7b56\u7565\u4f18\u5316\u65b9\u6cd5\u7684\u5bb6\u65cf\uff0c\u4e3b\u8981\u5305\u62ec\u4e24\u79cd\u53d8\u4f53\uff1a\u4e00\u662f\u5e26KL\u60e9\u7f5a\u9879\u7684\u65b9\u5f0f\uff08PPO-Penalty\uff09\uff0c\u5373\u5728\u76ee\u6807\u51fd\u6570\u4e2d\u52a0\u5165 KL \u6563\u5ea6\u60e9\u7f5a\u56e0\u5b50\uff0c\u52a8\u6001\u8c03\u6574\u5176\u6743\u91cd\uff0c\u4f7f\u65b0\u65e7\u7b56\u7565\u7684 KL \u6563\u5ea6\u7ef4\u6301\u5728\u671f\u671b\u8303\u56f4\uff1b\u4e8c\u662f\u66f4\u5e38\u7528\u7684\u622a\u65ad\u7b56\u7565\u76ee\u6807\uff08PPO-Clip\uff09\uff0c\u5373\u76f4\u63a5\u5728\u76ee\u6807\u51fd\u6570\u4e2d\u5bf9\u65b0\u65e7\u7b56\u7565\u7684\u6982\u7387\u6bd4\u7387\u8fdb\u884c\u88c1\u526a\uff0c\u4ee5\u9650\u5236\u6bcf\u6b21\u66f4\u65b0\u7684\u5e45\u5ea6\u3002\u5b9e\u8df5\u4e2d\uff0cPPO-Clip \u56e0\u4e3a\u5b9e\u73b0\u7b80\u5355\u3001\u7a33\u5b9a\u6027\u597d\u800c\u6210\u4e3a\u4e3b\u6d41\uff0c\u4e5f\u5c31\u662f OpenAI \u7b49\u673a\u6784\u4f7f\u7528\u7684\u9ed8\u8ba4\u7248\u672c\u3002\u4e0b\u9762\u5c06\u91cd\u70b9\u4ecb\u7ecd\u622a\u65ad\u7248 PPO \u7684\u6838\u5fc3\u601d\u60f3\u548c\u76ee\u6807\u51fd\u6570\u8bbe\u8ba1\u3002</p> <p>\u622a\u65ad\u76ee\u6807\u51fd\u6570\uff1a PPO-Clip \u7684\u5173\u952e\u5728\u4e8e\u5b9a\u4e49\u6982\u7387\u6bd4\u7387\\(r_t(\\theta)\\)\u6765\u5ea6\u91cf\u65b0\u65e7\u7b56\u7565\u5728\u540c\u4e00\u52a8\u4f5c\u4e0a\u7684\u6982\u7387\u53d8\u5316\u5e45\u5ea6\uff1a</p> \\[r_t(\\theta) \\;=\\; \\frac{\\pi_{\\theta}(a_t \\mid s_t)}{\\pi_{\\theta_{\\text{old}}}(a_t \\mid s_t)} ,\\] <p>\u5176\u4e2d\\(\\pi_{\\theta}\\)\u662f\u5f53\u524d\u7b56\u7565\uff0c\\(\\pi_{\\theta_{\\text{old}}}\\)\u662f\u7b56\u7565\u66f4\u65b0\u524d\u7684\u65e7\u7b56\u7565\u3002\u5982\u679c\\(r_t(\\theta) &gt; 1\\)\uff0c\u8868\u793a\u65b0\u7b56\u7565\u5728\u72b6\u6001\\(s_t\\)\u4e0b\u8ba9\u52a8\u4f5c\\(a_t\\)\u66f4\u52a0\u8d8b\u5411\u4e8e\u53d1\u751f\uff1b\u53cd\u4e4b\u82e5\\(r_t(\\theta) &lt; 1\\)\uff0c\u5219\u65b0\u7b56\u7565\u964d\u4f4e\u4e86\u8be5\u52a8\u4f5c\u7684\u6982\u7387\u3002\u4e3a\u4e86\u907f\u514d\\(r_t(\\theta)\\)\u504f\u79bb1\u8fc7\u591a\uff08\u5bf9\u5e94\u7b56\u7565\u6539\u53d8\u592a\u5927\uff09\uff0cPPO \u5f15\u5165\u4e86\u622a\u65ad\u526a\u5207\u64cd\u4f5c\u3002\u622a\u65ad\u7248\u7b56\u7565\u68af\u5ea6\u7684\u76ee\u6807\u51fd\u6570\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a</p> \\[L_{\\text{CLIP}}(\\theta) \\;=\\; \\mathbb{E}_t\\Big[\\,\\min\\big(r_t(\\theta)\\,\\hat{A}_t,\\;\\text{clip}\\big(r_t(\\theta),\\,1-\\varepsilon,\\,1+\\varepsilon\\big)\\,\\hat{A}_t\\big)\\Big],\\] <p>\u5176\u4e2d\\(\\hat{A}_t\\)\u662f\u4f18\u52bf\u51fd\u6570\u7684\u4f30\u8ba1\uff0c\\(\\varepsilon\\)\u662f\u4e00\u4e2a\u5c0f\u7684\u8d85\u53c2\u6570\uff08\u4f8b\u5982 0.1 \u6216 0.2\uff09\u3002\u8fd9\u4e2a\u76ee\u6807\u51fd\u6570\u53d6\u539f\u59cb\u6982\u7387\u6bd4\u7387\u4f18\u52bf\\(r_t(\\theta)\\hat{A}_t\\)\u548c\u622a\u65ad\u540e\u7684\u6982\u7387\u6bd4\u7387\u4f18\u52bf\u4e24\u8005\u4e2d\u7684\u8f83\u5c0f\u503c\uff0c\u4ece\u800c\u5b9e\u73b0\u5bf9\u7b56\u7565\u66f4\u65b0\u5e45\u5ea6\u7684\u9650\u5236\u3002\u5f53\u4f18\u52bf\\(\\hat{A}_t\\)\u4e3a\u6b63\u65f6\uff0c\u5982\u679c\\(r_t(\\theta)\\)\u5c1d\u8bd5\u589e\u5927\u8d85\u8fc7\\((1+\\varepsilon)\\)\uff0c\u622a\u65ad\u64cd\u4f5c\u4f1a\u963b\u6b62\u7b56\u7565\u4f18\u52bf\u7ee7\u7eed\u53d8\u5927\uff1b\u5f53\u4f18\u52bf\u4e3a\u8d1f\u65f6\uff0c\u82e5\\(r_t(\\theta)\\)\u964d\u4f4e\u5230\u5c0f\u4e8e\\((1-\\varepsilon)\\)\uff0c\u622a\u65ad\u4e5f\u4f1a\u963b\u6b62\u7b56\u7565\u8fc7\u5ea6\u51cf\u5c0f\u8be5\u52a8\u4f5c\u6982\u7387\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0cPPO \u5728\u76ee\u6807\u51fd\u6570\u5c42\u9762\u5185\u5d4c\u4e86\u5bf9\u7b56\u7565\u66f4\u65b0\u5e45\u5ea6\u7684\u9650\u5236\uff0c\u8fd1\u4f3c\u5b9e\u73b0\u4e86 TRPO \u7684\u201c\u4fe1\u8d56\u57df\u201d\u6548\u679c\uff0c\u800c\u65e0\u9700\u663e\u5f0f\u8ba1\u7b97\u4e8c\u9636\u68af\u5ea6\u6216\u8fdb\u884c\u7ea6\u675f\u4f18\u5316\u3002</p> <p></p> <p>\u56fe1\uff1aPPO \u622a\u65ad\u7b56\u7565\u76ee\u6807\u793a\u610f\u56fe\u3002\u5de6\u56fe\u8868\u793a\u4f18\u52bf\\(A\\)\u4e3a\u6b63\u7684\u60c5\u5f62\uff0c\u53f3\u56fe\u4e3a\u4f18\u52bf\\(A\\)\u4e3a\u8d1f\u65f6\u7684\u60c5\u5f62\uff0c\u7ea2\u70b9\u8868\u793a\u7b56\u7565\u66f4\u65b0\u7684\u8d77\u59cb\u4f4d\u7f6e\uff08\\(r=1\\) \u5bf9\u5e94\u65e7\u7b56\u7565\uff09\u3002</p> <p>\u901a\u8fc7\u4e0a\u8ff0\u622a\u65ad\u7b56\u7565\uff0cPPO \u7684\u7b56\u7565\u4f18\u5316\u66f4\u52a0\u4fdd\u5b88\u7a33\u5b9a\uff1a\u5f53\u7b56\u7565\u66f4\u65b0\u5bf9\u63d0\u5347\u6536\u76ca\u975e\u5e38\u6709\u5229\u65f6\uff0c\u4e5f\u4e0d\u4f1a\u56e0\u4e3a\u8d2a\u5fc3\u800c\u8d70\u5f97\u592a\u8fdc\uff1b\u5f53\u7b56\u7565\u66f4\u65b0\u65b9\u5411\u662f\u6709\u5bb3\u7684\uff0c\u622a\u65ad\u673a\u5236\u5219\u4f1a\u7ed9\u4e88\u663e\u8457\u7684\u60e9\u7f5a\uff0c\u4fc3\u4f7f\u68af\u5ea6\u53cd\u5411\u63a8\u52a8\u7b56\u7565\u671d\u7ea0\u6b63\u65b9\u5411\u53d1\u5c55\u3002\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cPPO \u8bba\u6587\u4e5f\u63a2\u8ba8\u4e86\u4f7f\u7528\u81ea\u9002\u5e94 KL \u60e9\u7f5a\u7684\u65b9\u6cd5\uff08PPO-Penalty\uff09\uff0c\u5373\u7ed9\u76ee\u6807\u51fd\u6570\u6dfb\u52a0\\(\\beta \\cdot \\mathrm{KL}(\\pi_{\\theta_{\\text{old}}}|\\pi_{\\theta})\\)\u60e9\u7f5a\u9879\u5e76\u52a8\u6001\u8c03\u6574\u7cfb\u6570\\(\\beta\\)\u63a7\u5236\u65b0\u65e7\u7b56\u7565\u8ddd\u79bb\u3002\u7136\u800c\u5b9e\u9a8c\u8bc1\u660e\u526a\u5207\u6cd5\uff08PPO-Clip\uff09\u5728\u5b9e\u73b0\u7b80\u5355\u6027\u7684\u540c\u65f6\uff0c\u80fd\u53d6\u5f97\u66f4\u597d\u7684\u7a33\u5b9a\u6027\u80fd\uff0c\u56e0\u6b64 PPO-Clip \u66f4\u4e3a\u5e38\u7528\u3002</p> <p>\u4e0e TRPO \u7684\u6bd4\u8f83\uff1a \u603b\u7684\u6765\u8bf4\uff0cPPO \u5ef6\u7eed\u4e86 TRPO\u201c\u9650\u5236\u7b56\u7565\u6539\u53d8\u91cf\u201d\u7684\u601d\u60f3\uff0c\u90fd\u65e8\u5728\u9632\u6b62\u7b56\u7565\u66f4\u65b0\u6b65\u957f\u8fc7\u5927\u5f15\u8d77\u6027\u80fd\u5d29\u6e83\u3002\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e TRPO \u901a\u8fc7\u4e8c\u9636\u8fd1\u4f3c\u548c\u7ea6\u675f\u4f18\u5316\u4e25\u683c\u9650\u5236 KL \u6563\u5ea6\uff0c\u800c PPO \u5219\u901a\u8fc7\u4fee\u6539\u76ee\u6807\u51fd\u6570\uff08\u526a\u5207\u6216\u8f6f\u7ea6\u675f\uff09\u5b9e\u73b0\u7c7b\u4f3c\u6548\u679c\uff0c\u7b97\u6cd5\u5b9e\u73b0\u66f4\u52a0\u7b80\u5355\u9ad8\u6548\u3002\u8fd9\u4f7f\u5f97 PPO \u66f4\u6613\u4e8e\u5728\u590d\u6742\u7b56\u7565\u7f51\u7edc\uff08\u4f8b\u5982\u5e26\u5171\u4eab\u53c2\u6570\u7684 actor-critic \u67b6\u6784\uff09\u4e2d\u5e94\u7528\uff0c\u5e76\u652f\u6301\u76f4\u63a5\u7528\u81ea\u52a8\u5fae\u5206\u6846\u67b6\u5b9e\u73b0\u68af\u5ea6\u66f4\u65b0\u3002\u5b9e\u8df5\u7ecf\u9a8c\u8868\u660e\uff0cPPO \u901a\u5e38\u66f4\u5bb9\u6613\u8c03\u53c2\uff0c\u9002\u7528\u8303\u56f4\u66f4\u5e7f\uff0c\u800c\u6536\u655b\u6027\u80fd\u4e0e TRPO \u76f8\u5f53\u751a\u81f3\u66f4\u4f18\u3002\u51ed\u501f\u5728\u8fde\u7eed\u63a7\u5236\u3001\u79bb\u6563\u52a8\u4f5c\uff08Atari \u6e38\u620f\uff09\u7b49\u5404\u79cd\u4efb\u52a1\u4e2d\u7684\u51fa\u8272\u8868\u73b0\uff0cPPO \u5df2\u6210\u4e3a\u6df1\u5ea6\u5f3a\u5316\u5b66\u4e60\u9886\u57df\u5e94\u7528\u6700\u5e7f\u6cdb\u7684\u7b56\u7565\u4f18\u5316\u7b97\u6cd5\u4e4b\u4e00\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM","Post Training"]},{"location":"posts/PPO%E5%8E%9F%E7%90%86%E5%8F%8A%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/#2-ppo-pytorch","title":"2. PPO \u7684 PyTorch \u5b9e\u73b0","text":"<p>\u6574\u4f53\u7ed3\u6784\uff1a PPO \u901a\u5e38\u91c7\u7528 Actor-Critic \u67b6\u6784\u5b9e\u73b0\uff0c\u5176\u4e2d\u5305\u542b\u7b56\u7565\u7f51\u7edc\uff08Actor\uff09\u548c\u4ef7\u503c\u7f51\u7edc\uff08Critic\uff09\u3002\u53ef\u4ee5\u5c06 Actor \u548c Critic \u96c6\u6210\u5728\u540c\u4e00\u4e2a\u6a21\u578b\u4e2d\uff0c\u5171\u4eab\u90e8\u5206\u5c42\u7136\u540e\u8f93\u51fa\u5404\u81ea\u7684\u7ed3\u679c\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e24\u4e2a\u72ec\u7acb\u7684\u795e\u7ecf\u7f51\u7edc\u3002\u4e00\u4e2a\u7ecf\u5178\u8bbe\u8ba1\u662f\u5171\u4eab\u4e00\u4e2a\u9690\u5c42\u8868\u793a\uff0c\u7136\u540e Actor \u8f93\u51fa\u52a8\u4f5c\u5206\u5e03\u53c2\u6570\uff08\u5bf9\u4e8e\u8fde\u7eed\u52a8\u4f5c\u73af\u5883\u901a\u5e38\u8f93\u51fa\u5747\u503c\u548c\u5bf9\u6570\u6807\u51c6\u5dee\uff0c\u7528\u4e8e\u6784\u9020\u9ad8\u65af\u5206\u5e03\uff1b\u5bf9\u4e8e\u79bb\u6563\u52a8\u4f5c\u5219\u8f93\u51fa\u5404\u52a8\u4f5c\u7684\u6982\u7387\uff09\uff0cCritic \u8f93\u51fa\u5bf9\u5e94\u72b6\u6001\u7684\u4ef7\u503c\u4f30\u8ba1\\(V(s)\\)\u3002\u4e0b\u9762\u662f\u4e00\u6bb5 PPO \u7b97\u6cd5\u6838\u5fc3\u8bad\u7ec3\u6b65\u9aa4\u7684 PyTorch \u98ce\u683c\u4ee3\u7801\u793a\u4f8b\uff08\u4e3a\u4fbf\u4e8e\u8bf4\u660e\u505a\u4e86\u7b80\u5316\uff0c\u7701\u7565\u4e86\u5e76\u884c\u91c7\u6837\u3001\u71b5\u5956\u52b1\u7b49\u5de5\u7a0b\u7ec6\u8282\uff09\uff1a</p> <pre><code># \u5047\u8bbe actor_critic \u662f\u5305\u542b\u7b56\u7565\u548c\u4ef7\u503c\u7684\u6a21\u578b\uff0c\u5df2\u83b7\u5f97\u91c7\u6837\u6570\u636e\uff1aold_states, old_actions, old_log_probs, returns, advantages\noptimizer = optim.Adam(actor_critic.parameters(), lr=3e-4)\nfor epoch in range(epochs):                          # \u5bf9\u540c\u4e00\u6279\u6570\u636e\u8fdb\u884c\u591a\u8f6e\u66f4\u65b0\n    indices = np.random.permutation(len(old_states)) # \u6253\u4e71\u7d22\u5f15\u5b9e\u73b0\u5c0f\u6279\u91cf\n    for start_idx in range(0, len(old_states), batch_size):\n        mb_idx = indices[start_idx : start_idx + batch_size]\n        states_b = old_states[mb_idx]\n        actions_b = old_actions[mb_idx]\n        old_log_b = old_log_probs[mb_idx]\n        returns_b = returns[mb_idx]\n        adv_b    = advantages[mb_idx]\n\n        # \u524d\u5411\u8ba1\u7b97\u7b56\u7565\u548c\u4ef7\u503c\n        mean, logstd, value_b = actor_critic(states_b)\n        dist = torch.distributions.Normal(mean, logstd.exp())   # \u8fde\u7eed\u52a8\u4f5c\u7b56\u7565\u5206\u5e03\n        new_log_probs = dist.log_prob(actions_b).sum(dim=-1, keepdim=True)\n        # \u8ba1\u7b97\u6982\u7387\u6bd4\u7387 r(\u03b8)\n        ratio = torch.exp(new_log_probs - old_log_b)\n\n        # \u8ba1\u7b97\u622a\u65ad\u7b56\u7565\u635f\u5931 L_CLIP\n        surr1 = ratio * adv_b\n        surr2 = torch.clamp(ratio, 1.0 - clip_param, 1.0 + clip_param) * adv_b\n        policy_loss = -torch.min(surr1, surr2).mean()           # \u53d6\u8d1f\u53f7\u8f6c\u5316\u4e3a\u635f\u5931\uff08\u68af\u5ea6\u4e0b\u964d\u6700\u5c0f\u5316\uff09\n\n        # \u8ba1\u7b97\u4ef7\u503c\u51fd\u6570\u635f\u5931\n        value_loss = F.mse_loss(value_b, returns_b)\n\n        # \u603b\u635f\u5931\uff08\u71b5\u5956\u52b1\u9879\u6b64\u5904\u7701\u7565\uff09\n        loss = policy_loss + vf_coef * value_loss\n        optimizer.zero_grad()\n        loss.backward()\n        nn.utils.clip_grad_norm_(actor_critic.parameters(), max_grad_norm)  # \u68af\u5ea6\u88c1\u526a\n        optimizer.step()\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u5b9e\u73b0\u4e86 PPO \u66f4\u65b0\u7684\u6838\u5fc3\u6b65\u9aa4\uff1a\u9996\u5148\u5229\u7528\u5f53\u524d\u7b56\u7565\u7f51\u7edc\u8ba1\u7b97\u7ed9\u5b9a\u72b6\u6001\u6279\u6b21\u7684\u52a8\u4f5c\u6982\u7387 new_log_probs \u548c\u72b6\u6001\u4ef7\u503c value_b\uff0c\u7136\u540e\u8ba1\u7b97\u65b0\u65e7\u7b56\u7565\u7684\u6982\u7387\u6bd4\u7387 <code>ratio</code>\u3002\u63a5\u7740\u6784\u9020\u672a\u622a\u65ad\u7684\u7b56\u7565\u6536\u76ca <code>surr1 = ratio * advantage</code> \u548c\u622a\u65ad\u540e\u7684\u6536\u76ca <code>surr2 = clamp(ratio, 1-\u03b5, 1+\u03b5) * advantage</code>\uff0c\u53d6\u4e24\u8005\u7684\u6700\u5c0f\u503c\u5e76\u52a0\u8d1f\u53f7\u6c42\u5e73\u5747\u4f5c\u4e3a\u7b56\u7565\u635f\u5931\uff08\u5373\\(-L_{\\text{CLIP}}\\)\uff09\u3002\u4ef7\u503c\u51fd\u6570\u635f\u5931\u5219\u4f7f\u7528MSE\u5c06 Critic \u8f93\u51fa\u7684\u4ef7\u503c\\(V(s)\\)\u56de\u5f52\u5230\u5b9e\u9645\u7684\u56de\u62a5\uff08\u6216\u79f0 returns\uff0c\u901a\u5e38\u91c7\u7528TD(lambda)\u6216\u8499\u7279\u5361\u6d1b\u65b9\u5f0f\u8ba1\u7b97)\u3002\u603b\u635f\u5931\u662f\u4e24\u8005\u52a0\u6743\u548c\uff08\u4ee3\u7801\u4e2d\u7b56\u7565\u635f\u5931\u548c\u4ef7\u503c\u635f\u5931\u7cfb\u6570 vf_coef \u901a\u5e38\u53d6 1.0\uff1b\u82e5\u6dfb\u52a0\u71b5\u5956\u52b1\u8fd8\u9700\u51cf\u53bb entropy_coef\\(\\times\\)\u71b5\uff09\u3002\u7136\u540e\u5bf9\u603b\u635f\u5931\u6267\u884c\u53cd\u5411\u4f20\u64ad\uff0c\u5e76\u8fdb\u884c\u68af\u5ea6\u88c1\u526a\u4ee5\u589e\u5f3a\u8bad\u7ec3\u7a33\u5b9a\u6027\uff0c\u6700\u540e\u66f4\u65b0\u7f51\u7edc\u53c2\u6570\u3002</p> <p>\u91c7\u6837\u4e0e\u8bad\u7ec3\u6d41\u7a0b\uff1a PPO \u7684\u8bad\u7ec3\u9075\u5faa\u201c\u4ea4\u66ff\u91c7\u6837-\u66f4\u65b0\u201d\u7684\u5faa\u73af\u8fc7\u7a0b\u3002\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u91c7\u6837\u6570\u636e\uff1a \u5728\u5f53\u524d\u7b56\u7565\\(\\pi_{\\theta_{\\text{old}}}\\)\u4e0b\uff0c\u4e0e\u73af\u5883\u4ea4\u4e92\u91c7\u96c6\u4e00\u6279\u8f68\u8ff9\u6570\u636e\uff08\u53ef\u4ee5\u5e76\u884c\u591a\u4e2a\u73af\u5883\u52a0\u901f\u6536\u96c6\uff09\u3002\u6bcf\u6761\u8f68\u8ff9\u957f\u5ea6\u4e3a\\(T\\)\uff0c\u6c47\u603b\u5f97\u5230\u4e00\u4e2a\u5305\u542b\\(N\\)\u6761\u6570\u636e\uff08\u72b6\u6001-\u52a8\u4f5c-\u5956\u52b1\u5e8f\u5217\uff09\u7684\u6279\u6b21\u3002\u901a\u5e38 \\(N=\\text{batch_size}\\)\u4f1a\u8bbe\u5f97\u8f83\u5927\u4ee5\u964d\u4f4e\u7b56\u7565\u68af\u5ea6\u7684\u65b9\u5dee\uff0c\u5982 2048\u30014096 \u7b49\u3002</li> <li>\u8ba1\u7b97\u5956\u52b1\u4e0e\u4f18\u52bf\uff1a \u6839\u636e\u6536\u96c6\u5230\u7684\u6bcf\u6761\u8f68\u8ff9\uff0c\u8ba1\u7b97\u6bcf\u4e2a\u65f6\u95f4\u6b65\u7684\u7d2f\u79ef\u6298\u6263\u56de\u62a5\uff08\u79f0\u4e3a \u8fd4\u56de\uff09\u3002\u5229\u7528\u4ef7\u503c\u7f51\u7edc\uff08Critic\uff09\u4f30\u8ba1\u6bcf\u4e2a\u72b6\u6001\u7684\u57fa\u51c6\u503c\\(V(s_t)\\)\uff0c\u7531\u6b64\u8ba1\u7b97\u4f18\u52bf\u51fd\u6570\u4f30\u8ba1\\(\\hat{A}_t = G_t - V(s_t)\\)\uff0c\u5176\u4e2d\\(G_t\\)\u662f\u8be5\u72b6\u6001\u8d77\u59cb\u7684\u6298\u6263\u7d2f\u8ba1\u56de\u62a5\u3002\u4e3a\u964d\u4f4e\u65b9\u5dee\u3001\u63d0\u9ad8\u4f18\u52bf\u4f30\u8ba1\u7684\u7a33\u5065\u6027\uff0c\u4e00\u822c\u4f7f\u7528\u5e7f\u4e49\u4f18\u52bf\u4f30\u8ba1\uff08GAE\uff09\u65b9\u6cd5\u6765\u5e73\u6ed1\u8ba1\u7b97\\(\\hat{A}_t\\)\u3002GAE \u5728\u8ba1\u7b97\u4f18\u52bf\u65f6\u5f15\u5165\u4e86\u53c2\u6570\\(\\lambda\\)\uff08\u5982 0.95\uff09\u6765\u6298\u4e2d\u504f\u5dee\u548c\u65b9\u5dee\uff0c\u4f7f\u5f97\u4f18\u52bf\u4f30\u8ba1\u66f4\u7a33\u5b9a\u3002</li> <li>\u6784\u9020 PPO \u635f\u5931\uff1a \u5c06\u91c7\u6837\u5f97\u5230\u7684\u6570\u636e\u89c6\u4e3a\u56fa\u5b9a\u6570\u636e\u96c6\uff0c\u4ee5\u65e7\u7b56\u7565\\(\\pi_{\\theta_{\\text{old}}}\\)\u4e3a\u53c2\u8003\u8ba1\u7b97\u6982\u7387\u6bd4\\(r_t(\\theta)\\)\uff0c\u6784\u5efa\u526a\u5207\u7b56\u7565\u76ee\u6807\\(L_{\\text{CLIP}}(\\theta)\\)\u548c\uff08\u53ef\u9009\u7684\uff09\u4ef7\u503c\u635f\u5931\u3001\u71b5\u9879\u7b49\uff0c\u5f97\u5230\u5b8c\u6574\u7684 PPO \u635f\u5931\u51fd\u6570\uff08\u89c1\u4e0a\u6587\u516c\u5f0f\u548c\u4ee3\u7801\u5b9e\u73b0\uff09\u3002</li> <li>\u591a\u8f6e\u68af\u5ea6\u66f4\u65b0\uff1a \u5728\u4fdd\u6301\u91c7\u6837\u6570\u636e\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u968f\u673a\u68af\u5ea6\u4e0a\u5347\uff08\u5b9e\u73b0\u4e0a\u7b49\u4ef7\u4e8e\u5bf9\u4e0a\u8ff0\u603b\u635f\u5931\u4e0b\u964d\uff09\u5bf9\u7b56\u7565\u7f51\u7edc\u548c\u4ef7\u503c\u7f51\u7edc\u6267\u884c\\(K\\)\u8f6e\u66f4\u65b0\u3002\u6bcf\u8f6e\u4ece\u91c7\u6837\u6279\u6b21\u4e2d\u6309\u4e00\u5b9a minibatch \u5927\u5c0f\u62bd\u53d6\u5c0f\u6279\u6570\u636e\uff0c\u8ba1\u7b97\u68af\u5ea6\u5e76\u66f4\u65b0\u53c2\u6570\u3002\u8fd9\u6837\u91cd\u590d\u591a\u6b21\uff0c\u4ee5\u5145\u5206\u5229\u7528\u6bcf\u6279\u6837\u672c\u3002</li> <li>\u66f4\u65b0\u65e7\u7b56\u7565\u53c2\u6570\uff1a \u5c06\\(\\theta_{\\text{old}} \\leftarrow \\theta\\)\uff0c\u5373\u5c06\u65b0\u53c2\u6570\u4f5c\u4e3a\u4e0b\u6b21\u91c7\u6837\u7684\u65e7\u7b56\u7565\uff0c\u7ee7\u7eed\u4e0b\u4e00\u5faa\u73af\u3002\u901a\u5e38\u91cd\u590d\u4e0a\u8ff0\u5faa\u73af\u76f4\u81f3\u6536\u655b\u6216\u8bad\u7ec3\u6b65\u6570\u8017\u5c3d\u3002</li> </ol> <p></p> <p>\u56fe2\uff1aPPO \u7b97\u6cd5\u6574\u4f53\u8bad\u7ec3\u6d41\u7a0b\u793a\u610f\u3002Actor \u4ece\u73af\u5883\u72b6\u6001\\(s\\) \u4ea7\u751f\u52a8\u4f5c\\(a\\) \u4e0e\u73af\u5883\u4ea4\u4e92\u6536\u96c6\u5956\u52b1\\(r\\)_\uff0cCritic \u4f30\u8ba1\u72b6\u6001\u4ef7\u503c\u7528\u4e8e\u4f18\u52bf\u8ba1\u7b97\u3002\u7ecf\u9a8c\u6570\u636e\u5b58\u5165\u56de\u653e\u7f13\u51b2\uff08PPO\u4e2d\u4e00\u822c\u4e0d\u91cd\u590d\u4f7f\u7528\u65e7\u6570\u636e\uff0c\u5373 on-policy\uff0c\u6bcf\u6b21\u66f4\u65b0\u540e\u6e05\u7a7a\u7f13\u51b2\uff09\u3002\u4e00\u5b9a\u6b65\u957f\u540e\uff0c\u5c06\u6536\u96c6\u7684\u6570\u636e\u7528\u4e8e\u591a\u8f6e\u7b56\u7565\u7f51\u7edc\u548c\u4ef7\u503c\u7f51\u7edc\u7684\u66f4\u65b0\uff08\u56fe\u4e2d\u201cUpdate\u201d\u6b65\u9aa4\uff09\uff0c\u66f4\u65b0\u5b8c\u6210\u540e\u91cd\u7f6e\u65e7\u7b56\u7565\uff0c\u518d\u6b21\u91c7\u96c6\u6570\u636e\u3002</p> <p>PyTorch \u5b9e\u73b0\u4e2d\uff0c\u4e0a\u8ff0\u5faa\u73af\u5e38\u8868\u73b0\u4e3a\u4e24\u4e2a\u5d4c\u5957\u7684<code>for</code>\u5faa\u73af\uff1a\u5916\u5c42\u5faa\u73af\u5904\u7406\u91c7\u6837-\u66f4\u65b0\u8fed\u4ee3\uff0c\u5185\u5c42\u5faa\u73af\u5bf9\u6bcf\u6279\u6570\u636e\u8fdb\u884c\\(K\\)\u6b21\u5c0f\u6279\u91cf\u4f18\u5316\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u5b9e\u73b0\u7ec6\u8282\u4e0a\uff0c\u4e3a\u4e86\u63d0\u5347\u6027\u80fd\u548c\u6548\u679c\uff0c\u901a\u5e38\u4f1a\u5bf9\u4f18\u52bf\u8fdb\u884c\u6807\u51c6\u5316\u5904\u7406\uff08\u51cf\u53bb\u5747\u503c\u9664\u4ee5\u6807\u51c6\u5dee\uff09\uff0c\u5bf9\u6bcf\u4e2a\u5c0f\u6279\u91cd\u65b0\u8ba1\u7b97\u7b56\u7565\u7684 log\u6982\u7387\u548c\u4ef7\u503c\u4ee5\u4fdd\u8bc1\u5bf9\u5e94\u5f53\u524d\u53c2\u6570\uff0c\u7b49\u7b49\u3002\u8fd9\u4e9b\u5de5\u7a0b\u7ec6\u8282\u5728\u5f88\u591a\u5f00\u6e90\u5b9e\u73b0\uff08\u5982 OpenAI Baselines\u3001CleanRL \u7b49\uff09\u4e2d\u6709\u4f53\u73b0\uff0c\u76f8\u5173\u7814\u7a76\u4e5f\u603b\u7ed3\u4e86 PPO \u5b9e\u73b0\u9700\u8981\u6ce8\u610f\u7684\u8bf8\u591a\u7ec6\u8282\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM","Post Training"]},{"location":"posts/PPO%E5%8E%9F%E7%90%86%E5%8F%8A%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/#3","title":"3. \u5e38\u89c1\u9677\u9631\u4e0e\u8c03\u8bd5\u5efa\u8bae","text":"<p>\u5c3d\u7ba1 PPO \u7b97\u6cd5\u76f8\u5bf9\u7a33\u5b9a\u548c\u9c81\u68d2\uff0c\u4f46\u5728\u5b9e\u9645\u8bad\u7ec3\u4e2d\u4ecd\u6709\u8bb8\u591a\u8d85\u53c2\u6570\u9009\u62e9\u548c\u5b9e\u73b0\u7ec6\u8282\u4f1a\u663e\u8457\u5f71\u54cd\u6548\u679c\u3002\u4ee5\u4e0b\u603b\u7ed3 PPO \u5b9e\u9a8c\u4e2d\u5e38\u89c1\u7684\u9677\u9631\u548c\u8c03\u4f18\u5efa\u8bae\uff1a</p> <ul> <li>\u5b66\u4e60\u7387\uff08Learning Rate\uff09\uff1a \u5b66\u4e60\u7387\u8fc7\u9ad8\u65f6\uff0c\u7b56\u7565\u66f4\u65b0\u6b65\u4f10\u8fc7\u5927\uff0c\u53ef\u80fd\u5bfc\u81f4\u8bad\u7ec3\u4e0d\u7a33\u5b9a\u751a\u81f3\u6536\u76ca\u5d29\u584c\uff1b\u5b66\u4e60\u7387\u8fc7\u4f4e\u5219\u6536\u655b\u7f13\u6162\uff0c\u96be\u4ee5\u8fbe\u5230\u6700\u4f18\u8868\u73b0\u3002\u4e00\u822c\u91c7\u7528\u81ea\u9002\u5e94\u77e9\u4f30\u8ba1\u4f18\u5316\u5668\uff08Adam\uff09\u5e76\u9700\u6839\u636e\u4efb\u52a1\u8c03\u6574\u5b66\u4e60\u7387\uff0c\u5178\u578b\u53d6\u503c\u5728\\(10^{-4}\\)\u91cf\u7ea7\u3002\u53ef\u4ee5\u901a\u8fc7\u76d1\u63a7\u8bad\u7ec3\u66f2\u7ebf\u7684\u6ce2\u52a8\u6765\u8c03\u8282\u5b66\u4e60\u7387\uff1a\u82e5\u89c2\u5bdf\u5230\u7b56\u7565\u6536\u76ca\u5267\u70c8\u9707\u8361\u6216\u4e0b\u964d\uff0c\u5e94\u9002\u5f53\u964d\u4f4e\u5b66\u4e60\u7387\uff1b\u53cd\u4e4b\u6536\u655b\u8fc7\u6162\u5219\u53ef\u914c\u60c5\u63d0\u9ad8\u3002</li> <li>\u526a\u5207\u7cfb\u6570 \\(\\varepsilon\\)\uff1a \u9009\u62e9\u5408\u9002\u7684\u88c1\u526a\u8303\u56f4\u5bf9\u4e8ePPO\u81f3\u5173\u91cd\u8981\u3002\\(\\varepsilon\\)\u901a\u5e38\u8bbe\u7f6e\u57280.1\u52300.2\u4e4b\u95f4\u3002\u5982\u679c\\(\\varepsilon\\)\u53d6\u503c\u8fc7\u5927\uff0c\u7b56\u7565\u66f4\u65b0\u7ea6\u675f\u53d8\u5f97\u5bbd\u677e\uff0cPPO \u53ef\u80fd\u9000\u5316\u4e3a\u672a\u7ecf\u9650\u5236\u7684\u7b56\u7565\u68af\u5ea6\uff0c\u4ece\u800c\u5931\u53bb\u7a33\u5b9a\u6027\uff1b\u53cd\u4e4b\u82e5\\(\\varepsilon\\)\u592a\u5c0f\uff0c\u66f4\u65b0\u6b65\u5e45\u5c06\u8fc7\u4e8e\u4fdd\u5b88\uff0c\u5bfc\u81f4\u7b56\u7565\u6536\u655b\u53d8\u6162\u3002\u7ecf\u9a8c\u4e0a\uff0c\\(\\varepsilon=0.2\\)\u5e38\u4f5c\u4e3a\u9ed8\u8ba4\u503c\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\u6839\u636e KL \u6563\u5ea6\u7b49\u6307\u6807\u5fae\u8c03\u3002</li> <li>\u91c7\u6837\u6279\u91cf\u5927\u5c0f\uff1a \u6bcf\u6b21\u8fed\u4ee3\u6536\u96c6\u7684\u6837\u672c\u6570\u91cf\uff08\u5373 batch size \u6216\u8005\u6bcf\u6761\u8f68\u8ff9\u957f\u5ea6\\(T\\)\uff09\u4f1a\u5f71\u54cd\u7b56\u7565\u68af\u5ea6\u4f30\u8ba1\u7684\u65b9\u5dee\u548c\u7a33\u5b9a\u6027\u3002\u6279\u91cf\u8fc7\u5c0f\u4f1a\u5bfc\u81f4\u4f30\u8ba1\u566a\u58f0\u5927\uff0c\u8bad\u7ec3\u66f2\u7ebf\u6296\u52a8\u660e\u663e\uff1b\u6279\u91cf\u8fc7\u5927\u5219\u63d0\u9ad8\u5355\u6b21\u8fed\u4ee3\u8ba1\u7b97\u6210\u672c\u3002\u5e38\u7528\u7684\u8bbe\u7f6e\u662f\u5728\u4e00\u4e2a\u5e76\u884c\u73af\u5883\u6b65\u6570\u79ef\u7d2f 2048 \u6216 4096 \u6761\u6837\u672c\u540e\u66f4\u65b0\u4e00\u6b21\u3002\u603b\u7684\u539f\u5219\u662f\uff1a\u589e\u5927\u6837\u672c\u91cf\u53ef\u4ee5\u6362\u53d6\u66f4\u5e73\u7a33\u7684\u7b56\u7565\u63d0\u5347\uff0c\u4f46\u4f1a\u964d\u4f4e\u6bcf\u5355\u4f4d\u6837\u672c\u7684\u66f4\u65b0\u9891\u7387\uff0c\u8981\u5728\u8ba1\u7b97\u8d44\u6e90\u5141\u8bb8\u8303\u56f4\u5185\u5e73\u8861\u4e8c\u8005\u3002</li> <li>\u591a\u8f6e\u5c0f\u6279\u66f4\u65b0\u6b21\u6570 \\(K\\)\uff1a PPO \u5141\u8bb8\u5bf9\u540c\u4e00\u6279\u6570\u636e\u8fdb\u884c\u591a\u6b21\u68af\u5ea6\u4e0a\u5347\u66f4\u65b0\uff0c\u4f46\u662f\u66f4\u65b0\u8f6e\u6570\u4e0d\u80fd\u8fc7\u591a\u3002\u4e00\u822c\u8bbe\u7f6e\\(K=3\\sim10\\)\uff0c\u5982\u679c\\(K\\)\u592a\u5927\uff0c\u5219\u53ef\u80fd\u8fc7\u5ea6\u62df\u5408\u8fd9\u6279\u91c7\u6837\u6570\u636e\uff0c\u5bfc\u81f4\u7b56\u7565\u5bf9\u65b0\u6570\u636e\u6cdb\u5316\u53d8\u5dee\u3002\u8c03\u8bd5\u65f6\u53ef\u4ee5\u89c2\u5bdf\u6bcf\u6b21\u7b56\u7565\u66f4\u65b0\u7684KL\u6563\u5ea6\u6216\u88ab\u622a\u65ad\u7684\u6837\u672c\u6bd4\u4f8b\uff08clip fraction\uff09\uff1a\u82e5\u591a\u8f6e\u66f4\u65b0\u540e KL \u6563\u5ea6\u660e\u663e\u8d85\u51fa\u9884\u671f\uff08\u4f8b\u5982\u8d85\u8fc7 0.1\uff09\uff0c\u6216\u8005 clip fraction \u5f88\u9ad8\uff08\u5927\u91cf\u6837\u672c\u8fbe\u5230\u4e86\u526a\u5207\u8fb9\u754c\uff09\uff0c\u8bf4\u660e\u7b56\u7565\u66f4\u65b0\u5e45\u5ea6\u8fc7\u5927\uff0c\u53ef\u80fd\u9700\u8981\u51cf\u5c11\\(K\\)\u6216\u964d\u4f4e\u5b66\u4e60\u7387\u3002</li> <li>\u503c\u51fd\u6570\u4f30\u8ba1\u504f\u5dee\uff1a \u4ef7\u503c\u7f51\u7edc\uff08Critic\uff09\u7684\u51c6\u786e\u6027\u5bf9\u4f18\u52bf\u51fd\u6570\u4f30\u8ba1\u5f71\u54cd\u91cd\u5927\u3002\u5982\u679c Critic \u65e0\u6cd5\u7cbe\u786e\u903c\u8fd1\u73af\u5883\u7684\u4ef7\u503c\u51fd\u6570\uff0c\u4f18\u52bf\u4f30\u8ba1\u5c06\u51fa\u73b0\u504f\u5dee\uff0c\u8fdb\u800c\u5f71\u54cd\u7b56\u7565\u68af\u5ea6\u65b9\u5411\u3002\u5e38\u89c1\u73b0\u8c61\u662f\u7b56\u7565\u9677\u5165\u6b21\u4f18\u6216\u6536\u655b\u7f13\u6162\u3002\u5e94\u5bf9\u65b9\u6cd5\u5305\u62ec\uff1a\u589e\u52a0\u4ef7\u503c\u7f51\u7edc\u7684\u8bad\u7ec3\u5f3a\u5ea6\uff08\u4f8b\u5982\u6bcf\u6b21\u7b56\u7565\u66f4\u65b0\u8fed\u4ee3\u591a\u6b21\u4ef7\u503c\u7f51\u7edc\u6216\u8005\u63d0\u9ad8\u4ef7\u503c\u635f\u5931\u6743\u91cd\\(c_1\\)\uff09\u4ee5\u53ca\u589e\u52a0 Critic \u7f51\u7edc\u5bb9\u91cf\uff08\u66f4\u591a\u5c42\u6570\u6216\u5355\u5143\uff09\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u5f15\u5165\u503c\u51fd\u6570\u622a\u65ad\uff08\u5373\u9650\u5236\u6bcf\u6b21\u66f4\u65b0\u4ef7\u503c\u7684\u53d8\u5316\u5e45\u5ea6\uff09\u6765\u9632\u6b62\u4ef7\u503c\u4f30\u8ba1\u53d1\u6563\uff0c\u8fd9\u5728\u67d0\u4e9b\u5b9e\u73b0\u4e2d\u88ab\u8bc1\u660e\u6709\u52a9\u4e8e\u7a33\u5b9a\u8bad\u7ec3\u3002</li> <li>\u71b5\u7cfb\u6570\u4e0e\u63a2\u7d22\uff1a PPO \u901a\u5e38\u4f1a\u5728\u76ee\u6807\u4e2d\u52a0\u5165\u7b56\u7565\u71b5\u7684\u5956\u52b1\u9879\uff08\u7cfb\u6570\u8bb0\u4e3a\\(c_2\\)\uff09\u4ee5\u9f13\u52b1\u63a2\u7d22\u3002\u5982\u679c\u71b5\u7cfb\u6570\u8bbe\u7f6e\u8fc7\u5927\uff0c\u7b56\u7565\u53ef\u80fd\u957f\u671f\u4fdd\u6301\u9ad8\u968f\u673a\u6027\uff0c\u6536\u76ca\u63d0\u5347\u7f13\u6162\uff1b\u82e5\u71b5\u7cfb\u6570\u8fc7\u5c0f\uff0c\u5219\u53ef\u80fd\u8fc7\u65e9\u6536\u655b\u5230\u6b21\u4f18\u7b56\u7565\u3002\u5b9e\u8df5\u4e2d\\(c_2\\)\u4e00\u822c\u53d6 0.01\uff5e0.02 \u5de6\u53f3\u3002\u8c03\u53c2\u65f6\u53ef\u4ee5\u89c2\u5bdf\u7b56\u7565\u7684\u71b5\u503c\u66f2\u7ebf\uff1a\u71b5\u503c\u4e0b\u964d\u8fc7\u5feb\u610f\u5473\u7740\u63a2\u7d22\u4e0d\u8db3\uff0c\u53ef\u9002\u5f53\u63d0\u9ad8\\(c_2\\)\uff1b\u71b5\u503c\u957f\u671f\u7ef4\u6301\u8f83\u9ad8\u5219\u8003\u8651\u964d\u4f4e\\(c_2\\)\u3002</li> <li>\u8bad\u7ec3\u4e0d\u7a33\u5b9a\u53ca\u8c03\u8bd5\uff1a \u5f53 PPO \u8bad\u7ec3\u51fa\u73b0\u4e0d\u7a33\u5b9a\u6216\u6536\u655b\u56f0\u96be\u65f6\uff0c\u5efa\u8bae\u4ece\u4ee5\u4e0b\u65b9\u9762\u6392\u67e5\uff1a\u2460\u5f52\u4e00\u5316\u4f18\u52bf\uff1a\u786e\u4fdd\u4f18\u52bf\u7ecf\u8fc7\u51cf\u5747\u503c\u9664\u65b9\u5dee\u7684\u6807\u51c6\u5316\u5904\u7406\uff0c\u53ef\u663e\u8457\u7a33\u5b9a\u8bad\u7ec3\uff1b\u2461\u5b66\u4e60\u7387\u9000\u706b\uff1a\u968f\u7740\u8bad\u7ec3\u63a8\u8fdb\u9010\u6b65\u964d\u4f4e\u5b66\u4e60\u7387\uff0c\u907f\u514d\u540e\u671f\u9707\u8361\uff1b\u2462\u89c2\u5bdf\u5173\u952e\u6307\u6807\uff1a\u5b9a\u671f\u6253\u5370 KL \u6563\u5ea6\u3001clip fraction\u3001\u7b56\u7565\u71b5\u548c\u4ef7\u503c\u635f\u5931\u7b49\u6307\u6807\uff0c\u5224\u65ad\u662f\u5426\u7b56\u7565\u66f4\u65b0\u8fc7\u5ea6\uff08\u5982KL\u5267\u589e\uff09\u6216\u4ef7\u503c\u51fd\u6570\u8bad\u7ec3\u4e0d\u8db3\u7b49\uff1b\u2463\u73af\u5883\u566a\u58f0\u548c\u968f\u673a\u79cd\u5b50\uff1a\u5bf9\u4e8e\u7ed3\u679c\u6ce2\u52a8\u5927\u7684\u4efb\u52a1\uff0c\u591a\u8fd0\u884c\u51e0\u6b21\u53d6\u5e73\u5747\uff0c\u4ee5\u5206\u8fa8\u7b97\u6cd5\u672c\u8eab\u95ee\u9898\u8fd8\u662f\u968f\u673a\u56e0\u7d20\u5bfc\u81f4\u3002</li> </ul> <p>\u603b\u7684\u6765\u8bf4\uff0cPPO \u4f5c\u4e3a\u5f53\u524d\u6700\u6210\u529f\u7684\u7b56\u7565\u4f18\u5316\u7b97\u6cd5\u4e4b\u4e00\uff0c\u5176\u6838\u5fc3\u601d\u60f3\u662f\u5728\u7b56\u7565\u68af\u5ea6\u66f4\u65b0\u4e2d\u5f15\u5165\u9002\u5ea6\u7684\u7ea6\u675f\uff0c\u4ece\u800c\u8fbe\u5230\u7a33\u5b9a\u8bad\u7ec3\u4e0e\u9ad8\u6548\u91c7\u6837\u7684\u5e73\u8861\u3002\u901a\u8fc7\u5408\u7406\u7684\u8d85\u53c2\u6570\u8c03\u8282\u548c\u6280\u5de7\uff08\u5982GAE\u3001\u71b5\u5956\u52b1\u3001\u68af\u5ea6\u88c1\u526a\u7b49\uff09\uff0c\u5df2\u7ecf\u5728\u673a\u5668\u4eba\u7684\u8fde\u7eed\u63a7\u5236\u3001\u6e38\u620fAI\u4ee5\u53ca\u5927\u89c4\u6a21\u9884\u8bad\u7ec3\u6a21\u578b\u5fae\u8c03\uff08\u5982\u57fa\u4e8e\u4eba\u7c7b\u53cd\u9988\u7684\u5bf9\u8bdd\u6a21\u578b\u4f18\u5316\uff09\u7b49\u4f17\u591a\u573a\u666f\u4e2d\u53d6\u5f97\u4e86\u5353\u8d8a\u7684\u6210\u679c\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60","LLM","Post Training"]},{"location":"posts/Position%20Embedding%E4%B9%8B%E6%88%91%E8%A7%81/","title":"Position Embedding\u4e4b\u6211\u89c1","text":"\u6807\u7b7e\uff1a \u4f4d\u7f6e\u7f16\u7801LLM","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/Position%20Embedding%E4%B9%8B%E6%88%91%E8%A7%81/#_1","title":"\u5f15\u8a00","text":"<p>Transformer \u67b6\u6784\u629b\u5f03\u4e86 RNN \u548c CNN \u4e2d\u5929\u7136\u5e26\u6709\u987a\u5e8f\u611f\u7684\u7ed3\u6784\uff0c\u56e0\u6b64\u4e3a\u4e86\u8ba9\u6a21\u578b\u7406\u89e3 token \u4e4b\u95f4\u7684\u4f4d\u7f6e\u4fe1\u606f\uff0c\u5fc5\u987b\u663e\u5f0f\u5730\u6ce8\u5165\u4f4d\u7f6e\u7f16\u7801\uff08Positional Encoding\uff09\u3002</p> <p>\u6700\u5e38\u89c1\u7684\u7f16\u7801\u65b9\u5f0f\uff0c\u662f\u300aAttention is All You Need\u300b\u4e2d\u63d0\u51fa\u7684 \u6b63\u4f59\u5f26\u4f4d\u7f6e\u7f16\u7801\uff08Sinusoidal Positional Encoding\uff09\uff0c\u5176\u6838\u5fc3\u8bbe\u8ba1\u662f\uff1a</p> <ul> <li>\u4e0d\u540c\u7ef4\u5ea6\u4f7f\u7528\u4e0d\u540c\u9891\u7387\uff1b</li> <li>\u5076\u6570\u7ef4\u4f7f\u7528 \\(\\sin\\)\uff0c\u5947\u6570\u7ef4\u4f7f\u7528 \\(\\cos\\)\u3002</li> </ul> <p>\u8fd9\u5f15\u53d1\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>\u4e3a\u4ec0\u4e48\u8981\u533a\u5206\u5947\u5076\u7ef4\u5ea6\uff08sin / cos\uff09\uff1f</li> <li>\u4e3a\u4ec0\u4e48\u8981\u4e3a\u4e0d\u540c\u7ef4\u5ea6\u5206\u914d\u4e0d\u540c\u7684\u9891\u7387\uff1f</li> </ol> <p>\u6211\u5c06\u5728\u672c\u6587\u4e2d\u6df1\u5165\u63a8\u5bfc\u548c\u5256\u6790\uff0c\u5e76\u8c08\u4e0b\u6211\u7684\u770b\u6cd5\u3002</p>","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/Position%20Embedding%E4%B9%8B%E6%88%91%E8%A7%81/#_2","title":"\u6b63\u4f59\u5f26\u4f4d\u7f6e\u7f16\u7801\u7684\u5f62\u5f0f","text":"<p>\u8bbe\u6a21\u578b\u7ef4\u5ea6\u4e3a \\(d_{model}\\)\uff0c\u4f4d\u7f6e\u4e3a \\(pos\\)\uff0c\u7b2c \\(i\\) \u4e2a\u7ef4\u5ea6\u7684\u7f16\u7801\u4e3a\uff1a</p> <ul> <li>\u5076\u6570\u7ef4\u5ea6\uff08\\(2i\\)\uff09\uff1a</li> </ul> <p>$$   PE_{(pos, 2i)} = \\sin\\left(\\frac{pos}{10000^{2i/d_{model}}}\\right)   $$</p> <ul> <li>\u5947\u6570\u7ef4\u5ea6\uff08\\(2i+1\\)\uff09\uff1a</li> </ul> <p>$$   PE_{(pos, 2i+1)} = \\cos\\left(\\frac{pos}{10000^{2i/d_{model}}}\\right)   $$</p> <p>\u5176\u4e2d \\(\\lambda_i = 10000^{2i/d_{model}}\\) \u63a7\u5236\u9891\u7387\u3002</p>","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/Position%20Embedding%E4%B9%8B%E6%88%91%E8%A7%81/#_3","title":"\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u4e0d\u540c\u7684\u9891\u7387\uff1f","text":"","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/Position%20Embedding%E4%B9%8B%E6%88%91%E8%A7%81/#_4","title":"\u6784\u5efa\u591a\u5c3a\u5ea6\u7684\u4f4d\u7f6e\u4fe1\u606f\u8868\u8fbe","text":"<p>\u6bcf\u4e2a\u7ef4\u5ea6\u7684\u9891\u7387\u4e0d\u540c\uff0c\u76f8\u5f53\u4e8e\u5728\u9891\u57df\u4e0a\u89c2\u5bdf\u5e8f\u5217\uff1a</p> <ul> <li>\u4f4e\u9891\uff08\u5927\u6ce2\u957f\uff09\u7ef4\u5ea6\u611f\u77e5\u957f\u8ddd\u79bb\u4f9d\u8d56\uff1b</li> <li>\u9ad8\u9891\uff08\u5c0f\u6ce2\u957f\uff09\u7ef4\u5ea6\u611f\u77e5\u5c40\u90e8\u53d8\u5316\u3002</li> </ul> <p>\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u50cf\u5c0f\u6ce2\u6216\u5085\u91cc\u53f6\u53d8\u6362\u4e00\u6837\uff0c\u4ece\u591a\u5c3a\u5ea6\u4e0a\u5bf9\u5e8f\u5217\u4f4d\u7f6e\u8fdb\u884c\u5efa\u6a21\u3002</p>","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/Position%20Embedding%E4%B9%8B%E6%88%91%E8%A7%81/#_5","title":"\u907f\u514d\u7ef4\u5ea6\u95f4\u5197\u4f59","text":"<p>\u5982\u679c\u6240\u6709\u7ef4\u5ea6\u4f7f\u7528\u76f8\u540c\u9891\u7387\uff0c\u90a3\u4e0d\u540c\u7ef4\u5ea6\u4e4b\u95f4\u4f1a\u9ad8\u5ea6\u5197\u4f59\uff0c\u65e0\u6cd5\u63d0\u4f9b\u65b0\u7684\u4fe1\u606f\u3002</p> <p>\u9891\u7387\u7684\u6307\u6570\u7ea7\u9012\u589e\uff08\\(10000^{2i/d}\\)\uff09\u786e\u4fdd\u4e0d\u540c\u7ef4\u5ea6\u643a\u5e26\u7684\u4f4d\u7f6e\u4fe1\u606f\u5728\u6570\u5b66\u4e0a\u7ebf\u6027\u65e0\u5173\u3002</p>","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/Position%20Embedding%E4%B9%8B%E6%88%91%E8%A7%81/#sin-cos","title":"\u4e3a\u4ec0\u4e48\u8981\u533a\u5206sin \u4e0e cos\uff1f","text":"<p>\u5373\uff1a\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u6240\u6709\u7ef4\u5ea6\u90fd\u7528 \\(\\sin\\)\uff0c\u6216\u8005\u90fd\u7528 \\(\\cos\\)\uff1f</p> <p>\u2705 \u539f\u56e0\u662f\uff1a</p> <p>\u4f7f\u7528\u6b63\u5f26\u548c\u4f59\u5f26\u4f5c\u4e3a\u4e00\u7ec4\u5085\u91cc\u53f6\u57fa\u5e95\uff0c\u53ef\u4ee5\u8ba9\u4e24\u4e2a\u4f4d\u7f6e\u4e4b\u95f4\u7684\u70b9\u79ef\u76f4\u63a5\u53cd\u6620\u5b83\u4eec\u7684\u76f8\u5bf9\u8ddd\u79bb\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u63a8\u5bfc\u5982\u4e0b\uff1a</p> <p>\u5bf9\u4e8e\u4e24\u4e2a\u4f4d\u7f6e \\(pos_1\\) \u548c \\(pos_2\\)\uff0c\u5b83\u4eec\u7684\u7f16\u7801\u4e3a\uff1a</p> <ul> <li>\u7b2c \\(i\\) \u5bf9\u7ef4\u5ea6\uff08\\(2i, 2i+1\\)\uff09\u4e3a\uff1a</li> </ul> <p>$$   \\left[ \\sin\\left(\\frac{pos}{\\lambda_i}\\right), \\cos\\left(\\frac{pos}{\\lambda_i}\\right) \\right]   $$</p> <p>\u5b83\u4eec\u7684\u70b9\u79ef\u4e3a\uff1a</p> \\[ PE(pos_1) \\cdot PE(pos_2) = \\sum_i \\left( \\sin\\left(\\frac{pos_1}{\\lambda_i}\\right)\\sin\\left(\\frac{pos_2}{\\lambda_i}\\right) + \\cos\\left(\\frac{pos_1}{\\lambda_i}\\right)\\cos\\left(\\frac{pos_2}{\\lambda_i}\\right) \\right) = \\sum_i \\cos\\left(\\frac{pos_1 - pos_2}{\\lambda_i}\\right) \\] <p>\u8fd9\u4e2a\u7ed3\u679c\u8bf4\u660e\uff1a</p> <p>\u4e24\u4e2a\u4f4d\u7f6e\u7f16\u7801\u7684\u70b9\u79ef\u8868\u793a\u7684\u662f\u201c\u76f8\u5bf9\u4f4d\u7f6e\u5dee\u201d\u800c\u4e0d\u662f\u201c\u7edd\u5bf9\u4f4d\u7f6e\u201d\uff0c\u4ece\u800c\u5141\u8bb8 Transformer \u95f4\u63a5\u611f\u77e5\u4f4d\u7f6e\u4fe1\u606f\u3002</p> <p>\u8fd9\u6b63\u662f\u6ce8\u610f\u529b\u673a\u5236\u7f3a\u5931\u4f4d\u7f6e\u4fe1\u606f\u7684\u4e00\u4e2a\u4f18\u96c5\u8865\u6551\u3002</p> <p>\u82e5\u53ea\u7528 \\(\\sin\\)\uff0c\u70b9\u79ef\u5c31\u53d8\u6210\uff1a</p> \\[ PE(pos_1) \\cdot PE(pos_2) = \\sum_i \\sin\\left(\\frac{pos_1}{\\lambda_i}\\right)\\sin\\left(\\frac{pos_2}{\\lambda_i}\\right) \\] <p>\u8fd9\u65e0\u6cd5\u7b80\u5316\u4e3a \\(\\cos(pos_1 - pos_2)\\) \u7684\u5f62\u5f0f\uff0c\u6a21\u578b\u5931\u53bb\u4e86\u76f8\u5bf9\u4f4d\u7f6e\u4fe1\u606f\u7684\u5185\u79ef\u89e3\u7801\u80fd\u529b\u3002</p>","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/Position%20Embedding%E4%B9%8B%E6%88%91%E8%A7%81/#_6","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u5947\u5076\u4ea4\u9519","text":"<p>\u5982\u679c\u4e0d\u6697\u62db\u5947\u5076\u4ea4\u66ff\u7684\u5f62\u5f0f\u6392\u5e03\uff0c\u800c\u7528\u5176\u4ed6\u6392\u5e03\u65b9\u5f0f\uff0c\u6bd4\u5982\u628a\u524d\u4e00\u534a\u7ef4\u5ea6\u90fd\u7528 sin\uff0c\u540e\u4e00\u534a\u90fd\u7528 cos\uff0c\u8fd8\u80fd\u4fdd\u6301\u8fd9\u79cd\u6027\u8d28\u5417\uff1f</p> <p>\u6211\u4eec\u8bbe\uff1a</p> <ul> <li>\u524d \\(d/2\\) \u7ef4\u4f7f\u7528 \\(\\sin\\left(\\frac{pos}{\\lambda_i}\\right)\\)\uff1b</li> <li>\u540e \\(d/2\\) \u7ef4\u4f7f\u7528 \\(\\cos\\left(\\frac{pos}{\\lambda_i}\\right)\\)\uff1b</li> </ul> <p>\u90a3\u4e48\u70b9\u79ef\u4ecd\u7136\u4e3a\uff1a</p> \\[ PE(pos_1) \\cdot PE(pos_2) = \\sum_i \\sin\\left(\\frac{pos_1}{\\lambda_i}\\right)\\sin\\left(\\frac{pos_2}{\\lambda_i}\\right) + \\cos\\left(\\frac{pos_1}{\\lambda_i}\\right)\\cos\\left(\\frac{pos_2}{\\lambda_i}\\right) = \\sum_i \\cos\\left(\\frac{pos_1 - pos_2}{\\lambda_i}\\right) \\] <p>\u8fd9\u8868\u660e\uff1a</p> <p>\u53ea\u8981 sin \u548c cos \u662f\u914d\u5bf9\u4f7f\u7528\u5e76\u4e14\u9891\u7387\u4e00\u4e00\u5bf9\u5e94\uff0c\u65e0\u8bba\u662f\u201c\u4ea4\u9519\u6392\u5e03\u201d\u8fd8\u662f\u5176\u4ed6\u6392\u5e03\u65b9\u5f0f\uff0c\u90fd\u80fd\u4fdd\u7559\u539f\u6709\u6027\u8d28\u3002</p> <p>\u26a0\ufe0f \u4f46\u6ce8\u610f\uff1a</p> <p>\u5982\u679c\u524d\u534a sin \u4f7f\u7528\u7684\u662f\u4e00\u7ec4\u9891\u7387\uff0c\u540e\u534a cos \u4f7f\u7528\u7684\u662f\u53e6\u4e00\u7ec4\u9891\u7387\uff08\u6bd4\u5982\u91cd\u590d\u3001\u7ffb\u8f6c\u6216\u9519\u4f4d\uff09\uff0c\u90a3\u4e48\u70b9\u79ef\u7ed3\u679c\u5c06\u4e0d\u518d\u662f\u7eaf\u7cb9\u7684 \\(\\cos(pos_1 - pos_2)\\) \u53e0\u52a0\uff0c\u4e5f\u5c31\u5931\u53bb\u4e86\u76f8\u5bf9\u4f4d\u7f6e\u53ef\u89e3\u91ca\u6027\u3002</p>","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/RoPE%EF%BC%9A%E7%9B%B8%E5%AF%B9%E8%B7%9D%E7%A6%BB%E6%84%9F%E7%9F%A5%E7%9A%84%E7%A7%98%E5%AF%86/","title":"RoPE\uff1a\u76f8\u5bf9\u8ddd\u79bb\u611f\u77e5\u7684\u79d8\u5bc6","text":"\u6807\u7b7e\uff1a \u4f4d\u7f6e\u7f16\u7801LLM","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/RoPE%EF%BC%9A%E7%9B%B8%E5%AF%B9%E8%B7%9D%E7%A6%BB%E6%84%9F%E7%9F%A5%E7%9A%84%E7%A7%98%E5%AF%86/#1","title":"1\u202f\u80cc\u666f\u4e0e\u52a8\u673a","text":"<p>Transformer\u202f\u81ea\u6ce8\u610f\u529b\u5bf9\u5e8f\u5217\u987a\u5e8f\u4e0d\u654f\u611f\uff0c\u5fc5\u987b\u663e\u5f0f\u6ce8\u5165\u4f4d\u7f6e\u4fe1\u606f\u3002\u65e9\u671f\u91c7\u7528\u56fa\u5b9a\u6b63\u5f26/\u4f59\u5f26\u7edd\u5bf9\u7f16\u7801\u6216\u53ef\u5b66\u4e60\u7edd\u5bf9\u5d4c\u5165\uff0c\u4f46\u5b83\u4eec\u96be\u4ee5\u8868\u8fbe\u76f8\u5bf9\u8ddd\u79bb\u4e14\u5bf9\u957f\u5ea6\u6cdb\u5316\u80fd\u529b\u6709\u9650\u3002\u76f8\u5bf9\u4f4d\u7f6e\u7f16\u7801\uff08RPE\uff09\u867d\u80fd\u90e8\u5206\u7f13\u89e3\uff0c\u4f46\u5b9e\u73b0\u590d\u6742\u3001\u901f\u5ea6\u6162\u3002RoPE \u901a\u8fc7\u590d\u6570\u65cb\u8f6c\u4e00\u6b21\u6027\u540c\u65f6\u7f16\u7801\u7edd\u5bf9\u548c\u76f8\u5bf9\u4f4d\u7f6e\u4fe1\u606f\uff0c\u4e3a\u957f\u4e0a\u4e0b\u6587\u3001\u5927\u6a21\u578b\u63a8\u7406\u5e26\u6765\u8ba1\u7b97\u4e0e\u6cdb\u5316\u4f18\u52bf\u3002</p>","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/RoPE%EF%BC%9A%E7%9B%B8%E5%AF%B9%E8%B7%9D%E7%A6%BB%E6%84%9F%E7%9F%A5%E7%9A%84%E7%A7%98%E5%AF%86/#2-rope","title":"2\u202fRoPE\u662f\u4ec0\u4e48","text":"<p>\u5728\u5927\u591a\u6570\u202fLLM\u202f\u4ee3\u7801\u4e0e\u8bba\u6587\u7684\u5b9e\u73b0\u91cc\uff0cRoPE\u202f\u5e76\u4e0d\u662f\u201c\u7ed9\u8bcd\u5411\u91cf\u52a0\u4e00\u5217\u5750\u6807\u201d\u7684\u4f20\u7edf\u4f4d\u7f6e\u5d4c\u5165\uff0c\u800c\u662f\u5728\u6bcf\u4e2a\u81ea\u6ce8\u610f\u529b\u5c42\u5185\u5bf9\u202fQuery/Key\u202f\u77e9\u9635\u505a\u4e00\u6b21\u6309\u4f4d\u7f6e\u89d2\u5ea6\u7684\u65cb\u8f6c\uff1a\u8f93\u5165 token \u5148\u8fdb\u5165\u8bcd\u8868\u67e5\u627e\u5f97\u5230\\(h\\)\uff0c\u968f\u540e\u7ecf\u7ebf\u6027\u6295\u5f71\u5206\u6210\\(q,k,v\\)\uff0c\u63a5\u7740\u4ec5\u5bf9\\(q\\)\u3001\\(k\\)\u8fdb\u884c <code>apply_rotary_pos_emb</code>\uff0c\u518d\u8fdb\u5165\u70b9\u79ef\u2011Softmax \u8ba1\u7b97\u6ce8\u610f\u529b\u6743\u91cd\u3002\u8fd9\u4e00\u6b65\u53d1\u751f\u5728 Multi\u2011Head\u202fAttention\u202f\u6a21\u5757\u5185\u90e8\uff0c\u4e0e\u8bcd\u5d4c\u5165\u77e9\u9635\u672c\u8eab\uff08token embedding\uff09\u89e3\u8026\u3002</p> <p>RoPE \u6700\u65e9\u7531\u202fRoFormer\u202f\u63d0\u51fa\uff0c\u5176\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u628a\u67e5\u8be2\\(q\\)\u548c\u952e\\(k\\)\u89c6\u4e3a\u5076\u6570/\u5947\u6570\u4ea4\u9519\u7684\u4e8c\u7ef4\u5411\u91cf\u5bf9\\((x_{2i},x_{2i+1})\\)\uff0c\u5bf9\u7b2c\\(p\\)\u4f4d\u5e94\u7528\u540c\u4e00\u89d2\u5ea6\\(\\theta_p\\)\u7684\u65cb\u8f6c\u53d8\u6362</p> \\[R_{\\theta_p}\\begin{pmatrix}x_{2i},x_{2i+1}\\end{pmatrix}= \\begin{pmatrix}x_{2i}\\cos\\theta_p - x_{2i+1}\\sin\\theta_p \\ x_{2i}\\sin\\theta_p + x_{2i+1}\\cos\\theta_p\\end{pmatrix}\\] <p>\u5176\u4e2d\\(\\theta_p = p/10000^{2i/d}\\)\u4e0e\u4f20\u7edf\u6b63\u5f26\u7f16\u7801\u540c\u6e90\u3002\u4e58\u79ef\\(q^\\top k\\)\u4e2d\u65cb\u8f6c\u89d2\u5ea6\u76f8\u51cf\uff0c\u81ea\u7136\u4ea7\u751f\u76f8\u5bf9\u4f4d\u7f6e\u504f\u5dee\uff0c\u56e0\u6b64\u81ea\u6ce8\u610f\u529b\u4ec5\u4f9d\u8d56\\(p_q-p_k\\)\u3002</p> <p>\u6027\u8d28</p> <ul> <li>\u7b49\u53d8\u6027\uff1a\u65cb\u8f6c\u77e9\u9635\u4fdd\u6301\u8303\u6570\u4e0d\u53d8\uff0c\u907f\u514d\u5e45\u503c\u7206\u70b8\u3002</li> <li>\u76f8\u5bf9\u8ddd\u79bb\u5355\u8c03\u8870\u51cf\uff1a\u5185\u79ef\u968f\u8ddd\u79bb\u589e\u5927\u800c\u4f59\u5f26\u8870\u51cf\u3002</li> <li>\u65e0\u989d\u5916\u53c2\u6570\uff1a\u4e0e\u53ef\u5b66\u4e60\u7edd\u5bf9\u5d4c\u5165\u76f8\u6bd4\uff0c\u53c2\u6570\u4e3a\u96f6\uff0c\u663e\u5b58\u5360\u7528\u66f4\u4f4e\u3002</li> <li>\u6613\u4e8e\u957f\u6587\u672c\u63d2\u503c/\u5916\u63a8\uff1a\u901a\u8fc7\u4f38\u7f29\\(\\theta\\)\u6216\u63d2\u503c\uff0c\u53ef\u628a\u9884\u8bad\u7ec3 2\u202fk\u202f\u2192\u202f128\u202fk\u202ftokens\u3002</li> </ul> <p></p> <p>\u771f\u5b9e\u4ee3\u7801\u793a\u4f8b</p> <p>\u2014\u2014StableLM\u2011Alpha \u5b98\u65b9\u5b9e\u73b0 </p> <pre><code>cos, sin = rotary_emb(v, seq_len)          # \u9884\u53d6\u65cb\u8f6c\u7cfb\u6570  \nq, k = apply_rotary_pos_emb(q, k, cos, sin, position_ids)  \n</code></pre> <ul> <li>\u4ec5\u65cb\u8f6c\u202fQ/K\uff0c\u4e0d\u5904\u7406\u202fV\uff0c\u662f LLaMA\u3001StableLM\u3001Phi\u20113 \u7b49\u4e3b\u6d41\u5b9e\u73b0\u7684\u5171\u8bc6</li> <li>\u65cb\u8f6c\u64cd\u4f5c\u4f4d\u4e8e\u6ce8\u610f\u529b\u5c42\u91cc\uff0c\u56e0\u800c RoPE\u202f\u2260\u202ftoken embedding \u7684\u4e00\u90e8\u5206\uff1b\u5982\u679c\u628a RoPE \u63d0\u524d\u5230\u8bcd\u5d4c\u5165\u9636\u6bb5\uff0c\u76f8\u5bf9\u4f4d\u7f6e\u4fe1\u606f\u5728\u968f\u540e\u7684\u7ebf\u6027\u6295\u5f71\u4e2d\u4f1a\u88ab\u7834\u574f\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u65cb\u8f6c\u89d2\u5dee\u7b49\u4e8e\u76f8\u5bf9\u8ddd\u79bb</li> </ul> <p>\u4e3a\u4ec0\u4e48\u9009\u62e9\u5728 Attention \u5185\u90e8\u65cb\u8f6c</p> <ol> <li>\u76f8\u5bf9\u4f4d\u7f6e\u4fe1\u606f\u5929\u7136\u4fdd\u7559\\(q_i^\\top k_j\\)\u4e2d\u89d2\u5ea6\u5dee\\(\\theta_i-\\theta_j\\)\u53ea\u53d6\u51b3\u4e8e\\(i-j\\)\uff0c\u4e0e\u7edd\u5bf9\u4f4d\u7f6e\u65e0\u5173\uff0c\u5b9e\u73b0\u4e86\u96f6\u53c2\u6570\u7684\u76f8\u5bf9\u7f16\u7801\u3002</li> <li>\u8ba1\u7b97/\u663e\u5b58\u96f6\u989d\u5916\u5f00\u9500 \u65cb\u8f6c\u662f\u9010\u5143\u7d20\u4e58\u52a0\uff08\u6216\u590d\u6570\u4e58\u6cd5\uff09\uff0c\u590d\u6742\u5ea6\u4e0e\u539f\u672c\u70b9\u79ef\u76f8\u540c\uff1b\u4e0d\u9700\u8981\u4e3a\u6bcf\u4e2a\u4f4d\u7f6e\u5b58\u8868\u6216\u5411\u91cf\u3002</li> <li>\u63a8\u7406\u9636\u6bb5\u53ef\u7f13\u5b58 cos/sin \u76f8\u540c\u957f\u5ea6\u53ea\u9700\u4e00\u6b21\u9884\u8ba1\u7b97\u5373\u53ef\u590d\u7528\uff0c\u5728\u957f\u4e0a\u4e0b\u6587\u63a8\u7406\u4e2d\u6bd4\u628a\u4f4d\u7f6e\u5411\u91cf\u52a0\u5230\\(h\\)\u66f4\u8282\u7701\u5e26\u5bbd\u3002</li> </ol> <p>\u5e38\u89c1\u8bef\u533a\u6f84\u6e05</p> \u8bef\u89e3 \u4e8b\u5b9e\u4e0e\u89e3\u91ca \u201cRoPE \u662f\u53e6\u4e00\u79cd\u8bcd\u5d4c\u5165\u201d \u5426\u3002\u8bcd\u5d4c\u5165\u8d1f\u8d23\u8bed\u4e49\uff0cRoPE\u00a0\u4ec5\u5728\u6ce8\u610f\u529b\u6c42\u6743\u91cd\u524d\u5bf9\u00a0\\(q,k\\)\u505a\u65cb\u8f6c\uff0c\u4ece\u800c\u628a\u201c\u4f4d\u7f6e\u4fe1\u606f\u201d\u6df7\u5165\u6ce8\u610f\u529b\u5206\u6570\uff0c\u800c\u975e\u5b58\u8fdb token \u5411\u91cf\u3002 \u201cRoPE \u4e5f\u8981\u52a0\u5230\u00a0Value\u201d \u4e00\u822c\u4e0d\u52a0\u3002\\(v\\)\u4e0d\u53c2\u4e0e dot\u2011product\uff0c\u65cb\u8f6c\u5bf9\u6700\u7ec8\u8f93\u51fa\u65e0\u7528\uff0c\u53cd\u800c\u6d6a\u8d39\u7b97\u529b\u3002\u90e8\u5206\u5b9e\u9a8c\u5bf9\\(v\\)\u65cb\u8f6c\u6548\u679c\u65e0\u663e\u8457\u63d0\u5347\u3002 \u201c\u6362\u6210 RoPE \u53ea\u8981\u6539 Embedding \u5c42\u201d \u8fd8\u9700\u6539 Attention\u3002\u5fc5\u987b\u5728\u6240\u6709\u81ea\u6ce8\u610f\u529b\u5c42\u8c03\u7528 <code>apply_rotary_pos_emb</code>\uff1b\u5355\u72ec\u66ff\u6362\u8bcd\u5d4c\u5165\u5c42\u4e0d\u4f1a\u751f\u6548\u3002","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/RoPE%EF%BC%9A%E7%9B%B8%E5%AF%B9%E8%B7%9D%E7%A6%BB%E6%84%9F%E7%9F%A5%E7%9A%84%E7%A7%98%E5%AF%86/#3","title":"3\u202f\u5982\u4f55\u5b9e\u73b0","text":"","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/RoPE%EF%BC%9A%E7%9B%B8%E5%AF%B9%E8%B7%9D%E7%A6%BB%E6%84%9F%E7%9F%A5%E7%9A%84%E7%A7%98%E5%AF%86/#31-pytorch","title":"3.1\u202fPyTorch\u202f\u4f2a\u4ee3\u7801","text":"<pre><code>def apply_rope(x):\n    # x: (batch, seq, n_heads, head_dim)\n    x_even, x_odd = x[..., 0::2], x[..., 1::2]\n    pos = torch.arange(x.shape[1], device=x.device)\n    theta = pos[:, None] / 10000 ** (torch.arange(head_dim//2) / (head_dim//2))\n    sin, cos = theta.sin(), theta.cos()\n    x_rot = torch.stack([x_even*cos - x_odd*sin,\n                         x_even*sin + x_odd*cos], dim=-1)\n    return x_rot.flatten(-2)\n</code></pre> <p>\u5173\u952e\u5b9e\u73b0\u70b9\uff1a</p> <ol> <li>\u5148\u5bf9\u7ef4\u5ea6\u505a <code>reshape</code>/<code>view</code>\uff0c\u4fdd\u8bc1\u5076\u6570-\u5947\u6570\u914d\u5bf9\u3002</li> <li>\u53ea\u5bf9 Query \u548c Key \u65cb\u8f6c\uff0cValue \u4fdd\u6301\u4e0d\u53d8\uff08LLaMA\u7cfb\u505a\u6cd5\uff09\u3002</li> <li>\u5728\u63a8\u7406\u9636\u6bb5\u7f13\u5b58 <code>cos\u03b8</code>,\u202f<code>sin\u03b8</code> \u4ee5\u52a0\u901f\u3002</li> </ol>","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/RoPE%EF%BC%9A%E7%9B%B8%E5%AF%B9%E8%B7%9D%E7%A6%BB%E6%84%9F%E7%9F%A5%E7%9A%84%E7%A7%98%E5%AF%86/#32","title":"3.2\u202f\u4f38\u7f29\u5230\u957f\u4e0a\u4e0b\u6587","text":"<ul> <li>\u0398\u2011scaling\uff1a\u5c06\\(\\theta_p\\)\u9664\u4ee5\u7cfb\u6570\u202f\\(s&lt;1\\)\uff08NTK-aware scaling\uff09\u4ee5\u7ebf\u6027\u62c9\u4f38\u9891\u7387\u3002</li> <li>\u4f4d\u7f6e\u63d2\u503c\uff08PI\uff09\uff1a\u5728\u66f4\u957f\u5e8f\u5217\u4e0a\u91cd\u65b0\u91c7\u6837\u202f\\(\\theta\\)\uff0c\u4e0d\u9700\u6539\u6a21\u578b\u6743\u91cd\uff1b\u5b9e\u9a8c\u663e\u793a RoPE\u2011PI \u5728 32\u202fk+ \u957f\u5ea6\u4fdd\u6301\u56f0\u60d1\u5ea6\u5e73\u7a33\u3002</li> <li>YaRN\uff1a\u5fae\u8c03\u5c11\u91cf token\uff0c\u5bf9 \u03b8 \u52a8\u6001\u7f29\u653e\u548c\u5206\u6bb5 fine\u2011tune\uff0c\u53ef\u8fbe 128\u202fk \u4e0a\u4e0b\u6587\u4e14\u8bad\u7ec3\u4ee3\u4ef7\u4e3a\u524d\u4eba 10%\u3002</li> </ul>","tags":["\u4f4d\u7f6e\u7f16\u7801","LLM"]},{"location":"posts/TFDS%20vs%20WebDataset/","title":"TFDS vs WebDataset","text":"\u6807\u7b7e\uff1a \u6570\u636e\u5de5\u7a0b","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#1","title":"1. \u4e24\u79cd\u683c\u5f0f\u7684\u5178\u578b\u5e94\u7528\u573a\u666f","text":"<ul> <li> <p>TFDS (TensorFlow Datasets)\uff1a\u63d0\u4f9b\u6807\u51c6\u5316\u7684\u6570\u636e\u96c6\u6253\u5305\u683c\u5f0f\uff08TFRecord + \u5143\u4fe1\u606f\uff09\u4e0e\u201c\u50cf\u5b98\u65b9\u6570\u636e\u96c6\u4e00\u6837\u201d\u5206\u53d1/\u590d\u73b0\u7684\u80fd\u529b\u3002\u975e\u5e38\u9002\u5408\u56e2\u961f\u5185\u5916\u5206\u53d1\u3001\u7248\u672c\u7ba1\u7406\u3001\u5143\u6570\u636e\u6821\u9a8c\uff0c\u8ba9\u6570\u636e\u6210\u4e3a\u201c\u53ef\u590d\u73b0\u5b9e\u9a8c\u8d44\u4ea7\u201d\u3002</p> <p>\u5728 PyTorch \u573a\u666f\u4e2d\uff0c\u53ef\u5c06 TFDS \u4f5c\u4e3a\u4e2d\u7acb\u7684\u53d1\u5e03\u683c\u5f0f\uff1a\u4e0a\u6e38\u7528 TFDS \u6784\u5efa\u4e0e\u9a8c\u6536\uff0c\u4e0b\u6e38\u8bad\u7ec3\uff08\u5c24\u5176\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\uff09\u518d\u8f6c\u6362\u4e3a\u66f4\u9ad8\u541e\u5410\u7684\u683c\u5f0f\u3002</p> </li> <li> <p>WebDataset (wds)\uff1a\u901a\u8fc7<code>.tar</code> \u5206\u7247 + \u952e\u7ea6\u5b9a\u7ec4\u7ec7\u6837\u672c\uff0c\u5929\u7136\u9002\u914d PyTorch IterableDataset\uff0c\u652f\u6301 \u672c\u5730/HTTP/S3 \u6d41\u5f0f\u8bfb\u53d6\u3001\u5206\u5e03\u5f0f\u5207\u5206\u3001\u9ad8\u541e\u5410\u987a\u5e8f IO\u3002\u975e\u5e38\u9002\u5408\u6d77\u91cf\u591a\u6a21\u6001\u6570\u636e\u4e0e\u8de8\u673a\u5206\u5e03\u5f0f\u8bad\u7ec3\u3002</p> </li> </ul>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#2","title":"2. \u6570\u636e\u5b58\u50a8\u7ed3\u6784","text":"","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#21-tfds","title":"2.1 TFDS","text":"<ul> <li>\u76ee\u5f55\u5316\u7ed3\u6784\uff08\u793a\u610f\uff09\uff1a</li> </ul> <pre><code>my_dataset/1.0.0/\n  my_dataset-train.tfrecord-00000-of-00050\n  my_dataset-train.tfrecord-00001-of-00050\n  ...\n  my_dataset-val.tfrecord-00000-of-00005\n  dataset_info.json\n  checksums.tsv\n</code></pre> <ul> <li>\u6837\u672c\u5355\u4f4d\uff1aTF Example\uff08Protocol Buffers\uff09\uff0c\u5b57\u6bb5\u7531 <code>features</code>\uff08schema\uff09\u7ea6\u675f\u3002</li> <li>\u5143\u4fe1\u606f\uff1a<code>dataset_info.json</code>\uff08\u7248\u672c\u3001\u6837\u672c\u6570\u3001features\u3001splits\uff09\u3001<code>checksums.tsv</code>\uff08\u5b8c\u6574\u6027\u6821\u9a8c\uff09\u3002</li> <li>\u5207\u5206\uff1a\u5929\u7136\u652f\u6301 <code>train/val/test</code>\u3002</li> <li>{dataset_name}-{split}.tfrecord-{shard_index:05d}-of-{num_shards:05d}\u662fTFDS\u5bf9\u4e00\u4e2a split \u7684 TFRecord \u5206\u7247\u547d\u540d\u89c4\u8303\uff0c\u5982my_dataset-train.tfrecord-00000-of-00050<ul> <li><code>my_dataset</code>\uff1a\u6570\u636e\u96c6\u540d\uff08dataset name\uff09</li> <li><code>train</code>\uff1a\u5207\u5206\uff08split\uff09\uff0c\u5e38\u89c1\u8fd8\u6709 validation/test \u7b49</li> <li><code>.tfrecord</code>\uff1a\u5b58\u50a8\u683c\u5f0f\uff0c\u6587\u4ef6\u91cc\u662f\u5e8f\u5217\u5316\u7684 tf.train.Example</li> <li><code>-00000-</code>\uff1a\u8fd9\u662f\u5206\u7247\u5e8f\u53f7\uff08shard_index\uff09\uff0c\u4ece 0 \u5f00\u59cb\uff1b\u8fd9\u91cc\u662f\u7b2c 0 \u7247</li> <li><code>of-00050</code>\uff1a\u8fd9\u4e2a split \u4e00\u5171\u6709 50 \u4e2a\u5206\u7247\uff08num_shards=50\uff09</li> </ul> </li> </ul>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#22-webdataset","title":"2.2 WebDataset","text":"<ul> <li>\u5206\u7247\u6587\u4ef6\uff1a<code>shard-000000.tar</code>, <code>shard-000001.tar</code>, \u2026\uff08\u63a8\u8350 100\u2013500MB/\u7247 \u6216 1\u20135 \u4e07\u6837\u672c/\u7247\uff0c\u4f9d\u6570\u636e\u4f53\u91cf\u4e0e\u4ecb\u8d28\u8c03\u4f18\uff09\u3002</li> <li>\u6837\u672c\u7ec4\u7ec7\uff1a\u540c\u4e00\u524d\u7f00\u4ee3\u8868\u4e00\u4e2a\u6837\u672c\uff0c\u540e\u7f00\u6269\u5c55\u540d\u8868\u793a\u901a\u9053/\u6a21\u6001\uff1a</li> </ul> <pre><code>000123.jpg        # \u56fe\u50cf\n000123.json       # \u5143\u6570\u636e/\u6807\u6ce8\n000123.txt        # \u6587\u672c\n000124.jpg\n000124.json\n...\n</code></pre> <ul> <li>\u5e38\u89c1\u952e\uff1a<code>\"jpg\"|\"png\"|\"mp4\"|\"wav\"|\"json\"|\"txt\"|\"cls\"|\"__key__\"</code>\u3002</li> <li>\u4f4d\u7f6e\uff1a\u672c\u5730/HTTP/S3 \u5747\u53ef\uff08\u53ef\u76f4\u63a5\u6d41\u5f0f\u8bfb\u53d6\uff0c\u907f\u514d\u9884\u4e0b\u8f7d\uff09\u3002</li> </ul>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#3-tfds","title":"3. TFDS\uff1a\u4ece\u539f\u59cb\u6587\u4ef6\u5230\u53ef\u590d\u73b0\u7684\u6570\u636e\u96c6","text":"<p>\u76ee\u6807\uff1a\u628a\u672c\u5730\u5df2\u6709\u7684\u539f\u59cb\u6587\u4ef6\uff08\u56fe\u7247/\u6807\u6ce8\u7b49\uff09\u89c4\u8303\u5316\u4e3a\u4e00\u4e2a\u5e26\u7248\u672c\u4e0e\u5207\u5206\u3001\u53ef\u590d\u73b0\u7684 TFDS \u6570\u636e\u96c6\uff0c\u80fd\u4e00\u952e\u8f6c\u6362\u4e3a WebDataset \u4f9b PyTorch \u5206\u5e03\u5f0f\u8bad\u7ec3\u3002</p>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#31","title":"3.1 \u539f\u59cb\u6570\u636e\u51c6\u5907","text":"<p>\u5047\u8bbe\u539f\u59cb\u6570\u636e\u5df2\u6574\u7406\u6210\u5982\u4e0b\u7ed3\u6784\uff08\u793a\u4f8b\uff09\uff1a</p> <pre><code>/data/my_dataset_raw/\n  train/\n    000001.jpg\n    000001.json\n    000002.jpg\n    000002.json\n    ...\n  val/\n    100001.jpg\n    100001.json\n    ...\n</code></pre> <p>\u5176\u4e2d <code>*.json</code> \u81f3\u5c11\u5305\u542b\uff1a</p> <pre><code>{\"id\": \"000001\", \"image_path\": \"/data/my_dataset_raw/train/000001.jpg\", \"label_name\": \"cat\"}\n</code></pre> <p>\u63d0\u793a\uff1a\u4e5f\u53ef\u4ee5\u7528 CSV/JSONL \u7b49\u4efb\u610f\u683c\u5f0f\uff0c\u5173\u952e\u662f\u80fd\u5728 <code>_generate_examples</code> \u91cc\u8bfb\u51fa\u6765\u5e76\u6620\u5c04\u5230\u7279\u5f81\u5b57\u6bb5\u3002</p>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#32-builder","title":"3.2 \u5b9a\u4e49\u6700\u5c0f Builder\uff08\u4ec5\u672c\u5730\u81ea\u7528\u6240\u9700\u5b57\u6bb5\uff09","text":"<pre><code># pip install tensorflow tensorflow-datasets\nimport tensorflow_datasets as tfds\n\nclass MyDataset(tfds.core.GeneratorBasedBuilder):\n    VERSION = tfds.core.Version(\"1.0.0\")\n\n    def _info(self):\n        return tfds.core.DatasetInfo(\n            features=tfds.features.FeaturesDict({\n                \"image\": tfds.features.Image(shape=(None, None, 3)),\n                \"label\": tfds.features.ClassLabel(names=[\"cat\", \"dog\"]),\n                \"id\": tf.string,\n            }),\n            supervised_keys=(\"image\", \"label\"),  # \u4fbf\u4e8e as_supervised=True \u8fd4\u56de (x, y)\n        )\n\n    def _split_generators(self, dl_manager):\n        root = \"/data/my_dataset_raw\"  # \u6539\u6210\u539f\u59cb\u6570\u636e\u6839\u76ee\u5f55\n        return {\n            \"train\": self._generate_examples(f\"{root}/train\"),\n            \"val\":   self._generate_examples(f\"{root}/val\"),\n        }\n\n    def _generate_examples(self, path):\n        # \u8bfb\u53d6 path \u4e0b\u7684 *.json\uff0c\u4ea7\u51fa (key, example_dict)\n        import os, json, glob\n        for meta_file in glob.glob(os.path.join(path, \"*.json\")):\n            meta = json.load(open(meta_file, \"r\"))\n            key  = meta[\"id\"]                       # \u4efb\u4f55\u53ef\u552f\u4e00\u6807\u8bc6\u6837\u672c\u7684\u5b57\u7b26\u4e32\n            yield key, {\n                \"image\": meta[\"image_path\"],        # \u8def\u5f84/bytes/ndarray \u5747\u53ef\n                \"label\": meta[\"label_name\"],        # \u5fc5\u987b\u5728 names=[\"cat\",\"dog\"] \u5185\n                \"id\":    str(meta[\"id\"]),\n            }\n</code></pre> <p>\u8bf4\u660e\uff1a<code>example_dict</code> \u7684\u952e \u5fc5\u987b\u4e0e <code>_info()</code> \u4e2d <code>features</code> \u7684\u952e\u4e00\u81f4\uff1b<code>meta[\"...\"]</code> \u662f\u539f\u59cb\u6807\u6ce8\u91cc\u7684\u5b57\u6bb5\u540d\uff0c\u4e0d\u8981\u6c42\u540c\u540d\u3002</p>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#33-tfds","title":"3.3 \u6784\u5efa\uff08\u5199\u5165\u672c\u5730 TFDS \u5206\u7247\uff09","text":"<pre><code>import tensorflow_datasets as tfds\n\n# data_dir \u662f TFDS \u8f93\u51fa\u76ee\u5f55\uff08\u5199\u51fa\u7684 .tfrecord + dataset_info.json + checksums\uff09\nDATA_DIR = \"/data/tfds_store\"\n\nbuilder = tfds.builder(\"my_dataset\")   # \u7c7b\u540d MyDataset -&gt; \u540d\u5b57 \"my_dataset\"\nbuilder.download_and_prepare(data_dir=DATA_DIR)\n</code></pre> <p>\u6784\u5efa\u5b8c\u6210\u540e\uff0c\u76ee\u5f55\u7c7b\u4f3c\uff1a</p> <pre><code>/data/tfds_store/my_dataset/1.0.0/\n  my_dataset-train.tfrecord-00000-of-00050\n  my_dataset-train.tfrecord-00001-of-00050\n  ...\n  my_dataset-val.tfrecord-00000-of-00005\n  dataset_info.json\n  checksums.tsv\n</code></pre> <p>\u5206\u7247\u547d\u540d\u542b\u4e49\uff1a<code>{name}-{split}.tfrecord-{idx:05d}-of-{num:05d}</code>\uff0c\u5373\u7b2c <code>idx</code> \u4e2a\u5206\u7247\u3001\u5171 <code>num</code> \u7247\u3002\u591a\u5206\u7247\u4fbf\u4e8e\u5e76\u884c\u8bfb\u4e0e\u5931\u8d25\u91cd\u8bd5\u3002</p>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#34","title":"3.4 \u6570\u636e\u67e5\u9a8c\uff08\u5feb\u901f\u62bd\u6837\u4e0e\u5143\u4fe1\u606f\uff09","text":"<pre><code>import tensorflow_datasets as tfds\nimport numpy as np\n\nds_train = tfds.load(\n    \"my_dataset\", split=\"train\", data_dir=\"/data/tfds_store\",\n    as_supervised=True, shuffle_files=False\n)\n\nfor i, (x, y) in enumerate(tfds.as_numpy(ds_train.take(3))):\n    print(i, x.shape, x.dtype, int(y))\n</code></pre> <p>\u67e5\u770b\u5143\u4fe1\u606f\uff1a</p> <pre><code>b = tfds.builder(\"my_dataset\", data_dir=\"/data/tfds_store\")\ninfo = b.info\nprint(info.version, info.splits, info.features)\n</code></pre>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#4-webdataset-tfds-pytorch","title":"4. WebDataset\uff1a\u4ece TFDS \u5230 PyTorch \u5206\u5e03\u5f0f\u8bad\u7ec3","text":"","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#41-tfds-webdataset","title":"4.1 \u5c06 TFDS \u8f6c\u4e3a WebDataset","text":"<p>\u672c\u5730\u6784\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u628a TFDS \u6837\u672c\u6d41\u8f6c\u6210 <code>.tar</code> \u5206\u7247\uff0c\u4fbf\u4e8e PyTorch \u5728\u591a\u673a\u591a\u5361\u4e0b\u9ad8\u541e\u5410\u8bad\u7ec3\u3002\u6838\u5fc3\u8f6c\u6362\u793a\u610f\uff08\u53ef\u5d4c\u5165\u5176\u4ed6\u6570\u636e\u5de5\u7a0b\u811a\u672c\uff09\uff1a</p> <pre><code>import tensorflow_datasets as tfds\nfrom PIL import Image\nfrom io import BytesIO\nimport tarfile, os, json\n\ndef write_sample(tar, key, pil_img, label, meta=None):\n    \"\"\"\n    \u5c06\u5355\u6761\u6837\u672c\u5199\u5165\u4e00\u4e2a\u5df2\u6253\u5f00\u7684 .tar \u5206\u7247\u4e2d\u3002\n    - key: \u6837\u672c\u552f\u4e00\u952e\uff08\u7528\u4e8e\u751f\u6210 000001.jpg / 000001.cls / 000001.json\uff09\n    - pil_img: PIL.Image \u683c\u5f0f\u7684\u56fe\u50cf\n    - label: \u6574\u6570\u6807\u7b7e\uff08\u6216\u53ef\u8f6c\u4e3a int \u7684\u5b57\u7b26\u4e32\uff09\n    - meta: \u53ef\u9009\u7684\u5b57\u5178\u5143\u4fe1\u606f\uff0c\u5c06\u4ee5 JSON \u5f62\u5f0f\u5199\u5165\n    \"\"\"\n    # 1) \u5199\u5165\u56fe\u50cf =&gt; {key}.jpg\n    buf = BytesIO()\n    pil_img.save(buf, format=\"JPEG\")  # \u5c06 PIL \u56fe\u7247\u7f16\u7801\u4e3a JPEG \u4e8c\u8fdb\u5236\n    ti = tarfile.TarInfo(f\"{key}.jpg\")\n    ti.size = len(buf.getvalue())     # TarInfo \u9700\u8981\u63d0\u524d\u77e5\u9053\u5c3a\u5bf8\n    tar.addfile(ti, BytesIO(buf.getvalue()))\n\n    # 2) \u5199\u5165\u6807\u7b7e =&gt; {key}.cls\n    lb = str(int(label)).encode()     # \u7edf\u4e00\u8f6c\u4e3a\u5b57\u8282\u4e32\uff0c\u5185\u5bb9\u4e3a\u7c7b\u522b\u6574\u6570\n    ti = tarfile.TarInfo(f\"{key}.cls\")\n    ti.size = len(lb)\n    tar.addfile(ti, BytesIO(lb))\n\n    # 3) \u53ef\u9009\uff1a\u5199\u5165\u5143\u4fe1\u606f =&gt; {key}.json\n    if meta is not None:\n        jb = json.dumps(meta).encode(\"utf-8\")\n        ti = tarfile.TarInfo(f\"{key}.json\")\n        ti.size = len(jb)\n        tar.addfile(ti, BytesIO(jb))\n\n\ndef tfds_split_to_wds(name, split, out_dir, data_dir, shard_size=50000):\n    \"\"\"\n    \u5c06 TFDS \u7684\u67d0\u4e2a split\uff08\u5982 'train'/'test'\uff09\u8f6c\u6362\u4e3a WebDataset \u7684 .tar \u5206\u7247\u96c6\u5408\u3002\n\n    \u53c2\u6570\uff1a\n    - name: TFDS \u6570\u636e\u96c6\u540d\u79f0\uff08\u5982 'cifar10' / 'my_dataset'\uff09\n    - split: \u8981\u5bfc\u51fa\u7684\u5207\u5206\uff08\u5982 'train' / 'test' / 'val'\uff09\n    - out_dir: \u8f93\u51fa .tar \u5206\u7247\u7684\u76ee\u5f55\n    - data_dir: TFDS \u6570\u636e\u6240\u5728\u76ee\u5f55\uff08\u6784\u5efa\u540e\u7684 TFRecord \u5b58\u653e\u8def\u5f84\uff09\n    - shard_size: \u6bcf\u4e2a .tar \u5206\u7247\u5305\u542b\u7684\u6837\u672c\u6570\u91cf\u4e0a\u9650\uff08\u5230\u8fbe\u4e0a\u9650\u5c31\u5207\u65b0\u5206\u7247\uff09\n    \"\"\"\n    os.makedirs(out_dir, exist_ok=True)\n\n    # \u52a0\u8f7d TFDS \u6570\u636e\u96c6\u4e3a (image, label) \u5f62\u5f0f\uff0c\u5e76\u505a\u8f7b\u5ea6\u9884\u53d6\u4ee5\u63d0\u5347\u8f6c\u6362\u541e\u5410\n    ds = tfds.load(\n        name,\n        split=split,\n        data_dir=data_dir,\n        as_supervised=True  # -&gt; (image, label)\n    ).prefetch(1024)\n\n    # \u521d\u59cb\u5316\u5206\u7247\u7f16\u53f7\u4e0e\u8ba1\u6570\u5668\n    shard_idx, in_shard = 0, 0\n    tar = tarfile.open(os.path.join(out_dir, f\"{name}-{split}-{shard_idx:06d}.tar\"), \"w\")\n\n    # \u904d\u5386\u6837\u672c\u6d41\uff08tfds.as_numpy \u5c06 TFDS \u6837\u672c\u8f6c\u4e3a numpy\uff09\n    for i, (img, label) in enumerate(tfds.as_numpy(ds)):\n        key = f\"{i:09d}\"  # \u4f7f\u7528 9 \u4f4d\u96f6\u586b\u5145\u7684\u987a\u5e8f\u7f16\u53f7\u4f5c\u4e3a\u6837\u672c key\uff08\u4fbf\u4e8e\u6392\u5e8f\u4e0e\u4e00\u81f4\u6027\uff09\n\n        # \u5c06 numpy \u7684 HWC uint8 \u56fe\u50cf\u8f6c\u6210 PIL\uff0c\u518d\u5199\u5165 tar\uff08\u540c\u65f6\u5199 label / meta\uff09\n        write_sample(\n            tar=tar,\n            key=key,\n            pil_img=Image.fromarray(img),\n            label=int(label),\n            meta={\"split\": split}  # \u53ef\u643a\u5e26\u5c11\u91cf\u8f85\u52a9\u4fe1\u606f\uff0c\u65b9\u4fbf\u540e\u7eed\u8c03\u8bd5\n        )\n        in_shard += 1\n\n        # \u8fbe\u5230\u5206\u7247\u4e0a\u9650\uff1a\u5173\u95ed\u5f53\u524d .tar\uff0c\u5f00\u542f\u4e0b\u4e00\u4e2a\u5206\u7247\n        if in_shard &gt;= shard_size:\n            tar.close()\n            shard_idx += 1\n            in_shard = 0\n            tar = tarfile.open(os.path.join(out_dir, f\"{name}-{split}-{shard_idx:06d}.tar\"), \"w\")\n\n    # \u6570\u636e\u904d\u5386\u7ed3\u675f\uff0c\u5173\u95ed\u6700\u540e\u4e00\u4e2a\u5206\u7247\n    tar.close()\n</code></pre> <p>\u7528\u6cd5\u793a\u4f8b:</p> <p>tfds_split_to_wds(name=\"my_dataset\", split=\"train\", out_dir=\"/data/wds/my_dataset\", data_dir=\"/data/tfds_store\", shard_size=50_000)</p>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/TFDS%20vs%20WebDataset/#42-webdataset-pytorch","title":"4.2 \u7528 WebDataset \u5728 PyTorch \u4e2d\u8bad\u7ec3\uff08\u542b\u5206\u5e03\u5f0f\u5207\u5206\uff09","text":"<pre><code># pip install webdataset torchvision\nimport os\nimport torch\nimport webdataset as wds\nfrom torch.utils.data import DataLoader\nfrom torchvision import transforms\n\n# \u8def\u5f84\u4e0e\u8d85\u53c2\u6570\uff08\u4e0e\u5bfc\u51fa\u7684wds\u8def\u5f84\u4e00\u81f4\uff09\n# \u8bad\u7ec3\u5206\u7247\uff08brace expansion\uff09\uff0c\u6839\u636e\u5206\u7247\u6570\u91cf\u8c03\u6574\u53f3\u8fb9\u754c\nTRAIN_URLS = \"/data/wds/my_dataset/my_dataset-train-{000000..000123}.tar\"\nVAL_URLS   = \"/data/wds/my_dataset/my_dataset-val-{000000..000009}.tar\"\n\nBATCH_SIZE = 256           # \u5927 batch \u5efa\u8bae\u914d\u5408\u591a\u8fdb\u7a0b\u4e0e\u8db3\u591f\u5e26\u5bbd\nNUM_WORKERS = 8\nPREFETCH_FACTOR = 2\nIMAGE_SIZE = 224           # \u793a\u4f8b\uff1a224 \u8f93\u5165\nLABEL_NAMES = [\"cat\", \"dog\"]  # \u4ec5\u4f9b\u6ce8\u91ca\u53c2\u8003\uff08\u8bad\u7ec3\u76f4\u63a5\u7528 int \u6807\u7b7e\uff09\n\n# \u5b9a\u4e49\u56fe\u7247\u589e\u5f3a\ntfms = transforms.Compose([\n    transforms.Resize(256),\n    transforms.CenterCrop(IMAGE_SIZE),\n    transforms.ToTensor(),\n])\n\n\ndef parse_sample(sample):\n    \"\"\"\n    \u83b7\u53d6\u4e00\u4e2a\u6570\u636e\u6837\u672c\uff0c\u53ef\u4ee5\u5728\u8be5\u51fd\u6570\u4e2d\u5b9e\u73b0\u6570\u636e\u9884\u5904\u7406\n    WebDataset \u6bcf\u4e2a\u6837\u672c\u662f\u4e00\u4e2a dict\uff1a\n      sample[\"jpg\"] : PIL.Image\n      sample[\"cls\"] : bytes/int\uff08\u8fd9\u91cc\u6211\u4eec\u4fdd\u5b58\u7684\u662f\u6587\u672c\u6574\u6570\uff0c\u5982 b\"0\" \u6216 b\"1\"\uff09\n      sample[\"__key__\"] : \u53ef\u9009\uff0c\u6837\u672c\u952e\n      sample[\"json\"] : \u53ef\u9009\uff0c\u5143\u4fe1\u606f\n    \"\"\"\n    img = tfms(sample[\"jpg\"]) # \u6b64\u5904\u8f6c\u4e3a\u4e86Tensor\u683c\u5f0f\n    y_raw = sample[\"cls\"]\n    # .cls \u901a\u5e38\u662f bytes\uff08\u5982 b\"0\"\uff09\uff0c\u4e5f\u53ef\u80fd\u5df2\u88ab\u8bfb\u53d6\u4e3a int\uff1b\u7edf\u4e00\u8f6c int\n    if isinstance(y_raw, (bytes, bytearray)):\n        y = int(y_raw.decode(\"utf-8\"))\n    else:\n        y = int(y_raw)\n    return img, y\n\n\n# \u4ece WebDataset \u5230 PyTorch Iterable\ndef make_wds_loader(urls, parser, batch_size=BATCH_SIZE, shuffle_buf=10_000, training=True):\n    ds = (\n        wds.WebDataset(urls, shardshuffle=True)  # \u5206\u7247\u7ea7\u968f\u673a\u5316\n          .split_by_node()                      # \u591a\u673a\u5207\u5206\uff08DDP \u591a\u8282\u70b9\uff09\n          .split_by_worker()                    # DataLoader \u591a worker \u5207\u5206\n          .shuffle(shuffle_buf if training else 0)  # \u6837\u672c\u7ea7\u5c0f\u7f13\u51b2\u533a\u6253\u4e71\uff08\u9a8c\u8bc1\u53ef\u4e3a 0\uff09\n          .decode(\"pil\")                        # \u5c06\u56fe\u50cf\u89e3\u7801\u4e3a PIL.Image\n          .map(parser)                          # \u53d8\u6362\u4e3a (img, label)\n          .batched(batch_size, partial=True)    # \u6253\u5305\u4e3a\u6279\u6b21\uff1bpartial=True \u4fdd\u7559\u4e0d\u6ee1\u6279\n    )\n    loader = DataLoader(\n        ds,\n        batch_size=None,                # \u5df2\u5728 .batched \u5b8c\u6210\u7ec4\u6279\n        num_workers=NUM_WORKERS,\n        prefetch_factor=PREFETCH_FACTOR,\n        persistent_workers=True,\n        pin_memory=True                 # \u82e5\u4f7f\u7528 GPU \u8bad\u7ec3\u5efa\u8bae\u6253\u5f00\n    )\n    return loader\n\ntrain_loader = make_wds_loader(TRAIN_URLS, parse_sample, training=True)\nval_loader = make_wds_loader(VAL_URLS, parse_sample, training=False)\n\n# \u8bad\u7ec3/\u9a8c\u8bc1\uff08\u793a\u4f8b\uff09\nimport torch.nn as nn\nimport torch.optim as optim\nfrom torchvision.models import resnet18\n\ndevice = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n\nmodel = resnet18(num_classes=len(LABEL_NAMES)).to(device)\ncriterion = nn.CrossEntropyLoss()\noptimizer = optim.AdamW(model.parameters(), lr=3e-4)\n\ndef train_one_epoch(epoch):\n    model.train()\n    for step, (images, targets) in enumerate(train_loader):\n        images = images.to(device, non_blocking=True) # \u5728parse_sample\u4e2d\u5df2\u5c06\u5176\u8f6c\u4e3aTensor\u683c\u5f0f\n        targets = torch.as_tensor(targets, dtype=torch.long, device=device)\n\n        logits = model(images)\n        loss = criterion(logits, targets)\n\n        optimizer.zero_grad(set_to_none=True)\n        loss.backward()\n        optimizer.step()\n\n        if step % 50 == 0:\n            print(f\"[Epoch {epoch}] step={step} loss={loss.item():.4f}\")\n\n@torch.no_grad()\ndef evaluate():\n    model.eval()\n    total, correct = 0, 0\n    for images, targets in val_loader:\n        images = images.to(device, non_blocking=True)\n        targets = torch.as_tensor(targets, dtype=torch.long, device=device)\n        logits = model(images)\n        pred = logits.argmax(dim=1)\n        total += targets.numel()\n        correct += (pred == targets).sum().item()\n    acc = correct / max(1, total)\n    print(f\"[Eval] acc={acc:.4%}\")\n\nfor epoch in range(1, 6):\n    train_one_epoch(epoch)\n    evaluate()\n</code></pre> <p>\u5728 DDP/\u591a\u673a\u591a\u5361\u4e2d\u7684\u8981\u70b9</p> <ul> <li>DDP \u521d\u59cb\u5316\uff08<code>torchrun</code>/<code>torch.distributed.launch</code>\uff09\u540e\u518d\u521b\u5efa <code>dataset</code>\uff0c\u4f7f <code>.split_by_node()</code> \u611f\u77e5\u4e16\u754c\u5927\u5c0f\u4e0e rank\u3002</li> <li>\u968f\u673a\u6027\uff1a\u6bcf\u8f6e\uff08epoch\uff09\u53ef\u901a\u8fc7 <code>wds.ResampledShards</code> \u6216\u91cd\u5efa <code>WebDataset</code> \u5b9e\u4f8b\u6765\u5b9e\u73b0\u5206\u7247\u7ea7\u91cd\u91c7\u6837\uff1b\u6216\u8bbe\u7f6e <code>epoch</code> \u76f8\u5173\u79cd\u5b50\u5f71\u54cd <code>.shuffle(buf)</code> \u7684\u987a\u5e8f\u3002</li> <li>I/O \u541e\u5410\uff1a\u9002\u5f53\u589e\u5927 <code>num_workers</code>\u3001<code>prefetch_factor</code>\u3001<code>bufsize</code>\uff08<code>.shuffle(bufsize)</code>\uff09\uff0c\u5e76\u4fdd\u8bc1\u7f51\u7edc\u6216\u78c1\u76d8\u5e26\u5bbd\u5145\u8db3\u3002</li> <li>\u8fdc\u7a0b\u5b58\u50a8\uff1a<code>urls</code> \u53ef\u7528 <code>https://.../shard-{...}.tar</code> \u6216 <code>s3://...</code>\uff0c\u652f\u6301\u6d41\u5f0f\u8bad\u7ec3\u3002</li> </ul>","tags":["\u6570\u636e\u5de5\u7a0b"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/","title":"ZeRO\u4f18\u5316\u5668\u8bbe\u8ba1\u7406\u5ff5\u89e3\u6790","text":"\u6807\u7b7e\uff1a \u5e76\u884c\u8bad\u7ec3LLM","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#1","title":"1. \u80cc\u666f\u4e0e\u52a8\u673a","text":"<p>\u968f\u7740\u6df1\u5ea6\u5b66\u4e60\u6a21\u578b\u53c2\u6570\u89c4\u6a21\u4e0d\u65ad\u6500\u5347\uff0c\u4f20\u7edf\u7684\u6570\u636e\u5e76\u884c (Data Parallel, DP) \u8bad\u7ec3\u9762\u4e34\u4e25\u91cd\u7684\u663e\u5b58\u74f6\u9888\u3002\u5728\u6807\u51c6DP\u4e2d\uff0c\u6bcf\u5757GPU\u90fd\u7ef4\u62a4\u6a21\u578b\u7684\u5b8c\u6574\u62f7\u8d1d\uff0c\u5305\u62ec\u6a21\u578b\u53c2\u6570\u3001\u5404\u5c42\u68af\u5ea6\u548c\u4f18\u5316\u5668\u72b6\u6001\u3002\u8fd9\u79cd\u72b6\u6001\u5197\u4f59\u5bfc\u81f4\u663e\u5b58\u9700\u6c42\u968fGPU\u6570\u7ebf\u6027\u589e\u52a0\uff0c\u5374\u65e0\u6cd5\u901a\u8fc7\u589e\u52a0GPU\u6765\u964d\u4f4e\u5355\u5361\u5185\u5b58\u5360\u7528\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5728\u5f53\u524d32GB\u663e\u5b58\u7684GPU\u4e0a\uff0c\u57fa\u7840DP\u5728\u6a21\u578b\u8d85\u8fc7\u7ea614\u4ebf\u53c2\u6570\u65f6\u5c31\u4f1a\u5185\u5b58\u8017\u5c3d (OOM)\u3002\u4ee5GPT-2 (15\u4ebf\u53c2\u6570) \u4e3a\u4f8b\uff0c\u4ec5Adam\u4f18\u5316\u5668\u7684\u72b6\u6001 (\u6743\u91cd\u7684FP32\u526f\u672c\u3001\u4e00\u9636\u68af\u5ea6m\u548c\u4e8c\u9636\u68af\u5ea6v) \u5373\u5360\u7528\u7ea618GB\u663e\u5b58\uff0c\u5728\u5355\u536132GB\u73af\u5883\u4e0b\u65e0\u6cd5\u8bad\u7ec3\u3002\u5373\u4f7f\u4f7f\u75288\u5f20GPU\u505a\u6570\u636e\u5e76\u884c\uff0c\u4f20\u7edfDP\u4ecd\u4f1a\u5728\u6bcf\u5361\u590d\u5236\u8fd918GB\u4f18\u5316\u5668\u72b6\u6001\uff0c\u603b\u663e\u5b58\u9700\u6c42\u8fdc\u8d85\u5355\u5361\u9650\u5236\u3002\u56e0\u6b64\uff0c\u5927\u6a21\u578b\u8bad\u7ec3\u4e9f\u9700\u65b0\u7684\u5e76\u884c\u7b56\u7565\u6765\u7a81\u7834\u663e\u5b58\u58c1\u5792\u3002</p> <p>Zero Redundancy Optimizer (ZeRO) \u7531\u5fae\u8f6fDeepSpeed\u56e2\u961f\u63d0\u51fa\uff0c\u6b63\u662f\u4e3a\u89e3\u51b3\u4e0a\u8ff0\u5185\u5b58\u5197\u4f59\u95ee\u9898\u800c\u751f\u3002ZeRO\u7684\u6838\u5fc3\u601d\u60f3\u662f\u5229\u7528\u6570\u636e\u5e76\u884c\u96c6\u7fa4\u7684\u6574\u4f53\u5185\u5b58\u8d44\u6e90\uff0c\u901a\u8fc7\u5206\u533a\u5b58\u50a8\u6a21\u578b\u72b6\u6001\u6765\u6d88\u9664\u5404GPU\u95f4\u7684\u91cd\u590d\u5360\u7528\u3002\u7b80\u800c\u8a00\u4e4b\uff0c\u4e0d\u518d\u8ba9\u6bcf\u5f20\u5361\u90fd\u4fdd\u5b58\u5b8c\u6574\u7684\u53c2\u6570\u3001\u68af\u5ea6\u548c\u4f18\u5316\u5668\u72b6\u6001\uff0c\u800c\u662f\u6309\u9700\u5c06\u8fd9\u4e9b\u6570\u636e\u5207\u5206\u540e\u5206\u5e03\u5230\u4e0d\u540cGPU\uff0c\u53ea\u5728\u8ba1\u7b97\u65f6\u4e34\u65f6\u6c47\u96c6\u9700\u8981\u7684\u90e8\u5206\u3002\u8fd9\u79cd\u201c\u96f6\u5197\u4f59\u201d\u6570\u636e\u5e76\u884c\u65b9\u6848\uff08ZeRO-DP\uff09\u5728\u4fdd\u6301\u4e0e\u6570\u636e\u5e76\u884c\u76f8\u5f53\u7684\u8ba1\u7b97\u548c\u901a\u4fe1\u6548\u7387\u524d\u63d0\u4e0b\uff0c\u5927\u5e45\u63d0\u9ad8\u4e86\u5185\u5b58\u5229\u7528\u7387\u3002ZeRO\u7684\u51fa\u73b0\uff0c\u4f7f\u5f97\u6a21\u578b\u89c4\u6a21\u51e0\u4e4e\u53ef\u4ee5\u968f\u7740GPU\u6570\u91cf\u7ebf\u6027\u6269\u5c55\uff1a\u4f8b\u5982\u7406\u8bba\u4e0a1024\u5f20GPU\u5373\u53ef\u8bad\u7ec3\u5305\u542b1\u4e07\u4ebf\u53c2\u6570\u7684\u6a21\u578b\uff0c\u6bcf\u5361\u5206\u62c5\u7ea616GB\u663e\u5b58\u3002\u7814\u7a76\u8005\u5229\u7528ZeRO\u7684\u8fd9\u4e00\u7a81\u7834\u6210\u529f\u8bad\u7ec3\u4e86\u5f53\u65f6\u89c4\u6a21\u6700\u5927\u768417B\u53c2\u6570\u8bed\u8a00\u6a21\u578b\u3002\u603b\u7684\u6765\u8bf4\uff0cZeRO\u7684\u80cc\u666f\u52a8\u673a\u5728\u4e8e\u6d88\u9664\u6570\u636e\u5e76\u884c\u4e2d\u7684\u5185\u5b58\u5197\u4f59\uff0c\u4ece\u800c\u5728\u65e0\u9700\u4fee\u6539\u6a21\u578b\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u7a81\u7834\u5355\u673a\u663e\u5b58\u9650\u5236\uff0c\u652f\u6301\u767e\u4ebf\u4e43\u81f3\u4e07\u4ebf\u53c2\u6570\u7ea7\u6a21\u578b\u7684\u9ad8\u6548\u8bad\u7ec3\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#2-zero","title":"2. ZeRO \u4e09\u9636\u6bb5\u8bbe\u8ba1","text":"<p>ZeRO\u901a\u8fc7\u9010\u6b65\u589e\u5927\u7684\u5206\u7247\u8303\u56f4\u6765\u5b9e\u73b0\u5185\u5b58\u4f18\u5316\uff0c\u5171\u5212\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff08Stage 1/2/3\uff09\uff0c\u6bcf\u4e2a\u9636\u6bb5\u5728\u524d\u4e00\u9636\u6bb5\u57fa\u7840\u4e0a\u8fdb\u4e00\u6b65\u51cf\u5c11\u663e\u5b58\u5197\u4f59\u3002\u5404\u9636\u6bb5\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u5206\u7247\u5bf9\u8c61\u7684\u4e0d\u540c\uff1a</p> <ul> <li>ZeRO-1\uff1a\u4f18\u5316\u5668\u72b6\u6001\u5206\u7247 \u2013 \u53ea\u5bf9\u4f18\u5316\u5668\u72b6\u6001\u8fdb\u884c\u5206\u533a\uff0c\u6bcf\u5757GPU\u4ec5\u7ef4\u62a4\u5168\u90e8\u4f18\u5316\u5668\u72b6\u6001\u4e2d\u7684\u4e00\u90e8\u5206\u3002\u8fd9\u6837\u53ef\u4ee5\u663e\u8457\u524a\u51cfAdam\u7b49\u4f18\u5316\u5668\u5e26\u6765\u7684\u5185\u5b58\u5360\u7528\uff0c\u4f46\u6a21\u578b\u53c2\u6570\u548c\u68af\u5ea6\u4ecd\u5b8c\u6574\u590d\u5236\u5728\u6bcf\u5361\u4e0a\u3002</li> <li>ZeRO-2\uff1a\u4f18\u5316\u5668\u72b6\u6001 + \u68af\u5ea6\u5206\u7247 \u2013 \u5728ZeRO-1\u57fa\u7840\u4e0a\uff0c\u8fdb\u4e00\u6b65\u5c06\u53cd\u5411\u4f20\u64ad\u4ea7\u751f\u7684\u68af\u5ea6\u4e5f\u5206\u7247\u5b58\u50a8\uff0c\u5404GPU\u53ea\u4fdd\u7559\u5bf9\u5e94\u90e8\u5206\u7684\u68af\u5ea6\u3002\u8fd9\u8fdb\u4e00\u6b65\u964d\u4f4e\u663e\u5b58\u9700\u6c42\uff0c\u4f46\u6a21\u578b\u53c2\u6570\u672c\u8eab\u4ecd\u672a\u5206\u7247\u3002</li> <li>ZeRO-3\uff1a\u53c2\u6570 + \u68af\u5ea6 + \u4f18\u5316\u5668\u72b6\u6001\u4e09\u91cd\u5206\u7247 \u2013 \u5bf9\u6a21\u578b\u8bad\u7ec3\u4e2d\u7684\u6240\u6709\u4e09\u7c7b\u4e3b\u8981\u72b6\u6001\u90fd\u505a\u5206\u7247\u3002\u4e5f\u5373\u53c2\u6570\u3001\u68af\u5ea6\u548c\u4f18\u5316\u5668\u72b6\u6001\u5747\u6253\u6563\u5206\u914d\u5230\u6240\u6709GPU\uff0c\u771f\u6b63\u5b9e\u73b0\u201c\u96f6\u5197\u4f59\u201d\u3002\u8fd9\u662f\u5185\u5b58\u4f18\u5316\u5e45\u5ea6\u6700\u5927\u4f46\u5b9e\u73b0\u4e5f\u6700\u590d\u6742\u7684\u9636\u6bb5\u3002</li> </ul> <p>\u4e0b\u9762\u5206\u522b\u4ecb\u7ecd\u6bcf\u4e2a\u9636\u6bb5\u7684\u539f\u7406\u3001\u901a\u4fe1\u5f00\u9500\u548c\u4f18\u7f3a\u70b9\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#21-zero-1","title":"2.1 ZeRO-1\uff1a\u4f18\u5316\u5668\u72b6\u6001\u5206\u7247","text":"<p>\u539f\u7406\uff1a \u5c06\u4f18\u5316\u5668\u7684\u6240\u6709\u72b6\u6001\u6309\u53c2\u6570\u5212\u5206\u4e3aN\u4efd\uff0c\u5206\u914d\u7ed9N\u4e2aGPU\u8fdb\u7a0b\u4e2d\u7684\u5404\u4e00\u4e2a\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8eAdam\u4f18\u5316\u5668\uff0c\u6bcf\u4e2a\u53c2\u6570\u5bf9\u5e94\u7684FP32\u6743\u91cd\u526f\u672c\u3001\u4e00\u9636\u52a8\u91cfm\u3001\u4e8c\u9636\u52a8\u91cfv\u8fd9\u4e09\u9879\u4f1a\u62c6\u5206\u6210N\u5757\uff0c\u4ee4\u7b2ci\u4e2aGPU\u4ec5\u4fdd\u5b58\u7b2ci\u5757\u5e76\u66f4\u65b0\u76f8\u5173\u53c2\u6570\u3002\u8fd9\u6837\u6bcf\u5f20\u5361\u53ea\u9700\u7ef4\u62a4\u539f\u672c1/N\u7684\u4f18\u5316\u5668\u72b6\u6001\uff0c\u5185\u5b58\u5360\u7528\u4e0b\u964d\u7ea6N\u500d\u3002\u5728\u4e00\u4e2a\u8bad\u7ec3step\u7ed3\u675f\u65f6\uff0c\u5404GPU\u9700\u8981\u540c\u6b65\u5b83\u4eec\u66f4\u65b0\u7684\u53c2\u6570\u7247\u6bb5\uff0c\u4ee5\u786e\u4fdd\u6240\u6709\u5361\u4e0a\u7684\u53c2\u6570\u4e00\u81f4\u3002\u8fd9\u901a\u5e38\u901a\u8fc7\u4e00\u6b21\u5168\u5c40All-Gather\u64cd\u4f5c\u6536\u96c6\u66f4\u65b0\u540e\u7684\u53c2\u6570\u6765\u5b8c\u6210\u3002</p> <p>\u901a\u4fe1\u5f00\u9500\uff1a ZeRO-1\u7684\u901a\u4fe1\u6a21\u5f0f\u4e0e\u5e38\u89c4\u6570\u636e\u5e76\u884c\u975e\u5e38\u63a5\u8fd1\uff0c\u56e0\u4e3a\u6b63\u5411\u548c\u53cd\u5411\u8fc7\u7a0b\u4e2d\u5404\u5361\u4ecd\u62e5\u6709\u5b8c\u6574\u53c2\u6570\u53c2\u4e0e\u8ba1\u7b97\u3002\u4e3b\u8981\u7684\u901a\u4fe1\u4ec5\u53d1\u751f\u5728\u53cd\u5411\u540e\u7684\u68af\u5ea6\u5f52\u5e76\uff08All-Reduce\u6216\u7b49\u4ef7\u5b9e\u73b0\uff09\u4ee5\u53ca\u4f18\u5316\u5668\u66f4\u65b0\u540e\u7684\u53c2\u6570\u540c\u6b65\u4e0a\u3002\u76f8\u8f83\u4e8e\u6807\u51c6DP\uff0cZeRO-1\u51e0\u4e4e\u6ca1\u6709\u989d\u5916\u901a\u4fe1\u91cf\u5f00\u9500\uff0c\u901a\u4fe1\u6210\u672c\u4e0e\u4f20\u7edf\u6570\u636e\u5e76\u884c\u7c7b\u4f3c\u3002\u56e0\u6b64ZeRO-1\u7684\u8ba1\u7b97\u901f\u5ea6\u4e0eDP\u57fa\u672c\u6301\u5e73\uff0c\u4f46\u663e\u5b58\u5f00\u9500\u663e\u8457\u964d\u4f4e\u3002</p> <p>\u4f18\u7f3a\u70b9\uff1a \u4f18\u70b9\u662f\u5b9e\u73b0\u7b80\u5355\u3001\u5bf9\u73b0\u6709\u8bad\u7ec3\u6d41\u7a0b\u6539\u52a8\u5c0f\uff0c\u901a\u4fe1\u4ee3\u4ef7\u4f4e\uff0c\u80fd\u591f\u76f4\u63a5\u5c06\u4f18\u5316\u5668\u72b6\u6001\u5185\u5b58\u51cf\u5c11\u7ea64\u500d\u3002\u9488\u5bf9\u4f18\u5316\u5668\u72b6\u6001\u5360\u6bd4\u8f83\u9ad8\u7684\u573a\u666f\uff08\u4f8b\u5982Adam\u5728FP16\u8bad\u7ec3\u4e0b\u72b6\u6001\u53ef\u8fbe\u53c2\u65704\u500d\u4ee5\u4e0a\uff09\u6548\u679c\u7a81\u51fa\u3002\u7f3a\u70b9\u662f\u5728\u6a21\u578b\u53c2\u6570\u672c\u8eab\u5f88\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u4ecd\u9700\u6bcf\u5361\u4fdd\u5b58\u5b8c\u6574\u53c2\u6570\u548c\u68af\u5ea6\uff0c\u65e0\u6cd5\u5f7b\u5e95\u89e3\u51b3\u8d85\u5927\u6a21\u578b\u7684\u663e\u5b58\u74f6\u9888\u3002\u56e0\u6b64ZeRO-1\u9002\u5408\u6a21\u578b\u89c4\u6a21\u4e2d\u7b49\u4f46\u4f18\u5316\u5668\u5185\u5b58\u5360\u7528\u5de8\u5927\u7684\u60c5\u51b5\uff0c\u4f8b\u5982\u53c2\u6570\u6570\u4ebf\u3001\u4f7f\u7528Adam\u4f18\u5316\u5668\u7684\u6a21\u578b\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#22-zero-2","title":"2.2 ZeRO-2\uff1a\u4f18\u5316\u5668\u72b6\u6001 + \u68af\u5ea6\u5206\u7247","text":"<p>\u539f\u7406\uff1a \u5728ZeRO-1\u7684\u57fa\u7840\u4e0a\uff0cZeRO-2\u8fdb\u4e00\u6b65\u5c06\u53cd\u5411\u4f20\u64ad\u7684\u68af\u5ea6\u4e5f\u6309\u53c2\u6570\u5206\u533a\u3002\u6bcf\u4e2aGPU\u5728\u53cd\u5411\u4e2d\u53ea\u8ba1\u7b97\u5e76\u4fdd\u7559\u81ea\u5df1\u8d1f\u8d23\u53c2\u6570\u7684\u90a3\u90e8\u5206\u68af\u5ea6\uff0c\u5176\u4f59\u68af\u5ea6\u901a\u8fc7\u5206\u5e03\u5f0f\u89c4\u7ea6\u540e\u5c31\u5730\u4e22\u5f03\u3002\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u5f53\u5404\u5c42\u53cd\u5411\u8ba1\u7b97\u4ea7\u751f\u68af\u5ea6\u65f6\uff0c\u7cfb\u7edf\u5c06\u5bf9\u5e94\u68af\u5ea6\u6839\u636e\u53c2\u6570\u6240\u5c5e\u5206\u533a\u6267\u884cReduce-Scatter\u64cd\u4f5c\uff1a\u5c06\u4e0d\u540c\u53c2\u6570\u7684\u68af\u5ea6\u5212\u5206\u5e76\u89c4\u7ea6\u5230\u8d1f\u8d23\u8be5\u5206\u533a\u7684GPU\u4e0a\u3002\u8fd9\u6837\u6bcf\u5f20\u5361\u6700\u7ec8\u53ea\u7559\u4e0b\u4e861/N\u7684\u68af\u5ea6\uff08\u5373\u4e0e\u5176\u53c2\u6570\u5206\u533a\u5bf9\u5e94\u7684\u90e8\u5206\uff09\uff0c\u4e0d\u7528\u518d\u5b58\u50a8\u5b8c\u6574\u68af\u5ea6\u77e9\u9635\u3002\u4f18\u5316\u5668\u66f4\u65b0\u65f6\uff0c\u5404GPU\u4ecd\u5404\u81ea\u4f7f\u7528\u672c\u5730\u7684\u68af\u5ea6\u5206\u7247\u548c\u4f18\u5316\u5668\u72b6\u6001\u5206\u7247\u6765\u66f4\u65b0\u5bf9\u5e94\u7684\u53c2\u6570\u5206\u7247\uff0c\u672c\u8d28\u4e0a\u5b9e\u73b0\u4e86\u6570\u636e\u5e76\u884c\u4e0b\u68af\u5ea6\u540c\u6b65\u548c\u53c2\u6570\u66f4\u65b0\u7684\u878d\u5408\u3002</p> <p>\u901a\u4fe1\u5f00\u9500\uff1a ZeRO-2\u76f8\u6bd4ZeRO-1\u589e\u52a0\u4e86\u68af\u5ea6\u5f52\u5e76\u7684\u901a\u4fe1\u6b65\u9aa4\u3002\u4f20\u7edfDP\u4f7f\u7528All-Reduce\u6c47\u603b\u68af\u5ea6\uff0c\u800cZeRO-2\u91c7\u7528\u7b49\u4ef7\u7684Reduce-Scatter\uff08\u89c4\u7ea6\u5e76\u6563\u64ad\uff09\u6765\u5b8c\u6210\u68af\u5ea6\u540c\u6b65\u3002\u603b\u901a\u4fe1\u91cf\u4e0eAll-Reduce\u76f8\u5f53\uff0c\u4f46\u901a\u8fc7\u89c4\u7ea6\u5230\u4e0d\u540cGPU\u907f\u514d\u4e86\u5168\u526f\u672c\u68af\u5ea6\u7684\u5b58\u50a8\u3002\u56e0\u6b64\u901a\u4fe1\u5f00\u9500\u76f8\u5bf9ZeRO-1\u7565\u6709\u63d0\u9ad8\uff0c\u4f46\u4ecd\u4fdd\u6301\u5728\u4e0eDP\u540c\u9636\u7684\u91cf\u7ea7\u3002\u6b64\u5916\uff0cDeepSpeed\u5728ZeRO-2\u4e2d\u5e38\u7528\u201c\u901a\u4fe1\u6876 (bucket)\u201d\u7b56\u7565\uff0c\u5c06\u591a\u4e2a\u5c0f\u68af\u5ea6\u6253\u5305\u540e\u518d\u505aReduce-Scatter\uff0c\u51cf\u5c11\u901a\u4fe1\u6b21\u6570\u5e76\u53ef\u4ee5\u4e0e\u53cd\u5411\u8ba1\u7b97\u91cd\u53e0\u3002\u7efc\u4e0a\uff0cZeRO-2\u7684\u901a\u4fe1\u4ee3\u4ef7\u4e2d\u7b49\uff0c\u53ef\u901a\u8fc7\u5f02\u6b65\u5316\u548c\u5206\u6876\u4f18\u5316\u6765\u51cf\u5c0f\u5f71\u54cd\u3002</p> <p>\u4f18\u7f3a\u70b9\uff1a \u76f8\u8f83ZeRO-1\uff0cZeRO-2\u8fdb\u4e00\u6b65\u91ca\u653e\u4e86\u5b58\u50a8\u68af\u5ea6\u7684\u5185\u5b58\uff0c\u4ee4\u6bcf\u5361\u663e\u5b58\u5360\u7528\u6700\u591a\u53ef\u7f29\u51cf\u5230\u539f\u6765\u76841/8\uff08\u7406\u8bba8\u500d\u964d\u4f4e\uff09\u3002\u8fd9\u4f7f\u5f97\u5728\u76f8\u540c\u786c\u4ef6\u4e0a\u53ef\u4ee5\u8bad\u7ec3\u66f4\u5927\u6a21\u578b\u6216\u4f7f\u7528\u66f4\u5927batch\u3002\u5176\u7f3a\u70b9\u662f\u5b9e\u73b0\u590d\u6742\u5ea6\u548c\u901a\u4fe1\u91cf\u6709\u6240\u589e\u52a0\uff0c\u5c24\u5176\u662f\u5728\u68af\u5ea6\u5927\u91cf\u3001\u901a\u4fe1\u5e26\u5bbd\u6709\u9650\u7684\u573a\u666f\u4e0b\u53ef\u80fd\u5f71\u54cd\u8bad\u7ec3\u541e\u5410\u3002\u4f46\u603b\u4f53\u800c\u8a00\uff0cZeRO-2\u5728\u663e\u5b58\u6362\u53d6\u5c11\u91cf\u901a\u4fe1\u7684\u6298\u8877\u4e0a\u6027\u4ef7\u6bd4\u8f83\u9ad8\uff0c\u9002\u5408GPU\u6570\u91cf\u6709\u9650\u4f46\u5e0c\u671b\u8bad\u7ec3\u63a5\u8fd1\u5341\u4ebf\u7ea7\u6a21\u578b\u7684\u60c5\u51b5\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#23-zero-3","title":"2.3 ZeRO-3\uff1a\u5168\u53c2\u6570\u72b6\u6001\u5206\u7247","text":"<p>\u539f\u7406\uff1a ZeRO-3\u662fZeRO\u7cfb\u5217\u7684\u6700\u7ec8\u9636\u6bb5\uff0c\u5bf9\u6a21\u578b\u53c2\u6570\u3001\u68af\u5ea6\u548c\u4f18\u5316\u5668\u72b6\u6001\u8fdb\u884c\u4e09\u91cd\u7ec6\u7c92\u5ea6\u5206\u7247\u3002\u5728\u8be5\u6a21\u5f0f\u4e0b\uff0c\u6ca1\u6709\u4efb\u4f55\u4e00\u4e2aGPU\u4fdd\u5b58\u6574\u4e2a\u6a21\u578b\u7684\u53c2\u6570\uff1a\u6bcf\u4e2aGPU\u53ea\u6301\u6709\u5168\u90e8\u53c2\u6570\u4e2d\u76841/N\uff08\u5047\u8bbeN\u5f20\u5361\uff09\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u6a21\u578b\u521d\u59cb\u5316\u65f6\u5c06\u5404\u5c42\u53c2\u6570\u5f20\u91cf\u6309\u884c\u6216\u5217\u5207\u5206\u6210N\u5757\uff0c\u5206\u522b\u653e\u5230\u4e0d\u540cGPU\u4e0a\u3002\u524d\u5411\u4f20\u64ad\u65f6\uff0c\u9047\u5230\u67d0\u5c42\u9700\u8981\u7684\u6743\u91cd\uff0c\u6846\u67b6\u4f1a\u4ece\u5176\u5b83GPU\u62c9\u53d6\u5176\u4f59\u788e\u7247\uff0c\u4e34\u65f6\u62fc\u63a5\u51fa\u5b8c\u6574\u6743\u91cd\u518d\u8ba1\u7b97\u3002\u8fd9\u79cd\u62c9\u53d6\u901a\u5e38\u901a\u8fc7\u9ad8\u6548\u7684\u591a\u5bf9\u591aAll-Gather\u5b9e\u73b0\uff0c\u5e76\u53ef\u5728\u8ba1\u7b97\u524d\u9884\u53d6\u4e0b\u4e00\u5c42\u53c2\u6570\u4ee5\u9690\u85cf\u5ef6\u8fdf\u3002\u53cd\u5411\u4f20\u64ad\u65f6\uff0c\u6bcf\u5f20\u5361\u6839\u636e\u5c40\u90e8\u8f93\u51fa\u8bef\u5dee\u53ea\u8ba1\u7b97\u5b83\u62e5\u6709\u7684\u53c2\u6570\u7247\u6bb5\u7684\u68af\u5ea6\uff0c\u5982\u679c\u68af\u5ea6\u9700\u8981\u8de8\u5206\u7247\u6c47\u603b\u5219\u4f7f\u7528\u901a\u4fe1\u89c4\u7ea6\u3002\u68af\u5ea6\u8ba1\u7b97\u540e\u7acb\u5373\u6267\u884cReduce-Scatter\uff0c\u5c06\u5b8c\u6574\u68af\u5ea6\u5e73\u5747\u5206\u53d1\u56de\u5404\u8d1f\u8d23\u5206\u7247\u7684GPU\u4e0a\u3002\u8fd9\u6837\u6bcf\u5757GPU\u540c\u6837\u53ea\u4fdd\u7559\u4e86\u5bf9\u5e94\u53c2\u6570\u5206\u533a\u7684\u68af\u5ea6\u3002\u53c2\u6570\u66f4\u65b0\u9636\u6bb5\uff0c\u5404GPU\u4ec5\u4f7f\u7528\u672c\u5730\u5206\u7247\u7684\u68af\u5ea6\u548c\u4f18\u5316\u5668\u72b6\u6001\u6765\u66f4\u65b0\u672c\u5730\u53c2\u6570\u788e\u7247\uff0c\u65e0\u9700\u5168\u5c40\u540c\u6b65\uff0c\u5176\u4f59GPU\u7684\u5bf9\u5e94\u53c2\u6570\u5c06\u7531\u5b83\u4eec\u5404\u81ea\u66f4\u65b0\u3002\u4e0b\u4e00\u6b21\u524d\u5411\u9700\u8981\u8be5\u53c2\u6570\u65f6\u518d\u91cd\u65b0\u6309\u9700\u6536\u96c6\u3002\u901a\u8fc7\u4e0a\u8ff0\u673a\u5236\uff0cZeRO-3\u5c06\u6a21\u578b\u4e09\u7c7b\u72b6\u6001\u7684\u5197\u4f59\u62f7\u8d1d\u5168\u90e8\u53bb\u9664\uff0c\u6bcf\u5f20\u5361\u4ec5\u5b58\u50a8\u539f\u6765\u76841/N\u5927\u5c0f\u7684\u6570\u636e\u788e\u7247\uff0c\u5927\u5e45\u7a81\u7834\u4e86\u5355\u5361\u5185\u5b58\u9650\u5236\u3002</p> <p>\u901a\u4fe1\u5f00\u9500\uff1a ZeRO-3\u4e3a\u4e86\u52a8\u6001\u6c47\u96c6\u6240\u9700\u7684\u53c2\u6570\u548c\u68af\u5ea6\uff0c\u4e0d\u53ef\u907f\u514d\u5730\u5f15\u5165\u4e86\u9891\u7e41\u7684\u901a\u4fe1\u3002\u5728\u524d\u5411\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u5c42\u8ba1\u7b97\u524d\u90fd\u8981\u8fdb\u884c\u4e00\u6b21\u53c2\u6570All-Gather\uff0c\u5c06\u8be5\u5c42\u5206\u6563\u5728\u5404GPU\u7684\u6743\u91cd\u788e\u7247\u6536\u96c6\u8d77\u6765\uff1b\u5728\u53cd\u5411\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u53ef\u80fd\u9700\u8981\u5bf9\u67d0\u4e9b\u68af\u5ea6\u6267\u884cAll-Gather\u4ee5\u8ba1\u7b97\u53c2\u6570\u66f4\u65b0\uff08\u89c6\u5b9e\u73b0\u7b56\u7565\u800c\u5b9a\uff09\uff0c\u7136\u540e\u5bf9\u68af\u5ea6\u6267\u884cReduce-Scatter\u5b8c\u6210\u8de8\u5361\u68af\u5ea6\u805a\u5408\u3002\u56e0\u6b64\uff0c\u6bcf\u5c42\u7684\u524d\u5411\u548c\u53cd\u5411\u90fd\u4f34\u968f\u901a\u4fe1\u64cd\u4f5c\u3002\u603b\u4f53\u6765\u770b\uff0cZeRO-3\u7684\u901a\u4fe1\u91cf\u7ea6\u4e3a\u4f20\u7edf\u6570\u636e\u5e76\u884c\u76841.5\u500d\uff08\u56e0\u4e3a\u53c2\u6570\u9700\u8981\u989d\u5916\u5728\u5404\u5361\u4f20\u8f93\uff09\uff0c\u901a\u4fe1\u9891\u6b21\u4e5f\u663e\u8457\u66f4\u9ad8\u3002\u8fd9\u5bf9GPU\u4e92\u8054\u5e26\u5bbd\u63d0\u51fa\u4e86\u66f4\u9ad8\u8981\u6c42\u3002\u4e0d\u8fc7\uff0cDeepSpeed\u901a\u8fc7\u4e00\u7cfb\u5217\u901a\u4fe1\u4f18\u5316\u6765\u964d\u4f4e\u5f00\u9500\uff0c\u5305\u62ec\uff1a\u5728\u8ba1\u7b97\u65f6\u5e76\u884c\u8fdb\u884c\u901a\u4fe1\uff08\u9690\u85cfAll-Gather/Reduce\u7684\u5ef6\u8fdf\uff09\u3001\u63d0\u524d\u9884\u53d6\u4e0b\u4e00\u6279\u53c2\u6570\u788e\u7247\u4ee5\u53ca\u52a8\u6001\u8c03\u6574\u901a\u4fe1\u7c92\u5ea6\u7b49\u3002\u5b9e\u8df5\u8868\u660e\uff0c\u5373\u4fbf\u5728\u5343\u4ebf\u53c2\u6570\u8bad\u7ec3\u4e2d\uff0c\u7ecf\u8fc7\u4f18\u5316\u7684ZeRO-3\u901a\u4fe1\u8017\u65f6\u4e5f\u53ef\u63a7\u5236\u5728\u603b\u65f6\u95f4\u768415%\u4ee5\u5185\u3002\u7b80\u800c\u8a00\u4e4b\uff0cZeRO-3\u4ee5\u589e\u52a0\u4e00\u5b9a\u901a\u4fe1\u6362\u53d6\u7ebf\u6027\u7ea7\u7684\u5185\u5b58\u8282\u7701\uff0c\u5176\u901a\u4fe1\u6210\u672c\u867d\u6700\u9ad8\u4f46\u901a\u8fc7\u91cd\u53e0\u548c\u538b\u7f29\u6280\u672f\u53ef\u88ab\u663e\u8457\u7f13\u89e3\u3002</p> <p>\u4f18\u7f3a\u70b9\uff1a \u4f18\u70b9\u662f\u4e0d\u8a00\u800c\u55bb\u7684\uff1aZeRO-3\u6700\u5927\u5316\u5229\u7528\u96c6\u7fa4\u603b\u663e\u5b58\uff0c\u4f7f\u6a21\u578b\u89c4\u6a21\u4e0d\u518d\u53d7\u5355\u5361\u9650\u5236\u3002\u6bcf\u589e\u52a0\u4e00\u5757GPU\uff0c\u5c31\u7b49\u6548\u589e\u52a0\u4e00\u4efd\u6a21\u578b\u5bb9\u91cf\u3002\u4f8b\u598264\u5361\u96c6\u7fa4\u4e0b\u7406\u8bba\u4e0a\u53ef\u8bad\u7ec3\u6bd4\u5355\u5361\u592764\u500d\u7684\u6a21\u578b\u3002\u8fd9\u4f7f\u5f97\u50cfGPT-3\uff081750\u4ebf\u53c2\u6570\uff09\u8fd9\u7c7b\u8d85\u5927\u6a21\u578b\u5728\u6709\u9650\u8d44\u6e90\u4e0b\u6210\u4e3a\u53ef\u80fd\u3002\u53e6\u5916\uff0cZeRO-3\u8fd8\u652f\u6301\u7ed3\u5408CPU\u5185\u5b58\u548cNVMe\u78c1\u76d8\u7684\u5206\u7247\u5f02\u6784\u5b58\u50a8\uff08\u5373ZeRO-Infinity\uff09\uff0c\u53ef\u4ee5\u5c06\u53c2\u6570/\u4f18\u5316\u5668\u72b6\u6001\u8fdb\u4e00\u6b65\u8de8\u8bbe\u5907\u5206\u7247\u548cOffload\uff0c\u7a81\u7834GPU\u663e\u5b58\u603b\u91cf\u9650\u5236\u3002\u7f3a\u70b9\u662f\u5b9e\u73b0\u590d\u6742\u5ea6\u548c\u8c03\u5ea6\u5f00\u9500\u6700\u9ad8\uff0c\u5bf9\u901a\u4fe1\u5e26\u5bbd\u548c\u5ef6\u8fdf\u8f83\u4e3a\u654f\u611f\u3002\u5c24\u5176\u5728GPU\u5f88\u591a\u6216\u7f51\u7edc\u8f83\u6162\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u826f\u597d\u901a\u4fe1\u4f18\u5316\uff0c\u53ef\u80fd\u51fa\u73b0\u901a\u4fe1\u74f6\u9888\u5f71\u54cd\u541e\u5410\u3002\u6b64\u5916\uff0cZeRO-3\u5bf9\u6846\u67b6\u548c\u6a21\u578b\u6709\u66f4\u591a\u7ea6\u675f\uff0c\u4f8b\u5982\u6a21\u578b\u53c2\u6570\u9700\u8981\u5728\u4f7f\u7528\u65f6\u53ef\u52a8\u6001\u6536\u96c6\uff0c\u67d0\u4e9b\u4e0d\u89c4\u5219\u7684\u6a21\u578b\u7ed3\u6784\u53ef\u80fd\u9700\u8981\u7279\u6b8a\u5904\u7406\u3002\u603b\u7684\u6765\u8bf4\uff0cZeRO-3\u975e\u5e38\u9002\u5408\u767e\u4ebf\u5230\u4e07\u4ebf\u7ea7\u6a21\u578b\u7684\u8bad\u7ec3\uff0c\u5df2\u6210\u4e3a\u5f53\u524d\u8d85\u5927\u6a21\u578b\u5206\u5e03\u5f0f\u8bad\u7ec3\u7684\u6838\u5fc3\u57fa\u77f3\u6280\u672f\u3002\u5728\u8d44\u6e90\u8db3\u591f\u4e14\u901a\u4fe1\u4f18\u5316\u5f97\u5f53\u7684\u524d\u63d0\u4e0b\uff0c\u5b83\u80fd\u591f\u4ee5\u8f83\u5c0f\u4ee3\u4ef7\u6362\u53d6\u5de8\u5927\u7684\u5185\u5b58\u6269\u5c55\u80fd\u529b\u3002</p> <p>\u9636\u6bb5\u6bd4\u8f83\uff1a \u7efc\u5408\u6765\u770b\uff0cZeRO\u5404\u9636\u6bb5\u5728\u5185\u5b58\u8282\u7701\u548c\u901a\u4fe1\u5f00\u9500\u4e0a\u5448\u9012\u589e\u5173\u7cfb\u3002ZeRO-1\u6700\u7b80\u5355\uff0c\u7ea64\u500d\u5185\u5b58\u8282\u7701\uff0c\u51e0\u4e4e\u65e0\u989d\u5916\u901a\u4fe1\uff1bZeRO-2\u53ef\u8fbe8\u500d\u5de6\u53f3\u8282\u7701\uff0c\u901a\u4fe1\u7565\u589e\u4f46\u53ef\u63a5\u53d7\uff1bZeRO-3\u8282\u7701\u7387\u4e0eGPU\u6570\u8fd1\u4f3c\u7ebf\u6027 (1/N)\uff0c\u4f46\u901a\u4fe1\u6700\u590d\u6742\u3002\u5177\u4f53\u9009\u62e9\u4e0a\uff0c\u5c0f\u89c4\u6a21\u6a21\u578b\u53ef\u7528ZeRO-1/2\u4ee5\u51cf\u5c11\u4f18\u5316\u5668\u5f00\u9500\uff0c\u800c\u771f\u6b63\u7684\u8d85\u5927\u6a21\u578b\u8bad\u7ec3\u51e0\u4e4e\u53ea\u80fd\u4f9d\u8d56ZeRO-3 \u6765\u5f7b\u5e95\u6253\u7834\u5355\u5361\u5185\u5b58\u5929\u82b1\u677f\u3002\u5b9e\u9645\u5de5\u7a0b\u4e2d\u5e38\u5e38\u76f4\u63a5\u91c7\u7528ZeRO-3\uff0c\u5e76\u901a\u8fc7\u914d\u7f6e\u8c03\u6574\u5728\u9700\u8981\u65f6\u5173\u6389\u67d0\u4e9b\u529f\u80fd\uff08\u5982offload\uff09\u6765\u9000\u5316\u4e3aZeRO-2\u6216ZeRO-1\uff0c\u4ee5\u5e73\u8861\u6027\u80fd\u548c\u5185\u5b58\u9700\u6c42\u3002</p> <p>\u4ee5\u4e0b\u662fZeRO-3\u4e00\u6b21\u8bad\u7ec3\u8fed\u4ee3\u4e2d\u7684\u6838\u5fc3\u4ea4\u6362\uff1a</p> \u65f6\u95f4\u70b9 \u4e3b\u8981\u64cd\u4f5c \u6240\u9700\u901a\u4fe1 \u53c2\u4e0e\u5f20\u91cf \u5907\u6ce8 \u6a21\u578b\u521d\u59cb\u5316 \u6309\u53c2\u6570\u7ef4\u5ea6/\u884c\u5217\u628a FP16 \u6743\u91cd \u5207\u6210 N \u5757\u5e76\u6563\u5e03\u5230 N \u5f20 GPU \u65e0\uff08\u76f4\u63a5\u5206\u914d\uff09 \u53c2\u6570\u788e\u7247 <code>deepspeed.zero.Init</code> \u5b8c\u6210 \u524d\u5411\uff08FWD\uff09 All\u2011Gather \u5f53\u524d\u5c42\u7684\u6743\u91cd\u788e\u7247\u5230\u6bcf\u5f20\u5361 FWD\u2011AllGather \u53c2\u6570\u788e\u7247 \u2192 \u5b8c\u6574\u5c42\u6743\u91cd \u9884\u53d6\u4e0b\u4e00\u5c42\uff0c\u8ba1\u7b97\u540e\u7acb\u5373 <code>release</code> \u53cd\u5411\uff08BWD\uff09 \uff08\u53ef\u9009\uff09\u518d\u6b21 All\u2011Gather \u6fc0\u6d3b\u6240\u9700\u6743\u91cd\uff1b\u968f\u540e\u5bf9\u5c40\u90e8\u68af\u5ea6\u505a Reduce\u2011Scatter BWD\u2011AllGather + BWD\u2011ScatterReduce \u5b8c\u6574\u5c42\u6743\u91cd / \u68af\u5ea6\u788e\u7247 \u68af\u5ea6\u94a9\u5b50\u5728 bucket \u6ee1\u65f6\u89e6\u53d1\u901a\u4fe1 \u4f18\u5316\u5668 step \u6bcf\u5f20\u5361\u4ec5\u7528\u672c\u5730\u68af\u5ea6 &amp; \u672c\u5730\u72b6\u6001\u66f4\u65b0 \u672c\u5730\u53c2\u6570\u788e\u7247 \u65e0\uff08\u5b8c\u5168\u672c\u5730\uff09 m\u3001v\u3001FP32 \u4e3b\u6743\u91cd\u7b49 \u5355\u5361\u6301\u6709 1/N \u72b6\u6001","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#3","title":"3. \u5185\u5b58\u4f18\u5316\u673a\u5236","text":"<p>\u672c\u8282\u4ece\u663e\u5b58\u5360\u7528\u89d2\u5ea6\u5206\u6790ZeRO\u5404\u9636\u6bb5\u5982\u4f55\u4f18\u5316\u53c2\u6570\u3001\u68af\u5ea6\u3001\u4f18\u5316\u5668\u72b6\u6001\u4e09\u7c7b\u5185\u5b58\uff0c\u5e76\u8ba8\u8bba\u6fc0\u6d3b\u91cd\u8ba1\u7b97\u7b49\u914d\u5408\u7b56\u7565\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#31","title":"3.1 \u6a21\u578b\u4e09\u7c7b\u72b6\u6001\u7684\u663e\u5b58\u5360\u7528","text":"<p>\u5728\u5927\u6a21\u578b\u8bad\u7ec3\u4e2d\uff0c\u663e\u5b58\u4e3b\u8981\u88ab\u4ee5\u4e0b\u4e09\u90e8\u5206\u6d88\u8017\uff1a</p> <ul> <li>\u6a21\u578b\u53c2\u6570 (Parameters)\uff1a \u5373\u6a21\u578b\u7684\u6743\u91cd\u77e9\u9635\u548c\u504f\u7f6e\u7b49\uff0c\u53ef\u89c6\u4e3a_\u9759\u6001\u5b58\u50a8_\uff0c\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u9700\u8981\u5e38\u9a7b\u663e\u5b58\u3002\u5176\u5360\u7528\u968f\u6a21\u578b\u89c4\u6a21\u7ebf\u6027\u589e\u957f\u3002\u4f8b\u5982\u767e\u4ebf\u7ea7\u53c2\u6570\u6a21\u578b\u5149\u6743\u91cd\u5c31\u9700\u8981\u51e0\u5341GB\u663e\u5b58\u3002</li> <li>\u6fc0\u6d3b\u503c (Activations)\uff1a \u524d\u5411\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u6bcf\u5c42\u7684\u4e2d\u95f4\u6fc0\u6d3b\u9700\u8981\u6682\u5b58\u4ee5\u4f9b\u53cd\u5411\u4f7f\u7528\uff0c\u5360\u7528\u968fbatch\u5927\u5c0f\u548c\u5e8f\u5217\u957f\u5ea6\u589e\u957f\uff0c\u4e00\u822c\u662f\u663e\u5b58\u4e3b\u8981\u6d88\u8017\u4e4b\u4e00\u3002\u6df1\u5c42Transformer\u4e2d\uff0c\u6fc0\u6d3b\u5360\u7528\u751a\u81f3\u53ef\u80fd\u8d85\u8fc7\u53c2\u6570\u672c\u8eab\u3002</li> <li>\u4f18\u5316\u5668\u72b6\u6001 (Optimizer States)\uff1a \u4f18\u5316\u7b97\u6cd5\u4e3a\u52a0\u901f\u6536\u655b\u800c\u7ef4\u62a4\u7684\u9644\u52a0\u53d8\u91cf\uff0c\u6bd4\u5982Adam\u7684\u4e00\u9636\u3001\u4e8c\u9636\u52a8\u91cf\uff0c\u8fd8\u6709FP32\u7cbe\u5ea6\u7684\u4e3b\u6743\u91cd\u62f7\u8d1d\u7b49\u3002\u8fd9\u4e9b\u72b6\u6001\u6bcf\u4e2a\u53c2\u6570\u5bf9\u5e94\u591a\u4efd\u503c\uff0c\u56e0\u6b64\u603b\u5927\u5c0f\u5f80\u5f80\u662f\u53c2\u6570\u7684\u6570\u500d\u3002\u4ee5Adam\u5728\u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3\u4e0b\u4e3a\u4f8b\uff0cm\u548cv\u901a\u5e38\u4ee532\u4f4d\u6d6e\u70b9\u5b58\u50a8\uff0c\u76f8\u5f53\u4e8e\u6bcf\u4e2a\u53c2\u6570\u6709\u989d\u59162\u00d7Param\u5927\u5c0f\uff0c\u518d\u52a0\u4e0a\u7ef4\u62a4\u7684FP32\u6743\u91cd\u526f\u672c\uff0c\u4f18\u5316\u5668\u72b6\u6001\u53ef\u8fbe\u5230\u53c2\u65704~6\u500d\u5185\u5b58\uff0c\u5360\u636e\u663e\u5b58\u5927\u5934\u3002</li> </ul> <p>\u5728\u4f20\u7edf\u6570\u636e\u5e76\u884c\u4e2d\uff0c\u8fd9\u4e09\u90e8\u5206\u5728\u6bcf\u5757GPU\u4e0a\u5404\u4fdd\u5b58\u4e00\u4efd\uff0c\u603b\u4f53\u5360\u7528\u975e\u5e38\u9ad8\uff0c\u5e38\u5bfc\u81f4\u201c\u663e\u5b58\u7206\u70b8\u201d\u3002\u4f8b\u5982\u67d0\u5927\u578b\u6a21\u578b\u5728\u5355GPU\u4e0a\u8bad\u7ec3\u65f6\uff0c\u53c2\u6570+\u68af\u5ea6+\u4f18\u5316\u5668\u72b6\u6001\u603b\u5171\u53ef\u80fd\u9700\u8981\u5176\u53c2\u6570\u91cf5\uff5e8\u500d\u7684\u663e\u5b58\uff0c\u8fd9\u5bf9\u786c\u4ef6\u63d0\u51fa\u4e86\u6781\u9ad8\u8981\u6c42\u3002</p> <p>ZeRO\u9488\u5bf9\u4e0a\u8ff0\u53c2\u6570\u3001\u68af\u5ea6\u3001\u4f18\u5316\u5668\u72b6\u6001\u5f15\u5165\u5206\u7247\u673a\u5236\u6765\u5206\u522b\u4f18\u5316\u3002\u5176\u6548\u679c\u53ef\u4ee5\u7528\u4e00\u4e2a7.5B\u53c2\u6570\u6a21\u578b\u300164\u5361\u5e76\u884c\u7684\u6848\u4f8b\u6765\u8bf4\u660e\uff1a</p> <ul> <li>\u4e0d\u4f7f\u7528ZeRO (\u6807\u51c6DP)\uff1a\u6bcf\u5361\u9700\u8981\u5b8c\u6574\u5b58\u50a8\u53c2\u6570\u3001\u68af\u5ea6\u3001\u4f18\u5316\u5668\u72b6\u6001\u3002\u4f8b\u59827.5B\u53c2\u6570\u6a21\u578b\u6df7\u5408\u7cbe\u5ea6\u4e0b\uff0c\u6bcf\u5361\u5927\u7ea6\u9700\u8981120GB\u663e\u5b58\uff0c\u663e\u7136\u8fdc\u8d85\u5355\u5361\u5bb9\u91cf\u3002</li> <li>ZeRO Stage 1 (Pos)\uff1a\u4ec5\u5206\u7247\u4f18\u5316\u5668\u72b6\u6001\uff0c\u53c2\u6570\u548c\u68af\u5ea6\u4ecd\u5168\u91cf\u590d\u5236\u3002\u5bf9\u4e8e64\u5361\u5e76\u884c\uff0c\u4f18\u5316\u5668\u72b6\u6001\u5185\u5b58\u4ece\u539f\u6765\u768412\u03c8\uff08\u8fd9\u91cc\u03c8\u8868\u793a\u53c2\u6570\u5927\u5c0f\u5e38\u6570\uff09\u964d\u4f4e\u523012\u03c8/64\uff0c\u7ea6\u51cf\u5c114\u500d\u3002\u4e0a\u8ff07.5B\u6a21\u578b\u6bcf\u5361\u5360\u7528\u4ece120GB\u964d\u81f3\u7ea631.4GB\u3002</li> <li>ZeRO Stage 2 (Pos+g)\uff1a\u5206\u7247\u4f18\u5316\u5668+\u68af\u5ea6\u3002\u68af\u5ea6\u5360\u7528\u4ece2\u03c8\u964d\u4f4e\u52302\u03c8/64\uff0c\u518d\u7ed3\u5408\u4f18\u5316\u5668\u72b6\u6001\u5206\u7247\uff0c\u603b\u4f53\u5185\u5b58\u76f8\u6bd4DP\u51cf\u5c118\u500d\u5de6\u53f3\u30027.5B\u6a21\u578b\u4f8b\u5b50\u4e2d\u6bcf\u5361\u970016.6GB\uff0c\u6bd4\u672a\u5206\u7247\u7684120GB\u964d\u4f4e\u4e8686%\u3002</li> <li>ZeRO Stage 3 (Pos+g+p)\uff1a\u5206\u7247\u4f18\u5316\u5668+\u68af\u5ea6+\u53c2\u6570\u3002\u6b64\u65f6\u6a21\u578b\u72b6\u6001\u4e09\u8005\u5747\u644a\u523064\u5361\u4e0a\uff0c\u5355\u5361\u6240\u9700\u5185\u5b58\u7ea6\u4e3a\u539f\u6765\u76841/64\u30027.5B\u6a21\u578b\u6bcf\u5361\u53ea\u9700\u7ea61.9GB\uff0c\u5185\u5b58\u7f29\u51cf\u8fbe98%\u3002\u6362\u8a00\u4e4b\uff0c\u53ea\u8981GPU\u6570\u91cf\u8db3\u591f\uff0cZeRO-3\u7406\u8bba\u4e0a\u53ef\u4ee5\u652f\u6301\u4efb\u610f\u5927\u5c0f\u7684\u6a21\u578b\u3002</li> </ul> <p>\u4e0a\u8ff0\u662f\u7406\u8bba\u6700\u5927\u8282\u7701\u503c\uff0c\u5b9e\u9645\u4e2d\u8fd8\u4f1a\u6709\u4e00\u4e9b\u989d\u5916\u5f00\u9500\uff08\u4f8b\u5982\u901a\u4fe1\u7f13\u5b58\u3001\u5185\u5b58\u788e\u7247\u7b49\uff09\u4f7f\u5f97\u8282\u7701\u7387\u7565\u4f4e\u4e8e\u7406\u60f3\u503c\u3002\u4f46\u603b\u4f53\u8d8b\u52bf\u7b26\u54084\u500d (ZeRO-1)\u30018\u500d (ZeRO-2)\u3001N\u500d (ZeRO-3) \u7684\u7ea7\u6570\u589e\u957f\u3002\u5728\u771f\u5b9e\u5b9e\u9a8c\u4e2d\uff0cZeRO-3\u76f8\u8f83ZeRO-2\u901a\u5e38\u80fd\u8fdb\u4e00\u6b65\u8282\u7701\u7ea6\u4e00\u534a\u5de6\u53f3\u7684\u663e\u5b58\u3002\u4f8b\u5982\u67d0GPT-3\u89c4\u6a21\u6a21\u578b\u57288\u5361\u4e0b\uff0cZeRO-2\u65f6\u5355\u5361\u5360\u752874.8GB\uff0c\u800cZeRO-3\u964d\u81f341.5GB\uff0c\u51cf\u5c11\u4e8644%\u3002\u867d\u7136\u6ca1\u8fbe\u5230\u7406\u8bba1/8=12.5%\uff0887.5%\u964d\u4f4e\uff09\u7684\u6781\u9650\uff0c\u4f46\u5df2\u7ecf\u5927\u5e45\u7f13\u89e3\u4e86\u663e\u5b58\u538b\u529b\u3002\u53ef\u89c1ZeRO-3\u7ed3\u5408\u5927\u89c4\u6a21\u5e76\u884cGPU\uff0c\u80fd\u5c06\u6a21\u578b\u72b6\u6001\u5360\u7528\u4ece\u201c\u65e0\u6cd5\u8bad\u7ec3\u201d\u964d\u81f3\u201c\u8f7b\u677e\u5bb9\u7eb3\u201d\u7684\u6c34\u5e73\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#32","title":"3.2 \u5404\u9636\u6bb5\u663e\u5b58\u8282\u7701\u603b\u7ed3","text":"<p>\u7efc\u5408\u4ee5\u4e0a\u5206\u6790\uff0cZeRO\u5404\u9636\u6bb5\u5bf9\u4e09\u7c7b\u72b6\u6001\u7684\u5185\u5b58\u5360\u7528\u5f71\u54cd\u5982\u4e0b\uff1a</p> <ul> <li>\u53c2\u6570 (Weights)\uff1a Stage1/2\u672a\u5206\u7247\u53c2\u6570\uff0c\u6bcf\u5361\u4fdd\u7559\u5168\u91cf\u53c2\u6570\uff0c\u5360\u7528=100%\u3002Stage3\u5c06\u53c2\u6570\u6309GPU\u6570\u5747\u5206\uff0c\u6bcf\u5361\u4ec5\u5b58\u539f\u6765\u76841/N\uff0c\u5927\u5e45\u51cf\u5c11\u4e86\u6a21\u578b\u9759\u6001\u5185\u5b58\u3002</li> <li>\u68af\u5ea6 (Gradients)\uff1a Stage1\u672a\u5206\u7247\u68af\u5ea6\uff0c\u53cd\u5411\u540e\u6bcf\u5361\u5b58\u5b8c\u6574\u68af\u5ea6=100%\u3002Stage2/3\u5bf9\u68af\u5ea6\u505aReduce-Scatter\u5206\u7247\uff0c\u6bcf\u5361\u53ea\u4fdd\u75591/N\u68af\u5ea6\uff0c\u663e\u5b58\u4e0b\u964d\u4e3a\u539f\u6765\u76841/N\u3002</li> <li>\u4f18\u5316\u5668\u72b6\u6001 (Opt State)\uff1a Stage1\u5f00\u59cb\u5206\u7247\u4f18\u5316\u5668\u72b6\u6001\uff0c\u6bcf\u5361\u4fdd\u75591/N\uff0c\u663e\u5b58\u964d\u4e3a1/N\u3002Stage2/3\u540c\u7406\u4fdd\u6301\u4f18\u5316\u5668\u72b6\u6001\u5206\u7247\u3002\u5bf9\u4e8eAdam\u8fd9\u610f\u5473\u7740\u4ece\u539f\u672c\u52a8\u8f844\u00d7\u53c2\u6570\u91cf\u7684\u5360\u7528\u964d\u4e3a\u539f\u6765\u76841/N\uff0c\u5927\u6a21\u578b\u8bad\u7ec3\u6210\u4e3a\u53ef\u80fd\u3002</li> </ul> <p>\u7b80\u5355\u6765\u8bf4\uff0cZeRO-1\u4e3b\u8981\u8282\u7701\u4f18\u5316\u5668\u72b6\u6001\u5185\u5b58\uff08\u7ea64\u500d\u51cf\u5c0f\uff09\uff0cZeRO-2\u5728\u6b64\u57fa\u7840\u4e0a\u518d\u8282\u7701\u68af\u5ea6\u5185\u5b58\uff08\u7ea68\u500d\u51cf\u5c0f\uff09\uff0cZeRO-3\u5219\u8fde\u53c2\u6570\u4e5f\u6309N\u7b49\u6bd4\u4f8b\u7f29\u51cf\uff08N\u500d\u51cf\u5c0f\uff09\u3002\u8fd9\u4e09\u7c7b\u72b6\u6001\u5206\u7247\u76f8\u8f85\u76f8\u6210\uff0c\u4f7f\u5f97\u6a21\u578b\u603b\u72b6\u6001\u5185\u5b58\u968f\u5e76\u884c\u5ea6\u589e\u52a0\u800c\u5927\u5e45\u964d\u4f4e\u3002\u6b63\u56e0\u4e3a\u5982\u6b64\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\u6211\u4eec\u5f80\u5f80\u5c06ZeRO-3\u4e0e\u6fc0\u6d3b\u91cd\u8ba1\u7b97\u7b49\u624b\u6bb5\u7ed3\u5408\uff0c\u5145\u5206\u538b\u69a8\u786c\u4ef6\u663e\u5b58\u6f5c\u529b\uff0c\u505a\u5230\u201c\u4f4e\u8d44\u6e90\u8dd1\u5927\u6a21\u578b\u201d\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#33-zero","title":"3.3 \u6fc0\u6d3b\u91cd\u8ba1\u7b97\u4e0e ZeRO \u7684\u534f\u540c","text":"<p>\u6fc0\u6d3b\u91cd\u8ba1\u7b97 (Activation Checkpointing\uff0c\u53c8\u79f0Recompute) \u662f\u5e94\u5bf9\u6fc0\u6d3b\u5185\u5b58\u5360\u7528\u7684\u5e38\u7528\u7b56\u7565\uff0c\u5373\u5728\u524d\u5411\u8ba1\u7b97\u65f6\u6709\u9009\u62e9\u5730\u4e0d\u4fdd\u5b58\u4e2d\u95f4\u6fc0\u6d3b\uff0c\u7b49\u53cd\u5411\u9700\u8981\u65f6\u518d\u91cd\u65b0\u8ba1\u7b97\u83b7\u53d6\uff0c\u4ece\u800c\u8282\u7701\u5185\u5b58\u3002Recompute\u672c\u8d28\u4e0a\u7528\u989d\u5916\u7684\u8ba1\u7b97\u6362\u53d6\u5185\u5b58\uff1a\u4e00\u822c\u4f1a\u7565\u5fae\u964d\u4f4e\u8bad\u7ec3\u541e\u5410\uff0c\u4f46\u5bf9\u975e\u5e38\u6df1\u7684\u6a21\u578b\u80fd\u8282\u7ea640%\u4ee5\u4e0a\u7684\u6fc0\u6d3b\u5360\u7528\u3002</p> <p>ZeRO\u4f18\u5316\u7684\u662f\u6a21\u578b\u72b6\u6001\uff08\u53c2\u6570\u3001\u68af\u5ea6\u3001\u4f18\u5316\u5668\uff09\u7684\u5b58\u50a8\uff0c\u4e0eRecompute\u9488\u5bf9\u6fc0\u6d3b\u5185\u5b58\u7684\u4f18\u5316\u662f\u6b63\u4ea4\u4e92\u8865\u7684\u3002\u4e8c\u8005\u7ed3\u5408\u53ef\u4ee5\u8986\u76d6\u663e\u5b58\u5f00\u9500\u7684\u4e24\u4e2a\u4e3b\u8981\u65b9\u9762\uff1aZeRO\u524a\u51cf\u6a21\u578b\u9759\u6001\u72b6\u6001\uff0cRecompute\u538b\u7f29\u52a8\u6001\u6fc0\u6d3b\u5360\u7528\uff0c\u4ece\u800c\u6700\u5927\u5316\u6574\u4f53\u8282\u7701\u3002DeepSpeed\u5b98\u65b9\u4e5f\u5f3a\u70c8\u5efa\u8bae\u5728\u4f7f\u7528ZeRO-2/3\u65f6\u5f00\u542f\u6fc0\u6d3b\u91cd\u8ba1\u7b97\uff0c\u4ee5\u6362\u53d6\u66f4\u5927batch\u6216\u66f4\u6df1\u7684\u6a21\u578b\u3002\u4f8b\u5982\u5728\u8bad\u7ec350\u5c42\u4ee5\u4e0a\u7684Transformer\u65f6\uff0c\u5f00\u542fRecompute\u53ef\u5c06\u6fc0\u6d3b\u5185\u5b58\u5360\u7528\u964d\u4f4e\u4e00\u534a\u5de6\u53f3\uff0c\u662fZeRO\u4e0d\u53ef\u6216\u7f3a\u7684\u4f19\u4f34\u7b56\u7565\u3002</p> <p>\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cZeRO\u672c\u8eab\u4e5f\u5f15\u5165\u4e86\u4e00\u4e9b\u9488\u5bf9\u6fc0\u6d3b\u7684\u9ad8\u7ea7\u4f18\u5316\uff0c\u88ab\u79f0\u4e3aZeRO-R\uff08Residual Optimizations\uff09\u3002\u5176\u4e2d\u5305\u62ec\uff1a(1) \u5206\u533a\u6fc0\u6d3b\u91cd\u8ba1\u7b97 (Partitioned Activations)\uff0c\u5c06\u6a21\u578b\u5e76\u884c\u73af\u5883\u4e0b\u9700\u8981\u91cd\u590d\u7684\u6fc0\u6d3b\u4e5f\u8fdb\u884c\u8de8GPU\u5206\u7247\uff0c\u5728\u9700\u8981\u7528\u5230\u65f6\u518dAll-Gather\u5230\u4e00\u8d77\u3002\u8fd9\u53ef\u4ee5\u8fdb\u4e00\u6b65\u51cf\u5c11\u6fc0\u6d3b\u5197\u4f59\u62f7\u8d1d\uff0c\u5360\u7528\u968f\u5e76\u884c\u5ea6\u7ebf\u6027\u964d\u4f4e\uff08\u751a\u81f3\u53ef\u9009\u62e9\u5c06\u6fc0\u6d3b\u788e\u7247\u6682\u5b58CPU\uff09\u3002(2) \u6052\u5b9a\u5927\u5c0f\u5185\u5b58\u6c60\uff0c\u5c06\u53cd\u590d\u7533\u8bf7\u91ca\u653e\u7684\u4e34\u65f6\u5f20\u91cf\u7528\u56fa\u5b9a\u7f13\u51b2\u533a\u590d\u7528\uff0c\u907f\u514d\u788e\u7247\u5316\u3002(3) \u52a8\u6001\u5185\u5b58\u6574\u7406\uff0c\u5c06\u751f\u547d\u5468\u671f\u4e0d\u540c\u7684\u5f20\u91cf\u653e\u5165\u9884\u5148\u5206\u914d\u7684\u8fde\u7eed\u533a\uff0c\u51cf\u5c11CUDA allocator\u788e\u7247\u3002\u8fd9\u4e9b\u6280\u672f\u53ef\u4ee5\u89c6\u4f5cZeRO\u5bf9\u6fc0\u6d3b\u548c\u4e34\u65f6\u7a7a\u95f4\u7684\u201c\u8f6f\u4f18\u5316\u201d\u3002\u5728\u5b9e\u9645\u5de5\u7a0b\u4e2d\uff0c\u7528\u6237\u4e3b\u8981\u9700\u8981\u5173\u6ce8\u662f\u5426\u5f00\u542factivation checkpointing\u3002DeepSpeed\u63d0\u4f9b\u4e86\u4fbf\u6377\u9009\u9879\uff1a\u4f8b\u5982\u914d\u7f6e\u6587\u4ef6\u4e2d<code>\"activation_checkpointing\": {\"partition_activations\": true, ...}</code>\u53ef\u4ee5\u8ba9ZeRO-3\u81ea\u52a8\u5bf9\u91cd\u8ba1\u7b97\u7684\u6fc0\u6d3b\u8fdb\u884c\u5206\u7247\u5b58\u50a8\u3002\u603b\u4e4b\uff0cRecompute + ZeRO \u7684\u7ec4\u5408\u662f\u5927\u6a21\u578b\u8bad\u7ec3\u7684\u5e38\u89c4\u64cd\u4f5c\uff1a\u524d\u8005\u89e3\u51b3\u6df1\u5ea6\u7f51\u7edc\u6fc0\u6d3b\u663e\u5b58\u5360\u7528\u9ad8\u7684\u95ee\u9898\uff0c\u540e\u8005\u89e3\u51b3\u5bbd\u5927\u7f51\u7edc\u53c2\u6570\u5197\u4f59\u7684\u95ee\u9898\uff0c\u4e24\u8005\u7ed3\u5408\u80fd\u8ba9\u6709\u9650\u663e\u5b58\u652f\u6301\u8fdc\u8d85\u4ee5\u5f80\u89c4\u6a21\u7684\u6a21\u578b\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#4","title":"4. \u901a\u4fe1\u5f00\u9500\u4e0e\u5206\u5e03\u5f0f\u539f\u8bed","text":"<p>\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u8bad\u7ec3\u4e0d\u53ef\u907f\u514d\u5730\u5f15\u5165\u901a\u4fe1\u5f00\u9500\uff0c\u800cZeRO\u5404\u9636\u6bb5\u7684\u901a\u4fe1\u6a21\u5f0f\u548c\u4f18\u5316\u7b56\u7565\u662f\u5176\u6027\u80fd\u5173\u952e\u3002\u4e0b\u9762\u7ed3\u5408\u5206\u5e03\u5f0f\u539f\u8bedAllReduce/AllGather/ReduceScatter\uff0c\u5206\u6790ZeRO\u7684\u901a\u4fe1\u5f00\u9500\u4e0e\u5e76\u884c\u8c03\u5ea6\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#41","title":"4.1 \u5404\u9636\u6bb5\u7684\u901a\u4fe1\u6a21\u5f0f","text":"<p>\u5728ZeRO\u65b9\u6848\u4e0b\uff0c\u4e0d\u540c\u9636\u6bb5\u9700\u8981\u7684\u901a\u4fe1\u64cd\u4f5c\u6709\u6240\u533a\u522b\uff1a</p> <ul> <li>\u6570\u636e\u5e76\u884c (Baseline DDP)\uff1a\u6bcf\u4e2astep\u4e3b\u8981\u901a\u4fe1\u662f\u68af\u5ea6All-Reduce\uff0c\u5c06\u5404\u5361\u8ba1\u7b97\u7684\u68af\u5ea6\u6c42\u548c\u540e\u540c\u6b65\u5230\u6240\u6709GPU\u3002\u53c2\u6570\u66f4\u65b0\u540e\u901a\u5e38\u4e0d\u9700\u8981\u989d\u5916\u901a\u4fe1\uff0c\u56e0\u4e3a\u6bcf\u5361\u53c2\u6570\u4fdd\u6301\u4e00\u81f4\u526f\u672c\u3002</li> <li>ZeRO-1\uff1a\u4e0eDDP\u7c7b\u4f3c\uff0c\u53ea\u9700\u5bf9\u68af\u5ea6\u505aAll-Reduce\u540c\u6b65\u3002\u53e6\u5916\u5728\u6bcf\u6b21\u4f18\u5316\u5668\u66f4\u65b0\u540e\uff0c\u7528Broadcast\u6216All-Gather\u53d1\u9001\u66f4\u65b0\u540e\u7684\u53c2\u6570\u7ed9\u5176\u4ed6\u5361\uff0c\u4ee5\u66ff\u6362\u5b83\u4eec\u672c\u5730\u7684\u65e7\u53c2\u6570\uff08\u56e0\u4e3a\u53ea\u6709\u62e5\u6709\u5bf9\u5e94\u4f18\u5316\u5668\u72b6\u6001\u7684GPU\u771f\u6b63\u66f4\u65b0\u4e86\u8be5\u53c2\u6570\uff09\u3002\u8be5\u53c2\u6570\u540c\u6b65\u4e0eAll-Reduce\u7b49\u4ef7\uff08\u53ea\u662f\u53d1\u751f\u5728\u66f4\u65b0\u540e\uff09\uff0c\u901a\u4fe1\u91cf\u5f88\u5c0f\u3002</li> <li>ZeRO-2\uff1a\u4f7f\u7528Reduce-Scatter + All-Gather\u6765\u66ff\u4ee3All-Reduce\u5b8c\u6210\u68af\u5ea6\u5f52\u5e76\u3002\u53cd\u5411\u4e2d\uff0c\u6bcf\u5f20\u5361\u5c06\u672c\u5730\u68af\u5ea6\u5206\u5757\u540e\u4e0e\u5bf9\u5e94GPU Reduce-Scatter\u7d2f\u52a0\uff0c\u8fd9\u76f8\u5f53\u4e8eAll-Reduce\u62c6\u89e3\u4e3a\u89c4\u7ea6\u548c\u6563\u53d1\u4e24\u4e2a\u6b65\u9aa4\u3002\u5728\u5b9e\u73b0\u4e0a\uff0cDeepSpeed\u76f4\u63a5\u5bf9\u68af\u5ea6\u8fdb\u884cReduce-Scatter\u6c47\u805a\uff0c\u5404GPU\u5f97\u5230\u5404\u81ea\u5206\u7247\u7684\u603b\u68af\u5ea6\uff0c\u7136\u540e\u5404\u81ea\u66f4\u65b0\u53c2\u6570\u3002\u7531\u4e8e\u53c2\u6570\u4ecd\u5168\u91cf\u590d\u5236\uff0c\u5404\u5361\u6700\u7ec8\u9700\u8981\u4e00\u81f4\u53c2\u6570\uff0c\u6240\u4ee5\u8fd8\u9700\u4e00\u6b21\u53c2\u6570\u5e7f\u64ad\u3002\u4f46\u5982\u679c\u6240\u6709GPU\u90fd\u5e94\u7528\u4e86\u540c\u6837\u7684\u5168\u5c40\u68af\u5ea6\u66f4\u65b0\uff0c\u53c2\u6570\u672c\u5c31\u662f\u4e00\u81f4\u7684\uff0c\u65e0\u9700\u518d\u540c\u6b65\u3002\u56e0\u6b64ZeRO-2\u901a\u5e38\u907f\u514d\u4e86\u989d\u5916\u7684\u53c2\u6570\u901a\u4fe1\uff0c\u53ea\u5728\u68af\u5ea6\u5f52\u5e76\u4e0a\u6bd4DP\u591a\u7528\u4e86\u5206\u6563\u64cd\u4f5c\u3002\u5176\u603b\u901a\u4fe1\u91cf\u7565\u9ad8\u4e8eAll-Reduce\u4f46\u540c\u9636\uff0c\u4e3b\u8981\u7279\u70b9\u662f\u5c06\u4e00\u6b21\u5927\u7684All-Reduce\u62c6\u6210\u4e24\u6b21\u66f4\u5c0f\u64cd\u4f5c\uff0c\u66f4\u6613\u4e0e\u8ba1\u7b97\u91cd\u53e0\u3002</li> <li>ZeRO-3\uff1a\u901a\u4fe1\u6700\u4e3a\u9891\u7e41\uff0c\u6db5\u76d6\u524d\u5411\u7684\u53c2\u6570All-Gather\u548c\u540e\u5411\u7684\u53c2\u6570All-Gather + \u68af\u5ea6Reduce-Scatter\u3002\u5177\u4f53\u800c\u8a00\uff0c\u5728\u524d\u5411\u6bcf\u5c42\u8ba1\u7b97\u524d\uff0c\u5404GPU\u901a\u8fc7All-Gather\u4ece\u522b\u7684\u5361\u83b7\u53d6\u8be5\u5c42\u7684\u53c2\u6570\u788e\u7247\uff0c\u7ec4\u88c5\u6210\u5b8c\u6574\u6743\u91cd\u7528\u4e8e\u8ba1\u7b97\uff1b\u5728\u53cd\u5411\u8ba1\u7b97\u8be5\u5c42\u68af\u5ea6\u65f6\uff0c\u540c\u6837\u9700\u8981\u786e\u4fdd\u53c2\u4e0e\u8ba1\u7b97\u7684\u53c2\u6570\u662f\u5b8c\u6574\u7684\uff0c\u53ef\u901a\u8fc7\u518d\u6b21All-Gather\u53c2\u6570\u6216\u5728\u524d\u5411\u65f6\u7f13\u5b58\u4f7f\u7528\uff1b\u68af\u5ea6\u4ea7\u751f\u540e\uff0c\u7acb\u5373\u5bf9\u5176\u6267\u884cReduce-Scatter\uff0c\u5c06\u68af\u5ea6\u7247\u6bb5\u89c4\u7ea6\u5e76\u5206\u53d1\u56de\u5404\u8d1f\u8d23\u66f4\u65b0\u7684GPU\u3002\u56e0\u6b64\uff0c\u6bcf\u5c42\u90fd\u6709\u4e24\u4e2a\u901a\u4fe1\u8fc7\u7a0b\uff08\u524d\u5411All-Gather + \u540e\u5411Reduce-Scatter\uff0c\u5fc5\u8981\u65f6\u8fd8\u6709\u540e\u5411All-Gather\uff09\u3002\u8fd9\u4e9b\u64cd\u4f5c\u901a\u8fc7NCCL\u7b49\u5e93\u9ad8\u6548\u5b9e\u73b0\uff0c\u4f46\u76f8\u5bf9\u4e8eZeRO-2/DP\u800c\u8a00\u901a\u4fe1\u603b\u91cf\u589e\u52a0\u663e\u8457\u3002\u6b63\u5982\u524d\u6587\u6240\u8ff0\uff0cZeRO-3\u6574\u4f53\u901a\u4fe1\u91cf\u7ea6\u4e3a\u539f\u6765\u76841.5\u500d\uff0c\u5e76\u4f1a\u968f\u7740\u5c42\u6570\u7ebf\u6027\u589e\u52a0\u901a\u4fe1\u9891\u6b21\u3002\u5b83\u9002\u5408\u5728\u9ad8\u5e26\u5bbd\u4e92\u8054\u73af\u5883\uff08\u5982NVLink\u3001InfiniBand\uff09\u4e0b\u4f7f\u7528\uff0c\u5728\u7f51\u7edc\u8f83\u6162\u65f6\u9700\u8981\u989d\u5916\u4f18\u5316\u624d\u80fd\u4fdd\u6301\u541e\u5410\u3002</li> </ul>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/ZeRO%E4%BC%98%E5%8C%96%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%A7%A3%E6%9E%90/#42","title":"4.2 \u901a\u4fe1\u4f18\u5316\u4e0e\u5f02\u6b65\u91cd\u53e0","text":"<p>\u9762\u5bf9ZeRO-3\u9ad8\u9891\u901a\u4fe1\u5e26\u6765\u7684\u6311\u6218\uff0cDeepSpeed\u548cPyTorch FSDP\u7b49\u5b9e\u73b0\u90fd\u6295\u5165\u4e86\u5927\u91cf\u4f18\u5316\u624b\u6bb5\uff0c\u4ee5\u5c3d\u53ef\u80fd\u964d\u4f4e\u901a\u4fe1\u5f00\u9500\u5bf9\u8bad\u7ec3\u6027\u80fd\u7684\u5f71\u54cd\u3002\u4ee5\u4e0b\u4ecb\u7ecd\u51e0\u9879\u5173\u952e\u6280\u672f\uff1a</p> <ul> <li>\u8ba1\u7b97\u4e0e\u901a\u4fe1\u91cd\u53e0 (Overlap Compute/Communication)\uff1a \u901a\u8fc7\u591aCUDA\u6d41\u5e76\u884c\u6267\u884c\u8ba1\u7b97\u548c\u901a\u4fe1\uff0c\u4f7fGPU\u4e0d\u5fc5\u7b49\u5f85\u6570\u636e\u4f20\u8f93\u5b8c\u6210\u624d\u7ee7\u7eed\u8ba1\u7b97\u3002\u4f8b\u5982\u5728\u524d\u5411\u4f20\u64ad\u4e2d\uff0c\u5f53\u67d0\u5c42\u53c2\u6570All-Gather\u5c1a\u672a\u5b8c\u5168\u5b8c\u6210\u65f6\uff0c\u53ef\u4ee5\u5148\u884c\u5229\u7528\u5df2\u5230\u8fbe\u7684\u90e8\u5206\u6570\u636e\u5f00\u59cb\u8ba1\u7b97\uff0c\u6216\u8005\u63d0\u524d\u542f\u52a8\u4e0b\u4e00\u5c42\u7684\u9884\u53d6\uff1b\u5728\u53cd\u5411\u4e2d\uff0c\u53ef\u4e00\u8fb9\u8fdb\u884c\u5f53\u524d\u5c42\u7684\u53cd\u5411\u8ba1\u7b97\uff0c\u4e00\u8fb9\u5728\u540e\u53f0\u5f02\u6b65\u6267\u884c\u524d\u4e00\u5c42\u68af\u5ea6\u7684Reduce-Scatter\u3002DeepSpeed\u63d0\u4f9b\u4e86\u914d\u7f6e\u9879<code>\"overlap_comm\": true</code>\u6765\u5f00\u542f\u8fd9\u4e00\u7279\u6027\uff0c\u4f7f\u901a\u4fe1\u8017\u65f6\u51e0\u4e4e\u5168\u90e8\u88ab\u63a9\u76d6\u5728\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u3002Amazon\u56e2\u961f\u66fe\u53d1\u73b0\u539f\u59cbZeRO-3\u7531\u4e8e\u540c\u6b65\u8fc7\u4e8e\u7c97\u653e\uff0cGPU\u5e38\u5904\u4e8e\u7b49\u5f85\u901a\u4fe1\u5b8c\u6210\u7684\u7a7a\u8f6c\u72b6\u6001\u3002\u4ed6\u4eec\u901a\u8fc7\u7ec6\u7c92\u5ea6\u540c\u6b65\u548c\u89e3\u8026\u901a\u4fe1\u4f9d\u8d56\uff0c\u5c06\u901a\u4fe1\u4e0e\u8ba1\u7b97\u7684\u91cd\u53e0\u7a0b\u5ea6\u5927\u5927\u63d0\u9ad8\uff0c\u663e\u8457\u51cf\u5c11\u4e86\u7b49\u5f85\u6d6a\u8d39\u3002\u4f18\u5316\u540e\uff0cAll-Gather\u548cReduce-Scatter\u53ef\u4ee5\u51e0\u4e4epipelin\u5f0f\u5730\u7a7f\u63d2\u5728\u524d\u5411/\u540e\u5411\u5404\u5c42\u7684\u8ba1\u7b97\u4e4b\u95f4\uff0c\u6700\u5927\u5316GPU\u5229\u7528\u7387\u3002</li> <li>\u901a\u4fe1\u5206\u6876\u4e0e\u5206\u7247 (Bucketization &amp; Chunking)\uff1a \u8003\u8651\u5230\u6a21\u578b\u4e2d\u5b58\u5728\u5927\u91cf\u5c0f\u5f20\u91cf\u901a\u4fe1\u7684\u60c5\u51b5\uff0c\u5c06\u591a\u4e2a\u5c0ftensor\u62fc\u63a5\u6210\u4e00\u4e2a\u5927buffer\u518d\u8fdb\u884c\u4e00\u6b21All-Gather\u6216Reduce-Scatter\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u5e26\u5bbd\u5229\u7528\u7387\u3002DeepSpeed\u5141\u8bb8\u7528\u6237\u8c03\u8282\u5982<code>reduce_bucket_size</code>\u3001<code>allgather_bucket_size</code>\u53c2\u6570\uff0c\u5c06\u68af\u5ea6\u6216\u53c2\u6570\u5206\u7247\u7d2f\u79ef\u5230\u4e00\u5b9a\u5927\u5c0f\uff08\u598250MB\uff09\u518d\u53d1\u8d77\u901a\u4fe1\u3002\u8fd9\u6837\u505a\u53ef\u4ee5\u644a\u5e73\u901a\u4fe1\u521d\u59cb\u5316\u5f00\u9500\uff0c\u51cf\u5c11\u8fc7\u591a\u5c0f\u62a5\u6587\u5e26\u6765\u7684\u6548\u7387\u635f\u5931\u3002\u540c\u65f6\uff0c\u5206\u6876\u4f20\u8f93\u4e5f\u5229\u4e8e\u4e0e\u8ba1\u7b97\u91cd\u53e0\uff08\u6bcf\u5904\u7406\u5b8c\u4e00\u6876\u68af\u5ea6\u5c31\u7acb\u523b\u901a\u4fe1\uff0c\u8ba1\u7b97\u4e0d\u5fc5\u7b49\u5f85\u6240\u6709\u68af\u5ea6\u7b97\u5b8c\u624d\u540c\u6b65\uff09\u3002\u9700\u8981\u6ce8\u610f\u5206\u6876\u5927\u5c0f\u8fc7\u5927\u53ef\u80fd\u589e\u52a0\u4e00\u6b21\u901a\u4fe1\u65f6\u5ef6\uff0c\u5b9e\u9645\u914d\u7f6e\u65f6\u901a\u5e38\u572850~100MB\u8303\u56f4\u8c03\u4f18\u3002</li> <li>\u9884\u53d6\u4e0b\u4e00\u6b65\u6570\u636e (Prefetching)\uff1a \u9488\u5bf9ZeRO-3\u4e2d\u5c42\u4e0e\u5c42\u4e4b\u95f4\u4e32\u884c\u901a\u4fe1\u7684\u74f6\u9888\uff0c\u5f15\u5165\u53c2\u6570\u9884\u53d6\u673a\u5236\uff1a\u5728\u5f53\u524d\u5c42\u524d\u5411/\u540e\u5411\u8ba1\u7b97\u65f6\u5e76\u884c\u8bf7\u6c42\u4e0b\u4e00\u5c42\u6240\u9700\u7684\u53c2\u6570\u788e\u7247\u3002\u8fd9\u6837\u5f53\u8fdb\u5165\u4e0b\u4e00\u5c42\u65f6\uff0c\u6240\u9700\u53c2\u6570\u53ef\u80fd\u5df2\u7ecf\u5728\u8def\u4e0a\u751a\u81f3\u63a5\u6536\u5b8c\u6bd5\uff0c\u7f29\u77ed\u4e86\u7b49\u5f85\u65f6\u95f4\u3002DeepSpeed\u7684\u914d\u7f6e<code>\"stage3_prefetch_bucket_size\"</code>\u7b49\u5373\u63a7\u5236\u9884\u53d6\u7684\u7c92\u5ea6\u3002\u5408\u7406\u7684\u9884\u53d6\u53ef\u4ee5\u5c06\u901a\u4fe1\u5ef6\u8fdf\u9690\u85cf\u5728\u8ba1\u7b97\u4e2d\uff0c\u4f46\u9884\u53d6\u8fc7\u591a\u6570\u636e\u53ef\u80fd\u9020\u6210\u65e0\u8c13\u4f20\u8f93\u6216\u5185\u5b58\u5360\u7528\uff0c\u9700\u8981\u52a8\u6001\u6743\u8861\u3002\u5b9e\u9645\u7ed3\u679c\u8868\u660e\uff0c\u9884\u53d6\u5bf9\u4e8e\u5c0fbatch\u60c5\u51b5\u4e0b\u63d0\u5347\u660e\u663e\u2014\u2014\u56e0\u4e3a\u6bcf\u5c42\u8ba1\u7b97\u66f4\u5feb\uff0c\u901a\u4fe1\u6765\u4e0d\u53ca\u5b8c\u5168\u9690\u85cf\uff0c\u9700\u8981\u9884\u5148\u8c03\u5ea6\u3002</li> <li>\u538b\u7f29\u4e0e\u91cf\u5316\u901a\u4fe1 (\u901a\u4fe1\u538b\u7f29)\uff1a \u9488\u5bf9\u67d0\u4e9b\u901a\u4fe1\u74f6\u9888\uff0c\u7814\u7a76\u8005\u4e5f\u63a2\u7d22\u4e86\u68af\u5ea6\u538b\u7f29\u3001\u91cf\u5316\u4f20\u8f93\u7b49\u65b9\u6cd5\u3002\u4f8b\u5982ZeRO++\u4e2d\u63d0\u51fa\u5bf9All-Gather\u7684\u6743\u91cd\u5757\u8fdb\u884c8-bit\u91cf\u5316\u518d\u4f20\u8f93\uff0c\u4ee5\u964d\u4f4e\u901a\u4fe1\u5b57\u8282\u6570\u3002\u8fd9\u4e9b\u65b9\u6cd5\u9700\u914d\u5408\u989d\u5916\u7684\u8fd8\u539f\u5f00\u9500\uff0c\u5c5e\u4e8e\u524d\u6cbf\u63a2\u7d22\uff0c\u5728\u6b64\u4e0d\u5c55\u5f00\u3002</li> </ul> <p>\u901a\u8fc7\u4ee5\u4e0a\u7b56\u7565\uff0cZeRO\u5404\u9636\u6bb5\u7684\u901a\u4fe1\u5f00\u9500\u88ab\u5927\u5927\u4f18\u5316\u3002\u5728\u7406\u60f3\u73af\u5883\u4e0b\uff0cZeRO-3\u53ef\u8fd1\u4e4e\u7ebf\u6027\u6269\u5c55\uff1a\u5fae\u8f6f\u62a5\u544a\u5728400 GPU\u4e0a\u8bad\u7ec31000\u4ebf\u53c2\u6570\u6a21\u578b\u65f6\u83b7\u5f97\u4e86\u8d85\u8fc710\u500d\u52a0\u901f\uff0c\u901a\u4fe1\u5e76\u672a\u6210\u4e3a\u4e3b\u8981\u74f6\u9888\u3002\u800c\u5728\u901a\u4fe1\u8f83\u6162\u73af\u5883\uff08\u5982\u591a\u673a\u5f31\u7f51\u7edc\uff09\u4e0b\uff0c\u5145\u5206\u7684\u901a\u4fe1\u91cd\u53e0\u548c\u5206\u6876\u4e5f\u80fd\u4f7fZeRO-3\u4fdd\u6301\u8f83\u597d\u7684\u6269\u5c55\u6548\u7387\u3002\u4f8b\u5982\u67d0\u5b9e\u9a8c\u5bf9\u6bd4\u663e\u793a\uff0c8\u5361\u6269\u5c55\u523032\u5361\u65f6\uff0cZeRO-3\u7684\u5e76\u884c\u6548\u7387\u8fbe\u5230\u4e8676%\uff0c\u660e\u663e\u4f18\u4e8eZeRO-2\u768454%\u3002\u603b\u4e4b\uff0c\u901a\u4fe1\u4f18\u5316\u4f7f\u5f97ZeRO\u5728\u6781\u5927\u964d\u4f4e\u5185\u5b58\u7684\u540c\u65f6\uff0c\u5c3d\u53ef\u80fd\u4fdd\u6301\u4e86\u8bad\u7ec3\u541e\u5410\u7387\u3002\u5728\u5de5\u7a0b\u5b9e\u8df5\u4e2d\u5e94\u6839\u636e\u786c\u4ef6\u548c\u6a21\u578b\u89c4\u6a21\uff0c\u8c03\u6574\u5982<code>overlap_comm</code>, <code>bucket_size</code>\u7b49\u53c2\u6570\uff0c\u4ee5\u83b7\u5f97\u901a\u4fe1\u548c\u8ba1\u7b97\u7684\u6700\u4f73\u5e73\u8861\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/%E4%B8%BA%E4%BD%95FP16%E8%AE%AD%E7%BB%83%E6%97%B6%E6%A2%AF%E5%BA%A6%E5%AE%B9%E6%98%93%E4%B8%8B%E6%BA%A2%E4%B8%BA0%EF%BC%9F/","title":"\u4e3a\u4f55FP16\u8bad\u7ec3\u65f6\u68af\u5ea6\u5bb9\u6613\u4e0b\u6ea2\u4e3a0\uff1f","text":"\u6807\u7b7e\uff1a \u6a21\u578b\u91cf\u5316LLM","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/%E4%B8%BA%E4%BD%95FP16%E8%AE%AD%E7%BB%83%E6%97%B6%E6%A2%AF%E5%BA%A6%E5%AE%B9%E6%98%93%E4%B8%8B%E6%BA%A2%E4%B8%BA0%EF%BC%9F/#1","title":"1. \u68af\u5ea6\u5929\u7136\u5c31\u5f88\u5c0f","text":"<p>\u6df1\u5ea6\u7f51\u7edc\u7684\u68af\u5ea6\u7531\u94fe\u5f0f\u6cd5\u5219\u51b3\u5b9a</p> \\[\\nabla_w L =\\prod_{l=1}^{n}\\frac{\\partial h_l}{\\partial h_{l-1}}\\] <ul> <li>\u6fc0\u6d3b\u51fd\u6570\uff08ReLU \u4f8b\u5916\uff09\u3001\u5f52\u4e00\u5316\u3001Softmax \u7b49\u7b97\u5b50\u7684\u5bfc\u6570\u7edd\u5bf9\u503c\u666e\u904d \u5c0f\u4e8e 1\u3002</li> <li>\u7f51\u7edc\u8d8a\u6df1\u6216\u5e8f\u5217\u8d8a\u957f\uff0c\u8fd9\u4e9b\u5bfc\u6570\u76f8\u4e58\u5c31\u8d8a\u63a5\u8fd1 0\uff0c\u68af\u5ea6\u5448\u6307\u6570\u7ea7\u8870\u51cf\uff08\u68af\u5ea6\u6d88\u5931\uff09\u3002</li> </ul> <p>\u5b9e\u9645\u5927\u578b Transformer \u4e2d\uff0c\u67d0\u4e9b\u5c42\u7684\u6743\u91cd\u68af\u5ea6\u5e38\u843d\u5230\\(10^{-9}\\sim10^{-7}\\)\u7ea7\u522b\u3002</p>","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/%E4%B8%BA%E4%BD%95FP16%E8%AE%AD%E7%BB%83%E6%97%B6%E6%A2%AF%E5%BA%A6%E5%AE%B9%E6%98%93%E4%B8%8B%E6%BA%A2%E4%B8%BA0%EF%BC%9F/#2-fp16","title":"2. FP16 \u80fd\u8868\u793a\u7684\u6700\u5c0f\u6b63\u6570\u8fdc\u5927\u4e8e\u8fd9\u4e9b\u68af\u5ea6","text":"<ul> <li>\u5728 \u786c\u4ef6\uff08GPU Tensor Core\uff09\u4e0a\uff0c\u4e9a\u6b63\u89c4\u6570\uff08subnormal\uff09\u901a\u5e38\u4f1a\u88ab flush-to-zero \u4ee5\u63d0\u5347\u541e\u5410\uff1b\u8fd9\u628a\u53ef\u7528\u4e0b\u754c\u4ece\\(5.96\\times10^{-8}\\)\u518d\u62ac\u5230\\(6.10\\times10^{-5}\\)\u3002</li> <li>\u4e8e\u662f\u4efb\u4f55\u6570\u503c\\(|g| &lt; 6.1\\times10^{-5}\\)\u5728\u4e58\u6cd5\u7d2f\u52a0\u6216\u5199\u5165\u5185\u5b58\u65f6\u76f4\u63a5\u88ab\u622a\u65ad\u4e3a 0\u3002</li> </ul> \u6307\u6807 float32 (FP32) float16 (FP16) \u6700\u5c0f\u6b63 \u6b63\u89c4 \u6570\\(f_{\\min}\\) \\(2^{-126}\\approx1.18\\times10^{-38}\\) \\(2^{-14}\\approx6.10\\times10^{-5}\\) \u6700\u5c0f\u6b63 \u975e\u6b63\u89c4 \u6570\\(f_{\\text{sub}}\\) \\(2^{-149}\\approx1.40\\times10^{-45}\\) \\(2^{-24}\\approx5.96\\times10^{-8}\\) \u52a8\u6001\u8303\u56f4\\(\\dfrac{f_{\\max}}{f_{\\text{sub}}}\\) \\(\\sim10^{38}\\) \\(\\sim10^{12}\\) <p>\u5173\u952e\u5dee\u5f02\uff1a FP16 \u53ea\u6709 5 \u4f4d\u6307\u6570\uff0c\u52a8\u6001\u8303\u56f4\u7ea6\u662f FP32 \u7684\u767e\u4e07\u5206\u4e4b\u4e00\uff0c\u6700\u5c0f\u53ef\u8868\u793a\u6b63\u6570\u4e5f\u5927\u5f97\u591a\u3002</p> <p>\u4e3e\u4f8b</p> <p>\\(g = 3.2\\times10^{-6}\\quad\\Longrightarrow\\quad \\text{FP32 \u8868\u793a: }3.2\\times10^{-6}\\bigl(\\text{\u6b63\u5e38}\\bigr)\\quad \\text{FP16 \u8868\u793a: }0\\)</p> <p>\u68af\u5ea6\u88ab\u5f3a\u884c\u7f6e\u96f6\u540e\uff0c\u8be5\u6743\u91cd\u5c31\u5f97\u4e0d\u5230\u66f4\u65b0\uff0c\u8bad\u7ec3\u6548\u679c\u53d7\u635f\u3002</p>","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/%E4%B8%BA%E4%BD%95FP16%E8%AE%AD%E7%BB%83%E6%97%B6%E6%A2%AF%E5%BA%A6%E5%AE%B9%E6%98%93%E4%B8%8B%E6%BA%A2%E4%B8%BA0%EF%BC%9F/#3","title":"3. \u4e3a\u4ec0\u4e48\u635f\u5931\u7f29\u653e\u80fd\u89e3\u51b3\uff1f","text":"<p>\u5c06\u635f\u5931\u653e\u5927\\(S\\)\u500d\uff1a</p> \\[\\tilde{L} = S\\,L,\\quad \\nabla_w \\tilde{L}=S\\,\\nabla_w L\\] <p>\u53ea\u8981\u6311\u9009\\(S\\)\u4f7f\u5f97</p> \\[S \\,\\nabla_w L &gt; 6.1\\times10^{-5},\\] <p>\u68af\u5ea6\u5c31\u80fd \u9003\u79bb\u4e0b\u6ea2\u533a\uff0c\u5728 FP16 \u8303\u56f4\u5185\u5b89\u5168\u8868\u793a\uff1b\u968f\u540e\u518d\u9664\u56de\\(S\\)\u4fdd\u8bc1\u6570\u503c\u7b49\u4ef7\u3002 \u8fd9\u6b63\u662f GradScaler \u7684\u6838\u5fc3\u601d\u60f3\uff1a\u52a8\u6001\u5bfb\u627e\u201c\u6700\u5927\u4f46\u4e0d\u6ea2\u51fa\u201d\u7684\\(S\\)\uff0c\u5728\u6027\u80fd\u4e0e\u6570\u503c\u7a33\u5b9a\u6027\u4e4b\u95f4\u53d6\u5f97\u5e73\u8861\u3002</p> <p>\u603b\u7ed3\uff1a</p> <ul> <li>\u68af\u5ea6\u672c\u8eab\u6781\u5c0f \uff0b FP16 \u52a8\u6001\u8303\u56f4\u7a84\u4e14\u786c\u4ef6\u6613\u5c06 subnormal \u5f52\u96f6 \u21d2 \u5f88\u591a\u68af\u5ea6\u88ab\u622a\u65ad\u4e3a 0\uff1b</li> <li>\u901a\u8fc7 \u635f\u5931\u7f29\u653e \u628a\u68af\u5ea6\u6574\u4f53\u62ac\u9ad8\uff0c\u518d\u5728\u66f4\u65b0\u524d\u7f29\u56de\u539f\u5c3a\u5ea6\uff0c\u5373\u53ef\u907f\u514d\u4e0b\u6ea2\uff0c\u540c\u65f6\u4fdd\u6301\u8ba1\u7b97\u6b63\u786e\u6027\u3002 </li> </ul>","tags":["\u6a21\u578b\u91cf\u5316","LLM"]},{"location":"posts/%E6%A0%87%E5%87%86%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A1%8C%EF%BC%88DP%EF%BC%89%E8%AE%AD%E7%BB%83%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/","title":"\u6807\u51c6\u6570\u636e\u5e76\u884c\uff08DP\uff09\u8bad\u7ec3\u6d41\u7a0b\u89e3\u6790","text":"\u6807\u7b7e\uff1a \u5e76\u884c\u8bad\u7ec3LLM","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/%E6%A0%87%E5%87%86%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A1%8C%EF%BC%88DP%EF%BC%89%E8%AE%AD%E7%BB%83%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/#1","title":"1. \u53c2\u6570\u521d\u59cb\u5316\u4e0e\u540c\u6b65\u673a\u5236","text":"<p>\u5728\u6570\u636e\u5e76\u884c (Data Parallel, DP) \u8bad\u7ec3\u4e2d\uff0c\u6bcf\u5757 GPU \u90fd\u4fdd\u6709\u4e00\u4efd\u5b8c\u6574\u7684\u6a21\u578b\u526f\u672c\u3002\u8bad\u7ec3\u5f00\u59cb\u65f6\u9700\u8981\u786e\u4fdd\u5404 GPU \u4e0a\u6a21\u578b\u53c2\u6570\u521d\u59cb\u503c\u4e00\u81f4\u3002\u901a\u5e38\u7684\u505a\u6cd5\u662f\u5728\u4e00\u4e2a\u8fdb\u7a0b\u4e0a\u521d\u59cb\u5316\u6a21\u578b\u53c2\u6570\uff0c\u7136\u540e\u5c06\u5176\u5e7f\u64ad\u540c\u6b65\u5230\u5176\u4ed6 GPU\u3002\u4f8b\u5982\uff0c\u5728 PyTorch DistributedDataParallel (DDP) \u4e2d\uff0c\u6784\u9020 DDP \u5bf9\u8c61\u65f6\u4f1a\u4f7f\u7528 <code>ProcessGroup::broadcast()</code> \u5c06 rank 0 \u8fdb\u7a0b\u7684\u6a21\u578b\u53c2\u6570\u72b6\u6001 (<code>state_dict</code>) \u53d1\u9001\u7ed9\u6240\u6709\u5176\u4ed6\u8fdb\u7a0b\u3002\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u6bcf\u4e2a GPU \u4e0a\u7684\u6a21\u578b\u526f\u672c\u4ece\u4e00\u5f00\u59cb\u5c31\u5177\u6709\u76f8\u540c\u7684\u6743\u91cd\u503c\u3002\u5982\u679c\u6a21\u578b\u5305\u542b\u7f13\u51b2\u533a\uff08\u5982 BatchNorm \u7684\u5747\u503c/\u65b9\u5dee\uff09\uff0cDDP \u4e5f\u4f1a\u5728\u6bcf\u6b21\u524d\u5411\u8ba1\u7b97\u524d\u5e7f\u64ad\u540c\u6b65\u8fd9\u4e9b\u7f13\u51b2\u533a\uff0c\u4ece\u800c\u4fdd\u6301\u6a21\u578b\u7684\u4e00\u81f4\u6027\u3002</p> <p>\u53e6\u4e00\u79cd\u5e38\u89c1\u65b9\u5f0f\u662f\u4f7f\u7528\u76f8\u540c\u7684\u968f\u673a\u79cd\u5b50\u5728\u6bcf\u4e2a GPU \u4e0a\u72ec\u7acb\u521d\u59cb\u5316\u6a21\u578b\u53c2\u6570\uff0c\u4f46\u4ecd\u9700\u901a\u8fc7\u4e0a\u8ff0\u5e7f\u64ad\u673a\u5236\u6765\u786e\u4fdd\u5b8c\u5168\u540c\u6b65\u3002\u603b\u4e4b\uff0c\u5728\u8bad\u7ec3\u7684\u8d77\u70b9\uff0c\u5404 GPU \u7684\u6a21\u578b\u53c2\u6570\u90fd\u662f\u5bf9\u9f50\u7684\uff0c\u6ca1\u6709\u5dee\u5f02\u3002\u8fd9\u4e3a\u540e\u7eed\u7684\u540c\u6b65\u66f4\u65b0\u5960\u5b9a\u4e86\u57fa\u7840\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/%E6%A0%87%E5%87%86%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A1%8C%EF%BC%88DP%EF%BC%89%E8%AE%AD%E7%BB%83%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/#2","title":"2. \u524d\u5411\u4e0e\u53cd\u5411\u4f20\u64ad\u8fc7\u7a0b","text":"<p>\u524d\u5411\u4f20\u64ad\uff08Forward Pass\uff09\uff1a \u5728\u6bcf\u6b21\u8bad\u7ec3\u8fed\u4ee3\u4e2d\uff0c\u5404 GPU \u4f1a\u5904\u7406\u4e0d\u540c\u7684\u8f93\u5165\u6570\u636e\u5b50\u96c6\u3002\u901a\u5e38\u5c06\u5168\u5c40\u6279\u6b21\uff08batch\uff09\u6309\u7b49\u4efd\u5212\u5206\u7ed9\u6bcf\u4e2a GPU\uff08\u4f8b\u5982\u91c7\u7528 DistributedSampler \u786e\u4fdd\u6bcf\u4e2aGPU\u8bfb\u53d6\u4e0d\u540c\u7684\u6570\u636e\u5207\u7247\uff09\u3002\u6bcf\u4e2a GPU \u4f7f\u7528\u672c\u5730\u7684\u6a21\u578b\u526f\u672c\u5bf9\u81ea\u5df1\u7684\u6570\u636e\u5b50\u96c6\u6267\u884c\u524d\u5411\u8ba1\u7b97\uff0c\u4ea7\u51fa\u9884\u6d4b\u7ed3\u679c\u548c\u635f\u5931\u503c\u3002\u7531\u4e8e\u6240\u6709 GPU \u4e0a\u6a21\u578b\u53c2\u6570\u521d\u59cb\u5b8c\u5168\u76f8\u540c\u4e14\u5c1a\u672a\u66f4\u65b0\uff0c\u56e0\u6b64\u9488\u5bf9\u4e0d\u540c\u6570\u636e\u8ba1\u7b97\u51fa\u7684\u68af\u5ea6\u4e4b\u524d\uff0c\u5404\u6a21\u578b\u526f\u672c\u4ecd\u4fdd\u6301\u540c\u6b65\u3002\u524d\u5411\u4f20\u64ad\u9636\u6bb5\u4e0d\u9700\u8981\u8de8 GPU \u901a\u4fe1\uff1b\u6bcf\u4e2a GPU \u72ec\u7acb\u5b8c\u6210\u5176\u8ba1\u7b97\u3002</p> <p>\u53cd\u5411\u4f20\u64ad\uff08Backward Pass\uff09\uff1a \u968f\u540e\uff0c\u6bcf\u4e2a GPU \u57fa\u4e8e\u5176\u8ba1\u7b97\u7684\u635f\u5931\uff0c\u5bf9\u672c\u5730\u6a21\u578b\u6267\u884c\u53cd\u5411\u4f20\u64ad\uff0c\u8ba1\u7b97\u5bf9\u5e94\u4e8e\u6574\u4e2a\u6a21\u578b\u6240\u6709\u53c2\u6570\u7684\u68af\u5ea6\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5c3d\u7ba1\u6bcf\u4e2a GPU \u53ea\u5904\u7406\u4e86\u5168\u5c40\u6279\u6b21\u7684\u4e00\u90e8\u5206\u6837\u672c\uff0c\u4f46\u5b83\u4f1a\u4e3a\u6a21\u578b\u7684\u6bcf\u4e00\u4e2a\u53c2\u6570\u8ba1\u7b97\u68af\u5ea6\uff08\u8fd9\u4e9b\u68af\u5ea6\u53cd\u6620\u4e86\u8be5GPU\u6240\u89c1\u6570\u636e\u5bf9\u53c2\u6570\u7684\u8bef\u5dee\u4fe1\u53f7\uff09\u3002\u6b64\u65f6\uff0c\u4e0d\u540c GPU \u5f97\u5230\u7684\u68af\u5ea6\u5404\u4e0d\u76f8\u540c\uff08\u56e0\u4e3a\u8f93\u5165\u6570\u636e\u4e0d\u540c\uff09\uff1b\u6bcf\u5757 GPU \u6682\u65f6\u5404\u81ea\u62e5\u6709\u4e00\u4efd\u5b8c\u6574\u7684\u68af\u5ea6\u5f20\u91cf\u96c6\u5408\u3002\u8fd9\u4e9b\u672c\u5730\u68af\u5ea6\u4f1a\u5b58\u50a8\u5728\u53c2\u6570\u7684 <code>.grad</code> \u5b57\u6bb5\u4e2d\uff0c\u4f9b\u540e\u7eed\u4f18\u5316\u6b65\u9aa4\u4f7f\u7528\u3002</p> <p>\u9700\u8981\u6ce8\u610f\uff0c\u5728\u6807\u51c6\u6570\u636e\u5e76\u884c\u4e2d\uff0c\u5404 GPU \u540c\u6b65\u5730\u8fdb\u884c\u524d\u5411\u548c\u53cd\u5411\u8ba1\u7b97\uff0c\u5373\u5404 GPU \u90fd\u6267\u884c\u76f8\u540c\u7684\u8ba1\u7b97\u56fe\uff0c\u53ea\u662f\u6570\u636e\u4e0d\u540c\u3002\u5b83\u4eec\u901a\u5e38\u4ee5\u9501\u6b65\u65b9\u5f0f\u63a8\u8fdb\u8bad\u7ec3\uff1a\u4e00\u6b21\u8fed\u4ee3\u4e2d\u6240\u6709 GPU \u5b8c\u6210\u524d\u5411\u548c\u53cd\u5411\u540e\uff0c\u624d\u4f1a\u8fdb\u5165\u68af\u5ea6\u805a\u5408\u548c\u53c2\u6570\u66f4\u65b0\u9636\u6bb5\u3002\u8fd9\u6837\u4fdd\u8bc1\u4e86\u6570\u636e\u5e76\u884c\u8bad\u7ec3\u5728\u6570\u5b66\u4e0a\u7b49\u4ef7\u4e8e\u5355 GPU \u4e0a\u5927\u6279\u91cf\u7684\u8bad\u7ec3\uff08\u53ea\u662f\u5c06\u5927\u6279\u6b21\u62c6\u5206\u5230\u591a\u5361\uff09\u2014\u2014\u524d\u63d0\u662f\u6b63\u786e\u540c\u6b65\u68af\u5ea6\u548c\u66f4\u65b0\u53c2\u6570\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/%E6%A0%87%E5%87%86%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A1%8C%EF%BC%88DP%EF%BC%89%E8%AE%AD%E7%BB%83%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/#3-all-reduce","title":"3. \u68af\u5ea6\u540c\u6b65\u673a\u5236\uff08All-Reduce\uff09","text":"<p>\u6bcf\u4e2a GPU \u53cd\u5411\u4f20\u64ad\u5f97\u5230\u7684\u662f\u57fa\u4e8e\u5176\u672c\u5730\u6570\u636e\u7684\u5c40\u90e8\u68af\u5ea6\u3002\u4e3a\u4e86\u4f7f\u591a\u5361\u8bad\u7ec3\u4e0e\u5355\u5361\u5927\u6279\u91cf\u68af\u5ea6\u4e0b\u964d\u7684\u7ed3\u679c\u4e00\u81f4\uff0c\u6211\u4eec\u9700\u8981\u5c06\u6240\u6709 GPU \u7684\u68af\u5ea6\u805a\u5408\uff08\u4e00\u822c\u53d6\u5e73\u5747\uff09\u540e\u518d\u66f4\u65b0\u53c2\u6570\u3002DP\u7b56\u7565\u4e2d\u7ecf\u5178\u7684\u505a\u6cd5\u662f\u5bf9\u68af\u5ea6\u4f7f\u7528 All-Reduce \u64cd\u4f5c\uff1a\u628a\u5404GPU\u5bf9\u5e94\u53c2\u6570\u7684\u68af\u5ea6\u52a0\u8d77\u6765\uff08\u6216\u53d6\u5e73\u5747\uff09\u5e76\u56de\u6536\u5230\u6bcf\u4e2aGPU\u3002\u8fd9\u4e00\u8fc7\u7a0b\u901a\u5e38\u5728\u53cd\u5411\u4f20\u64ad\u7ed3\u675f\u6216\u8fc7\u7a0b\u4e2d\u89e6\u53d1\u3002</p> <p></p> <p>\u56fe\uff1a\u73af\u5f62 All-Reduce \u901a\u4fe1\u62d3\u6251\u793a\u610f\uff0c\u6bcf\u4e2a GPU \u4ec5\u4e0e\u90bb\u5c45\u76f4\u63a5\u4ea4\u6362\u68af\u5ea6\u5206\u7247\uff0c\u4ece\u800c\u907f\u514d\u5355\u4e00\u8282\u70b9\u6210\u4e3a\u74f6\u9888\u3002</p> <p>\u5728\u65e9\u671f\u7b80\u5355\u5b9e\u73b0\u4e2d\uff0c\u53ef\u4ee5\u7531\u4e00\u4e2a\u201c\u53c2\u6570\u670d\u52a1\u5668\u201d\uff08\u6bd4\u5982\u4e3b\u8282\u70b9/GPU\uff09\u6536\u96c6\u6240\u6709\u68af\u5ea6\u6c42\u548c\u518d\u5e7f\u64ad\u56de\u5404GPU\uff0c\u4f46\u8fd9\u79cd\u96c6\u4e2d\u5f0f\u65b9\u6848\u901a\u4fe1\u5f00\u9500\u968fGPU\u6570\u7ebf\u6027\u589e\u957f\uff0c\u6613\u5f62\u6210\u74f6\u9888\u3002\u73b0\u4ee3\u5e93\uff08\u5982 NCCL\uff09\u666e\u904d\u91c7\u7528Ring All-Reduce\u73af\u5f62\u7b97\u6cd5\u6765\u4f18\u5316\u68af\u5ea6\u540c\u6b65\u6548\u7387\u3002\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6240\u6709 GPU \u903b\u8f91\u4e0a\u7ec4\u6210\u4e00\u4e2a\u73af\uff0c\u5404 GPU \u5c06\u81ea\u5df1\u68af\u5ea6\u5f20\u91cf\u6309\u5757\u62c6\u5206\u5e76\u5728\u73af\u4e0a\u9010\u6b65\u4e0e\u90bb\u5c45\u4ea4\u6362\u548c\u89c4\u7ea6\u3002Ring All-Reduce \u5206\u4e3aReduce-Scatter\uff08\u5404GPU\u9010\u6b65\u7d2f\u52a0\u5f97\u5230\u4e00\u5757\u5168\u5c40\u548c\uff09\u548cAll-Gather\uff08\u5c06\u5404\u5757\u5168\u5c40\u548c\u5206\u53d1\uff0c\u4f7f\u6bcfGPU\u5f97\u5230\u5b8c\u6574\u548c\uff09\u4e24\u4e2a\u9636\u6bb5\u3002\u7ecf\u8fc7\u4e00\u8f6e\u73af\u5f62\u4f20\u8f93\u540e\uff0c\u6bcf\u4e2a GPU \u6700\u7ec8\u90fd\u4f1a\u5f97\u5230\u5168\u5c40\u68af\u5ea6\u548c\uff08\u6216\u5747\u503c\uff09\u7684\u5b8c\u6574\u62f7\u8d1d\u3002\u76f8\u8f83\u53c2\u6570\u670d\u52a1\u5668\u6a21\u5f0f\uff0c\u73af\u5f62\u7b97\u6cd5\u5145\u5206\u5229\u7528\u6bcf\u5757GPU\u7684\u5e26\u5bbd\uff0c\u907f\u514d\u5355\u70b9\u74f6\u9888\uff0c\u5e76\u4e14\u603b\u901a\u4fe1\u91cf\u66f4\u5747\u5300\u3001\u9ad8\u6548\u3002</p> <p>\u5728\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0cPyTorch DDP \u5728\u68af\u5ea6\u540c\u6b65\u65b9\u9762\u505a\u4e86\u5927\u91cf\u4f18\u5316\u3002DDP\u4f1a\u5728\u6784\u9020\u65f6\u4e3a\u6bcf\u4e2a\u5f85\u8bad\u7ec3\u53c2\u6570\u6ce8\u518c\u4e00\u4e2aautograd\u56de\u8c03\u94a9\u5b50\uff0c\u7528\u4e8e\u76d1\u542c\u5176\u68af\u5ea6\u4f55\u65f6\u8ba1\u7b97\u5b8c\u6bd5\u3002\u4e3a\u4e86\u51cf\u5c11\u901a\u4fe1\u6b21\u6570\uff0cDDP\u8fd8\u5c06\u53c2\u6570\u68af\u5ea6\u5212\u5206\u8fdb\u82e5\u5e72\u6876\uff08bucket\uff09\u4e2d\uff1a\u4f8b\u5982\u5c06\u591a \u4e2a\u5c0f\u68af\u5ea6\u5f20\u91cf\u62fc\u5408\u6210\u8f83\u5927\u7684\u7f13\u51b2\u533a\u3002\u8fd9\u4e9b\u6876\u7684\u5927\u5c0f\u53ef\u4ee5\u901a\u8fc7 <code>bucket_cap_mb</code> \u53c2\u6570\u8c03\u6574\uff0c\u4e00\u822c\u9ed8\u8ba4\u4e0a\u9650\u4e3a 25MB \u5de6\u53f3\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u53ef\u4ee5\u4ee5bucket\u4e3a\u5355\u4f4d\u8fdb\u884c\u901a\u4fe1\uff0c\u964d\u4f4e\u901a\u4fe1\u8c03\u7528\u9891\u7387\u5e76\u63d0\u9ad8\u5e26\u5bbd\u5229\u7528\u7387\u3002</p> <p>\u68af\u5ea6All-Reduce\u7684\u89e6\u53d1\u65f6\u673a\u4e0e\u7c92\u5ea6\uff1a \u5728\u53cd\u5411\u4f20\u64ad\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u67d0\u4e9b\u53c2\u6570\u7684\u68af\u5ea6\u8ba1\u7b97\u5b8c\u6210\u3001\u5bf9\u5e94\u7684bucket\u586b\u6ee1\u65f6\uff0cDDP\u7684\u68af\u5ea6\u56de\u8c03\u4f1a\u7acb\u5373\u89e6\u53d1\u4e00\u4e2a\u5f02\u6b65\u7684 All-Reduce \u64cd\u4f5c\u6765\u540c\u6b65\u8be5bucket\u4e2d\u7684\u6240\u6709\u68af\u5ea6\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u68af\u5ea6\u7684\u89c4\u7ea6\u5e76\u4e0d\u7b49\u5230\u6240\u6709\u53c2\u6570\u90fd\u5904\u7406\u5b8c\u624d\u4e00\u6b21\u6027\u53d1\u751f\uff0c\u800c\u662f\u4e0e\u53cd\u5411\u8ba1\u7b97\u4ea4\u53e0\u91cd\u53e0\u8fdb\u884c\uff0c\u4ece\u6700\u540e\u4e00\u5c42\u5f00\u59cb\u68af\u5ea6\u4e00\u8fb9\u751f\u6210\u4e00\u8fb9\u5c31\u8fd1\u901a\u4fe1\u3002</p> <p></p> <p>\u56fe\uff1aDDP \u5c06\u6bcf\u5f20\u5361\u4e0a\u7684\u68af\u5ea6\u6309\u53c2\u6570\u5212\u5206\u5230\u4e0d\u540c bucket\uff0c\u4e2d\u95f4\u91c7\u7528\u94a9\u5b50\u5f02\u6b65\u89e6\u53d1 All-Reduce\uff08\u793a\u4f8b\u4e2d grad0 \u548c grad1 \u5c5e\u4e8e bucket1\uff0cgrad2 \u548c grad3 \u5c5e\u4e8e bucket0\uff09\u3002\u68af\u5ea6\u8ba1\u7b97\u987a\u5e8f\u4e0ebucket\u5212\u5206\u76f8\u5339\u914d\u65f6\uff0c\u53ef\u4ee5\u6700\u5927\u5316\u901a\u4fe1\u4e0e\u8ba1\u7b97\u91cd\u53e0\u3002</p> <p>\u5982\u4e0a\u56fe\u793a\u4f8b\uff0c\u5047\u8bbe\u6a21\u578b\u67094\u4e2a\u53c2\u6570 <code>param0</code>-<code>param3</code>\uff08\u5728\u4e24\u5f20GPU\u7684\u4e24\u4e2aDDP\u8fdb\u7a0b\u4e2d\u5404\u6709\u4e00\u4efd\uff09\u3002DDP\u6309\u7167\u9006\u5e8f\u5c06\u53c2\u6570\u5206\u914d\u5165\u4e24\u4e2abucket\uff1a<code>bucket1</code> \u5305\u542b <code>grad0, grad1</code>\uff0c<code>bucket0</code> \u5305\u542b <code>grad2, grad3</code>\u3002\u5728\u53cd\u5411\u8fc7\u7a0b\u4e2d\uff0c\u82e5\u68af\u5ea6\u4ea7\u751f\u987a\u5e8f\u662f grad3\u2192grad2\u2192grad1\u2192grad0\uff08\u4e00\u822c\u9760\u540e\u7684\u5c42\u68af\u5ea6\u5148\u8ba1\u7b97\u5b8c\uff09\uff0c\u90a3\u4e48\u5f53<code>bucket0</code>\u7684\u6240\u6709\u68af\u5ea6\u90fd\u5df2\u5c31\u7eea\u65f6\uff0c\u4f1a\u9a6c\u4e0a\u542f\u52a8\u4e00\u6b21 All-Reduce \u6765\u540c\u6b65\u8fd9\u4e9b\u68af\u5ea6\uff0c\u800c\u65e0\u9700\u7b49\u5f85\u8f83\u9760\u524d\u5c42\u7684 grad0/1\u3002\u63a5\u7740 grad0/1 \u5b8c\u6210\u540e\u540c\u6b65 <code>bucket1</code>\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97\u901a\u4fe1\u5f00\u9500\u9690\u85cf\u5728\u53cd\u5411\u8ba1\u7b97\u4e2d\uff0c\u63d0\u9ad8\u4e86\u5e76\u884c\u6548\u7387\u3002All-Reduce\u7684\u7ed3\u679c\u662f\u5c06\u540c\u4e00\u53c2\u6570\u7684\u5404GPU\u68af\u5ea6\u53d6\u548c\uff08\u6216\u5e73\u5747)\uff0c\u5e76\u5199\u56de\u5404GPU\u4e0a\u8be5\u53c2\u6570\u7684 <code>.grad</code> \u5b57\u6bb5\u3002\u56e0\u6b64\uff0c\u5728\u53cd\u5411\u4f20\u64ad\u5168\u90e8\u7ed3\u675f\u65f6\uff0c\u4e0d\u540cGPU\u4e0a\u5bf9\u5e94\u53c2\u6570\u7684\u68af\u5ea6\u5f20\u91cf\u5185\u5bb9\u5b8c\u5168\u76f8\u540c\u3002\u6b64\u65f6\u6bcf\u5757GPU\u90fd\u6301\u6709\u4e00\u4efd\u5168\u5c40\u5e73\u5747\u540e\u7684\u5b8c\u6574\u68af\u5ea6\u3002</p> <p>\u603b\u7ed3\u6765\u8bf4\uff0c\u6570\u636e\u5e76\u884c\u4e0b\u68af\u5ea6\u540c\u6b65\u91c7\u7528\u7684\u662f\u9010\u53c2\u6570\uff08\u6216\u9010bucket\uff09All-Reduce\uff1a\u5404GPU\u5185\u5b58\u4e2d\u6682\u5b58\u5b8c\u6574\u68af\u5ea6\uff0c\u4f46\u901a\u8fc7\u9ad8\u901f\u4e92\u8054\u4ea4\u6362\uff0c\u6700\u7ec8\u6bcf\u4e2a\u68af\u5ea6\u5f20\u91cf\u53d8\u4e3a\u5168\u5c40\u548c/\u5e73\u5747\u503c\u3002\u8fd9\u4fdd\u8bc1\u4e86\u540e\u7eed\u6bcf\u5757\u5361\u5728\u66f4\u65b0\u65f6\u4f7f\u7528\u7684\u68af\u5ea6\u4e0e\u5355\u5361\u7b49\u6548\uff0c\u540c\u65f6\u901a\u4fe1\u6a21\u5f0f\uff08\u5982Ring-AllReduce\uff09\u4e5f\u6700\u5927\u7a0b\u5ea6\u5229\u7528\u4e86\u5e76\u884c\u901a\u4fe1\u5e26\u5bbd\u3002</p> <p>\u5173\u4e8eRing All-Reduce\u7684\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u53ef\u4ee5\u53c2\u89c1\u8fd9\u7bc7\u535a\u5ba2\uff1ahttps://blog.csdn.net/qq_46009046/article/details/135161029</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/%E6%A0%87%E5%87%86%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A1%8C%EF%BC%88DP%EF%BC%89%E8%AE%AD%E7%BB%83%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/#4","title":"4. \u4f18\u5316\u5668\u72b6\u6001\u7ba1\u7406\u4e0e\u53c2\u6570\u66f4\u65b0","text":"<p>\u5b8c\u6210\u68af\u5ea6\u540c\u6b65\u540e\uff0c\u5404 GPU \u62e5\u6709\u4e86\u76f8\u540c\u7684\u6a21\u578b\u68af\u5ea6\uff0c\u4e8e\u662f\u53ef\u4ee5\u5404\u81ea\u8fdb\u884c\u672c\u5730\u7684\u4f18\u5316\u5668\u6b65\u9aa4\uff08optimizer step\uff09\u3002\u4ece\u4f18\u5316\u5668\u7684\u89c6\u89d2\u6765\u770b\uff0c\u6bcf\u4e2aGPU\u53ea\u662f\u5bf9\u81ea\u5df1\u7684\u6a21\u578b\u526f\u672c\u6267\u884c\u4e00\u6b21\u53c2\u6570\u66f4\u65b0\u3002\u7531\u4e8e\u6240\u6709GPU\u7684\u53c2\u6570\u521d\u59cb\u76f8\u540c\u4e14\u68af\u5ea6\u4e5f\u5df2\u540c\u6b65\u4e3a\u5168\u5c40\u5e73\u5747\u503c\uff0c\u56e0\u6b64\u5404GPU\u8fdb\u884c\u76f8\u540c\u7684\u53c2\u6570\u66f4\u65b0\u8ba1\u7b97\uff0c\u4f7f\u5f97\u66f4\u65b0\u540e\u5b83\u4eec\u7684\u6a21\u578b\u6743\u91cd\u4ecd\u4fdd\u6301\u4e00\u81f4\u3002\u8fd9\u4e00\u8fc7\u7a0b\u65e0\u9700\u989d\u5916\u901a\u4fe1\uff1a\u6570\u636e\u5e76\u884c\u8bad\u7ec3\u901a\u8fc7\u786e\u4fdd\u6bcf\u6b21\u8fed\u4ee3\u6240\u6709\u6a21\u578b\u526f\u672c\u68af\u5ea6\u4e00\u81f4\uff0c\u6765\u4fdd\u8bc1\u5404\u526f\u672c\u53c2\u6570\u540c\u6b65\u6f14\u5316\u3002</p> <p>\u4ee5\u5e38\u7528\u7684 Adam \u4f18\u5316\u5668\u4e3a\u4f8b\uff0c\u9664\u4e86\u6a21\u578b\u53c2\u6570\u672c\u8eab\uff0c\u6bcf\u5f20 GPU \u4e0a\u8fd8\u7ef4\u62a4\u4e86\u5b8c\u6574\u7684\u4f18\u5316\u5668\u72b6\u6001\uff0c\u5305\u62ec\u6bcf\u4e2a\u53c2\u6570\u7684\u4e00\u9636\u52a8\u91cf\\(m\\)\uff08\u68af\u5ea6\u7684\u6307\u6570\u6ed1\u52a8\u5e73\u5747\uff09\u548c\u4e8c\u9636\u52a8\u91cf\\(v\\)\uff08\u68af\u5ea6\u5e73\u65b9\u7684\u6307\u6570\u6ed1\u52a8\u5e73\u5747)\u7b49\u3002\u5982\u679c\u4f7f\u7528\u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3\uff0c\u901a\u5e38\u8fd8\u4f1a\u4e3a\u6bcf\u4e2a\u53c2\u6570\u4fdd\u5b58\u4e00\u4efdFP32\u7cbe\u5ea6\u7684\u4e3b\u526f\u672c\uff08\u5373\u6743\u91cd\u7684\u9ad8\u7cbe\u5ea6\u62f7\u8d1d\uff0c\u7528\u4e8e\u7d2f\u79ef\u7cbe\u7ec6\u66f4\u65b0\uff09\u3002\u56e0\u6b64\uff0c\u5728\u6807\u51c6\u6570\u636e\u5e76\u884c\u4e2d\uff0c\u6bcf\u4e2aGPU\u9488\u5bf9\u6bcf\u4e2a\u6a21\u578b\u53c2\u6570\u90fd\u4f1a\u5b58\u50a8\u5982\u4e0b\u72b6\u6001:</p> <ul> <li>\u53c2\u6570\u503c\uff1a\u6a21\u578b\u7684\u6743\u91cd\uff0c\u672c\u4f8b\u4e2d\u53ef\u4e3a FP16\uff08\u7528\u4e8e\u524d\u5411\u53cd\u5411\u8ba1\u7b97\uff09\u6216 FP32\uff08\u5168\u7cbe\u5ea6\u526f\u672c\uff09\u3002</li> <li>\u68af\u5ea6\uff1a\u53c2\u6570\u7684\u5f53\u524d\u68af\u5ea6\uff08\u53cd\u5411\u4f20\u64ad\u540e\u5df2\u540c\u6b65\u4e3a\u5168\u5c40\u68af\u5ea6\uff09\u3002</li> <li>\u4f18\u5316\u5668\u5185\u90e8\u72b6\u6001\uff1a\u4ee5 Adam \u4e3a\u4f8b\uff0c\u5305\u542b\u4e0e\u6bcf\u4e2a\u53c2\u6570\u5f62\u72b6\u76f8\u540c\u7684\u4e00\u9636\u52a8\u91cf\u5f20\u91cf\\(m\\)\u548c\u4e8c\u9636\u52a8\u91cf\u5f20\u91cf\\(v\\)\uff0c\u901a\u5e38\u4e3aFP32\u683c\u5f0f\u3002\u6b64\u5916\u82e5\u53c2\u6570\u672c\u8eab\u662fFP16\uff0c\u8fd8\u4f1a\u6709\u5bf9\u5e94\u7684 FP32 \u4e3b\u6743\u91cd\u526f\u672c\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u5757GPU\u5b58\u50a8\u7684\u4f18\u5316\u76f8\u5173\u6570\u636e\u8fdc\u8d85\u51fa\u6a21\u578b\u53c2\u6570\u672c\u8eab\u7684\u5927\u5c0f\u3002\u4f8b\u5982\uff0c\u82e5\u6a21\u578b\u53c2\u6570\u752816\u4f4d\u8868\u793a\uff0c\u800c\u4f18\u5316\u5668\u72b6\u6001\u752832\u4f4d\u8868\u793a\uff0c\u5219\u5355\u53c2\u6570\u5728\u6bcfGPU\u4e0a\u7684\u603b\u5b58\u50a8\u91cf\u7ea6\u4e3a\u53c2\u6570\u76843-4\u500d\uff08\u53c2\u6570FP16\u53602\u5b57\u8282\uff0c\u989d\u5916\u7684FP32\u526f\u672c+ m + v \u5171\u7ea612\u5b57\u8282\uff0c\u5408\u8ba1\u224814\u5b57\u8282\uff0c\u662fFP16\u53c2\u6570\u5927\u5c0f\u76847\u500d\uff1b\u82e5\u6298\u7b97\u6210\u76f8\u5bf9\u4e8eFP32\u53c2\u6570\u7684\u500d\u6570\u5219\u7ea63.5\u500d\uff09\u3002\u5373\u4f7f\u5728\u5168FP32\u8bad\u7ec3\u4e0b\uff0cAdam\u7684\\(m\\)\u548c\\(v\\)\u4e5f\u4f7f\u6bcf\u53c2\u6570\u5b58\u50a8\u81a8\u80c0\u81f33\u500d\u5927\u5c0f\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0c\u8fd9\u4e9b\u5185\u5b58\u6d88\u8017\u5728\u6240\u6709 GPU \u95f4\u662f\u5b8c\u5168\u5197\u4f59\u91cd\u590d\u7684\uff1a\u6570\u636e\u5e76\u884c\u4e0b\u6bcf\u5757\u5361\u90fd\u4fdd\u5b58\u4e86\u4e00\u4efd\u5b8c\u6574\u4e14\u51e0\u4e4e\u76f8\u540c\u7684\u4f18\u5316\u5668\u72b6\u6001\u62f7\u8d1d\u3002\u5404GPU\u7684\\(m\\)\u3001\\(v\\)\u5728\u6570\u503c\u4e0a\u968f\u8bad\u7ec3\u8fed\u4ee3\u6f14\u8fdb\u4fdd\u6301\u4e00\u81f4\uff08\u56e0\u4e3a\u5b83\u4eec\u7ecf\u5386\u4e86\u76f8\u540c\u7684\u66f4\u65b0\uff09\uff0c\u6ca1\u6709\u63d0\u4f9b\u989d\u5916\u7684\u4fe1\u606f\u91cf\u3002</p> <p>\u8fd9\u79cd\u5197\u4f59\u5e26\u6765\u4e86\u663e\u8457\u7684\u5185\u5b58\u5f00\u9500\u3002\u4f8b\u5982\uff0cMicrosoft\u7ed9\u51fa\u7684\u6848\u4f8b\u4e2d\uff0c\u4e00\u4e2a\u6a21\u578b\u4f7f\u7528Adam\u4f18\u5316\u65f6\uff0c\u5176\u4f18\u5316\u5668\u72b6\u6001\u603b\u8ba1\u5360\u7528\u7ea618GB\u663e\u5b58\uff1b\u5728\u5355\u673a8\u5361\u6570\u636e\u5e76\u884c\u8bad\u7ec3\u65f6\u6bcf\u5f20\u5361\u90fd\u9700\u898118GB\u6765\u5b58\u50a8\u8fd9\u4efd\u72b6\u6001\uff0c\u51e0\u4e4e\u8017\u5c3d\u4e86\u4e00\u575732GB GPU\u7684\u5927\u90e8\u5206\u5185\u5b58\u3002\u8fd9\u4e5f\u662f\u5927\u6a21\u578b\u65e0\u6cd5\u76f4\u63a5\u7528\u4f20\u7edf\u6570\u636e\u5e76\u884c\u653e\u8fdb\u5355\u5361\u7684\u539f\u56e0\u4e4b\u4e00\u3002\u7136\u800c\uff0c\u8fd918GB\u5176\u5b9e\u662f\u57288\u5f20\u5361\u4e0a\u91cd\u590d\u4e868\u6b21\u3002\u5982\u679c\u80fd\u5c06\u5176\u5408\u7406\u62c6\u5206\u52308\u5361\u4e0a\uff0c\u90a3\u4e48\u6bcf\u5361\u53ea\u9700\u5b58\u50a8\u7ea62.25GB\uff0c\u5c31\u80fd\u591f\u5927\u5e45\u964d\u4f4e\u5355\u5361\u5185\u5b58\u5360\u7528\u3002</p> <p>\u53c2\u6570\u66f4\u65b0\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e2aGPU\u4f9d\u636e\u540c\u6b65\u540e\u7684\u68af\u5ea6\u72ec\u7acb\u8ba1\u7b97\u53c2\u6570\u7684\u65b0\u503c\uff0c\u5e76\u76f8\u5e94\u66f4\u65b0\u672c\u5730\u7684\u4f18\u5316\u5668\u72b6\u6001 (\u4f8b\u5982\u66f4\u65b0 Adam \u7684\\(m\\)\u548c\\(v\\)\u77e2\u91cf)\u3002\u7531\u4e8e\u5404GPU\u68af\u5ea6\u76f8\u540c\uff0c\u66f4\u65b0\u516c\u5f0f\u4e5f\u4e00\u81f4\uff0c\u6545\u6b64\u6b65\u9aa4\u540e\u5404GPU\u7684\u6a21\u578b\u53c2\u6570\u4ecd\u7136\u5b8c\u5168\u76f8\u540c\u3002\u7136\u800c\u4ee3\u4ef7\u662f\uff1a\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e00\u540c\u6b65\u66f4\u65b0\uff0c\u6240\u6709GPU\u90fd\u5404\u81ea\u7ef4\u62a4\u4e86\u6574\u5957\u5b8c\u6574\u7684\u53c2\u6570\u548c\u4f18\u5316\u5668\u72b6\u6001\u3002\u8fd9\u79cd\u6570\u636e\u5e76\u884c\u7684\u539f\u59cb\u7b56\u7565\u867d\u7136\u5728\u8ba1\u7b97\u4e0a\u7b80\u5355\u76f4\u63a5\uff0c\u4f46\u975e\u5e38\u4e0d\u5229\u4e8e\u5927\u6a21\u578b\u7684\u5185\u5b58\u89c4\u6a21\u6269\u5c55\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/%E6%A0%87%E5%87%86%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A1%8C%EF%BC%88DP%EF%BC%89%E8%AE%AD%E7%BB%83%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/#5-zero","title":"5. \u5197\u4f59\u5b58\u50a8\u4e0e\u901a\u4fe1\u74f6\u9888\u5206\u6790 (ZeRO \u4f18\u5316\u52a8\u673a)","text":"<p>\u5982\u4e0a\u6240\u8ff0\uff0c\u539f\u59cb\u6570\u636e\u5e76\u884c\u5b58\u5728\u4e24\u4e2a\u4e3b\u8981\u5f00\u9500\u74f6\u9888\uff1a</p> <ul> <li>\u5b58\u50a8\u5197\u4f59\uff1a \u6bcf\u5f20 GPU \u5b58\u50a8\u4e86\u6a21\u578b\u7684\u5168\u90e8\u53c2\u6570\u3001\u526f\u672c\u68af\u5ea6\u4ee5\u53ca\u5b8c\u6574\u4f18\u5316\u5668\u72b6\u6001\uff08\u4e09\u8005\u7edf\u79f0\u4e3a\u6a21\u578b\u72b6\u6001Optimizer+Parameter+Gradient\uff0c\u5373OPG\uff09\u3002\u5bf9\u4e8e\\(N\\)\u5f20\u663e\u5361\u7684\u6570\u636e\u5e76\u884c\uff0c\u6a21\u578b\u72b6\u6001\u7684\u5185\u5b58\u5f00\u9500\u88ab\u91cd\u590d\u4e86\\(N\\)\u500d\u3002\u5f53\u6a21\u578b\u53c2\u6570\u89c4\u6a21\u5de8\u5927\u65f6\uff0c\u8fd9\u79cd\u7ebf\u6027\u653e\u5927\u5bfc\u81f4\u5355\u5361\u5185\u5b58\u5f88\u5feb\u8017\u5c3d\uff0c\u6210\u4e3a\u8bad\u7ec3\u66f4\u5927\u6a21\u578b\u7684\u969c\u788d\u3002\u4e0a\u8282\u7684\u5206\u6790\u8868\u660e\uff0c\u5f88\u591a\u5185\u5b58\u5b9e\u9645\u4e0a\u88ab\u6d6a\u8d39\u5728\u8de8GPU\u91cd\u590d\u5b58\u50a8\u76f8\u540c\u7684\u4fe1\u606f\u4e0a\u3002</li> <li>\u901a\u4fe1\u5f00\u9500\uff1a \u6bcf\u6b21\u53cd\u5411\u4f20\u64ad\u90fd\u9700\u8981\u5bf9\u6240\u6709\u53c2\u6570\u7684\u68af\u5ea6\u6267\u884c All-Reduce \u540c\u6b65\u3002\u5c3d\u7ba1\u501f\u52a9Ring-AllReduce\u7b97\u6cd5\u80fd\u591f\u8f83\u597d\u5730\u5229\u7528\u5e26\u5bbd\u8d44\u6e90\uff0c\u4f46\u5bf9\u4e8e\u6570\u5341\u4ebf\u4e0a\u767e\u4ebf\u53c2\u6570\u6a21\u578b\uff0c\u68af\u5ea6\u901a\u4fe1\u603b\u91cf\u4f9d\u7136\u53ef\u89c2\u3002All-Reduce\u901a\u4fe1\u672c\u8eab\u4e0d\u4f1a\u6539\u53d8\u603b\u7684\u6570\u636e\u4f20\u8f93\u91cf\uff08\u9700\u8981\u4f20\u8f93\u6240\u6709\u68af\u5ea6\u6570\u636e\uff09\uff0c\u5e76\u4e14\u5fc5\u987b\u5728\u6bcf\u6b21\u8fed\u4ee3\u90fd\u6267\u884c\u3002\u8fd9\u5728\u591a\u673a\u5206\u5e03\u5f0f\u73af\u5883\u4e0b\u5c24\u5176\u53ef\u80fd\u53d7\u7f51\u7edc\u5e26\u5bbd\u9650\u5236\u800c\u5f62\u6210\u65b0\u7684\u74f6\u9888\u3002</li> </ul> <p></p> <p>\u56fe\uff1aZeRO \u63d0\u51fa\u7684\u5206\u7247\u65b9\u6848\u663e\u8457\u51cf\u5c11\u4e86\u5355\u5361\u5185\u5b58\u5360\u7528\u3002\u5de6\u8d77\u7b2c\u4e00\u680f\u4e3a\u4f20\u7edf\u6570\u636e\u5e76\u884c\uff08Baseline DP\uff09\u7684\u5185\u5b58\u5206\u5e03\uff1a\u6bcf\u5f20 GPU \u4fdd\u5b58\u5b8c\u6574\u7684\u53c2\u6570\u3001\u68af\u5ea6\u548c\u4f18\u5316\u5668\u72b6\u6001\uff08OPG\uff09\u3002\u540e\u7eed\u5404\u680f\u5c55\u793a ZeRO-1/2/3 \u5206\u9636\u6bb5\u9010\u6b65\u5bf9 OPG \u8fdb\u884c\u5206\u533a\u540e\u7684\u5185\u5b58\u53d8\u5316\uff0c\u663e\u5b58\u5360\u7528\u968f\u9636\u6bb5\u63a8\u8fdb\u5927\u5e45\u4e0b\u964d\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0cMicrosoft \u63d0\u51fa\u4e86\u96f6\u5197\u4f59\u4f18\u5316\u5668 (Zero Redundancy Optimizer, ZeRO)\u3002ZeRO \u7684\u6838\u5fc3\u601d\u60f3\u662f\u5229\u7528\u6570\u636e\u5e76\u884c\u96c6\u7fa4\u7684\u603b\u5185\u5b58\uff0c\u628a\u539f\u672c\u5728\u6bcf\u5361\u5b8c\u6574\u5b58\u50a8\u7684\u6a21\u578b\u72b6\u6001\u62c6\u5206\uff08Shard/Partition\uff09\u5230\u5404\u4e2aGPU\u4e0a\uff0c\u4ece\u800c\u6d88\u9664\u91cd\u590d\u5b58\u50a8\u3002\u5177\u4f53\u800c\u8a00\uff0cZeRO\u5c06\u4f18\u5316\u62c6\u5206\u5206\u4e3a\u4e09\u4e2a\u9010\u6b65\u589e\u5f3a\u7684\u9636\u6bb5\uff0c\u5bf9\u5e94\u524d\u8ff0 OPG \u7684\u4e09\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>ZeRO-1\uff1a\u4f18\u5316\u5668\u72b6\u6001\u5206\u533a\uff08\\(P_{os}\\)\uff09 \u2013 \u5c06\u5982 Adam \u7684\\(m\\)\u3001\\(v\\)\u7b49\u72b6\u6001\u53d8\u91cf\u5728\u8fdb\u7a0b\u95f4\u5e73\u5747\u5206\u5272\uff0c\u6bcf\u5f20\u5361\u4ec5\u4fdd\u7559\u5176\u4e2d\u4e00\u90e8\u5206\u3002\u6b64\u4e3e\u7406\u8bba\u4e0a\u5c06 \u5185\u5b58\u5360\u7528\u964d\u4f4e\u7ea6 N \u500d\uff08\u4f8b\u59828\u5361\u96c6\u7fa4\u51cf\u5c11\u81f3\u539f\u6765\u76841/8\uff09\uff0c\u4f46 \u901a\u4fe1\u91cf\u4e0d\u589e\u52a0\uff08\u56e0\u4e3a\u4ecd\u9700\u5168\u68af\u5ea6 All-Reduce\uff09\u3002\u5b9e\u9645\u6548\u679c\u7ea64\u500d\u5185\u5b58\u7f29\u51cf\uff0c\u56e0\u4e3a\u5bf9\u4e8eAdam\u4f18\u5316\u5668\u72b6\u6001\u901a\u5e38\u5360\u4e3b\u5bfc\u3002</li> <li>ZeRO-2\uff1a\u4f18\u5316\u5668\u72b6\u6001 + \u68af\u5ea6\u5206\u533a\uff08\\(P_{os+g}\\)\uff09 \u2013 \u5728ZeRO-1\u57fa\u7840\u4e0a\uff0c\u8fdb\u4e00\u6b65\u5c06\u53cd\u5411\u5f97\u5230\u7684\u68af\u5ea6\u4e5f\u6309\u53c2\u6570\u5207\u5206\u5f52\u5404GPU\u6301\u6709\u4e00\u90e8\u5206\uff08\u901a\u8fc7\u5c06 All-Reduce \u6362\u4e3a\u66f4\u7cbe\u7ec6\u7684 Reduce-Scatter + All-Gather \u5b9e\u73b0\uff09\u3002\u8fd9\u6837\u6bcf\u5f20\u5361\u53ea\u9700\u4fdd\u5b58\u5c40\u90e8\u68af\u5ea6\u5757\u800c\u975e\u5168\u91cf\u68af\u5ea6\uff0c\u518d\u6b21\u5c06\u5185\u5b58\u9700\u6c42\u51cf\u534a\uff08\u603b\u4f53\u76f8\u6bd4\u539f\u59cb\u7ea68\u500d\u51cf\u5c11)\uff0c\u901a\u4fe1\u91cf\u4ecd\u4e0e\u5168\u91cfAll-Reduce\u76f8\u5f53\u3002</li> <li>ZeRO-3\uff1a\u4f18\u5316\u5668\u72b6\u6001 + \u68af\u5ea6 + \u53c2\u6570\u5206\u533a\uff08\\(P_{os+g+p}\\)\uff09 \u2013 \u8fde\u6a21\u578b\u53c2\u6570\u672c\u8eab\u4e5f\u4e0d\u518d\u6bcf\u5361\u5b8c\u6574\u4fdd\u5b58\uff0c\u800c\u662f\u52a8\u6001\u6309\u9700\u5728\u5404GPU\u95f4\u5212\u5206\u548cGather/Scatter\u3002\u8fd9\u4f7f\u5f97\u6a21\u578b\u7684\u4e09\u7c7b\u72b6\u6001\u5747\u5b9e\u73b0\u6309N\u7b49\u5206\u5b58\u50a8\uff0c\u5355\u5361\u5185\u5b58\u5360\u7528\u7ea6\u4e3a\u539f\u6765\u7684 1/N\uff08\u7406\u60f3\u60c5\u51b5\u4e0bN\u500d\u51cf\u5c11)\uff0c\u7a81\u7834\u4e86\u5355\u5361\u5185\u5b58\u9650\u5236\u3002\u7531\u4e8e\u9700\u8981\u5728\u524d\u5411\u548c\u53cd\u5411\u8ba1\u7b97\u4e2d\u53ca\u65f6\u6536\u96c6/\u62c6\u5206\u53c2\u6570\uff0cZeRO-3 \u4f1a\u5f15\u5165\u4e00\u5b9a\u7684\u989d\u5916\u901a\u4fe1\u5f00\u9500\uff08\u4e00\u822c\u7ea6\u589e\u52a050%\uff09\u3002</li> </ul> <p>\u901a\u8fc7\u4e0a\u8ff0\u5206\u533a\u7b56\u7565\uff0cZeRO \u5c06\u539f\u59cb\u6570\u636e\u5e76\u884c\u8bad\u7ec3\u7684\u5185\u5b58\u5197\u4f59\u51e0\u4e4e\u5b8c\u5168\u6d88\u9664\uff0c\u4f7f\u603b\u7684GPU\u96c6\u7fa4\u663e\u5b58\u5f97\u4ee5\u5145\u5206\u5229\u7528\u3002\u4f8b\u5982\uff0c\u5373\u4fbf\u8bad\u7ec3\u4e00\u4e07\u4ebf\u53c2\u6570\u89c4\u6a21\u7684\u6a21\u578b\uff0c\u53ea\u8981\u603bGPU\u663e\u5b58\u8db3\u591f\u5927\uff0cZeRO \u7406\u8bba\u4e0a\u90fd\u80fd\u5c06\u6a21\u578b\u62c6\u5206\u5b58\u50a8\u5e76\u987a\u5229\u8bad\u7ec3\u3002\u540c\u65f6\uff0c\u5728ZeRO-1\u548cZeRO-2\u9636\u6bb5\uff0c\u901a\u4fe1\u91cf\u4e0e\u4f20\u7edfDP\u76f8\u540c\uff1b\u5230ZeRO-3\u9636\u6bb5\uff0c\u901a\u4fe1\u91cf\u76f8\u5bf9\u7565\u6709\u589e\u52a0\u4f46\u53ef\u63a5\u53d7\uff0c\u4ece\u800c\u4fdd\u6301\u4e86\u4e0e\u6570\u636e\u5e76\u884c\u63a5\u8fd1\u7684\u901a\u4fe1\u6548\u7387\u3002\u6362\u8a00\u4e4b\uff0cZeRO\u65b9\u6848\u5728\u5927\u5e45\u964d\u4f4e\u5355\u5361\u5185\u5b58\u9700\u6c42\u7684\u540c\u65f6\uff0c\u4ecd\u4fdd\u7559\u4e86\u6570\u636e\u5e76\u884c\u7684\u8ba1\u7b97\u548c\u901a\u4fe1\u5e76\u884c\u5ea6\u4f18\u52bf\u3002</p> <p>\u603b\u7ed3: \u6807\u51c6\u6570\u636e\u5e76\u884c\u7b56\u7565\u4e0b\uff0c\u53c2\u6570\u3001\u526f\u672c\u68af\u5ea6\u548c\u4f18\u5316\u5668\u72b6\u6001\u7684\u91cd\u590d\u5b58\u50a8\u4ee5\u53ca\u5168\u91cf\u68af\u5ea6\u901a\u4fe1\u662f\u4e3b\u8981\u74f6\u9888\u3002\u8fd9\u5bfc\u81f4\u5355\u5361\u5185\u5b58\u6d6a\u8d39\u548c\u6269\u5c55\u6027\u53d7\u9650\u3002\u901a\u8fc7\u6df1\u5165\u7406\u89e3\u8fd9\u4e9b\u5f20\u91cf\u5728DP\u4e2d\u7684\u751f\u547d\u5468\u671f\u548c\u5f00\u9500\uff0c\u6211\u4eec\u5f88\u81ea\u7136\u5730\u770b\u5230\u4f18\u5316\u7a7a\u95f4\u2014\u2014\u8fd9\u6b63\u662f ZeRO \u51fa\u73b0\u7684\u80cc\u666f\u3002ZeRO \u9488\u5bf9\u6027\u5730\u6d88\u9664\u4e86\u5404GPU\u95f4\u7684\u5197\u4f59\u6570\u636e\u5b58\u50a8\uff0c\u5e76\u4f18\u5316\u4e86\u901a\u4fe1\u65b9\u5f0f\uff0c\u4f7f\u5f97\u6211\u4eec\u80fd\u591f\u8bad\u7ec3\u8fdc\u8d85\u5355GPU\u663e\u5b58\u5bb9\u91cf\u7684\u8d85\u5927\u6a21\u578b\uff0c\u540c\u65f6\u5c06\u901a\u4fe1\u5f00\u9500\u63a7\u5236\u5728\u5408\u7406\u8303\u56f4\u5185\u3002\u8fd9\u6837\uff0c\u6570\u636e\u5e76\u884c\u8bad\u7ec3\u5728\u5b58\u50a8\u4e0e\u901a\u4fe1\u6548\u7387\u4e0a\u90fd\u5f97\u5230\u5927\u5e45\u6539\u8fdb\uff0c\u4e3a\u5927\u89c4\u6a21\u6a21\u578b\u8bad\u7ec3\u94fa\u5e73\u4e86\u9053\u8def\u3002</p>","tags":["\u5e76\u884c\u8bad\u7ec3","LLM"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/","title":"\u878d\u6c47\u8d2f\u901aRL\u4e2d\u7684\u4ef7\u503c\u51fd\u6570\u4e0e\u4f18\u52bf\u51fd\u6570","text":"\u6807\u7b7e\uff1a \u5f3a\u5316\u5b66\u4e60","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#_1","title":"\u5f15\u8a00","text":"<p>\u5f3a\u5316\u5b66\u4e60\uff08Reinforcement Learning\uff09\u7b97\u6cd5\u901a\u5e38\u901a\u8fc7\u5b66\u4e60\u4ef7\u503c\u51fd\u6570\uff08value function\uff09\u6216\u76f4\u63a5\u4f18\u5316\u7b56\u7565\u6765\u5b9e\u73b0\u667a\u80fd\u4f53\u7b56\u7565\u7684\u6539\u8fdb\u3002\u5728\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\uff0c\u8bb8\u591a\u7b97\u6cd5\u90fd\u4f1a\u5229\u7528\u4ef7\u503c\u51fd\u6570\uff08\u5982\u72b6\u6001\u4ef7\u503c\u51fd\u6570\\(V(s)\\)\u6216\u52a8\u4f5c\u4ef7\u503c\u51fd\u6570\\(Q(s,a)\\)\uff09\u4ee5\u53ca\u4f18\u52bf\u51fd\u6570\uff08advantage function\uff09\u6765\u8bc4\u4f30\u7b56\u7565\u548c\u6307\u5bfc\u66f4\u65b0\u3002\u4ef7\u503c\u51fd\u6570\u8868\u793a\u5728\u7ed9\u5b9a\u72b6\u6001\u6216\u72b6\u6001-\u52a8\u4f5c\u5bf9\u4e0b\u80fd\u83b7\u5f97\u7684\u9884\u671f\u56de\u62a5\uff0c\u800c\u4f18\u52bf\u51fd\u6570\u5219\u8868\u793a\u67d0\u52a8\u4f5c\u76f8\u5bf9\u4e8e\u5e73\u5747\u6c34\u5e73\uff08\u57fa\u7ebf\uff09\u7684\u76f8\u5bf9\u597d\u5904\u3002\u4e0d\u540c\u7b97\u6cd5\u5bf9\u4ef7\u503c\u51fd\u6570\u548c\u4f18\u52bf\u51fd\u6570\u7684\u5b9a\u4e49\u4e0e\u4f7f\u7528\u65b9\u5f0f\u5404\u5f02\uff0c\u5f71\u54cd\u4e86\u7b97\u6cd5\u7684\u8bad\u7ec3\u76ee\u6807\u3001\u7b56\u7565\u66f4\u65b0\u65b9\u6cd5\u4ee5\u53ca\u9002\u7528\u573a\u666f\u3002</p> <p>\u672c\u6587\u5c06\u6a2a\u5411\u6bd4\u8f83\u5f3a\u5316\u5b66\u4e60\u4e2d\u4e3b\u6d41\u7b97\u6cd5\u5728\u7b56\u7565\u5b66\u4e60\u4e2d\u5bf9\u4ef7\u503c\u51fd\u6570\u548c\u4f18\u52bf\u51fd\u6570\u7684\u4f7f\u7528\u65b9\u5f0f\u4e0e\u5b9e\u73b0\u65b9\u6cd5\u3002\u6211\u4eec\u5c06\u8ba8\u8bba\u6bcf\u79cd\u7b97\u6cd5\u6240\u7528\u4ef7\u503c/\u4f18\u52bf\u51fd\u6570\u7684\u6570\u5b66\u5b9a\u4e49\u3001\u8fd9\u4e9b\u51fd\u6570\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u7684\u4f5c\u7528\uff0c\u4f18\u52bf\u51fd\u6570\u7684\u4f30\u8ba1\u65b9\u6cd5\uff08\u5982\u8499\u7279\u5361\u6d1b\u3001\u65f6\u5e8f\u5dee\u5206TD\u3001\u5e7f\u4e49\u4f18\u52bf\u4f30\u8ba1GAE\u7b49\uff09\u53ca\u5176\u53d8\u79cd\uff0c\u5e76\u5bf9\u6bd4\u503c\u51fd\u6570\u65b9\u6cd5\u4e0e\u4f18\u52bf\u65b9\u6cd5\uff08\u57fa\u4e8e\u4f18\u52bf\u7684\u7b56\u7565\u68af\u5ea6\u65b9\u6cd5\uff09\u7684\u5dee\u5f02\u4e0e\u9002\u7528\u6027\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#_2","title":"\u4ef7\u503c\u51fd\u6570\u4e0e\u4f18\u52bf\u51fd\u6570\uff1a\u5b9a\u4e49\u4e0e\u4f5c\u7528","text":"<p>\u5728\u9610\u8ff0\u5177\u4f53\u7b97\u6cd5\u524d\uff0c\u6211\u4eec\u5148\u660e\u786e\u4ef7\u503c\u51fd\u6570\u548c\u4f18\u52bf\u51fd\u6570\u7684\u5b9a\u4e49\uff1a</p> <ul> <li>\u72b6\u6001\u4ef7\u503c\u51fd\u6570\\(V^\\pi(s)\\)\uff1a\u5728\u7b56\u7565\\(\\pi\\)\u4e0b\uff0c\u4ece\u72b6\u6001\\(s\\)\u51fa\u53d1\u80fd\u83b7\u5f97\u7684\u671f\u671b\u7d2f\u8ba1\u56de\u62a5\uff08\u201c\u4ef7\u503c\u201d\uff09\uff0c\u516c\u5f0f\u4e3a\uff1a</li> </ul> \\[V^\\pi(s) = \\mathbb{E}_\\pi\\left[\\sum_{t=0}^{\\infty} \\gamma^t\\, r_{t}\\,\\Big|\\, s_0 = s\\right]\uff0c\\] <p>\u5176\u4e2d\\(\\gamma\\in[0,1]\\)\u4e3a\u6298\u6263\u56e0\u5b50\u3002\\(V(s)\\)\u8861\u91cf\u201c\u5904\u5728\u72b6\u6001\\(s\\)\u672c\u8eab\u6709\u591a\u597d\u201d\u3002</p> <ul> <li>\u52a8\u4f5c\u4ef7\u503c\u51fd\u6570\\(Q^\\pi(s,a)\\)\uff1a\u5728\u7b56\u7565\\(\\pi\\)\u4e0b\uff0c\u667a\u80fd\u4f53\u5728\u72b6\u6001\\(s\\)\u91c7\u53d6\u52a8\u4f5c\\(a\\)\u540e\u6240\u80fd\u83b7\u5f97\u7684\u671f\u671b\u7d2f\u8ba1\u56de\u62a5\uff0c\u5373Q\u51fd\u6570\uff0c\u5b9a\u4e49\u4e3a\uff1a</li> </ul> \\[Q^\\pi(s,a) = \\mathbb{E}_\\pi\\left[\\sum_{t=0}^{\\infty} \\gamma^t\\, r_{t}\\,\\Big|\\, s_0 = s, a_0 = a\\right]\u3002\\] <p>\\(Q(s,a)\\)\u8bc4\u4ef7\u201c\u5728\u72b6\u6001\\(s\\)\u4e0b\u6267\u884c\u52a8\u4f5c\\(a\\)\u7684\u597d\u574f\u201d\uff0c\u662f\u52a8\u4f5c-\u72b6\u6001\u5bf9\u7684\u4ef7\u503c\u3002</p> <ul> <li>\u4f18\u52bf\u51fd\u6570\\(A^\\pi(s,a)\\)\uff1a\u8868\u793a\u52a8\u4f5c\\(a\\)\u76f8\u5bf9\u4e8e\u72b6\u6001\\(s\\)\u7684\u5e73\u5747\u6c34\u5e73\u6709\u591a\u4f18\u8d8a\uff0c\u5b9a\u4e49\u4e3a\u4ef7\u503c\u5dee\uff1a</li> </ul> \\[A^\\pi(s,a) = Q^\\pi(s,a) - V^\\pi(s)\\] <p>\u5b83\u53cd\u6620\u5728\u72b6\u6001\\(s\\)\u4e0b\u9009\u62e9\u7279\u5b9a\u52a8\u4f5c\\(a\\)\u76f8\u6bd4\u5e73\u5747\u7b56\u7565\uff08\u57fa\u4e8e\u72b6\u6001\u4ef7\u503c\\(V\\)\uff09\u989d\u5916\u80fd\u83b7\u5f97\u591a\u5c11\u6536\u76ca\u3002\u4f18\u52bf\u51fd\u6570\u4e3a\u7b56\u7565\u68af\u5ea6\u65b9\u6cd5\u63d0\u4f9b\u4e86\u76f8\u5bf9\u8bc4\u4ef7\uff0c\u51cf\u5c0f\u4e86\u9ad8\u65b9\u5dee\u7684\u7edd\u5bf9\u56de\u62a5\u8bc4\u4f30\u3002</p> <p>\u5728\u7b56\u7565\u4f18\u5316\u4e2d\uff0c\u5f15\u5165\u57fa\u7ebf\\(b(s)\\)\uff08\u901a\u5e38\u53d6\u4e3a\\(V(s)\\)\uff09\u5e76\u4f7f\u7528\u4f18\u52bf\\(A(s,a)=Q(s,a)-b(s)\\)\uff0c\u4e0d\u4f1a\u6539\u53d8\u68af\u5ea6\u7684\u65e0\u504f\u6027\uff0c\u5374\u80fd\u964d\u4f4e\u65b9\u5dee\u3002\u56e0\u6b64\uff0c\u5f88\u591a\u7b56\u7565\u68af\u5ea6\u7b97\u6cd5\u5229\u7528\u4ef7\u503c\u51fd\u6570\u4f5c\u4e3a\u57fa\u7ebf\uff0c\u4f7f\u7528\u4f18\u52bf\u51fd\u6570\u8fdb\u884c\u7b56\u7565\u66f4\u65b0\uff0c\u4ee5\u63d0\u9ad8\u5b66\u4e60\u7a33\u5b9a\u6027\u3002\u5728\u503c\u51fd\u6570\u65b9\u6cd5\u4e2d\uff0c\u4ef7\u503c\u51fd\u6570\u672c\u8eab\u5219\u76f4\u63a5\u7528\u4e8e\u8bc4\u4f30\u548c\u51b3\u7b56\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u6309\u7b97\u6cd5\u7c7b\u522b\u8be6\u7ec6\u6bd4\u8f83\u5404\u7b97\u6cd5\u5728\u4ef7\u503c\u51fd\u6570\u4e0e\u4f18\u52bf\u51fd\u6570\u4e0a\u7684\u4f7f\u7528\u5dee\u5f02\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#dqn","title":"\u503c\u51fd\u6570\u65b9\u6cd5\uff1aDQN \u53ca\u5176\u6269\u5c55","text":"<p>\u6df1\u5ea6 Q \u7f51\u7edc\uff08DQN\uff09\u662f\u5178\u578b\u7684\u503c\u51fd\u6570\u65b9\u6cd5\u4ee3\u8868\u3002DQN \u76f4\u63a5\u8fd1\u4f3c\u6700\u4f18\u52a8\u4f5c\u4ef7\u503c\u51fd\u6570\\(Q(s,a)\\)\uff0c\u901a\u8fc7\u8d1d\u5c14\u66fc\u65b9\u7a0b\u8fdb\u884c\u8bad\u7ec3\u3002\u5176\u635f\u5931\u51fd\u6570\u57fa\u4e8e\u65f6\u5e8f\u5dee\u5206\uff08TD\uff09\u8bef\u5dee\u6784\u9020\uff0c\u5982\uff1a</p> <ul> <li>DQN \u66f4\u65b0\uff1a\u4f7f\u7528\u5f53\u524d Q \u7f51\u7edc\u53c2\u6570\\(\\theta\\)\u548c\u76ee\u6807\u7f51\u7edc\u53c2\u6570\\(\\theta'\\)\uff0c\u5bf9\u4e8e\u7ecf\u9a8c\\((s,a,r,s')\\)\uff0c\u6784\u9020\u76ee\u6807\\(y = r + \\gamma \\max_{a'}Q_{\\theta'}(s',a')\\)\uff0c\u6700\u5c0f\u5316\u5747\u65b9\u8bef\u5dee\u635f\u5931:</li> </ul> \\[L(\\theta) = \\Big(Q_\\theta(s,a) - y\\Big)^2,\\] <p>\u5176\u4e2d\\(y\\)\u4e3a\u4f9d\u636e\u76ee\u6807\u7f51\u7edc\u8ba1\u7b97\u7684TD\u76ee\u6807\u3002\u8fd9\u4e00\u66f4\u65b0\u7b49\u4ef7\u4e8e\u6267\u884cQ\u5b66\u4e60\u7684\u8fed\u4ee3\u66f4\u65b0</p> \\[Q_{\\text{new}}(s,a) \\leftarrow (1-\\alpha) Q(s,a) + \\alpha \\big(r + \\gamma \\max_{a'} Q(s',a')\\big)\u3002\\] <p>DQN \u6ca1\u6709\u663e\u5f0f\u7684\u7b56\u7565\u53c2\u6570\uff0c\u800c\u662f\u901a\u8fc7\u66f4\u65b0 Q \u51fd\u6570\u6765\u95f4\u63a5\u6539\u8fdb\u7b56\u7565\uff1a\u7b56\u7565\u7531\\(Q\\)\u503c\u884d\u751f\uff08\u5982\u8d2a\u5fc3\u9009\u62e9\\(\\pi(s)=\\arg\\max_a Q(s,a)\\)\u6216\\(\\epsilon\\)-\u8d2a\u5fc3\u63a2\u7d22)\u3002\u5728 DQN \u4e2d\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528\u4f18\u52bf\u51fd\u6570\u53c2\u4e0e\u635f\u5931\u8ba1\u7b97\u6216\u7b56\u7565\u68af\u5ea6\uff0c\u56e0\u4e3a\u5176\u4f18\u5316\u76ee\u6807\u5b8c\u5168\u57fa\u4e8e\u4ef7\u503c\u51fd\u6570\u3002Dueling DQN\u5f15\u5165\u4e86\u4f18\u52bf\u51fd\u6570\u7684\u601d\u60f3\uff0c\u5c06 Q \u503c\u7f51\u7edc\u62c6\u5206\u4e3a\u72b6\u6001\u4ef7\u503c\\(V(s)\\)\u548c\u4f18\u52bf\\(A(s,a)\\)\u4e24\u90e8\u5206\u3002Dueling DQN\u7684\u8f93\u51fa\u7ed3\u6784\u5047\u5b9a\\(Q(s,a)=V(s)+A(s,a)\\)\uff08\u5b9e\u9645\u5b9e\u73b0\u4e2d\u51cf\u53bb\u4f18\u52bf\u7684\u5747\u503c\u505a\u5f52\u4e00\u5316\uff0c\u4ee5\u4fdd\u8bc1\u53ef\u8fa8\u8bc6\u6027\uff09\u3002\u8fd9\u79cd\u5206\u89e3\u4f7f\u7f51\u7edc\u80fd\u591f\u9996\u5148\u4f30\u8ba1\u72b6\u6001\u7684\u201c\u597d\u574f\u201d\uff0c\u518d\u4f30\u8ba1\u5404\u52a8\u4f5c\u76f8\u5bf9\u4e8e\u8be5\u72b6\u6001\u7684\u76f8\u5bf9\u4f18\u52bf\uff0c\u6709\u52a9\u4e8e\u63d0\u9ad8\u503c\u4f30\u8ba1\u7684\u6548\u7387\u3002\u4e0d\u8fc7\uff0c\u5373\u4f7f\u5728Dueling DQN\u4e2d\uff0c\u201c\u4f18\u52bf\u51fd\u6570\u201d\u53ea\u662f\u7f51\u7edc\u7684\u4e00\u90e8\u5206\uff0c\u5176\u8bad\u7ec3\u4ecd\u901a\u8fc7Q\u503c\u7684TD\u8bef\u5dee\u6765\u8fdb\u884c\uff0c\u53ea\u662f\u5728\u67b6\u6784\u4e0a\u4f53\u73b0\u4e3a\u4ef7\u503c\u4e0e\u4f18\u52bf\u4e24\u6761\u652f\u8def\u3002Double DQN \u7b49\u6269\u5c55\u5219\u5173\u6ce8\u4e8e\u503c\u51fd\u6570\u66f4\u65b0\u7684\u6539\u8fdb\uff08\u5982\u4f7f\u7528\u53cc\u7f51\u7edc\u907f\u514dover estimate\uff09\u3002</p> <p>\u603b\u7ed3\uff1aDQN \u53ca\u5176\u6269\u5c55\u5b8c\u5168\u4ee5\u503c\u51fd\u6570\u4e3a\u6838\u5fc3\u3002\u5b83\u5b66\u4e60\\(Q(s,a)\\)\u6765\u6307\u5bfc\u51b3\u7b56\uff0c\u4e0d\u8ba1\u7b97\u663e\u5f0f\u7684\u4f18\u52bf\u7528\u4e8e\u66f4\u65b0\uff08\u9664\u975e\u7b97\u4e0a\u67b6\u6784\u5185\u7684\u4f18\u52bf\u5206\u89e3\uff09\u3002\u5bf9\u4e8e\u79bb\u6563\u52a8\u4f5c\u7a7a\u95f4\u7684\u95ee\u9898\uff08\u5982 Atari \u6e38\u620f\uff09\uff0c\u503c\u51fd\u6570\u65b9\u6cd5\u8868\u73b0\u7a81\u51fa\u3002\u4f46\u662f\u7531\u4e8e\u9700\u8981\u5bf9\u6bcf\u4e2a\u53ef\u80fd\u52a8\u4f5c\u8ba1\u7b97\\(Q\\)\uff0c\u4f20\u7edf DQN \u4e0d\u80fd\u76f4\u63a5\u5e94\u7528\u4e8e\u8fde\u7eed\u52a8\u4f5c\u7a7a\u95f4\uff0c\u540e\u8005\u9700\u8981\u7b56\u7565\u51fd\u6570\u76f4\u63a5\u8f93\u51fa\u8fde\u7eed\u52a8\u4f5c\uff08\u8fd9\u5f15\u51fa\u4e86policy gradient\u548cactor critic\u65b9\u6cd5\uff09\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#reinforce","title":"\u7b56\u7565\u68af\u5ea6\u4e0e REINFORCE\uff1a\u4f18\u52bf\u57fa\u7ebf\u7684\u5f15\u5165","text":"<p>\u7b56\u7565\u68af\u5ea6\u65b9\u6cd5\u76f4\u63a5\u9488\u5bf9\u7b56\u7565\u53c2\u6570\u8fdb\u884c\u4f18\u5316\uff0c\u800c\u4e0d\u662f\u5148\u5b66\u503c\u51fd\u6570\u518d\u95f4\u63a5\u5bfc\u51fa\u7b56\u7565\u3002\u7ecf\u5178\u7684 REINFORCE \u7b97\u6cd5\uff08\u8499\u7279\u5361\u6d1b\u7b56\u7565\u68af\u5ea6\uff09\u901a\u8fc7\u91c7\u6837\u5b8c\u6574\u8f68\u8ff9\uff0c\u6839\u636e\u7d2f\u8ba1\u56de\u62a5\\(R_t=\\sum_{k=0}^{T-t}\\gamma^k r_{t+k}\\)\u6765\u66f4\u65b0\u7b56\u7565\u53c2\u6570\\(\\theta\\)\uff1a</p> <ul> <li>REINFORCE \u68af\u5ea6:</li> </ul> \\[\\nabla_\\theta J(\\theta) = \\mathbb{E}_{\\pi_\\theta}\\!\\Big[\\nabla_\\theta \\log \\pi_\\theta(a_t|s_t)\\,R_t\\Big]\\] <p>\u5176\u4e2d\\(R_t\\)\u5c31\u662f\u52a8\u4f5c$ a_t$\u540e\u5f97\u5230\u7684\u6298\u6263\u56de\u62a5\u3002</p> <p>\u7531\u4e8e\u76f4\u63a5\u4f7f\u7528\\(R_t\\)\u4f5c\u4e3a\u6743\u91cd\u4f1a\u5bfc\u81f4\u9ad8\u65b9\u5dee\uff0c\u53ef\u5f15\u5165\u57fa\u7ebf\\(b(s)\\)\uff08\u4e0d\u4f9d\u8d56\u4e8e\u52a8\u4f5c\uff09\u4ee5\u964d\u4f4e\u65b9\u5dee\u3002\u901a\u5e38\u9009\u62e9\\(V(s)\\)\u4f5c\u4e3a\u57fa\u7ebf\uff0c\u6b64\u65f6\\(R_t - V(s_t)\\)\u5373\u4e3a\u4f18\u52bf\u4f30\u8ba1\\(A(s_t,a_t)\\)\u3002\u5f15\u5165\u57fa\u7ebf\u540e\u7684\u68af\u5ea6\u4e3a\uff1a</p> \\[\\nabla_\\theta J(\\theta) = \\mathbb{E}[\\nabla_\\theta \\log \\pi_\\theta(a|s)A(s_t,a_t)]=\\mathbb{E}[\\nabla_\\theta \\log \\pi_\\theta(a|s)\\,(R_t - V(s_t))]\\] <p>\u5176\u4e2d\\(A(s_t,a_t)=R_t - V(s_t)\\)\u5373\u4f18\u52bf\u51fd\u6570\u3002\u8fd9\u6837\u7684REINFORCE with baseline\u7b97\u6cd5\u68af\u5ea6\u65e0\u504f\uff0c\u4f46\u51cf\u5c0f\u4e86\u65b9\u5dee\u3002\u5f53\u57fa\u7ebf\u51fd\u6570\u5b8c\u7f8e\u4f30\u8ba1\u4e86\u72b6\u6001\u503c\u65f6\uff0c\u4f18\u52bf\u7684\u671f\u671b\u4e3a0\uff0c\u4ece\u800c\u5254\u9664\u4e86\u548c\u72b6\u6001\u65e0\u5173\u7684\u566a\u58f0\u3002</p> <p>\u9700\u8981\u6ce8\u610f\uff0cREINFORCE\u7b97\u6cd5\u672c\u8eab\u4e0d\u5b66\u4e60\u503c\u51fd\u6570\uff08\u5982\u679c\u4e0d\u4f7f\u7528\u57fa\u7ebf\u5c31\u662f\u7eaf\u7b56\u7565\u65b9\u6cd5\uff09\uff0c\u56e0\u6b64\u4e25\u683c\u6765\u8bf4\u6ca1\u6709\u201c\u4ef7\u503c\u51fd\u6570\u201d\u7684\u53c2\u4e0e\uff1b\u82e5\u4f7f\u7528\u4e86\u57fa\u7ebf\uff0c\u5219\u9700\u8981\u4e00\u4e2a\u4ef7\u503c\u51fd\u6570\u8fd1\u4f3c\u5668\u6765\u63d0\u4f9b\\(V(s)\\)\u3002\u65e0\u8bba\u5982\u4f55\uff0cREINFORCE \u6216\u5176\u4ed6\u7b56\u7565\u68af\u5ea6\u65b9\u6cd5\u672c\u8d28\u4e0a\u5229\u7528\u4f18\u52bf\u51fd\u6570\u4f5c\u4e3a\u68af\u5ea6\u6743\u91cd\uff08\u65e0\u57fa\u7ebf\u65f6\u4f18\u52bf\u5c31\u662f\\(R_t\\)\uff09\u3002\u7531\u4e8e\u5b8c\u5168\u4f9d\u8d56\u91c7\u6837\u56de\u62a5\uff0cREINFORCE\u901a\u5e38\u4f7f\u7528\u8499\u7279\u5361\u6d1b\u65b9\u6cd5\u4f30\u8ba1\u4f18\u52bf/\u56de\u62a5\uff0c\u5373\u76f4\u5230\u4e00\u56de\u5408\u7ed3\u675f\u624d\u80fd\u5f97\u5230\\(R_t\\)\u3002\u8fd9\u5728\u957f\u65f6\u95f4\u4efb\u52a1\u6216\u7a00\u758f\u5956\u52b1\u73af\u5883\u4e0b\u4f1a\u9020\u6210\u9ad8\u65b9\u5dee\u548c\u6162\u66f4\u65b0\u3002</p> <p>\u603b\u7ed3\uff1aREINFORCE\u5c55\u793a\u4e86\u4f18\u52bf\u51fd\u6570\u7528\u4e8e\u7b56\u7565\u66f4\u65b0\u7684\u57fa\u672c\u601d\u60f3\uff1a\u901a\u8fc7\u51cf\u53bb\u57fa\u7ebf\uff08\u72b6\u6001\u4ef7\u503c\uff09\u5f62\u6210\u4f18\u52bf\uff0c\u4ee5\u76f8\u5bf9\u56de\u62a5\u6307\u5bfc\u7b56\u7565\u4f18\u5316\u3002\u8be5\u601d\u60f3\u5728\u540e\u7eed\u7684Actor-Critic\u7b97\u6cd5\u4e2d\u5f97\u5230\u5e7f\u6cdb\u5e94\u7528\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#actor-critica2ca3c","title":"Actor-Critic\u7b97\u6cd5\uff1aA2C/A3C \u5bf9\u4ef7\u503c\u4e0e\u4f18\u52bf\u7684\u7ed3\u5408","text":"<p>Actor-Critic\u65b9\u6cd5\u5c06\u7b56\u7565\uff08Actor\uff09\u4f18\u5316\u4e0e\u503c\u51fd\u6570\uff08Critic\uff09\u4f30\u8ba1\u76f8\u7ed3\u5408\u3002A2C/A3C\u5c31\u662f\u5178\u578b\u4ee3\u8868\uff0c\u5176\u4e2d\u201cCritic\u201d\u4f30\u8ba1\u72b6\u6001\u503c\u51fd\u6570\\(V_\\phi(s)\\)\uff0c\u5e76\u7528\u4e8e\u6784\u9020\u4f18\u52bf\u51fd\u6570\uff0cActor\u4f9d\u636e\u4f18\u52bf\u6765\u66f4\u65b0\u7b56\u7565\u3002</p> <ul> <li>\u4ef7\u503c\u51fd\u6570\uff1aA2C\u4e2dCritic\u901a\u8fc7\u6700\u5c0f\u5316TD\u8bef\u5dee\u6765\u5b66\u4e60\u72b6\u6001\u503c\u51fd\u6570\u3002\u4f8b\u5982\u91c7\u7528\\(n\\)\u6b65\u65f6\u5e8f\u5dee\u5206\u76ee\u6807\uff1a</li> </ul> \\[V_{\\phi}(s_t) \\leftarrow V_{\\phi}(s_t) + \\alpha\\, \\delta_t^{(n)},\\] <p>\u5176\u4e2d\\(\\delta_t^{(n)} = \\sum_{k=0}^{n-1}\\gamma^k r_{t+k} + \\gamma^n V_{\\phi}(s_{t+n}) - V_{\\phi}(s_t)\\)\u3002\u5f53\\(n=1\\)\u65f6\u5c31\u662f\u4e00\u6b65TD(0)\u66f4\u65b0\uff0c\\(n=T-t\\)\u5219\u4e3a\u8499\u7279\u5361\u6d1b\u56de\u62a5\u3002</p> <ul> <li>\u4f18\u52bf\u4f30\u8ba1\uff1aA2C\u5229\u7528Critic\u63d0\u4f9b\u7684\\(V(s)\\)\u8ba1\u7b97\u4f18\u52bf\\(\\hat{A}(s_t,a_t)\\)\u3002\u5e38\u7528\u7684\u4e00\u6b65\u4f18\u52bf\u4e3a\\(\\delta_t = r_t + \\gamma V(s_{t+1}) - V(s_t)\\)\u3002\u5b9e\u9645\u5b9e\u73b0\u4e2d\uff0cA3C\u8bba\u6587\u91c7\u7528\u591a\u6b65\u56de\u62a5\uff08\u4f8b\u598220\u6b65\uff09\u4f30\u8ba1\\(Q\\)\uff0c\u518d\u51cf\u53bb\\(V\\)\u5f97\u5230\u4f18\u52bf\uff0c\u4ee5\u6298\u4e2d\u504f\u5dee\u548c\u65b9\u5dee\u3002\u65e0\u8bba\u4e00\u6b65\u8fd8\u662f\u591a\u6b65\uff0c\u4f18\u52bf\u51fd\u6570 = TD\u76ee\u6807 - \u5f53\u524d\u4ef7\u503c\u4f30\u8ba1\u3002</li> <li>\u7b56\u7565\u66f4\u65b0\uff1aActor\u6839\u636e\u4f18\u52bf\u8fdb\u884c\u68af\u5ea6\u4e0a\u5347\u3002\u7b56\u7565\u635f\u5931\u901a\u5e38\u4e3a\uff1a</li> </ul> \\[L_{\\text{actor}} = -\\log \\pi_\\theta(a_t|s_t)\\,\\hat{A}(s_t,a_t),\\] <p>\u5373\\(\\nabla_\\theta L = -\\hat{A}(s_t,a_t),\\nabla_\\theta \\log \\pi_\\theta(a_t|s_t)\\)\u3002\u5f53\u4f18\u52bf\u4e3a\u6b63\u65f6\uff0c\u8be5\u52a8\u4f5c\u6982\u7387\u5e94\u589e\u52a0\uff1b\u4f18\u52bf\u4e3a\u8d1f\u5219\u5e94\u964d\u4f4e\u3002\u8fd9\u6b63\u662f\u7b56\u7565\u68af\u5ea6\u5b9a\u5f8b\u4e0e\u4f18\u52bf\u51fd\u6570\u76f8\u7ed3\u5408\u7684\u4f53\u73b0\u3002\u4e0e\u6b64\u540c\u65f6\uff0cCritic\u7684\u4ef7\u503c\u51fd\u6570\u635f\\(L_{\\text{critic}} = \\frac{1}{2}\\big(V(s_t)-\\text{target}\\big)^2\\)\u7528\u4e8e\u66f4\u65b0\\(\\phi\\)\u3002</p> <p>A3C\uff08\u5f02\u6b65\u4f18\u52bfActor-Critic\uff09\u4e0eA2C\u7684\u539f\u7406\u7c7b\u4f3c\uff0c\u53ea\u662f\u524d\u8005\u91c7\u7528\u591a\u7ebf\u7a0b\u5f02\u6b65\u66f4\u65b0\uff0c\u540e\u8005\u662f\u540c\u6b65\u7248\u672c\u3002A2C/A3C\u501f\u52a9\u4f18\u52bf\u51fd\u6570\u6709\u6548\u964d\u4f4e\u4e86\u7b56\u7565\u68af\u5ea6\u7684\u65b9\u5dee\uff0c\u4e14\u5229\u7528\u503c\u51fd\u6570\u8fdb\u884c\u57fa\u7ebf\u6821\u6b63\uff0c\u4f7f\u5b66\u4e60\u66f4\u52a0\u7a33\u5b9a\u3002\u5728\u5b9e\u8df5\u4e2d\uff0cA3C\u5e38\u4f7f\u7528\u4f8b\u59825\u6b65\u621620\u6b65\u56de\u62a5\u4f30\u8ba1\u4f18\u52bf\uff0c\u8fd9\u76f8\u5f53\u4e8eMonte Carlo\u4e0eTD\u7684\u6298\u4e2d\uff1a\u6b65\u6570\u8d8a\u5927\uff0c\u4f30\u8ba1\u8d8a\u51c6\u786e\u4f46\u65b9\u5dee\u8d8a\u9ad8\u3002</p> <p>\u9002\u7528\u6027\uff1aA2C/A3C \u5c5e\u4e8eon-policy Actor-Critic\uff0c\u9700\u8981\u4ece\u5f53\u524d\u7b56\u7565\u91c7\u6837\u6570\u636e\u66f4\u65b0\uff0c\u65e0\u7ecf\u9a8c\u56de\u653e\u3002\u5b83\u4eec\u53ef\u5e94\u7528\u4e8e\u79bb\u6563\u6216\u8fde\u7eed\u52a8\u4f5c\u7a7a\u95f4\uff0c\u56e0\u4e3aActor\u53ef\u4ee5\u8f93\u51fa\u4efb\u610f\u53c2\u6570\u5316\u7b56\u7565\uff08\u5982\u79bb\u6563\u5206\u5e03\u6216\u8fde\u7eed\u52a8\u4f5c\u5747\u503c\uff09\u3002\u4f8b\u5982\uff0cA3C \u5728 Atari \u6e38\u620f\uff08\u9ad8\u7ef4\u79bb\u6563\u52a8\u4f5c\uff09\u548cMuJoCo\u8fde\u7eed\u63a7\u5236\u4efb\u52a1\u4e0a\u90fd\u53d6\u5f97\u6210\u529f\u3002\u76f8\u6bd4DQN\uff0c\u8fd9\u7c7b\u7b97\u6cd5\u80fd\u66f4\u597d\u5730\u5904\u7406\u9ad8\u7ef4\u8fde\u7eed\u52a8\u4f5c\u7684\u95ee\u9898\uff0c\u4f46\u7531\u4e8e\u9700\u4e22\u5f03\u65e7\u6570\u636e\uff0c\u6837\u672c\u6548\u7387\u8f83\u4f4e\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#trpo-ppo","title":"\u4fe1\u8d56\u57df\u7b56\u7565\u4f18\u5316\uff1aTRPO \u4e0e PPO \u4e2d\u7684\u4f18\u52bf\u51fd\u6570","text":"<p>\u4fe1\u8d56\u57df\u7b56\u7565\u4f18\u5316\uff08TRPO\uff09\u548c\u8fd1\u7aef\u7b56\u7565\u4f18\u5316\uff08PPO\uff09\u662f\u7b56\u7565\u68af\u5ea6\u65b9\u6cd5\u7684\u6539\u8fdb\u7248\u672c\uff0c\u6ce8\u91cd\u7a33\u5b9a\u66f4\u65b0\u3002\u4e24\u8005\u90fd\u5c5e\u4e8eon-policy\u7b56\u7565\u4f18\u5316\u7b97\u6cd5\uff0c\u5e76\u4f7f\u7528Actor-Critic\u67b6\u6784\uff0c\u56e0\u6b64\u4ef7\u503c\u51fd\u6570\u548c\u4f18\u52bf\u51fd\u6570\u5728\u5176\u4e2d\u540c\u6837\u626e\u6f14\u5173\u952e\u89d2\u8272\u3002</p> <ul> <li>TRPO\uff1a\u63d0\u51fa\u901a\u8fc7\u9650\u5236\u7b56\u7565\u66f4\u65b0\u7684KL\u6563\u5ea6\u5728\u201c\u5c0f\u4fe1\u8d56\u57df\u201d\u5185\uff0c\u907f\u514d\u7b56\u7565\u9aa4\u53d8\u5bfc\u81f4\u6027\u80fd\u5d29\u6e83\u3002TRPO\u7684\u4f18\u5316\u76ee\u6807\u662f\u7ea6\u675f\u4e0b\u7684\u4f18\u52bf\u671f\u671b\u6700\u5927\u5316\uff0c\u5373\uff1a\u6700\u5927\u5316\\(L(\\theta) = \\mathbb{E}_{s,a\\sim \\pi_{\\text{old}}}\\Big[\\frac{\\pi_\\theta(a|s)}{\\pi_{\\text{old}}(a|s)}\\hat{A}(s,a)\\Big]\\)\uff0c\u540c\u65f6\u7ea6\u675f\\(\\mathbb{E}[D_{\\text{KL}}(\\pi_\\theta||\\pi_{\\text{old}})] \\le \\delta\\)\u3002\u8fd9\u91cc\\(\\hat{A}(s,a)\\)\u901a\u5e38\u901a\u8fc7\u5e7f\u4e49\u4f18\u52bf\u4f30\u8ba1\uff08GAE\uff09\u83b7\u53d6\uff08\u8be6\u89c1\u540e\u6587\uff09\u3002TRPO\u7531\u4e8e\u5f15\u5165\u4e8c\u6b21\u89c4\u5212\u6c42\u89e3\uff0c\u5b9e\u8df5\u8f83\u590d\u6742\uff0c\u4f46\u5960\u5b9a\u4e86\u540e\u7eed\u7b97\u6cd5\u4f7f\u7528\u4f18\u52bf\u51fd\u6570\u4f5c\u4e3a\u7b56\u7565\u66f4\u65b0\u9a71\u52a8\u7684\u6846\u67b6\u3002</li> <li>PPO\uff1a\u662f\u5bf9TRPO\u7684\u7b80\u5316\u548c\u6539\u8fdb\u3002PPO\u7684\u5e38\u7528\u53d8\u4f53\uff08PPO-Clip\uff09\u76f4\u63a5\u901a\u8fc7\u526a\u5207\uff08clipping\uff09\u7ea6\u675f\u7b56\u7565\u66f4\u65b0\u5e45\u5ea6\uff0c\u800c\u4e0d\u663e\u5f0f\u8ba1\u7b97KL\u7ea6\u675f\u3002\u5176\u76ee\u6807\u51fd\u6570\u4e3a\uff1a</li> </ul> \\[L(\\theta) = \\mathbb{E}_{s,a\\sim \\pi_{\\text{old}}}\\Big[\\min\\big(r(\\theta)\\,\\hat{A}(s,a),\\ \\text{clip}(r(\\theta),1-\\epsilon,1+\\epsilon)\\,\\hat{A}(s,a)\\big)\\Big]\\] <p>\u5176\u4e2d\\(r(\\theta)=\\frac{\\pi_\\theta(a|s)}{\\pi_{\\text{old}}(a|s)}\\)\u662f\u7b56\u7565\u6982\u7387\u6bd4\u3002\u8fd9\u4e2a\u76ee\u6807\u786e\u4fdd\u5f53\u7b56\u7565\u53d8\u5316\u8fc7\u5927\u65f6\uff0c\u901a\u8fc7\u526a\u9664\\(r(\\theta)\\)\u8d85\u8fc7\\([1-\\epsilon,1+\\epsilon]\\)\u7684\u90e8\u5206\u6765\u9650\u5236\u66f4\u65b0\u3002\u4f18\u52bf\u51fd\u6570\\(\\hat{A}(s,a)\\)\u5728\u6b64\u4ecd\u7136\u4f5c\u4e3a\u52a0\u6743\u56e0\u5b50\uff0c\u6307\u5f15\u54ea\u4e9b\u52a8\u4f5c\u6982\u7387\u9700\u8981\u589e\u5927\u6216\u51cf\u5c0f\u3002PPO\u901a\u5e38\u4f7f\u7528GAE\u6765\u8ba1\u7b97\u4f18\u52bf\uff0c\u4ece\u800c\u5728\u504f\u5dee\u4e0e\u65b9\u5dee\u95f4\u53d6\u5f97\u826f\u597d\u6298\u4e2d\u3002</p> <ul> <li>\u4ef7\u503c\u51fd\u6570\u57fa\u7ebf\uff1aTRPO\u548cPPO\u90fd\u9700\u8981\u8bad\u7ec3\u4e00\u4e2a\u4ef7\u503c\u51fd\u6570\uff08Critic\uff09\u6765\u63d0\u4f9b\\(V(s)\\)\u4f5c\u4e3a\u57fa\u7ebf\u3002\u901a\u5e38\u901a\u8fc7\u6700\u5c0f\u5316\u5747\u65b9TD\u8bef\u5dee\u6765\u8bad\u7ec3\\(V(s)\\)\uff0c\u7c7b\u4f3cA2C Critic\u7684\u66f4\u65b0\u3002\u4f18\u5316\u65f6\uff0c\u8fd9\u4e2a\u503c\u51fd\u6570\u7684\u635f\u5931\u4f1a\u4e0e\u7b56\u7565\u635f\u5931\u4e00\u5e76\u8003\u8651\uff08\u4f8b\u5982 PPO \u7684\u603b\u635f\u5931\u4e2d\u5305\u542b\u4e00\u4e2a\u5747\u65b9\u503c\u8bef\u5dee\u9879\uff09\u3002</li> </ul> <p>\u4f18\u52bf\u4f30\u8ba1\uff1aTRPO\u8bba\u6587\u5f15\u5165\u4e86\u5e7f\u4e49\u4f18\u52bf\u4f30\u8ba1 GAE(\\(\\lambda\\))\u65b9\u6cd5\uff0c\u7528\u52a0\u6743\u7684\u591a\u6b65TD\u8bef\u5dee\u8ba1\u7b97\u4f18\u52bf\uff0c\u4ee5\u964d\u4f4e\u65b9\u5dee\u3002GAE \u7684\u516c\u5f0f\u4e3a\uff1a</p> \\[\\begin{aligned}\\hat{A}_t^{\\text{GAE}(\\gamma,\\lambda)} &amp;= \\sum_{k=0}^{\\infty} (\\gamma\\lambda)^k \\delta_{t+k}\\\\ &amp;= r_t + \\gamma V(s_{t+1}) - V(s_t) \\\\ &amp;\\quad + \\gamma\\lambda\\left[r_{t+1} + \\gamma V(s_{t+2}) - V(s_{t+1})\\right] \\\\ &amp;\\quad + (\\gamma\\lambda)^2\\left[r_{t+2} + \\gamma V(s_{t+3}) - V(s_{t+2})\\right] + \\cdots\\end{aligned}, \\] <p>\u5176\u4e2d\\(\\delta_t = r_t + \\gamma V(s_{t+1}) - V(s_t)\\)\u3002\\(\\lambda\\)\u4ecb\u4e8e0\u548c1\u4e4b\u95f4\u8c03\u8282\u504f\u5dee-\u65b9\u5dee\u6743\u8861\uff1a\\(\\lambda=1\\)\u6062\u590d\u4e3a\u8499\u7279\u5361\u6d1b\u4f18\u52bf\uff08\u9ad8\u65b9\u5dee\u65e0\u504f\uff09\uff0c\\(\\lambda=0\\)\u5219\u4e3a\u4e00\u6b65TD\u4f18\u52bf\uff08\u4f4e\u65b9\u5dee\u6709\u504f\uff09\u3002PPO \u7b49\u7b97\u6cd5\u5e38\u9009\u7528\u4e2d\u95f4\u7684\\(\\lambda\\)\uff08\u59820.95\uff09\u6765\u5e73\u8861\u6548\u679c\u3002GAE \u7684\u4f7f\u7528\u8ba9\u4f18\u52bf\u4f30\u8ba1\u66f4\u52a0\u5e73\u6ed1\u7a33\u5b9a\uff0c\u5728\u5b9e\u8df5\u4e2d\u6781\u5927\u63d0\u9ad8\u4e86TRPO/PPO\u7684\u6027\u80fd\u3002</p> <p>\u9002\u7528\u6027\uff1aTRPO\u548cPPO\u65e2\u53ef\u7528\u4e8e\u79bb\u6563\u4e5f\u53ef\u7528\u4e8e\u8fde\u7eed\u52a8\u4f5c\u7a7a\u95f4\u3002PPO\u7531\u4e8e\u5b9e\u73b0\u7b80\u5355\u3001\u7a33\u5b9a\u6027\u597d\uff0c\u5df2\u5e7f\u6cdb\u5e94\u7528\u4e8e\u673a\u5668\u4eba\u63a7\u5236\u3001\u6e38\u620fAI\u7b49\u9886\u57df\u7684\u8fde\u7eed\u63a7\u5236\u548c\u9ad8\u7ef4\u89c2\u6d4b\u4efb\u52a1\u3002\u76f8\u5bf9\u4e8eDQN\u7b49off-policy\u503c\u65b9\u6cd5\uff0cPPO\u4e00\u7c7b\u65b9\u6cd5\u6837\u672c\u6548\u7387\u8f83\u4f4e\uff08\u9700\u8981\u8f83\u5927\u91cf\u91c7\u6837\uff09\uff0c\u4f46\u6536\u655b\u7a33\u5b9a\uff0c\u5bf9\u8d85\u53c2\u6570\u4e0d\u654f\u611f\uff0c\u9002\u5408\u9700\u8981\u53ef\u9760\u6536\u655b\u7684\u573a\u666f\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#off-policy-actor-criticddpgtd3-sac","title":"off policy Actor-Critic\uff1aDDPG\u3001TD3 \u4e0e SAC","text":"<p>\u524d\u8ff0A2C/PPO\u7b49\u4e3aon-policy\u65b9\u6cd5\uff0c\u4e0d\u80fd\u76f4\u63a5\u5229\u7528\u65e7\u6570\u636e\u3002\u800c\u79bb\u7b56\u7565\uff08off-policy\uff09Actor-Critic\u7b97\u6cd5\u7ed3\u5408\u4e86\u503c\u51fd\u6570\u8fd1\u4f3c\u548c\u7b56\u7565\u51fd\u6570\u8f93\u51fa\uff0c\u80fd\u5728\u8fde\u7eed\u52a8\u4f5c\u7a7a\u95f4\u9ad8\u6548\u5b66\u4e60\uff0c\u5178\u578b\u4ee3\u8868\u5305\u62ec DDPG\u3001TD3 \u548c SAC\u3002</p> <p>\u6df1\u5ea6\u786e\u5b9a\u6027\u7b56\u7565\u68af\u5ea6\uff08DDPG\uff09\u662f\u4e00\u79cd\u5c06DQN\u7684\u503c\u5b66\u4e60\u601d\u60f3\u5e94\u7528\u4e8e\u8fde\u7eed\u52a8\u4f5c\u7684\u7b97\u6cd5\u3002\u5b83\u5305\u542b\u4e00\u4e2a\u786e\u5b9a\u6027\u7b56\u7565\uff08Actor\\(\\mu(s)\\)\uff09\u548c\u4e00\u4e2aQ\u503c\u51fd\u6570\uff08Critic\\(Q(s,a)\\)\uff09\uff1a</p> <ul> <li>\u503c\u51fd\u6570\u66f4\u65b0\uff1aDDPG \u7684Critic\u4e0eDQN\u7c7b\u4f3c\uff0c\u91c7\u7528\u4e00\u6b65TD\u8fdb\u884cQ\u7f51\u7edc\u8bad\u7ec3\u3002\u4f7f\u7528\u7ecf\u9a8c\u56de\u653e\u6c60\u7684\u91c7\u6837\\((s,a,r,s')\\)\uff0c\u76ee\u6807\\(y = r + \\gamma Q_{\\phi_{\\text{targ}}}(s',\\mu_{\\theta_{\\text{targ}}}(s'))\\)\uff0c\u6700\u5c0f\u5316\u635f\u5931\\(\\frac{1}{2}(Q_\\phi(s,a)-y)^2\\)\u3002\u8fd9\u76f8\u5f53\u4e8e Q-learning \u7684\u8fde\u7eed\u52a8\u4f5c\u7248\u672c\u3002</li> <li>\u7b56\u7565\u66f4\u65b0\uff1aDDPG \u7684\u7b56\u7565\u76f4\u63a5\u8f93\u51fa\u4e00\u4e2a\u786e\u5b9a\u6027\u52a8\u4f5c\\(a=\\mu_\\theta(s)\\)\uff0c\u5176\u8bad\u7ec3\u76ee\u6807\u662f\u6700\u5927\u5316Q\u503c\u3002\u68af\u5ea6\u53ef\u4ece\u94fe\u5f0f\u6cd5\u5219\u63a8\u51fa\u4e3a\uff1a</li> </ul> \\[\\nabla_{\\theta} J \\approx \\mathbb{E}_{s\\sim \\mathcal{D}}[\\nabla_a Q_{\\phi}(s,a)\\big|_{a=\\mu_\\theta(s)} \\nabla_{\\theta} \\mu_\\theta(s)]\\] <p>\u5728\u5b9e\u73b0\u4e0a\u7b49\u4ef7\u4e8e\u6cbf\u7740\u589e\u5927\\(Q\\)\u503c\u7684\u65b9\u5411\u8c03\u6574\u7b56\u7565\u53c2\u6570\u3002\u76f4\u89c2\u7406\u89e3\uff0cCritic\u7ed9\u51fa\u5f53\u524d\u7b56\u7565\u52a8\u4f5c\u7684\u4ef7\u503c\u68af\u5ea6\uff0cActor\u6cbf\u68af\u5ea6\u63d0\u5347\u5176\u52a8\u4f5c\u7684\u4ef7\u503c\u3002</p> <ul> <li>\u4f18\u52bf\u51fd\u6570\u89c6\u89d2\uff1aDDPG \u7684\u7b56\u7565\u68af\u5ea6\u5b9e\u9645\u4e0a\u4f7f\u7528\u4e86\\(Q(s,a)\\)\u4f5c\u4e3a\u4f18\u52bf\u4fe1\u53f7\u3002\u56e0\u4e3a\u5bf9\u4e8e\u786e\u5b9a\u6027\u7b56\u7565\uff0c\u7b56\u7565\u68af\u5ea6\u516c\u5f0f\u53ef\u88ab\u89c6\u4e3a\\(\\nabla_\\theta \\log \\pi(a|s)\\)\u9879\u88ab\\(\\delta(a-\\mu(s))\\)\u6240\u66ff\u4ee3\uff0c\u7ed3\u679c\u5c31\u662f\\(\\nabla_a Q \\nabla_\\theta \\mu\\)\u3002\u82e5\u7c7b\u6bd4\u968f\u673a\u7b56\u7565\u60c5\u51b5\uff0c\\(Q(s,a)\\)\u5728\u6b64\u626e\u6f14\u4e86\u4f18\u52bf\u51fd\u6570\u7684\u89d2\u8272\uff08baseline\u53ef\u89c6\u4e3a0\uff09\uff0c\u56e0\u4e3a\u5b83\u8868\u793a\u9009\u62e9\u5f53\u524d\u7b56\u7565\u8f93\u51fa\u52a8\u4f5c\u7684\u8bc4\u4ef7\uff08\u6ca1\u6709\u51cf\u53bb\u72b6\u6001\u57fa\u7ebf\uff0c\u56e0\u4e3a\u5bf9\u786e\u5b9a\u6027\u7b56\u7565\u800c\u8a00\uff0c\u57fa\u7ebf\u5bf9\u68af\u5ea6\u65e0\u8d21\u732e\uff09\u3002\u56e0\u6b64\u867d\u7136 DDPG \u672a\u663e\u5f0f\u8ba1\u7b97\\(A(s,a)\\)\uff0c\u4f46\u5176\u66f4\u65b0\u672c\u8d28\u4e0a\u5229\u7528\u4e86\\(Q\\)\u51fd\u6570\u6765\u8861\u91cf\u52a8\u4f5c\u76f8\u5bf9\u597d\u574f\u3002</li> <li>\u76ee\u6807\u7f51\u7edc\u4e0e\u7a33\u5b9a\u6027\uff1aDDPG \u501f\u9274 DQN \u4f7f\u7528\u76ee\u6807\u7f51\u7edc\u5e73\u6ed1\u66f4\u65b0\uff0c\u4ee5\u53ca\u5728\u7b56\u7565\u8f93\u51fa\u4e0a\u6dfb\u52a0\u63a2\u7d22\u566a\u58f0\uff08\u5982OU\u566a\u58f0\uff09\u6765\u8fdb\u884c\u63a2\u7d22\u3002\u8fd9\u4e9b\u6280\u5de7\u63d0\u5347\u4e86\u8bad\u7ec3\u7a33\u5b9a\u6027\u3002</li> </ul> <p>Twin Delayed DDPG (TD3) \u5bf9 DDPG \u4f5c\u4e86\u6539\u8fdb\uff0c\u4e3b\u8981\u5dee\u5f02\u5728\u4e8e \u4f7f\u7528\u53ccQ\u7f51\u7edc\u51cf\u5c0f\u4f30\u8ba1\u504f\u5dee\uff08\u7c7b\u4f3cDouble DQN\uff09\u4ee5\u53ca\u5ef6\u8fdf\u66f4\u65b0\u7b56\u7565\u4ee5\u7a33\u5b9a\u8bad\u7ec3\u3002TD3 \u8bad\u7ec3\u4e24\u4e2aCritic\\(Q_{\\phi_1},Q_{\\phi_2}\\)\uff0c\u53d6\u8f83\u5c0f\u7684\u4f30\u8ba1\u4f5c\u4e3a\u76ee\u6807\uff08Clipped Double Q\uff09, \u4ece\u800c\u7f13\u89e3\u4ef7\u503c\u8fc7\u9ad8\u4f30\u8ba1\u7684\u95ee\u9898\u3002\u53e6\u5916\uff0c\u7b56\u7565\u7f51\u7edc\u66f4\u65b0\u9891\u7387\u964d\u4f4e\uff08\u4f8b\u5982\u6bcf2\u6b21Critic\u66f4\u65b0\u540e\u66f4\u65b0\u4e00\u6b21\uff09\uff0c\u5e76\u5728\u8ba1\u7b97\u76ee\u6807\u52a8\u4f5c\u65f6\u5bf9\u52a8\u4f5c\u6dfb\u52a0\u5c0f\u6270\u52a8\uff08\u76ee\u6807\u7b56\u7565\u5e73\u6ed1\uff09\uff0c\u907f\u514d\u7b56\u7565\u8fc7\u5ea6\u8ffd\u6c42Critic\u7684\u5c40\u90e8\u4e0d\u51c6\u786e\u9ad8\u503c\u3002\u4ef7\u503c\u51fd\u6570\u548c\u7b56\u7565\u66f4\u65b0\u5728TD3\u4e2d\u4ecd\u7c7b\u4f3c\u4e8eDDPG\uff0c\u53ea\u662f\u66f4\u7a33\u5b9a\u4e86\u3002TD3\u540c\u6837\u6ca1\u6709\u663e\u5f0f\u4f18\u52bf\u51fd\u6570\uff0c\u4f46\u53ccQ\u673a\u5236\u53ef\u4ee5\u7406\u89e3\u4e3a\u66f4\u7cbe\u51c6\u5730\u8bc4\u4f30\u4e86\u201c\u4f18\u52bf\u201d\uff08\u907f\u514d\u628a\u4e0d\u4f18\u52bf\u7684\u52a8\u4f5c\u8bef\u5224\u4e3a\u9ad8\u4ef7\u503c\uff09\u3002</p> <p>Soft Actor-Critic\uff08SAC\uff09\u8fdb\u4e00\u6b65\u7ed3\u5408\u4e86\u7b56\u7565\u968f\u673a\u6027\u548c\u71b5\u6b63\u5219\u5316\u3002SAC \u7684\u4e3b\u8981\u7279\u70b9\uff1a</p> <ul> <li>\u7b56\u7565\u662f\u968f\u673a\u7684\uff08\u8f93\u51fa\u9ad8\u65af\u5206\u5e03\u7b49\uff09\uff0c\u4e0d\u540c\u4e8eDDPG/TD3\u786e\u5b9a\u6027\u7b56\u7565\u3002\u8fd9\u4f7f\u7b56\u7565\u6709\u63a2\u7d22\u6027\uff0c\u5e76\u53ef\u4ee5\u8bad\u7ec3\u671f\u671b\u7b56\u7565\u68af\u5ea6\u3002</li> <li>\u71b5\u9879\u5956\u52b1\uff1aSAC\u5728\u5956\u52b1\u4e2d\u52a0\u5165\u7b56\u7565\u71b5\\(H(\\pi(\\cdot|s))\\)\uff0c\u76ee\u6807\u662f\u6700\u5927\u5316\u9884\u671f\u56de\u62a5\u548c\u71b5\u7684\u52a0\u6743\u548c\u3002\u8fd9\u7b49\u4ef7\u4e8e\u5728\u7b56\u7565\u66f4\u65b0\u65f6\u52a0\u5165\u4e00\u9879\u9f13\u52b1\u66f4\u968f\u673a\uff08\u63a2\u7d22\u6027\u66f4\u5f3a\uff09\u7684\u7b56\u7565\u3002\u516c\u5f0f\u4e0a\uff0c\u76f8\u5f53\u4e8e\u5c06\u4ef7\u503c\u51fd\u6570\u91cd\u65b0\u5b9a\u4e49\u4e3a\u5305\u542b\u71b5\u9879\u3002\u71b5\u7cfb\u6570\\(\\alpha\\)\u53ef\u56fa\u5b9a\u6216\u81ea\u52a8\u8c03\u8282\u3002</li> <li>\u503c\u51fd\u6570\u4e0e\u4f18\u52bf\uff1a\u73b0\u4ee3\u7248\u672c\u7684SAC\u4f7f\u7528\u4e24\u4e2aQ\u7f51\u7edc\\(Q_{\\phi_1}, Q_{\\phi_2}\\)\uff0c\u4e0d\u518d\u5355\u72ec\u7ef4\u62a4\\(V(s)\\)\u51fd\u6570\uff08\u65e9\u671f\u7248\u672c\u6709\u4e00\u4e2a\\(V\\)\u7f51\u7edc\u7528\u4e8e\u5e2e\u52a9\u8bad\u7ec3Q\uff09\u3002\u4e24\u4e2aQ\u7f51\u7edc\u7684\u8bad\u7ec3\u7c7b\u4f3cTD3\uff08\u5e26\u76ee\u6807\u7f51\u7edc\u3001polyak\u5e73\u5747\u3001clipped double Q\uff09\u3002\u76ee\u6807\u503c\u8ba1\u7b97\u65f6\u5305\u542b\u71b5\u9879\uff1a\u5bf9\u4e8e\u4e0b\u4e00\u72b6\u6001\\(s'\\)\uff0c\u53d6\u5f53\u524d\u7b56\u7565\\(\\pi\\)\u8f93\u51fa\u7684\u52a8\u4f5c\u5e76\u8ba1\u7b97\\(Q(s',a') - \\alpha \\log \\pi(a'|s')\\)\u4f5c\u4e3a\u6269\u5c55\u7684\u76ee\u6807\u3002\u56e0\u6b64Critic\u7684Bellman\u76ee\u6807\u4e3a\uff1a</li> </ul> \\[y = r + \\gamma\\Big(\\min_{i=1,2}Q_{\\phi_i,\\text{targ}}(s',a') - \\alpha \\log \\pi_\\theta(a'|s')\\Big)\\] <p>\u5176\u4e2d\u5176\u4e2d\\(\\alpha\\)\u4e3a\u71b5\u7cfb\u6570\uff0c\\(a'\\sim\\pi(\\cdot|s')\\)\uff0c\\(\\log\\pi\\)\u9879\u4f53\u73b0\u7b56\u7565\u968f\u673a\u6027\u7684\u5956\u52b1\u3002\u7b56\u7565\u66f4\u65b0\u5219\u4ee5\u6700\u5927\u5316soft Q\u503c\u4e3a\u76ee\u6807\uff0c\u635f\u5931\u4e3a\uff1a</p> \\[L_{\\text{actor}} = -\\mathbb{E}_{s\\sim \\mathcal{D}}\\Big[ Q_{\\phi}(s,a) - \\alpha \\log \\pi_\\theta(a|s) \\Big]\uff0c\\] <p>\u5373\u4f7f\\(Q-\\alpha \\log\\pi\\)\u6700\u5927\uff08\u5e73\u8861\u4e86\u4ef7\u503c\u548c\u71b5\uff09\u3002SAC\u6ca1\u6709\u663e\u5f0f\u7684\u4f18\u52bf\u51fd\u6570\u8ba1\u7b97\uff0c\u4f46\u5982\u679c\u4ece\u7b56\u7565\u68af\u5ea6\u5f62\u5f0f\u770b\uff0c\u4f18\u52bf\u76f8\u5f53\u4e8e\\(Q(s,a) - (\\text{\u67d0\u4e2abaseline})\\)\u3002\u7531\u4e8eSAC\u7b56\u7565\u66f4\u65b0\u65f6\u540c\u65f6\u8003\u8651\u589e\u5927\u5229\u6da6\uff08\u9ad8\\(Q\\)\uff09\u548c\u589e\u5927\u71b5\uff08\u9ad8\\(H\\)\uff09\uff0cbaseline\u53ef\u4ee5\u7406\u89e3\u4e3a\u9690\u542b\u5728\\(-\\alpha\\log\\pi\\)\u8fd9\u4e00\u9879\u4e2d\u3002</p> <ul> <li>\u8bad\u7ec3\u6027\u8d28\uff1aSAC\u4e0eDDPG\u4e00\u6837\u662foff-policy\u4e14\u53ef\u5229\u7528\u7ecf\u9a8c\u56de\u653e\u91cd\u590d\u5229\u7528\u6837\u672c\u3002\u5b83\u5728\u8fde\u7eed\u63a7\u5236\u4efb\u52a1\u4e2d\u8868\u73b0\u51fa\u8272\uff0c\u901a\u5e38\u6bd4DDPG/TD3\u66f4\u7a33\u5b9a\u4e14\u6837\u672c\u6548\u7387\u9ad8\u3002SAC\u5141\u8bb8\u7b56\u7565\u662f\u968f\u673a\u7684\uff0c\u4f46\u4f9d\u7136\u4f7f\u7528\u4ef7\u503c\u51fd\u6570\u6765\u6307\u5bfc\u7b56\u7565\u6539\u5584\uff0c\u5c5e\u4e8e\u57fa\u4e8e\u503c\u7684Actor-Critic\u53d8\u79cd\u3002</li> </ul> <p>\u5c0f\u7ed3\uff1a\u5bf9\u4e8eDDPG/TD3/SAC\u8fd9\u7c7b\u7b97\u6cd5\uff0c\u4ef7\u503c\u51fd\u6570\uff08Q\u51fd\u6570\uff09\u662f\u6838\u5fc3\uff1a\u5b83\u4eec\u76f4\u63a5\u5b66\u4e60\\(Q(s,a)\\)\u5e76\u7528\u5b83\u6765\u6307\u5bfc\u7b56\u7565\u53c2\u6570\u66f4\u65b0\u3002\u4f18\u52bf\u51fd\u6570\u6ca1\u6709\u4ee5\u663e\u5f0f\u5f62\u5f0f\u51fa\u73b0\uff08\u4e0d\u50cfA2C/PPO\u90a3\u6837\u8ba1\u7b97\\(A(s,a)\\)\uff09\uff0c\u4f46Q\u503c\u672c\u8eab\u627f\u62c5\u4e86\u4f18\u52bf\u8bc4\u4f30\u7684\u4f5c\u7528\u3002\u4f8b\u5982DDPG\u4e2d\uff0c\u7b56\u7565\u68af\u5ea6\u7528\\(\\nabla_a Q\\)\uff0c\u610f\u5473\u7740\u52a8\u4f5c\u4ef7\u503c\u8d8a\u9ad8\uff08\u4f18\u52bf\u8d8a\u5927\uff09\u5c31\u63d0\u9ad8\u8be5\u52a8\u4f5c\u6982\u7387\uff1bTD3\u4e5f\u662f\u57fa\u4e8eQ\uff1bSAC\u867d\u7136\u6709\u71b5\u9879\uff0c\u4f46\u4ecd\u662f\u901a\u8fc7Q\u503c\u8861\u91cf\u52a8\u4f5c\u4f18\u52a3\u3002\u8fde\u7eed\u52a8\u4f5c\u7a7a\u95f4\u7684\u95ee\u9898\u901a\u5e38\u4f9d\u8d56\u8fd9\u4e9b\u7b97\u6cd5\uff0c\u56e0\u4e3a\u7eaf\u503c\u65b9\u6cd5\uff08\u5982DQN\uff09\u65e0\u6cd5\u76f4\u63a5\u5e94\u7528\u3002\u76f8\u5bf9\u4e8eon-policy\u65b9\u6cd5\uff0c\u8fd9\u4e9boff-policy\u7b97\u6cd5\u6570\u636e\u5229\u7528\u7387\u9ad8\uff08\u53ef\u91cd\u653e\u7ecf\u9a8c\uff09\uff0c\u5728\u7a00\u758f\u5956\u52b1\u573a\u666f\u4e2d\u80fd\u591f\u591a\u6b21\u5b66\u4e60\u5c11\u91cf\u6210\u529f\u7ecf\u9a8c\uff0c\u56e0\u800c\u5728\u9700\u8981\u9ad8\u6548\u7387\u63a2\u7d22\u65f6\u66f4\u6709\u4f18\u52bf\u3002\u4e0d\u8fc7\uff0c\u5b83\u4eec\u5bf9\u8d85\u53c2\u6570\uff08\u63a2\u7d22\u566a\u58f0\u3001\u7a33\u5b9a\u5316\u6280\u5de7\uff09\u8f83\u654f\u611f\uff0c\u8bad\u7ec3\u8fc7\u7a0b\u53ef\u80fd\u4e0d\u5982PPO\u5e73\u6ed1\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#_3","title":"\u4f18\u52bf\u51fd\u6570\u7684\u4f30\u8ba1\u65b9\u6cd5\u7efc\u8ff0","text":"<p>\u4e0d\u540c\u7b97\u6cd5\u5728\u8bad\u7ec3\u4e2d\u91c7\u7528\u4e86\u4e0d\u540c\u7684\u4f18\u52bf\u4f30\u8ba1\u7b56\u7565\uff0c\u4e3b\u8981\u5305\u62ec\uff1a</p> <ul> <li>\u8499\u7279\u5361\u6d1b\uff08MC\uff09\u4f30\u8ba1\uff1a\u76f4\u63a5\u5229\u7528\u5b8c\u6574\u56de\u62a5\u4f5c\u4e3a\u4f18\u52bf\u3002\u4f8b\u5982REINFORCE\u4e2d\\(A(s_t,a_t)=R_t - b(s_t)\\)\uff0c\u82e5\u4e0d\u4f7f\u7528\u57fa\u7ebf\u5219\\(A=R_t\\)\u3002MC \u4f18\u52bf\u65e0\u504f\u4f46\u65b9\u5dee\u9ad8\uff0c\u4e00\u822c\u4ec5\u5728\u56de\u5408\u7ed3\u675f\u624d\u80fd\u8ba1\u7b97\u3002\u7b56\u7565\u68af\u5ea6\u65b9\u6cd5\u5728\u56de\u5408\u8f83\u77ed\u6216\u6709\u8db3\u591f\u6837\u672c\u65f6\u53ef\u7528MC\u3002</li> <li>\u65f6\u5e8f\u5dee\u5206\uff08TD\uff09\u4e00\u6b65\u4f30\u8ba1\uff1a\u4f7f\u7528\u5355\u6b65\u5956\u52b1\u52a0\u503c\u51fd\u6570bootstrap\uff1a\\(A(s,a)\\approx \\delta_t = r_t + \\gamma V(s_{t+1}) - V(s_t)\\)\u3002\u8fd9\u5176\u5b9e\u662fTD(0)\u7684TD\u8bef\u5dee\uff0c\u5e38\u7528\u4e8eActor-Critic\u7b97\u6cd5\u6bcf\u6b65\u5728\u7ebf\u5730\u8ba1\u7b97\u4f18\u52bf\u3002\u4e00\u6b65TD\u6709\u504f\u4f46\u65b9\u5dee\u4f4e\uff0c\u53ef\u4ee5\u5b9e\u65f6\u66f4\u65b0\u3002</li> <li>\u591a\u6b65 TD(\\(n\\)) \u4f30\u8ba1\uff1a\u7efc\u5408\u8003\u8651\\(n\\)\u6b65\u5185\u7684\u6536\u76ca\uff1a\\(\\hat{A}_t^{(n)} = \\sum_{k=0}^{n-1} \\gamma^k r_{t+k} + \\gamma^n V(s_{t+n}) - V(s_t)\\)\u3002\\(n\\)\u6b65\u56de\u62a5\u5305\u542b\u66f4\u591a\u5b9e\u9645\u5956\u52b1\u4fe1\u606f\uff0c\u51cf\u5c0f\u504f\u5dee\uff0c\u4f46\u82e5\\(n\\)\u5927\u65b9\u5dee\u4f1a\u4e0a\u5347\u3002A2C/A3C\u5e38\u91c7\u7528\u56fa\u5b9a\u7684\u591a\u6b65\uff08\u59825\u6b65\u300120\u6b65\uff09\u4f18\u52bf\u4f30\u8ba1\uff0c\u4ee5\u6743\u8861\u7a33\u5b9a\u6027\u548c\u6027\u80fd\u3002</li> <li>TD(\\(\\lambda\\))\u4e0e\u5e7f\u4e49\u4f18\u52bf\u4f30\u8ba1\uff08GAE\uff09\uff1aTD(\\(\\lambda\\))\u901a\u8fc7\u5bf9\u4e0d\u540c\u6b65\u957f\u7684\u56de\u62a5\u52a0\u6743\u6c42\u548c\u5b9e\u73b0\u4eceMC\u5230TD(0)\u7684\u5e73\u6ed1\u8fc7\u6e21\u3002GAE\u662f\u5e94\u7528\u4e8e\u4f18\u52bf\u4f30\u8ba1\u7684TD(\\(\\lambda\\))\uff1a\u4f7f\u7528\u53c2\u6570\\(\\lambda\\)\u5bf9\\(n\\)\u6b65TD\u8bef\u5dee\u52a0\u6743\u5e73\u5747\u3002\u5176\u5f62\u5f0f\u5982\u524d\u8ff0 \\(\\hat{A}_t^{\\text{GAE}} = \\sum_{k=0}^\\infty (\\gamma\\lambda)^k \\delta_{t+k}\\)\u3002\\(\\lambda\\)\u8d8a\u5927\uff0c\u4f18\u52bf\u4f30\u8ba1\u504f\u5411\u957f\u7a0bMC\uff1b\\(\\lambda\\)\u8d8a\u5c0f\uff0c\u504f\u5411\u77ed\u671fTD\u3002GAE \u80fd\u7075\u6d3b\u8c03\u6574bias-variance\uff0c\u4e8eTRPO/PPO\u7b49\u7b97\u6cd5\u4e2d\u6548\u679c\u663e\u8457\uff0c\u4f7f\u5f97\u5b83\u4eec\u5728\u4e0d\u540c\u4efb\u52a1\u4e0a\u5747\u53d6\u5f97\u826f\u597d\u6027\u80fd\u3002</li> </ul> <p>\u5728\u5b9e\u9645\u5b9e\u73b0\u4e2d\uff0c\u4e0d\u540c\u7b97\u6cd5\u91c7\u7528\u5982\u4e0b\u4f18\u52bf\u4f30\u8ba1\u65b9\u6848\uff1a</p> <ul> <li>DQN\uff1a\u503c\u65b9\u6cd5\uff0c\u65e0\u9700\u4f18\u52bf\u4f30\u8ba1\uff08\u76f4\u63a5Q-learning\uff09\u3002</li> <li>REINFORCE\uff1aMC\u56de\u5408\u56de\u62a5\uff08\u9ad8\u65b9\u5dee\uff0c\u9700\u8981baseline\u964d\u4f4e\u65b9\u5dee\uff09\u3002</li> <li>A2C/A3C\uff1a\u591a\u6b65\uff08n-step\uff09TD\u76ee\u6807\u51cf\u503c\uff0c\u59825\u6b65TD\u3002</li> <li>TRPO/PPO\uff1a\u901a\u5e38\u4f7f\u7528GAE(\\(\\lambda\\))\uff0c\u5178\u578b\\(\\lambda=0.95\\)\u3002</li> <li>DDPG/TD3/SAC\uff1a\u4e0d\u663e\u5f0f\u8ba1\u7b97\u4f18\u52bf\uff0c\u7528\\(Q\\)\u503c\u6216TD\u8bef\u5dee\u76f4\u63a5\u6307\u5bfc\u7b56\u7565\u66f4\u65b0\u3002\u53ef\u4ee5\u8ba4\u4e3aTD\u8bef\u5dee\u672c\u8eab\u4e5f\u662f\u4e00\u79cd\u4f18\u52bf\u4fe1\u53f7\uff0c\u5728actor-critic\u4ee3\u7801\u4e2d\u5f80\u5f80\u76f4\u63a5\u5c06\\(\\delta_t\\)\u89c6\u4f5c\u4f18\u52bf\u8fd1\u4f3c\u3002</li> </ul>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#vs","title":"\u503c\u51fd\u6570\u65b9\u6cd5 vs. \u4f18\u52bf\u65b9\u6cd5\uff1a\u5dee\u5f02\u4e0e\u9002\u7528\u6027\u5206\u6790","text":"<p>\u503c\u51fd\u6570\u65b9\u6cd5\uff08value-based\uff09\u548c\u57fa\u4e8e\u4f18\u52bf\u7684\u7b56\u7565\u65b9\u6cd5\uff08advantage-based policy methods\uff0c\u5373\u4f7f\u7528\u4f18\u52bf\u51fd\u6570\u7684\u7b56\u7565\u68af\u5ea6/Actor-Critic\uff09\u5728\u7b97\u6cd5\u601d\u60f3\u548c\u5e94\u7528\u573a\u666f\u4e0a\u5404\u6709\u4f18\u52bf\uff1a</p> <ul> <li>\u7b56\u7565\u83b7\u53d6\u65b9\u5f0f\uff1a\u503c\u51fd\u6570\u6cd5\uff08\u5982Q-learning/DQN\uff09\u901a\u8fc7\u5b66\u4e60\u4ef7\u503c\u51fd\u6570\u95f4\u63a5\u5730\u5f97\u5230\u7b56\u7565\u2014\u2014\u4f8b\u5982\u5bf9\\(Q(s,a)\\)\u53d6argmax\u5f97\u5230\u8d2a\u5fc3\u7b56\u7565\uff1b\u4f18\u52bf\u65b9\u6cd5\uff08\u5982A2C/PPO\uff09\u5219\u76f4\u63a5\u53c2\u6570\u5316\u7b56\u7565\uff0c\u901a\u8fc7\u7b56\u7565\u68af\u5ea6\u8c03\u6574\u53c2\u6570\u3002\u76f4\u63a5\u7b56\u7565\u4f18\u5316\u80fd\u591f\u81ea\u7136\u5904\u7406\u8fde\u7eed\u52a8\u4f5c\u7a7a\u95f4\u548c\u6982\u7387\u6df7\u5408\u7b56\u7565\uff0c\u800c\u503c\u65b9\u6cd5\u9700\u79bb\u6563\u5316\u6216\u5176\u4ed6\u5904\u7406\u624d\u80fd\u5e94\u7528\u4e8e\u8fde\u7eed\u52a8\u4f5c\u3002</li> <li>\u5b66\u4e60\u4fe1\u53f7\uff1a\u503c\u65b9\u6cd5\u5229\u7528TD\u8bef\u5dee\u6216\u8d1d\u5c14\u66fc\u6b8b\u5dee\u4f5c\u4e3a\u5b66\u4e60\u4fe1\u53f7\uff0c\u66f4\u65b0\u65b9\u5411\u4e0d\u4e00\u5b9a\u76f4\u63a5\u5bf9\u5e94\u7b56\u7565\u6027\u80fd\u68af\u5ea6\uff1b\u4f18\u52bf\u65b9\u6cd5\u76f4\u63a5\u5229\u7528\u4f18\u52bf\uff08\u7b56\u7565\u68af\u5ea6\u4e58\u5b50\uff09\u6307\u5f15\u7b56\u7565\u671d\u63d0\u5347\u56de\u62a5\u65b9\u5411\u66f4\u65b0\u3002\u4f18\u52bf\u51fd\u6570\u63d0\u4f9b\u4e86\u76f8\u5bf9\u8bc4\u4ef7\uff08\u597d\u4e8e\u5e73\u5747\u591a\u5c11\uff09\uff0c\u5f80\u5f80\u6bd4\u7edd\u5bf9\u503c\u8bc4\u4ef7\u66f4\u7a33\u5b9a\u3002\u56e0\u6b64\uff0c\u7b56\u7565\u68af\u5ea6\u7c7b\u7b97\u6cd5\u5728\u9ad8\u7ef4\u7b56\u7565\u53c2\u6570\u60c5\u51b5\u4e0b\u66f4\u7a33\u5b9a\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u6240\u6709\u52a8\u4f5c\u4ef7\u503c\u90fd\u5f88\u9ad8\u6216\u5f88\u4f4e\u800c\u4e27\u5931\u68af\u5ea6\u4fe1\u53f7\u3002</li> <li>\u6570\u636e\u6548\u7387\uff1a\u5927\u591a\u503c\u51fd\u6570\u6cd5\u662foff-policy\uff08\u5982DQN\u3001DDPG\u80fd\u91cd\u653e\u7ecf\u9a8c\uff09\uff0c\u6837\u672c\u5229\u7528\u7387\u9ad8\uff0c\u9002\u5408\u6570\u636e\u83b7\u53d6\u4ee3\u4ef7\u5927\u7684\u573a\u666f\u3002\u4f18\u52bf\u7b56\u7565\u6cd5\u5f88\u591a\u662fon-policy\uff08\u5982A2C\u3001PPO\u9700\u8981\u5728\u7ebf\u4ea4\u4e92\u65b0\u6570\u636e\uff09\uff0c\u6837\u672c\u6548\u7387\u76f8\u5bf9\u4f4e\uff0c\u4f46\u6bcf\u6b65\u66f4\u65b0\u66f4\u53ef\u9760\u3002Off-policy\u7684SAC\u3001TD3\u7ed3\u5408\u4e86\u7ecf\u9a8c\u91cd\u7528\u548c\u7b56\u7565\u68af\u5ea6\uff0c\u4e00\u5b9a\u7a0b\u5ea6\u517c\u987e\u4e86\u6548\u7387\u4e0e\u7a33\u5b9a\u3002</li> <li>\u7a33\u5b9a\u6027\u4e0e\u8c03\u53c2\uff1a\u503c\u65b9\u6cd5\u5728\u4f7f\u7528\u51fd\u6570\u903c\u8fd1\u65f6\u53ef\u80fd\u4e0d\u7a33\u5b9a\uff08\u5b58\u5728\u53d1\u6563\u98ce\u9669\uff09\uff0c\u9700\u8981\u7ecf\u9a8c\u56de\u653e\u3001\u76ee\u6807\u7f51\u7edc\u7b49\u6280\u5de7\u7a33\u5b9a\u8bad\u7ec3\u3002\u7b56\u7565\u68af\u5ea6\u6cd5\u56e0\u6709\u57fa\u7ebf\u548c\u4f18\u52bf\uff0c\u68af\u5ea6\u4f30\u8ba1\u66f4\u5e73\u7a33\uff0c\u4f46\u4e5f\u53ef\u80fd\u9762\u4e34\u65b9\u5dee\u5927\u548c\u201c\u9677\u5165\u5c40\u90e8\u6700\u4f18\u7b56\u7565\u201d\u7684\u95ee\u9898\uff0c\u9700\u8981\u901a\u8fc7\u71b5\u6b63\u5219\uff08SAC\uff09\u6216\u63a2\u7d22\u566a\u58f0\u7b49\u6539\u5584\u3002\u603b\u4f53\u800c\u8a00\uff0c\u73b0\u4ee3\u7b97\u6cd5\u5982PPO\u3001SAC\u90fd\u5df2\u975e\u5e38\u7a33\u5b9a\uff0c\u5728\u5404\u81ea\u9886\u57df\u88ab\u5e7f\u6cdb\u91c7\u7528\u3002</li> <li>\u63a2\u7d22\u4e0e\u7a00\u758f\u5956\u52b1\uff1a\u503c\u65b9\u6cd5\u901a\u5e38\u901a\u8fc7\\(\\epsilon\\)-\u8d2a\u5fc3\u6216\u7b56\u7565\u566a\u58f0\u63a2\u7d22\uff0c\u7a00\u758f\u5956\u52b1\u65f6\u80fd\u501f\u52a9\u4ef7\u503c\u4f20\u64ad\u66f4\u5feb\u53d1\u73b0\u9ad8\u5956\u72b6\u6001\uff08\u4f8b\u5982\u4ece\u7ec8\u70b9\u56de\u4f20\u503c\uff09\uff1b\u800c\u4f18\u52bf\u65b9\u6cd5\u82e5\u7b56\u7565\u4e00\u5f00\u59cb\u672a\u91c7\u5230\u5956\u52b1\uff0c\u68af\u5ea6\u53ef\u80fd\u4e3a\u96f6\uff0c\u9700\u914d\u5408\u63a2\u7d22\u7b56\u7565\u6216\u8f85\u52a9\u5956\u52b1\u3002\u5e26\u71b5\u7684SAC\u9f13\u52b1\u63a2\u7d22\uff0c\u90e8\u5206\u7f13\u89e3\u4e86\u8fd9\u4e00\u95ee\u9898\u3002Off-policy\u65b9\u6cd5\u4e5f\u53ef\u53cd\u590d\u5b66\u4e60\u5230\u7684\u4e00\u70b9\u7a00\u758f\u5956\u52b1\u4fe1\u53f7\uff0c\u8fd9\u5bf9\u89e3\u51b3\u7a00\u758f\u5956\u52b1\u4efb\u52a1\u6709\u5229\u3002</li> <li>\u9ad8\u7ef4\u72b6\u6001\uff1a\u4e24\u7c7b\u65b9\u6cd5\u90fd\u4f9d\u8d56\u6df1\u5ea6\u7f51\u7edc\u6765\u8fd1\u4f3c\u4ef7\u503c\u6216\u7b56\u7565\uff0c\u56e0\u6b64\u5728\u9ad8\u7ef4\u89c2\u6d4b\uff08\u5982\u50cf\u7d20\uff09\u4e0b\u90fd\u80fd\u5de5\u4f5c\u3002DQN \u901a\u8fc7CNN \u6210\u529f\u5e94\u7528\u4e8eAtari\u56fe\u50cf\u8f93\u5165\uff0cA3C\u4e5f\u7c7b\u4f3c\u3002\u4f46\u9ad8\u7ef4\u79bb\u6563\u52a8\u4f5c\u60c5\u51b5\u4e0b\uff0c\u503c\u65b9\u6cd5\u53ef\u80fd\u9762\u4e34\u8f93\u51fa\u7ef4\u6570\u8fc7\u5927\u7684\u95ee\u9898\uff08\u6bcf\u4e2a\u52a8\u4f5c\u4e00\u4e2aQ\u503c\uff09\uff1b\u7b56\u7565\u68af\u5ea6\u53ef\u53c2\u6570\u5316\u4e3a\u52a8\u4f5c\u6982\u7387\u5206\u5e03\uff0c\u8f83\u4e3a\u81ea\u7136\u3002\u56e0\u6b64\u5728\u5de8\u5927\u7684\u79bb\u6563\u52a8\u4f5c\u7a7a\u95f4\u6216\u7ec4\u5408\u52a8\u4f5c\u573a\u666f\uff0c\u7b56\u7565\u4f18\u5316\u53ef\u80fd\u66f4\u5408\u9002\u3002</li> </ul> <p>\u4efb\u52a1\u9002\u7528\u6027\u603b\u7ed3\uff08\u89c1\u4e0b\u8868\uff09\uff1a</p> \u7b97\u6cd5 \u4ef7\u503c\u51fd\u6570\u4f7f\u7528 \u4f18\u52bf\u51fd\u6570\u4f7f\u7528\u53ca\u4f30\u8ba1 \u7b56\u7565\u6027\u8d28 \u52a8\u4f5c\u7a7a\u95f4 \u5178\u578b\u5e94\u7528\u573a\u666f\u53ca\u7279\u70b9 DQN \u5b66\u4e60\\(Q(s,a)\\) \u65e0\u663e\u5f0f\u4f18\u52bf\uff08\u51b3\u6597DQN\u62c6\u5206\\(A\\)\uff09 \u6d3e\u751f\u8d2a\u5fc3\u7b56\u7565 \u79bb\u6563 Atari\u6e38\u620f\uff08\u50cf\u7d20\u8f93\u5165\uff09\u7b49\u79bb\u6563\u52a8\u4f5c\uff0c\u9ad8\u6837\u672c\u6548\u7387\uff0c\u9700\u7a33\u5b9a\u6280\u5de7 DDPG \u5b66\u4e60\\(Q(s,a)\\)(2\u7f51\u7edc) \u65e0\u663e\u5f0f\\(A\\)\uff0c\u7528\\(Q\\)\u68af\u5ea6\u4f5c\u7b56\u7565\u4fe1\u53f7 \u786e\u5b9a\u6027\u7b56\u7565 \u8fde\u7eed \u673a\u68b0\u81c2\u63a7\u5236\u7b49\u8fde\u7eed\u4efb\u52a1\uff0c\u6837\u672c\u6548\u7387\u9ad8\uff0c\u4f46\u63a2\u7d22\u56f0\u96be\uff0c\u9700\u566a\u58f0 TD3 \u5b66\u4e60\\(Q_1,Q_2\\) \u65e0\u663e\u5f0f\\(A\\)\uff0c\u53ccQ\u51cf\u5c11\u4f30\u8ba1\u504f\u5dee \u786e\u5b9a\u6027\u7b56\u7565 \u8fde\u7eed \u8fde\u7eed\u63a7\u5236\uff0c\u9ad8\u7cbe\u5ea6\u52a8\u4f5c\uff0c\u89e3\u51b3DDPG\u8fc7\u4f30\u8ba1\uff0c\u8bad\u7ec3\u66f4\u7a33\u5b9a SAC \u5b66\u4e60\\(Q_1,Q_2\\)\uff08\u71b5\u4fee\u6b63\uff09 \u65e0\u663e\u5f0f\\(A\\)\uff0c\u542b\u71b5\u9879\u7684soft Q\u4f5c\u4e3a\u4f18\u52bf\u4f9d\u636e \u968f\u673a\u7b56\u7565 \u8fde\u7eed \u8fde\u7eed\u63a7\u5236\uff08\u5982\u673a\u5668\u4eba\u3001\u81ea\u52a8\u9a7e\u9a76\uff09\uff0c\u7a33\u5b9a\u6027\u9ad8\uff0c\u63a2\u7d22\u5f3a REINF. \u65e0\uff08\u4ec5\u7b56\u7565\uff09 \\(A=R_t - b(s)\\)\uff0c\u901a\u5e38\\(b=0\\)\u6216\\(V(s)\\) \u968f\u673a\u7b56\u7565 \u4efb\u610f \u7406\u8bba\u7b97\u6cd5\uff0c\u5b9e\u8df5\u5c11\u76f4\u63a5\u7528\uff0c\u9ad8\u65b9\u5dee\uff0c\u9700baseline\uff0c\u7b80\u5355\u6e05\u6670 A2C/A3C \u5b66\u4e60\\(V(s)\\) \\(\\hat{A}\\)=n\u6b65TD\u8bef\u5dee \u968f\u673a\u7b56\u7565 \u79bb\u6563/\u8fde\u7eed \u6e38\u620fAI\uff08Atari\uff09\u3001\u5e76\u884c\u73af\u5883\u4e0b\u8bad\u7ec3\uff0c\u9ad8\u6548\u5229\u7528\u4f18\u52bf\u964d\u4f4e\u65b9\u5dee PPO \u5b66\u4e60\\(V(s)\\) \\(\\hat{A}\\)=GAE(\\(\\lambda\\)) \u968f\u673a\u7b56\u7565 \u79bb\u6563/\u8fde\u7eed \u901a\u7528\u7b97\u6cd5\uff0c\u673a\u5668\u4eba\u6a21\u62df\u3001\u9ad8\u7ef4\u63a7\u5236\uff0c\u8bad\u7ec3\u7a33\u5065\uff0c\u5de5\u4e1a\u754c\u5e38\u7528 TRPO \u5b66\u4e60\\(V(s)\\) \\(\\hat{A}\\)=GAE(\\(\\lambda\\)) \u7b49 \u968f\u673a\u7b56\u7565 \u79bb\u6563/\u8fde\u7eed \u7406\u8bba\u4fdd\u969c\u6536\u655b\uff0c\u5b9e\u73b0\u590d\u6742\uff0c\u8f83\u5c11\u7528\u4e86\uff08PPO\u66ff\u4ee3\uff09\uff0c\u65e9\u671f\u673a\u5668\u4ebaRL <p>\u8868\uff1a\u4e3b\u6d41\u7b97\u6cd5\u4e2d\u4ef7\u503c\u51fd\u6570\u4e0e\u4f18\u52bf\u51fd\u6570\u7684\u4f7f\u7528\u6bd4\u8f83\u53ca\u9002\u7528\u6027\u6982\u89c8\u3002</p> <p>\u4ece\u4e0a\u8868\u53ef\u4ee5\u770b\u51fa\uff0c\u503c\u51fd\u6570\u6cd5\uff08DQN\u7cfb\u5217\u3001DDPG/TD3\uff09\u504f\u597d\u79bb\u7b56\u7565\u3001\u9ad8\u6548\u5229\u7528\u6570\u636e\uff0c\u9002\u5408\u8fde\u7eed\u63a7\u5236\uff08DDPG/TD3\uff09\u6216\u590d\u6742\u79bb\u6563\uff08DQN\uff09\u4f46\u52a8\u4f5c\u6709\u9650\u7684\u573a\u666f\uff1b\u4f18\u52bf\u7b56\u7565\u6cd5\uff08A2C/PPO\u7b49\uff09\u63d0\u4f9b\u7a33\u5b9a\u7684\u7b56\u7565\u6539\u8fdb\uff0c\u5728\u9ad8\u7ef4\u8fde\u7eed\u63a7\u5236\u548c\u9700\u8981\u7a33\u5b9a\u8bad\u7ec3\u7684\u4efb\u52a1\u4e2d\u8868\u73b0\u7a81\u51fa\u3002\u5b9e\u9645\u5e94\u7528\u4e2d\u5e38\u5c06\u4e8c\u8005\u7ed3\u5408\uff1a\u4f8b\u5982\uff0c\u5148\u7528off-policy\u65b9\u6cd5\u9884\u8bad\u7ec3\u503c\u51fd\u6570\uff0c\u518d\u7528on-policy\u5fae\u8c03\u7b56\u7565\uff1b\u6216\u8005\u5728\u590d\u6742\u73af\u5883\u4e2d\u9009\u7528PPO\u4fdd\u8bc1\u6536\u655b\uff0c\u518d\u7528SAC\u63d0\u5347\u6027\u80fd\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"posts/%E8%9E%8D%E6%B1%87%E8%B4%AF%E9%80%9ARL%E4%B8%AD%E7%9A%84%E4%BB%B7%E5%80%BC%E5%87%BD%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8A%BF%E5%87%BD%E6%95%B0/#_4","title":"\u7ed3\u8bba","text":"<p>\u4ef7\u503c\u51fd\u6570\u548c\u4f18\u52bf\u51fd\u6570\u662f\u5f3a\u5316\u5b66\u4e60\u7b97\u6cd5\u4e2d\u7684\u4e24\u4e2a\u6838\u5fc3\u6982\u5ff5\uff0c\u4e0d\u540c\u7b97\u6cd5\u56f4\u7ed5\u5b83\u4eec\u53d1\u5c55\u51fa\u4e0d\u540c\u7684\u5b66\u4e60\u8303\u5f0f\u3002\u503c\u51fd\u6570\u65b9\u6cd5\u901a\u8fc7\u8fd1\u4f3c\u6700\u4f18\u503c\u51fd\u6570\u6765\u95f4\u63a5\u83b7\u53d6\u7b56\u7565\uff0c\u5f3a\u8c03\u4ef7\u503c\u8bc4\u4f30\uff0c\u9002\u5408\u5229\u7528\u4e30\u5bcc\u7ecf\u9a8c\u5e76\u5904\u7406\u67d0\u4e9b\u9ad8\u7ef4\u89c2\u6d4b\u95ee\u9898\uff0c\u4f46\u5728\u8fde\u7eed\u52a8\u4f5c\u4e0a\u9700\u8981\u6269\u5c55\u3002\u4f18\u52bf\u65b9\u6cd5\u76f4\u63a5\u4f18\u5316\u7b56\u7565\uff0c\u5229\u7528\u76f8\u5bf9\u4ef7\u503c\u4fe1\u53f7\uff08\u4f18\u52bf\uff09\u6307\u5bfc\u66f4\u65b0\uff0c\u5177\u6709\u68af\u5ea6\u660e\u786e\u3001\u6613\u5904\u7406\u8fde\u7eed\u52a8\u4f5c\u7b49\u4f18\u70b9\uff0c\u4f46\u901a\u5e38\u9700\u8981\u66f4\u591a\u6837\u672c\u652f\u6301\u3002\u73b0\u4ee3Actor-Critic\u7b97\u6cd5\u878d\u5408\u4e86\u4ef7\u503c\u8bc4\u4f30\u4e0e\u7b56\u7565\u4f18\u5316\uff0c\u4f18\u52bf\u51fd\u6570\u5728\u5176\u4e2d\u626e\u6f14\u627f\u4e0a\u542f\u4e0b\u7684\u89d2\u8272\u2014\u2014\u7531Critic\u63d0\u4f9b\u3001\u4e3aActor\u6240\u7528\uff0c\u4f7f\u5f97\u9ad8\u6548\u4e14\u7a33\u5b9a\u7684\u7b56\u7565\u5b66\u4e60\u6210\u4e3a\u53ef\u80fd\u3002\u901a\u8fc7\u5bf9\u6bd4DQN\u3001DDPG\u3001A2C\u3001PPO\u3001TRPO\u3001SAC\u3001TD3\u3001REINFORCE\u7b49\u7b97\u6cd5\uff0c\u53ef\u4ee5\u770b\u5230\uff1a\u6bcf\u79cd\u7b97\u6cd5\u5bf9\u4ef7\u503c\u51fd\u6570\u548c\u4f18\u52bf\u51fd\u6570\u7684\u4f7f\u7528\u90fd\u6709\u7cbe\u5de7\u7684\u8bbe\u8ba1\uff0c\u4eceQ\u5b66\u4e60\u7684Bellman\u66f4\u65b0\u5230PPO\u7684\u526a\u8f91\u4f18\u52bf\u68af\u5ea6\uff0c\u65e0\u4e0d\u4f53\u73b0\u4e86\u5bf9\u7a33\u5b9a\u6027\u4e0e\u6548\u7387\u7684\u6743\u8861\u3002</p> <p>\u5728\u66f4\u590d\u6742\u7684\u73af\u5883\u4e2d\uff0c\u5982\u4f55\u81ea\u9002\u5e94\u5730\u9009\u62e9\u548c\u878d\u5408\u4f18\u52bf\u4f30\u8ba1\u65b9\u6cd5\u3001\u63d0\u5347\u503c\u51fd\u6570\u548c\u7b56\u7565\u5b66\u4e60\u7684\u534f\u540c\uff0c\u4ecd\u662f\u5f3a\u5316\u5b66\u4e60\u7814\u7a76\u7684\u91cd\u8981\u8bfe\u9898\u3002\u901a\u8fc7\u6df1\u5165\u7406\u89e3\u4ef7\u503c\u51fd\u6570\u4e0e\u4f18\u52bf\u51fd\u6570\u7684\u4f5c\u7528\u673a\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u66f4\u597d\u5730\u9009\u62e9\u9002\u5408\u7684\u7b97\u6cd5\u5e76\u9488\u5bf9\u4e0d\u540c\u4efb\u52a1\u8fdb\u884c\u6539\u8fdb\uff0c\u4ece\u800c\u8bad\u7ec3\u51fa\u66f4\u9ad8\u6548\u3001\u9c81\u68d2\u7684\u667a\u80fd\u4f53\u3002</p>","tags":["\u5f3a\u5316\u5b66\u4e60"]},{"location":"projects/","title":"Projects","text":""},{"location":"projects/#_1","title":"\u9879\u76ee\u5408\u96c6","text":"<p>\u8fd9\u91cc\u5c06\u9646\u7eed\u4ecb\u7ecd\u6211\u4e00\u4e9b\u6709\u610f\u601d\u7684\u9879\u76ee\u3002</p>"},{"location":"projects/#_2","title":"\ud83d\udd16 \u9879\u76ee\u5217\u8868","text":"<ul> <li>YTracing\uff1a\u50cf\u6253\u5370\u65e5\u5fd7\u4e00\u6837\uff0c\u4f18\u96c5\u5b9e\u73b0C++\u4e8b\u4ef6\u8ffd\u8e2a\u4e0e\u6027\u80fd\u5206\u6790</li> </ul>"},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/","title":"YTracing\uff1a\u50cf\u6253\u5370\u65e5\u5fd7\u4e00\u6837\uff0c\u4f18\u96c5\u5b9e\u73b0C++\u4e8b\u4ef6\u8ffd\u8e2a\u4e0e\u6027\u80fd\u5206\u6790","text":""},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#_1","title":"\u5f15\u8a00","text":"<p>\u4f60\u662f\u5426\u66fe\u4e3a\u4f18\u5316 C++ \u7a0b\u5e8f\u7684\u6027\u80fd\u800c\u70e6\u607c\uff1f\u9762\u5bf9\u590d\u6742\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u5e38\u5e38\u96be\u4ee5\u786e\u5b9a\u6027\u80fd\u74f6\u9888\u7a76\u7adf\u5728\u4f55\u5904\u3002\u201c\u662f\u8fd9\u4e2a\u51fd\u6570\u592a\u6162\uff0c\u8fd8\u662f\u90a3\u4e2a\u5faa\u73af\u8017\u65f6\u592a\u4e45\uff1f\u201d \u4e3a\u4e86\u56de\u7b54\u8fd9\u4e9b\u95ee\u9898\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u6c42\u52a9\u4e8e\u91cd\u91cf\u7ea7\u7684\u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u4f46\u5b83\u4eec\u5f80\u5f80\u914d\u7f6e\u590d\u6742\uff0c\u4f7f\u7528\u95e8\u69db\u9ad8\u3002</p> <p>\u4eca\u5929\uff0c\u6211\u5411\u5927\u5bb6\u4ecb\u7ecd\u4e00\u4e2a\u6211\u5f00\u53d1\u7684\u5f00\u6e90\u9879\u76ee\u2014\u2014YTracing\u3002\u5b83\u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684 C++ \u4e8b\u4ef6\u8ddf\u8e2a\u5e93\uff0c\u65e8\u5728\u8ba9\u4f60\u50cf\u6253\u5370\u65e5\u5fd7\u4e00\u6837\uff0c\u8f7b\u677e\u5730\u4e3a\u4ee3\u7801\u6dfb\u52a0\u6027\u80fd\u201c\u63a2\u9488\u201d\uff0c\u5e76\u901a\u8fc7\u73b0\u4ee3\u5316\u7684\u524d\u7aef\u5de5\u5177\u76f4\u89c2\u5730\u5206\u6790\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u5e8f\u3002</p> <p>GitHub \u4ed3\u5e93\u94fe\u63a5: <code>https://github.com/zhangxiaochuan/YTracing</code></p>"},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#ytracing","title":"YTracing \u7684\u6838\u5fc3\u7406\u5ff5\uff1a\u4f4e\u4fb5\u5165\uff0c\u4f4e\u5f00\u9500\uff0c\u53ef\u63d2\u62d4","text":"<p>YTracing \u7684\u8bbe\u8ba1\u54f2\u5b66\u662f\u5c3d\u53ef\u80fd\u5730\u51cf\u5c11\u5bf9\u4e1a\u52a1\u4ee3\u7801\u7684\u201c\u4fb5\u5165\u6027\u201d\uff0c\u5e76\u628a\u5bf9\u7a0b\u5e8f\u6027\u80fd\u7684\u5f71\u54cd\u964d\u5230\u6700\u4f4e\u3002</p> <p>\u5b83\u662f\u5982\u4f55\u505a\u5230\u7684\u5462\uff1f\u7b54\u6848\u662f C++ \u5f00\u53d1\u8005\u90fd\u975e\u5e38\u719f\u6089\u7684\u6280\u672f\uff1aRAII (\u8d44\u6e90\u83b7\u53d6\u5373\u521d\u59cb\u5316)\u3002</p> <p>\u6211\u4eec\u901a\u8fc7\u4e24\u4e2a\u7b80\u5355\u7684\u5b8f\u6765\u4f7f\u7528 YTracing\uff1a</p> <ul> <li><code>YTRACING_FUNCTION()</code>: \u5728\u4e00\u4e2a\u51fd\u6570\u4f53\u7684\u5f00\u59cb\u5904\u8c03\u7528\uff0c\u5b83\u4f1a\u81ea\u52a8\u8bb0\u5f55\u4ece\u51fd\u6570\u5f00\u59cb\u5230\u7ed3\u675f\u7684\u6574\u4e2a\u65f6\u95f4\u8de8\u5ea6\u3002</li> <li><code>YTRACING_SCOPE(\"Some Custom Block\")</code>: \u7528\u4e8e\u7cbe\u786e\u6d4b\u91cf\u4e00\u4e2a\u7279\u5b9a\u4ee3\u7801\u5757\u7684\u6267\u884c\u65f6\u95f4\u3002</li> </ul> <p>\u5f53\u4f60\u5c06\u8fd9\u4e9b\u5b8f\u653e\u5165\u4ee3\u7801\u4e2d\u65f6\uff0c\u4e00\u4e2a <code>AutoTracer</code> \u5bf9\u8c61\u4f1a\u88ab\u521b\u5efa\u3002 \u5b83\u7684\u6784\u9020\u51fd\u6570\u4f1a\u8bb0\u5f55\u201c\u5f00\u59cb\u201d\u4e8b\u4ef6\uff0c\u800c\u6790\u6784\u51fd\u6570\uff08\u5728\u4f5c\u7528\u57df\u7ed3\u675f\u65f6\u81ea\u52a8\u8c03\u7528\uff09\u5219\u8bb0\u5f55\u201c\u7ed3\u675f\u201d\u4e8b\u4ef6\u3002</p> <p>\u6240\u6709\u7684\u4e8b\u4ef6\u6570\u636e\u90fd\u7531\u4e00\u4e2a\u5168\u5c40\u7684 <code>Collector</code> \u5355\u4f8b\u8fdb\u884c\u6536\u96c6\u3002<code>Collector</code> \u5728\u4e00\u4e2a\u72ec\u7acb\u7684\u540e\u53f0\u7ebf\u7a0b\u4e2d\u8fd0\u884c\uff0c\u5b9a\u671f\u5c06\u6536\u96c6\u5230\u7684\u4e8b\u4ef6\u6279\u91cf\u5199\u5165\u78c1\u76d8\u3002 \u8fd9\u79cd\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u5f0f\u786e\u4fdd\u4e86\u5728\u4f60\u7684\u4e3b\u4e1a\u52a1\u7ebf\u7a0b\u4e2d\uff0c\u8bb0\u5f55\u4e8b\u4ef6\u7684\u64cd\u4f5c\u51e0\u4e4e\u662f\u77ac\u65f6\u7684\uff0c\u6027\u80fd\u5f00\u9500\u6781\u5c0f\u3002</p>"},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#_2","title":"\u5173\u952e\u7279\u6027\uff1a\u96f6\u6210\u672c\u7684\u6761\u4ef6\u7f16\u8bd1","text":"<p>\u6211\u4eec\u6df1\u77e5\uff0c\u8ffd\u8e2a\u529f\u80fd\u5e76\u975e\u5728\u6240\u6709\u65f6\u5019\u90fd\u9700\u8981\u5f00\u542f\u3002\u5728\u53d1\u5e03 Release \u7248\u672c\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u65f6\uff0c\u4efb\u4f55\u5fae\u5c0f\u7684\u989d\u5916\u5f00\u9500\u90fd\u5e94\u8be5\u88ab\u6d88\u9664\u3002</p> <p>YTracing \u901a\u8fc7\u4e00\u4e2a\u7f16\u8bd1\u5b8f <code>TRACING</code> \u6765\u5b8c\u7f8e\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <ul> <li>\u5f53 <code>TRACING</code> \u5b8f\u88ab\u5b9a\u4e49\u65f6 (\u4f8b\u5982 <code>TRACING=1</code>)\uff0c<code>YTRACING_FUNCTION()</code> \u548c <code>YTRACING_SCOPE()</code> \u4f1a\u88ab\u6b63\u5e38\u5c55\u5f00\uff0c\u8ffd\u8e2a\u529f\u80fd\u88ab\u6fc0\u6d3b\u3002</li> <li>\u5f53 <code>TRACING</code> \u5b8f\u672a\u5b9a\u4e49\u65f6\uff0c\u8fd9\u4e9b\u57cb\u70b9\u5b8f\u4f1a\u9000\u5316\u4e3a\u4e00\u6761\u65e0\u64cd\u4f5c\u7684\u7a7a\u8bed\u53e5 <code>(void)0</code>\u3002</li> </ul> <p>\u8fd9\u610f\u5473\u7740\uff0c\u5728\u4f60\u7684\u53d1\u5e03\u7248\u672c\u4e2d\uff0c\u6240\u6709\u4e0e YTracing \u76f8\u5173\u7684\u4ee3\u7801\u90fd\u4f1a\u88ab\u7f16\u8bd1\u5668\u5f7b\u5e95\u4f18\u5316\u6389\uff0c\u4e0d\u4f1a\u4ea7\u751f\u4efb\u4f55\u989d\u5916\u7684\u6027\u80fd\u5f00\u9500\uff0c\u4e5f\u4e0d\u4f1a\u5f15\u5165\u4efb\u4f55\u8fd0\u884c\u65f6\u4f9d\u8d56\u3002\u4f60\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u4f1a\u50cf\u4ece\u672a\u6dfb\u52a0\u8fc7\u8ffd\u8e2a\u4ee3\u7801\u4e00\u6837\u7eaf\u51c0\u3002</p>"},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#_3","title":"\u5feb\u901f\u4e0a\u624b\u6307\u5357","text":""},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#_4","title":"\u5b89\u88c5","text":""},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#apt","title":"\u65b9\u5f0f\u4e00\uff1a\u901a\u8fc7 apt \u5b89\u88c5","text":"<ol> <li>\u6dfb\u52a0 PPA \u4ed3\u5e93\uff1a <pre><code>sudo add-apt-repository ppa:xiaochuanzhang/ytracing\nsudo apt update\n````\n\n2. \u5b89\u88c5\u5f00\u53d1\u5305\uff08\u5305\u542b\u5934\u6587\u4ef6\u548c\u5e93\u6587\u4ef6\uff09\uff1a\n\n```bash\nsudo apt install libytracing-dev\n</code></pre></li> </ol>"},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#_5","title":"\u65b9\u5f0f\u4e8c\uff1a\u901a\u8fc7\u6e90\u7801\u7f16\u8bd1","text":"<ol> <li>\u514b\u9686\u9879\u76ee\uff1a</li> </ol> <pre><code>git clone https://github.com/zhangxiaochuan/YTracing.git\ncd YTracing\n</code></pre> <ol> <li>\u7f16\u8bd1\u5e76\u5b89\u88c5\uff1a</li> </ol> <pre><code>mkdir build &amp;&amp; cd build\ncmake ..\nmake -j$(nproc)\nsudo make install\n</code></pre>"},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#_6","title":"\u4f7f\u7528","text":""},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#_7","title":"\u542f\u7528\u8ffd\u8e2a\u529f\u80fd","text":"<p>\u5728\u4ee3\u7801\u4e2d\u5f15\u5165\u5934\u6587\u4ef6\uff0c\u5e76\u4f7f\u7528\u4ee5\u4e0b\u4e24\u79cd\u65b9\u6cd5\u8bb0\u5f55\u8ffd\u8e2a\u4fe1\u606f\uff1a</p> <p></p><pre><code>#include &lt;YTracing/YTracing.h&gt;\n\nvoid my_function() {\n    // \u65b9\u6cd5\u4e00\uff1aYTRACING_FUNCTION\n    // \u8bb0\u5f55\u6574\u4e2a\u51fd\u6570\u7684\u6267\u884c\u65f6\u95f4\uff08\u4f5c\u7528\u57df\u662f\u6574\u4e2a\u51fd\u6570\uff09\n    YTRACING_FUNCTION();\n\n    // \u6a21\u62df\u4ee3\u7801\u6267\u884c\n    for (int i = 0; i &lt; 1000000; ++i) {}\n\n    {\n        // \u65b9\u6cd5\u4e8c\uff1aYTRACING_SCOPE(\"Custom Scope Name\")\n        // \u8bb0\u5f55\u4e00\u4e2a\u81ea\u5b9a\u4e49\u4ee3\u7801\u5757\u7684\u6267\u884c\u65f6\u95f4\uff08\u4f5c\u7528\u57df\u4ec5\u9650\u4e8e\u82b1\u62ec\u53f7\u5185\uff09\n        YTRACING_SCOPE(\"Inner Loop Work\");\n\n        for (int j = 0; j &lt; 500000; ++j) {}\n    }\n}\n</code></pre> \u533a\u522b\u8bf4\u660e\uff1a<p></p> <ul> <li>YTRACING_FUNCTION()\uff1a\u81ea\u52a8\u4ee5\u51fd\u6570\u540d\u4f5c\u4e3a\u4e8b\u4ef6\u540d\u79f0\uff0c\u8ffd\u8e2a\u6574\u4e2a\u51fd\u6570\u7684\u6267\u884c\u8017\u65f6\u3002</li> <li>YTRACING_SCOPE(\"Name\")\uff1a\u4ee5\u81ea\u5b9a\u4e49\u540d\u79f0\u8ffd\u8e2a\u7279\u5b9a\u4ee3\u7801\u5757\u7684\u6267\u884c\u8017\u65f6\uff0c\u9002\u5408\u51fd\u6570\u5185\u90e8\u7684\u5c40\u90e8\u6027\u80fd\u5206\u6790\u3002</li> </ul> <p>\u5728 <code>CMakeLists.txt</code> \u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u5b9a\u4e49\u4ee5\u542f\u7528\u8ffd\u8e2a\uff0c\u5e76\u94fe\u63a5YTracing\u5e93\uff1a</p> <pre><code>add_definitions(-DTRACING=1) # \u542f\u7528\u8ffd\u8e2a\u529f\u80fd\uff0c\u53bb\u6389\u8fd9\u884c\u5373\u53ef\u5173\u95ed\u8ffd\u8e2a\u529f\u80fd\n\nfind_package(ytracing REQUIRED)\ntarget_link_libraries(your_target PRIVATE YTracing::YTracingCore)\n</code></pre>"},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#yviewer","title":"\u4f7f\u7528 YViewer \u8fdb\u884c\u8ffd\u8e2a\u53ef\u89c6\u5316","text":"<p>\u4e3a\u65b9\u4fbf\u5bf9\u8ddf\u8e2a\u6570\u636e\u8fdb\u884c\u76f4\u89c2\u5206\u6790\uff0cYTracing \u63d0\u4f9b\u4e86 <code>YViewer</code> \u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5e2e\u52a9\u4f60\u53ef\u89c6\u5316\u8ddf\u8e2a\u7ed3\u679c\uff1a</p> <ol> <li>\u5b8c\u6210\u7f16\u8bd1\u4e4b\u540e\uff0c\u53ef\u4ee5\u6267\u884c\u76ee\u6807\u7a0b\u5e8f\uff0c\u5e76\u5728\u5de5\u4f5c\u76ee\u5f55\u4e0b\u751f\u6210tracing_YYYYMMDD_HHMMSS\u6587\u4ef6\u5939\uff0c\u5176\u4e2d\u5305\u62ec<code>.raw</code>\u683c\u5f0f\u7684\u539f\u59cb\u8ffd\u8e2a\u6570\u636e\u3002</li> <li> <p>\u4f7f\u7528YViewer\u5c06\u539f\u59cb <code>.raw</code> \u6587\u4ef6\u8f6c\u4e3a Perfetto \u683c\u5f0f <code>YViewer</code> \u4f1a\u5c06\u7531 YTracing \u751f\u6210\u7684 <code>.raw</code> \u8ddf\u8e2a\u6570\u636e\u8f6c\u6362\u4e3a\u53ef\u517c\u5bb9 Perfetto \u7684 <code>trace.json</code> \u683c\u5f0f\u3002</p> </li> <li> <p>\u5728 Perfetto UI \u4e2d\u67e5\u770b\u4e0e\u5206\u6790    \u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00 Perfetto Web UI\uff0c\u52a0\u8f7d\u751f\u6210\u7684 <code>trace.json</code> \u540e\uff0c\u4f60\u53ef\u4ee5\uff1a</p> <ul> <li>\u67e5\u770b\u51fd\u6570\u8c03\u7528\u4e0e\u4f5c\u7528\u57df\u5d4c\u5957\u5173\u7cfb\u53ca\u5176\u8017\u65f6\u60c5\u51b5\uff1b</li> <li>\u901a\u8fc7\u7f29\u653e\u3001\u5e73\u79fb\u3001\u540d\u79f0\u6216\u65f6\u95f4\u8fc7\u6ee4\u7b49\u64cd\u4f5c\uff0c\u7cbe\u51c6\u5b9a\u4f4d\u611f\u5174\u8da3\u7684\u90e8\u5206\uff1b</li> <li>\u5728\u53ef\u89c6\u5316\u65f6\u95f4\u7ebf\u754c\u9762\u4e2d\u5206\u6790\u5e76\u53d1\u6267\u884c\u3001\u7ebf\u7a0b\u6d3b\u52a8\u4e0e\u51fd\u6570\u6267\u884c\u65f6\u5e8f\u7b49\u3002</li> </ul> </li> <li> <p>\u63a8\u8350\u4f7f\u7528\u6d41\u7a0b</p> </li> </ol> <pre><code># 1. \u8fd0\u884c\u5df2\u63d2\u6869\u7684\u7a0b\u5e8f\uff1a\n./your_target\n# \u6b64\u64cd\u4f5c\u4f1a\u751f\u6210\u4e00\u4e2a\u5305\u542b .raw \u6587\u4ef6\u7684 tracing_YYYYMMDD_HHMMSS \u76ee\u5f55\u3002\n\n# 2. \u5c06\u8ddf\u8e2a\u6570\u636e\u8f6c\u6362\u4e3a JSON\uff1a\nYViewer tracing_YYYYMMDD_HHMMSS/\n# \u5c06\u5728tracing_YYYYMMDD_HHMMSS\u76ee\u5f55\u4e0b\u5c06\u751f\u6210 trace.json \u6587\u4ef6\u3002\n\n# 3. \u6253\u5f00\u5e76\u53ef\u89c6\u5316\uff1a\n\u6d4f\u89c8\u5668\u6253\u5f00 [Perfetto UI](https://ui.perfetto.dev) \u2192 \u70b9\u51fb \u201cOpen trace file\u201d \u2192 \u9009\u62e9 `trace.json`\u3002\n</code></pre> <p></p>"},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#faq","title":"\u5e38\u89c1\u95ee\u9898\u6392\u67e5 (FAQ)","text":"<p>Q1: \u96c6\u6210\u540e\u6ca1\u6709\u4efb\u4f55\u8ffd\u8e2a\u6570\u636e\u751f\u6210\uff0c\u8be5\u5982\u4f55\u6392\u67e5\uff1f</p> <p>A: \u8bf7\u6309\u4ee5\u4e0b\u6b65\u9aa4\u68c0\u67e5\uff1a</p> <ol> <li>\u662f\u5426\u5df2\u542f\u7528\u8ffd\u8e2a\u5b8f\uff1f \u786e\u4fdd\u4f60\u7684\u9876\u5c42 <code>CMakeLists.txt</code> \u4e2d\u5b9a\u4e49\u4e86 <code>TRACING=1</code> \u5b8f\u3002\u5982\u679c\u6ca1\u6709\u5b9a\u4e49\uff0c\u6240\u6709\u57cb\u70b9\u90fd\u4f1a\u5931\u6548\u3002</li> <li>\u4ee3\u7801\u8def\u5f84\u662f\u5426\u88ab\u6267\u884c\uff1f \u786e\u8ba4\u5e26\u6709 <code>YTRACING_...</code> \u5b8f\u7684\u4ee3\u7801\u5757\u786e\u5b9e\u5728\u4f60\u7684\u6d4b\u8bd5\u7528\u4f8b\u4e2d\u88ab\u6267\u884c\u4e86\u3002</li> <li>\u8fd0\u884c\u76ee\u5f55\u662f\u5426\u53ef\u5199\uff1f YTracing \u9700\u8981\u5728\u7a0b\u5e8f\u8fd0\u884c\u7684\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa <code>tracing_...</code> \u76ee\u5f55\u3002\u8bf7\u68c0\u67e5\u7a0b\u5e8f\u662f\u5426\u5177\u6709\u8db3\u591f\u7684\u5199\u6743\u9650\uff0c\u4ee5\u53ca\u7ec8\u7aef\u662f\u5426\u6709\u76ee\u5f55\u521b\u5efa\u6210\u529f\u6216\u5931\u8d25\u7684\u63d0\u793a\u3002</li> </ol> <p>Q2: \u5728\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u4e2d\u4f7f\u7528 YTracing \u9700\u8981\u989d\u5916\u8bbe\u7f6e\u5417\uff1f</p> <p>A: \u5b8c\u5168\u4e0d\u9700\u8981\u3002 YTracing \u5728\u8bbe\u8ba1\u4e0a\u5c31\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</p> <ul> <li><code>Collector</code> \u5185\u90e8\u4f7f\u7528 <code>std::mutex</code> \u6765\u4fdd\u62a4\u6570\u636e\u6536\u96c6\u8fc7\u7a0b\uff0c\u4f60\u53ef\u4ee5\u5728\u4efb\u610f\u7ebf\u7a0b\u4e2d\u76f4\u63a5\u4f7f\u7528 <code>YTRACING_...</code> \u5b8f\uff0c\u65e0\u9700\u4efb\u4f55\u7279\u6b8a\u4ee3\u7801\u3002</li> <li>Pro-tip: \u4e3a\u4e86\u5728 Perfetto UI \u4e2d\u66f4\u597d\u5730\u533a\u5206\u548c\u5206\u6790\u5e76\u53d1\u5173\u7cfb\uff0c\u5efa\u8bae\u4e3a\u4f60\u7684\u8ffd\u8e2a\u4e8b\u4ef6\u91c7\u7528\u4e00\u5957\u7edf\u4e00\u7684\u547d\u540d\u89c4\u8303\uff0c\u4f8b\u5982 <code>phase:stage:detail</code>\uff08\u5982 <code>rendering:shadow_pass:compute_shader</code>\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u66f4\u6e05\u6670\u5730\u770b\u51fa\u4e0d\u540c\u7ebf\u7a0b\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\u9636\u6bb5\u3002</li> </ul> <p>Q3: \u5982\u4f55\u5c06 YTracing \u7684\u8f6c\u6362\u6d41\u7a0b\u63a5\u5165\u5230 CI/CD \u4e2d\uff1f</p> <p>A: YTracing \u975e\u5e38\u9002\u5408\u7528\u4e8e CI/CD \u6d41\u7a0b\u4e2d\u7684\u6027\u80fd\u56de\u5f52\u6d4b\u8bd5\u3002</p> <ol> <li>\u4ea7\u51fa\u539f\u59cb\u6570\u636e: \u5728\u4f60\u7684 CI \u4f5c\u4e1a\u4e2d\uff0c\u7f16\u8bd1\u5e76\u8fd0\u884c\u4f60\u7684\u6d4b\u8bd5\u7528\u4f8b\u3002\u786e\u4fdd\u6d4b\u8bd5\u80fd\u89e6\u53d1\u5173\u952e\u7684\u4ee3\u7801\u8def\u5f84\uff0c\u4ece\u800c\u751f\u6210\u5305\u542b\u8ddf\u8e2a\u6570\u636e\u7684 <code>.raw</code> \u6587\u4ef6\u3002</li> <li>\u8f6c\u6362\u5e76\u5f52\u6863: \u5728\u540e\u7eed\u6b65\u9aa4\u4e2d\uff0c\u7f16\u8bd1 <code>YViewer</code> \u5de5\u5177\uff0c\u7528\u5b83\u5c06\u4e0a\u4e00\u6b65\u751f\u6210\u7684 <code>tracing_...</code> \u76ee\u5f55\u6279\u91cf\u8f6c\u6362\u4e3a <code>trace.json</code> \u6587\u4ef6\u3002</li> <li>\u4e0a\u4f20\u5de5\u4ef6: \u5c06\u751f\u6210\u7684 <code>trace.json</code> \u4f5c\u4e3a CI/CD \u4f5c\u4e1a\u7684\u5de5\u4ef6 (Artifact) \u4e0a\u4f20\u3002\u8fd9\u6837\uff0c\u6bcf\u6b21\u4ee3\u7801\u53d8\u66f4\u540e\uff0c\u4f60\u90fd\u53ef\u4ee5\u4e0b\u8f7d\u8be5\u6587\u4ef6\u8fdb\u884c\u6027\u80fd\u5bf9\u6bd4\uff0c\u68c0\u67e5\u662f\u5426\u5b58\u5728\u975e\u9884\u671f\u7684\u6027\u80fd\u8870\u9000\u3002</li> </ol> <p>Q4: YTracing \u4f1a\u4e0d\u4f1a\u6709\u660e\u663e\u7684\u6027\u80fd\u635f\u8017\uff1f</p> <p>A: YTracing \u7684\u6838\u5fc3\u8bbe\u8ba1\u76ee\u6807\u4e4b\u4e00\u5c31\u662f\u8f7b\u91cf\u5316\u3002\u5b83\u901a\u8fc7\u5f02\u6b65\u548c\u6279\u91cf\u5199\u5165\u6765\u6700\u5c0f\u5316 I/O \u5f00\u9500\u3002\u4f46\u9700\u8981\u660e\u786e\u7684\u662f\uff0c\u4efb\u4f55\u5f62\u5f0f\u7684\u8ffd\u8e2a\u90fd\u5fc5\u7136\u5b58\u5728\u5f00\u9500\u3002 \u6211\u7684\u5efa\u8bae\u662f\uff1a</p> <ul> <li>\u63a7\u5236\u7c92\u5ea6: \u4ec5\u5bf9\u4f60\u5173\u5fc3\u7684\u5173\u952e\u4ee3\u7801\u8def\u5f84\u5f00\u542f\u8ffd\u8e2a\uff0c\u907f\u514d\u5728\u7d27\u5bc6\u5faa\u73af\u5185\u90e8\u7b49\u6781\u5ea6\u9891\u7e41\u8c03\u7528\u7684\u5730\u65b9\u8fdb\u884c\u4e0d\u5fc5\u8981\u7684\u57cb\u70b9\u3002</li> <li>\u6309\u9700\u5f00\u542f: \u5728 Debug \u6216\u4e13\u95e8\u7684 Profiling \u6784\u5efa\u7c7b\u578b\u4e0b\u4f7f\u7528\u3002\u5bf9\u4e8e\u6700\u7ec8\u7684 Release \u7248\u672c\uff0c\u53ef\u4ee5\u901a\u8fc7 CMake \u9009\u9879\u5173\u95ed <code>TRACING</code> \u5b8f\uff0c\u5b9e\u73b0\u96f6\u6210\u672c\u90e8\u7f72\u3002</li> </ul>"},{"location":"projects/YTracing%EF%BC%9A%E5%83%8F%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0C%2B%2B%E4%BA%8B%E4%BB%B6%E8%BF%BD%E8%B8%AA%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/#_8","title":"\u603b\u7ed3\u4e0e\u5c55\u671b","text":"<p>YTracing \u63d0\u4f9b\u4e86\u4e00\u79cd\u4ecb\u4e8e\u201c\u624b\u52a8 <code>std::chrono</code> \u8ba1\u65f6\u201d\u548c\u201c\u91cd\u578b\u6027\u80fd\u5206\u6790\u5668\u201d\u4e4b\u95f4\u7684\u3001\u4f18\u96c5\u7684\u4e2d\u95f4\u65b9\u6848\u3002\u5b83\u8db3\u591f\u7b80\u5355\uff0c\u53ef\u4ee5\u968f\u65f6\u96c6\u6210\u5230\u4f60\u7684\u9879\u76ee\u4e2d\u8fdb\u884c\u5feb\u901f\u8c03\u8bd5\uff1b\u4e5f\u8db3\u591f\u5f3a\u5927\uff0c\u80fd\u901a\u8fc7 Perfetto UI \u63d0\u4f9b\u4e13\u4e1a\u7684\u65f6\u5e8f\u5206\u6790\u89c6\u56fe\u3002\u5b83\u7684\u201c\u53ef\u63d2\u62d4\u201d\u7279\u6027\u8ba9\u4f60\u53ef\u4ee5\u6beb\u65e0\u987e\u8651\u5730\u5728\u751f\u4ea7\u4ee3\u7801\u4e2d\u4fdd\u7559\u57cb\u70b9\uff0c\u53ea\u5728\u9700\u8981\u65f6\u5f00\u542f\uff0c\u771f\u6b63\u505a\u5230\u4e86\u201c\u96f6\u6210\u672c\u201d\u76d1\u63a7\u3002</p> <p>\u8fd9\u4e2a\u9879\u76ee\u76ee\u524d\u6258\u7ba1\u5728 GitHub \u4e0a\uff0c\u6211\u4eec\u6b22\u8fce\u4efb\u4f55\u5f62\u5f0f\u7684\u8d21\u732e\u2014\u2014\u65e0\u8bba\u662f\u63d0\u4ea4 Bug\u3001\u63d0\u51fa\u529f\u80fd\u5efa\u8bae\uff0c\u8fd8\u662f\u8d21\u732e\u4ee3\u7801\u3002\u5982\u679c\u4f60\u89c9\u5f97 YTracing \u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u8bf7\u7ed9\u5b83\u4e00\u4e2a Star\uff01</p> <p>\u7acb\u5373\u4f53\u9a8c YTracing\uff0c\u8ba9\u6027\u80fd\u5206\u6790\u53d8\u5f97\u524d\u6240\u672a\u6709\u7684\u7b80\u5355\uff01</p>"},{"location":"tags/","title":"Tags","text":""},{"location":"tags/#_1","title":"\ud83c\udff7\ufe0f \u6807\u7b7e\u7d22\u5f15","text":"<p>\u70b9\u51fb\u6807\u7b7e\u67e5\u770b\u5bf9\u5e94\u7684\u6587\u7ae0\u3002</p> <ul> <li>CLIP (1)</li> <li>DeepSeek (4)</li> <li>LLM (14)</li> <li>LoRA (1)</li> <li>Post Training (2)</li> <li>\u4f4d\u7f6e\u7f16\u7801 (2)</li> <li>\u591a\u6a21\u6001 (1)</li> <li>\u5e76\u884c\u8bad\u7ec3 (2)</li> <li>\u5f3a\u5316\u5b66\u4e60 (6)</li> <li>\u6570\u636e\u5de5\u7a0b (1)</li> <li>\u6a21\u578b\u91cf\u5316 (2)</li> </ul>"},{"location":"tags/clip/","title":"\u6807\u7b7e\uff1aCLIP","text":""},{"location":"tags/clip/#clip","title":"\u6807\u7b7e\uff1aCLIP","text":"<ul> <li>CLIP\uff1a\u591a\u6a21\u6001\u4e4b\u94a5</li> </ul>"},{"location":"tags/deepseek/","title":"\u6807\u7b7e\uff1aDeepSeek","text":""},{"location":"tags/deepseek/#deepseek","title":"\u6807\u7b7e\uff1aDeepSeek","text":"<ul> <li>DeepSeek-Coder\u5de5\u7a0b\u5316\u65b9\u6848</li> <li>DeepSeek-R1\uff1a\u901a\u8fc7\u5f3a\u5316\u5b66\u4e60\u6fc0\u52b1LLM\u63a8\u7406\u80fd\u529b</li> <li>DeepSeek-V3\u662f\u5982\u4f55\u70bc\u6210\u7684</li> <li>DeepSeekMath\u8bba\u6587\u7cbe\u8bfb</li> </ul>"},{"location":"tags/llm/","title":"\u6807\u7b7e\uff1aLLM","text":""},{"location":"tags/llm/#llm","title":"\u6807\u7b7e\uff1aLLM","text":"<ul> <li>CLIP\uff1a\u591a\u6a21\u6001\u4e4b\u94a5</li> <li>DeepSeek-Coder\u5de5\u7a0b\u5316\u65b9\u6848</li> <li>DeepSeek-R1\uff1a\u901a\u8fc7\u5f3a\u5316\u5b66\u4e60\u6fc0\u52b1LLM\u63a8\u7406\u80fd\u529b</li> <li>DeepSeek-V3\u662f\u5982\u4f55\u70bc\u6210\u7684</li> <li>DeepSeekMath\u8bba\u6587\u7cbe\u8bfb</li> <li>GRPO\u539f\u7406\u53ca\u76f8\u5173\u5bf9\u6bd4</li> <li>GradScaler\u7684\u6570\u5b66\u539f\u7406\u7b80\u8ff0</li> <li>LoRA\uff1a\u5927\u6a21\u578b\u7684\u4f4e\u79e9\u5bc6\u8bed</li> <li>PPO\u539f\u7406\u53ca\u907f\u5751\u6307\u5357</li> <li>Position Embedding\u4e4b\u6211\u89c1</li> <li>RoPE\uff1a\u76f8\u5bf9\u8ddd\u79bb\u611f\u77e5\u7684\u79d8\u5bc6</li> <li>ZeRO\u4f18\u5316\u5668\u8bbe\u8ba1\u7406\u5ff5\u89e3\u6790</li> <li>\u4e3a\u4f55FP16\u8bad\u7ec3\u65f6\u68af\u5ea6\u5bb9\u6613\u4e0b\u6ea2\u4e3a0\uff1f</li> <li>\u6807\u51c6\u6570\u636e\u5e76\u884c\uff08DP\uff09\u8bad\u7ec3\u6d41\u7a0b\u89e3\u6790</li> </ul>"},{"location":"tags/lora/","title":"\u6807\u7b7e\uff1aLoRA","text":""},{"location":"tags/lora/#lora","title":"\u6807\u7b7e\uff1aLoRA","text":"<ul> <li>LoRA\uff1a\u5927\u6a21\u578b\u7684\u4f4e\u79e9\u5bc6\u8bed</li> </ul>"},{"location":"tags/post-training/","title":"\u6807\u7b7e\uff1aPost Training","text":""},{"location":"tags/post-training/#post-training","title":"\u6807\u7b7e\uff1aPost Training","text":"<ul> <li>LoRA\uff1a\u5927\u6a21\u578b\u7684\u4f4e\u79e9\u5bc6\u8bed</li> <li>PPO\u539f\u7406\u53ca\u907f\u5751\u6307\u5357</li> </ul>"},{"location":"tags/%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81/","title":"\u6807\u7b7e\uff1a\u4f4d\u7f6e\u7f16\u7801","text":""},{"location":"tags/%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81/#_1","title":"\u6807\u7b7e\uff1a\u4f4d\u7f6e\u7f16\u7801","text":"<ul> <li>Position Embedding\u4e4b\u6211\u89c1</li> <li>RoPE\uff1a\u76f8\u5bf9\u8ddd\u79bb\u611f\u77e5\u7684\u79d8\u5bc6</li> </ul>"},{"location":"tags/%E5%A4%9A%E6%A8%A1%E6%80%81/","title":"\u6807\u7b7e\uff1a\u591a\u6a21\u6001","text":""},{"location":"tags/%E5%A4%9A%E6%A8%A1%E6%80%81/#_1","title":"\u6807\u7b7e\uff1a\u591a\u6a21\u6001","text":"<ul> <li>CLIP\uff1a\u591a\u6a21\u6001\u4e4b\u94a5</li> </ul>"},{"location":"tags/%E5%B9%B6%E8%A1%8C%E8%AE%AD%E7%BB%83/","title":"\u6807\u7b7e\uff1a\u5e76\u884c\u8bad\u7ec3","text":""},{"location":"tags/%E5%B9%B6%E8%A1%8C%E8%AE%AD%E7%BB%83/#_1","title":"\u6807\u7b7e\uff1a\u5e76\u884c\u8bad\u7ec3","text":"<ul> <li>ZeRO\u4f18\u5316\u5668\u8bbe\u8ba1\u7406\u5ff5\u89e3\u6790</li> <li>\u6807\u51c6\u6570\u636e\u5e76\u884c\uff08DP\uff09\u8bad\u7ec3\u6d41\u7a0b\u89e3\u6790</li> </ul>"},{"location":"tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/","title":"\u6807\u7b7e\uff1a\u5f3a\u5316\u5b66\u4e60","text":""},{"location":"tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/#_1","title":"\u6807\u7b7e\uff1a\u5f3a\u5316\u5b66\u4e60","text":"<ul> <li>DeepSeek-R1\uff1a\u901a\u8fc7\u5f3a\u5316\u5b66\u4e60\u6fc0\u52b1LLM\u63a8\u7406\u80fd\u529b</li> <li>DeepSeek-V3\u662f\u5982\u4f55\u70bc\u6210\u7684</li> <li>DeepSeekMath\u8bba\u6587\u7cbe\u8bfb</li> <li>GRPO\u539f\u7406\u53ca\u76f8\u5173\u5bf9\u6bd4</li> <li>PPO\u539f\u7406\u53ca\u907f\u5751\u6307\u5357</li> <li>\u878d\u6c47\u8d2f\u901aRL\u4e2d\u7684\u4ef7\u503c\u51fd\u6570\u4e0e\u4f18\u52bf\u51fd\u6570</li> </ul>"},{"location":"tags/%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8B/","title":"\u6807\u7b7e\uff1a\u6570\u636e\u5de5\u7a0b","text":""},{"location":"tags/%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8B/#_1","title":"\u6807\u7b7e\uff1a\u6570\u636e\u5de5\u7a0b","text":"<ul> <li>TFDS vs WebDataset</li> </ul>"},{"location":"tags/%E6%A8%A1%E5%9E%8B%E9%87%8F%E5%8C%96/","title":"\u6807\u7b7e\uff1a\u6a21\u578b\u91cf\u5316","text":""},{"location":"tags/%E6%A8%A1%E5%9E%8B%E9%87%8F%E5%8C%96/#_1","title":"\u6807\u7b7e\uff1a\u6a21\u578b\u91cf\u5316","text":"<ul> <li>GradScaler\u7684\u6570\u5b66\u539f\u7406\u7b80\u8ff0</li> <li>\u4e3a\u4f55FP16\u8bad\u7ec3\u65f6\u68af\u5ea6\u5bb9\u6613\u4e0b\u6ea2\u4e3a0\uff1f</li> </ul>"}]}